# dcf_valuator — 교수급 기업가치 평가 도구 가이드

## 이 도구는 뭔가요?
대학교 기업재무론 교수가 직접 분석하는 것처럼, **DCF(현금흐름할인법) + 상대가치 + 그레이엄 넘버 + 배당할인모형** 4가지 밸류에이션 모델을 한 번에 돌려서 "이 주식이 비싼지 싼지"를 정량적으로 판단해주는 도구입니다.
kr_stock의 `action=fundamental`이 현재 PER/PBR 숫자만 보여준다면, 이 도구는 그 숫자들을 **학술 모델에 넣어서 적정 주가를 계산**하고, 현재가 대비 저평가/고평가 판정까지 내립니다.

## kr_stock이나 technical_analyzer와 뭐가 다른가요?
| 항목 | kr_stock (fundamental) | technical_analyzer | dcf_valuator |
|------|----------------------|-------------------|-------------|
| 분석 관점 | 현재 재무 수치 나열 | 차트/기술적 지표 | **적정 주가 계산** |
| PER/PBR | 현재 값만 표시 | 사용 안 함 | 3년 평균과 비교 → 적정가 산출 |
| DCF 모델 | 없음 | 없음 | **10년 현금흐름 할인 + 영구가치** |
| 그레이엄 넘버 | 없음 | 없음 | **sqrt(22.5 x EPS x BPS)** 안전마진 계산 |
| 배당할인모형 | 없음 | 없음 | **Gordon Growth Model** (배당주 전용) |
| 민감도 분석 | 없음 | 없음 | **성장률 x 할인율 매트릭스** |
| AI 종합 판단 | 없음 | 매매 점수 (0~100) | 저평가/고평가 판정 + 괴리율(%) |

**한 줄 요약**: kr_stock은 "지금 PER이 몇 배야?", technical_analyzer는 "차트상 사도 돼?", dcf_valuator는 **"이 회사의 진짜 가치가 얼마야?"**

## 어떤 기술을 쓰나요?
- **pykrx** — 한국거래소 펀더멘털 데이터 (PER, PBR, EPS, BPS, DPS, DIV, 시가/종가)
- **numpy** — DCF 할인 계산, 통계 처리
- **pandas** — 3년/5년 시계열 데이터 처리, 연간 리샘플링
- **LLM 분석** — Aswath Damodaran 교수 수준의 종합 해설 생성
- **학술 모델**: DCF (Damodaran), Graham Number (Graham & Dodd), Gordon Growth Model (1962)
- 비용: **주식 데이터 무료** + LLM 호출 비용 (GPT-5.2 기준 약 $0.01/분석)

## 사용법

### action=full (전체 가치평가 종합) — 가장 많이 쓰게 될 액션
```
action=full, name="삼성전자"
```
- DCF 적정가 + 그레이엄 넘버 + 배당할인 적정가 + PER/PBR 상대가치를 **한 번에** 계산
- 모든 모델의 평균 적정가를 구하고, 현재가 대비 **괴리율(%)**을 산출
- 마지막에 LLM이 Damodaran 교수 수준의 종합 매수 판단을 덧붙임
- 출력 예시:
  - DCF 적정가: 82,000원 (▲ 14.5% 저평가)
  - 그레이엄 넘버: 76,500원 (▲ 6.8% 저평가)
  - 모델 평균 적정가: 79,200원 / 괴리율: +10.5% (저평가)

### action=dcf (DCF 모델)
```
action=dcf, name="카카오"
```
계산 과정:
| 단계 | 설명 | 상세 |
|------|------|------|
| 1. EPS 추출 | 최근 주당순이익 | pykrx 펀더멘털에서 추출 |
| 2. 성장률 추정 | 연간 EPS 복합성장률 | 3년 데이터 기반, -10%~+30% 클램프 |
| 3. 5년 고성장 | 추정 성장률로 FCF 계산 | 1~5년차 |
| 4. 5년 체감 | 성장률이 영구성장률(2%)로 수렴 | 6~10년차 |
| 5. 영구가치 | Terminal Value 계산 | FCF x (1+g) / (r-g) |
| 6. 현재가치 할인 | 할인율 10%로 할인 | 각 연도 FCF / (1+r)^n |
- EPS가 음수인 종목은 DCF 계산 불가 (적자 기업)
- 연도별 EPS 추이도 함께 출력

### action=relative (상대가치 분석)
```
action=relative, name="NAVER"
```
분석 항목:
| 지표 | 뭔가요? | 활용법 |
|------|--------|--------|
| 현재 PER | 주가 / 주당순이익 | 현재 몇 배를 지불하고 있나 |
| 3년 평균 PER | 최근 3년 PER 평균 | 과거 대비 비싼지 싼지 비교 |
| PER 기준 적정가 | EPS x 3년 평균 PER | "과거 수준이면 얼마여야 하나" |
| 현재 PBR | 주가 / 주당순자산 | 자산 대비 몇 배 |
| 3년 평균 PBR | 최근 3년 PBR 평균 | 자산가치 기준 비교 |
| PBR 기준 적정가 | BPS x 3년 평균 PBR | 자산가치 기준 적정가 |
- PER 0인 날은 자동 제외 (비정상 데이터)

### action=graham (그레이엄 넘버) — 가치투자자 필수 액션
```
action=graham, name="현대차"
```
- **공식**: 그레이엄 넘버 = sqrt(22.5 x EPS x BPS)
- Benjamin Graham의 보수적 내재가치 공식으로, **안전마진(Margin of Safety)**을 중시하는 가치투자 관점
- 출력:
  - 그레이엄 넘버: 185,000원
  - 안전마진: +25.3%
  - 판정: "충분한 안전마진 확보 (가치투자 관점 매수 적격)"
- 안전마진 해석:
  - +30% 이상 → 충분한 안전마진 (매수 적격)
  - 0%~+30% → 소폭 저평가 (추가 분석 필요)
  - 음수 → 그레이엄 기준 고평가 (부적합)
- EPS 또는 BPS가 음수이면 계산 불가

### action=ddm (배당할인모형) — 배당주 전용
```
action=ddm, name="KT&G"
```
- **Gordon Growth Model**: P = DPS x (1+g) / (r-g)
  - DPS: 주당 배당금
  - g: 배당 성장률 (연간 DPS 복합성장률, 0%~15% 클램프)
  - r: 요구수익률 10% (고정)
- 배당을 지급하지 않는 종목은 "DDM 적용 불가" 메시지 출력
- 배당수익률, 배당 성장률 추이도 함께 표시

### action=sensitivity (민감도 분석) — 시나리오별 적정가 매트릭스
```
action=sensitivity, name="삼성전자"
```
- 성장률(2%/5%/8%/10%/15%) x 할인율(8%/10%/12%/15%) = **20가지 시나리오** 매트릭스
- 각 칸에 DCF 적정가 + 현재가 대비 괴리율(%) 표시
- "낙관적 시나리오에서는 +45%, 비관적에서는 -20%" 같은 범위를 한눈에 파악
- LLM이 가장 합리적인 시나리오를 추천

---

## 이 도구를 쓰는 에이전트들

### 1. CIO (투자분석처장)
**언제 쓰나?** 매수/매도 결정의 핵심 근거를 마련할 때
**어떻게 쓰나?**
- `action=full`로 전체 밸류에이션 한 번에 확인
- `action=sensitivity`로 시나리오별 리스크 파악

**실전 시나리오:**
> CEO가 "카카오 지금 살 만해?" 라고 물으면:
> 1. `dcf_valuator action=full, name="카카오"` → DCF/그레이엄/PER/PBR 종합 적정가
> 2. `dcf_valuator action=sensitivity, name="카카오"` → 성장률별 적정가 범위
> 3. `technical_analyzer action=signal, name="카카오"` → 기술적 매매 점수
> 4. 종합 판단: "가치 기준 15% 저평가이나, 기술적으로 아직 하락 추세. 39,000원 이하에서 분할 매수 추천"

### 2. 종목분석 Specialist
**언제 쓰나?** CIO가 지시한 종목을 심층 가치분석할 때
**어떻게 쓰나?**
- `action=dcf` → EPS 기반 내재가치 산출
- `action=relative` → PER/PBR 밴드 분석으로 역사적 위치 파악
- `action=graham` → 보수적 안전마진 확인

**실전 시나리오:**
> CIO가 "삼성SDI 가치분석 해줘" 라고 지시하면:
> 1. `action=relative` → 현재 PER 25배, 3년 평균 18배 → PER 기준 38% 고평가
> 2. `action=dcf` → EPS 성장률 12%, DCF 적정가 420,000원 → 현재가 대비 5% 저평가
> 3. `action=graham` → 그레이엄 넘버 380,000원, 안전마진 -10% → 그레이엄 기준 고평가
> 4. 보고: "DCF 기준 소폭 저평가이나, PER 밴드/그레이엄 모두 고평가. 성장 기대가 현재 가격에 이미 반영된 상태. 380,000원 이하 조정 시 매수 고려"

---

## 파라미터 정리

| 파라미터 | 필수 | 타입 | 설명 |
|---------|------|------|------|
| action | O | string | full/dcf/relative/graham/ddm/sensitivity |
| name | X | string | 종목명 (예: "삼성전자"). name 또는 ticker 중 하나 필요 |
| ticker | X | string | 종목코드 (예: "005930"). name 또는 ticker 중 하나 필요 |

## 주의사항
- **장 마감 후 데이터 기준**입니다. 실시간 호가가 아닙니다.
- **EPS가 음수(적자)인 종목**은 DCF, 그레이엄 넘버 계산이 불가합니다. 상대가치(PBR)만 참고하세요.
- **배당을 안 주는 종목**은 DDM(배당할인모형) 적용이 불가합니다.
- 성장률은 **-10%~+30%** 범위로 자동 제한(클램프)됩니다. 극단적 성장 추정을 방지하기 위함입니다.
- 할인율 기본값 **10%**는 한국 주식시장의 일반적인 요구수익률입니다.
- 3년 펀더멘털 + 5년 가격 데이터를 사용합니다. 상장한 지 3년 미만인 종목은 데이터 부족으로 분석이 제한될 수 있습니다.
- DCF는 **미래 예측**이므로 100% 정확하지 않습니다. 반드시 민감도 분석(sensitivity)으로 시나리오 범위를 확인하세요.
- 종목명으로 검색 시 pykrx의 ticker 변환을 사용합니다. 정확한 종목명을 입력하세요.
- LLM 분석이 포함되는 액션(full, dcf, relative, sensitivity)은 응답 시간이 약간 더 걸립니다.
