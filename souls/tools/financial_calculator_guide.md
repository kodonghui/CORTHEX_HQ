# financial_calculator — 재무 계산기 도구 가이드

## 이 도구는 뭔가요?
투자와 사업에 필요한 재무 계산을 자동으로 해주는 도구입니다. 기업 가치 평가(DCF), 투자 수익률(NPV/IRR/ROI), 대출 상환 시뮬레이션, 손익분기점 분석까지 — 엑셀에서 복잡한 수식을 짜지 않아도 파라미터만 입력하면 바로 결과가 나옵니다.

## 어떤 API를 쓰나요?
- **numpy-financial** (재무 수학 계산 라이브러리)
- **numpy** (수치 계산 라이브러리)
- 비용: **무료** (외부 API 호출 없음, 서버 내 계산)
- 필요한 키: 없음

## 사용법

### action=dcf (기업가치 평가 — DCF)
```
action=dcf, cashflows="100,110,120,130,140", discount_rate=0.1, terminal_growth=0.02
```
- DCF(Discounted Cash Flow, 할인현금흐름)로 기업의 적정 가치를 계산합니다.
- 쉽게 말하면: "이 회사가 앞으로 벌어올 돈을 현재 가치로 환산하면 얼마인가?"
- 연도별 현금흐름의 현재가치 + 터미널 가치(Terminal Value, 예측 기간 이후 영구 가치)를 합산합니다.

**파라미터:**
| 파라미터 | 설명 | 기본값 |
|---------|------|--------|
| cashflows | 예상 미래 현금흐름 리스트 (억원 등) | (필수) |
| discount_rate | 할인율 (예: 0.1 = 10%) | 0.1 |
| terminal_growth | 영구성장률 (예: 0.02 = 2%) | 0.02 |

**예시:**
- `action=dcf, cashflows="100,110,120,130,140", discount_rate=0.1` → 5년 현금흐름 기반 기업가치

### action=npv (순현재가치 — NPV)
```
action=npv, cashflows="-1000,300,400,500,200", rate=0.1
```
- NPV(Net Present Value)를 계산합니다. "이 투자를 하면 이득인가 손해인가?"를 판단합니다.
- 첫 번째 값은 초기 투자금(음수), 이후는 매년 수익입니다.
- NPV > 0이면 투자 가치 있음, NPV < 0이면 투자 부적합.

**파라미터:**
| 파라미터 | 설명 | 기본값 |
|---------|------|--------|
| cashflows | 현금흐름 리스트 (첫 값은 투자금, 음수) | (필수) |
| rate | 할인율 | 0.1 |

**예시:**
- `action=npv, cashflows="-5000,1500,2000,2500,1000", rate=0.08` → 5000만원 투자, 4년간 수익 발생 시 NPV

### action=irr (내부수익률 — IRR)
```
action=irr, cashflows="-1000,300,400,500,200"
```
- IRR(Internal Rate of Return)을 계산합니다. "이 투자의 실질 수익률이 몇 %인가?"
- IRR이 기준수익률(hurdle_rate)보다 높으면 투자 가치 있음.

**파라미터:**
| 파라미터 | 설명 | 기본값 |
|---------|------|--------|
| cashflows | 현금흐름 리스트 (첫 값은 투자금, 음수) | (필수) |
| hurdle_rate | 기준수익률 (비교용) | 0.1 |

**예시:**
- `action=irr, cashflows="-10000,3000,4000,5000,3000"` → 1억 투자의 실질 수익률 계산

### action=loan (대출 상환 시뮬레이션)
```
action=loan, principal=100000000, annual_rate=0.05, years=30, method="equal_payment"
```
- 대출 원금, 이자율, 기간을 입력하면 월별 상환 스케줄을 생성합니다.
- 원리금균등(매달 같은 금액)과 원금균등(매달 원금은 같고 이자는 줄어듦) 두 가지 방식을 지원합니다.

**파라미터:**
| 파라미터 | 설명 | 기본값 |
|---------|------|--------|
| principal | 대출 원금 | (필수) |
| annual_rate | 연 이자율 (예: 0.05 = 5%) | (필수) |
| years | 대출 기간 (년) | (필수) |
| method | "equal_payment"(원리금균등) / "equal_principal"(원금균등) | "equal_payment" |

**예시:**
- `action=loan, principal=300000000, annual_rate=0.04, years=30` → 3억원 30년 주택담보대출 시뮬레이션

### action=roi (투자 수익률 — ROI/CAGR)
```
action=roi, initial=10000000, final=15000000, years=3
```
- 단순 ROI(총 수익률)와 CAGR(연평균 성장률)을 계산합니다.
- "1000만원 넣어서 1500만원 됐으면, 연간 수익률이 몇 %?"

**파라미터:**
| 파라미터 | 설명 | 기본값 |
|---------|------|--------|
| initial | 초기 투자금 | (필수) |
| final | 최종 가치 | (필수) |
| years | 투자 기간 (년) | 1 |

**예시:**
- `action=roi, initial=50000000, final=80000000, years=5` → 5000만원 → 8000만원, 5년간 수익률

### action=breakeven (손익분기점 분석)
```
action=breakeven, fixed_cost=5000000, variable_cost_per_unit=3000, price_per_unit=10000
```
- 손익분기점(BEP, Break-Even Point)을 계산합니다. "몇 개 팔아야 본전?"
- 고정비, 단위당 변동비, 판매가를 입력하면 손익분기 수량과 매출을 계산합니다.

**파라미터:**
| 파라미터 | 설명 | 기본값 |
|---------|------|--------|
| fixed_cost | 고정비 (임대료, 인건비 등) | (필수) |
| variable_cost_per_unit | 단위당 변동비 | (필수) |
| price_per_unit | 단위당 판매가 | (필수) |

**예시:**
- `action=breakeven, fixed_cost=10000000, variable_cost_per_unit=5000, price_per_unit=15000` → 월 고정비 1000만원일 때 손익분기점

## 이 도구를 쓰는 에이전트들

### 1. 투자분석처장 (CIO)
**언제 쓰나?** 종목 분석 시 기업 가치를 수치로 평가할 때
**어떻게 쓰나?**
- DCF로 기업의 적정 주가 계산
- ROI로 투자 성과 추적

### 2. 종목분석 Specialist
**언제 쓰나?** 종목의 내재가치(적정 가격)를 산출할 때
**어떻게 쓰나?**
- dart_api로 재무제표에서 현금흐름 데이터를 가져온 후
- DCF로 적정 기업가치 → 적정 주가 산출
- 현재 주가와 비교하여 저평가/고평가 판단

**실전 시나리오:**
> CEO가 "삼성전자 적정가가 얼마야?" 라고 하면:
> 1. dart_api로 삼성전자 최근 5년 잉여현금흐름(FCF) 조회
> 2. `action=dcf, cashflows="20000,22000,24000,26000,28000", discount_rate=0.1` 로 기업가치 계산
> 3. 기업가치를 발행주식수로 나눠서 적정 주가 산출
> 4. "적정 주가 약 78,000원, 현재가 75,000원 — 약 4% 저평가" 보고

### 3. 사업기획처장 (CSO)
**언제 쓰나?** 사업 타당성을 재무적으로 검증할 때
**어떻게 쓰나?**
- NPV/IRR로 신규 사업 투자 가치 판단
- breakeven으로 사업 생존 가능성 확인

### 4. 사업계획서 Specialist
**언제 쓰나?** 사업계획서에 재무 모델을 포함할 때
**어떻게 쓰나?**
- breakeven으로 손익분기점 산출
- NPV/IRR로 투자 수익 전망 수치화

### 5. 재무모델링 Specialist
**언제 쓰나?** 재무 모델 구축 및 시나리오 분석 시
**어떻게 쓰나?**
- DCF 3시나리오(보수/기본/낙관) 각각 계산
- ROI/CAGR로 과거 투자 성과 추적

### 6. 리스크관리 Specialist
**언제 쓰나?** VaR(위험가치) 계산이나 포트폴리오 리스크 분석 시
**어떻게 쓰나?**
- DCF로 기업가치 범위 산출 (할인율 변경하여 민감도 분석)
- ROI로 포트폴리오 성과 추적

## 주의사항
- DCF 결과는 **입력한 현금흐름 추정치에 크게 의존**합니다. "쓰레기를 넣으면 쓰레기가 나온다(GIGO)" — 현금흐름 추정이 잘못되면 결과도 틀립니다.
- 할인율(discount_rate)과 영구성장률(terminal_growth)의 차이가 작을수록 터미널 가치가 비정상적으로 커집니다. 영구성장률은 GDP 성장률(2~3%)을 넘지 않는 것이 일반적입니다.
- 대출 시뮬레이션에서 **중도상환 수수료, 변동금리**는 반영되지 않습니다.
- numpy-financial 라이브러리가 서버에 설치되어 있어야 합니다.
