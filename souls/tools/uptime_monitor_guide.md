# uptime_monitor — 웹사이트 상태 모니터 도구 가이드

## 이 도구는 뭔가요?
우리 회사 웹사이트나 서비스가 잘 돌아가고 있는지 자동으로 확인하는 도구입니다.
등록된 웹사이트에 접속을 시도해서 정상 응답이 오는지, 응답 속도가 느리지는 않은지 측정하고,
다운(접속 불가)된 사이트를 빠르게 감지하여 보고합니다.

## 어떤 API를 쓰나요?
- **HTTP HEAD 요청** (httpx 라이브러리)
- 등록된 URL에 직접 접속하여 상태 코드(200 = 정상)와 응답 시간을 측정합니다
- 비용: **무료** (외부 API 사용 없음, 직접 접속 방식)
- 필요한 키: 없음

## 사용법

### action=add (모니터링 대상 사이트 추가)
```
action=add, url="https://corthex-hq.com", name="CORTHEX HQ", expected_status=200
```
- 모니터링할 웹사이트를 목록에 추가합니다
- `url`: 감시할 웹사이트 주소 (필수)
- `name`: 사이트 이름 (선택, 없으면 URL을 이름으로 사용)
- `expected_status`: 정상일 때 기대하는 상태 코드 (기본값: 200)

**예시:**
- `action=add, url="https://corthex-hq.com", name="우리 서비스"` → CORTHEX HQ를 감시 목록에 추가

### action=remove (모니터링 대상 사이트 제거)
```
action=remove, url="https://corthex-hq.com"
```
- 감시 목록에서 해당 URL을 제거합니다
- `url`: 제거할 웹사이트 주소 (필수)

### action=check (등록된 모든 사이트 상태 즉시 확인)
```
action=check
```
- 등록된 모든 사이트에 접속을 시도하고 결과를 보여줍니다
- 각 사이트별로 상태(정상/장애), 응답 속도를 표시합니다
- 응답 시간이 2초 이상이면 "느림 경고"를 표시합니다
- 결과는 이력(history)으로 자동 저장됩니다

**예시:**
- `action=check` → "CORTHEX HQ - 200 OK (응답: 0.35초)" 형태로 전체 결과 반환

### action=list (모니터링 목록 조회)
```
action=list
```
- 현재 등록된 모니터링 대상 목록을 보여줍니다
- 사이트 이름, URL, 기대 상태 코드, 등록일을 표시합니다

### action=history (특정 사이트의 응답 시간 이력 조회)
```
action=history, url="https://corthex-hq.com", hours=24
```
- 특정 사이트의 최근 N시간 이력을 분석합니다
- `url`: 확인할 사이트 주소 (필수)
- `hours`: 조회할 시간 범위 (기본값: 24시간)
- 가용률(uptime), 평균/최소/최대 응답시간, 장애 발생 횟수를 보여줍니다

**예시:**
- `action=history, url="https://corthex-hq.com", hours=48` → 최근 48시간 동안의 가용률, 평균 응답시간 등 통계

## 이 도구를 쓰는 에이전트들

### 1. 기술개발처장 (CTO)
**언제 쓰나?** 서비스 상태 전체를 점검하거나, CEO에게 가동 현황을 보고할 때
**어떻게 쓰나?**
- 주기적으로 `action=check`로 전체 사이트 상태 확인
- 장애 발생 시 `action=history`로 언제부터 문제가 있었는지 추적

**실전 시나리오:**
> CEO가 "사이트 잘 되고 있어?" 라고 하면:
> 1. `action=check`로 전체 사이트 상태 확인
> 2. 문제 있는 사이트가 있으면 `action=history`로 장애 이력 분석
> 3. 가동률/응답 속도를 포함한 보고서 작성

### 2. DB/인프라 Specialist
**언제 쓰나?** 서버 인프라 점검 시, 배포 후 사이트 정상 동작 확인 시
**어떻게 쓰나?**
- 배포 후 `action=check`로 서비스 정상 확인
- `action=add`로 새 서비스 URL을 감시 목록에 등록
- `action=history`로 가용률(SRE Error Budget) 추적

**실전 시나리오:**
> 새 서비스를 배포한 후:
> 1. `action=add, url="https://새서비스.com"`으로 감시 등록
> 2. `action=check`로 즉시 상태 확인
> 3. 가용률이 99.9% 미만이면 원인 조사 시작

## 주의사항
- 모니터링 목록과 이력은 `data/` 폴더에 JSON으로 저장됩니다 (배포 시 초기화될 수 있음)
- 이력은 사이트당 최대 1,000건까지 보관됩니다
- 응답 시간 2초 이상이면 자동으로 "느림 경고"가 표시됩니다
- HEAD 요청(가벼운 요청)으로 측정하므로 실제 페이지 로딩 시간과 차이가 있을 수 있습니다
- 서버 자체에서 실행되므로 네트워크 위치에 따라 응답 시간이 달라질 수 있습니다
