# sector_rotator — 업종 순환 분석 도구 가이드

## 이 도구는 뭔가요?
Sam Stovall(S&P 500 업종 순환 이론의 대가)처럼 **"지금 돈이 어디로 몰리고 있나? 다음 강세 업종은?"**을 분석해주는 도구입니다.
KOSPI 시가총액 상위 50개 종목의 기간별 수익률을 추적하고, 업종별 모멘텀을 비교하며, 경기 사이클에 따른 로테이션 전략을 제시합니다.

## kr_stock이나 technical_analyzer와 뭐가 다른가요?
| 항목 | kr_stock | technical_analyzer | sector_rotator |
|------|---------|-------------------|---------------|
| 분석 단위 | **종목 1개** | **종목 1개** | **시장 전체 (50종목)** |
| 업종별 수익률 순위 | 없음 | 없음 | **1개월/3개월 기간별 순위** |
| 강세/약세 업종 분류 | 없음 | 없음 | **TOP 10 / BOTTOM 10** |
| 모멘텀 점수 | 없음 | RSI 등 개별 지표 | **수익률 + 거래량변화 종합** |
| 경기 사이클 판단 | 없음 | 없음 | **LLM 기반 현재 국면 진단** |
| 종목 vs KOSPI 비교 | 없음 | 없음 | **1/3/6개월 초과수익률(알파)** |

## 어떤 기술을 쓰나요?
- **pykrx** — 한국거래소 시가총액, OHLCV, KOSPI 지수 데이터
- **시가총액 기준 업종 분류** — KOSPI 시총 상위 50개 종목을 추출하여 업종별 성과 분석
- **모멘텀 점수** — 수익률 + 거래량 변화율(x0.3 가중치)을 합산한 복합 점수
- **LLM 분석** — full과 rotation 액션에서 교수급 업종 순환 해설 생성
- 비용: **주식 데이터 무료** + LLM 호출 비용 (full/rotation만, 약 $0.01/분석)

---

## 사용법

### action=full (전체 업종 종합 분석) — 가장 많이 쓰게 될 액션
```
action=full
action=full, days=90
```
- KOSPI 시가총액 상위 50개 종목의 **1개월/3개월 수익률**을 계산
- 3개월 수익률 기준으로 전체 순위를 매기고, 상위 30종목 표시
- **강세 TOP 10 / 약세 BOTTOM 10** 분류
- LLM이 업종 순환 이론에 기반한 교수급 해설 + 업종 배분 전략 제안

**출력 예시:**
```
순위   종목    |  1개월  |  3개월
  1.  한미반도체 | +18.3% | +45.2%
  2.  HD현대일렉 | +12.1% | +38.7%
  ...
 30.  LG화학    |  -5.2% | -12.1%

강세 TOP 10: 한미반도체, HD현대일렉, ...
약세 BOTTOM 10: LG화학, ...
```

### action=ranking (업종별 수익률 순위)
```
action=ranking
```
- full과 동일한 데이터를 제공합니다 (현재 내부적으로 full과 같은 로직)
- 빠르게 "지금 뭐가 오르고 있나?" 확인할 때 사용

### action=momentum (업종 모멘텀 분석) — "자금이 어디로 흘러가고 있나?"
```
action=momentum
```
분석 항목:
| 지표 | 뭔가요? | 활용법 |
|------|--------|--------|
| 1개월 수익률 | 최근 30일간 주가 상승/하락률 | 단기 추세 파악 |
| 거래량 변화율 | 최근 5일 평균 거래량 / 전체 30일 평균 | 양수 = 관심 증가, 음수 = 관심 감소 |
| 모멘텀 점수 | 수익률 + (거래량변화 x 0.3) | **종합 모멘텀 — 수익률도 오르고 거래량도 증가하면 높은 점수** |

- KOSPI 시총 상위 **30종목** 대상
- "수익률은 오르는데 거래량도 같이 늘어나는 종목" = 진짜 강세 (거품 아님)
- "수익률은 오르는데 거래량이 줄어드는 종목" = 상승 피로 (주의)

**모멘텀 점수 공식:** `점수 = 수익률(%) + 거래량변화율(%) x 0.3`

### action=rotation (업종 순환 사이클 판단) — "지금 경기가 어느 국면인가?"
```
action=rotation
```
Sam Stovall의 업종 순환 이론을 기반으로 **현재 경기 국면**을 판단합니다.

경기 사이클별 유리한 업종:
| 국면 | 뭔가요? | 유리한 업종 |
|------|--------|-----------|
| 회복기 (Recovery) | 경기 바닥을 찍고 올라오는 시기 | 금융, 부동산, 경기소비재 |
| 확장기 (Expansion) | 경기가 성장하는 시기 | IT/반도체, 산업재, 소재 |
| 과열기 (Late Cycle) | 경기 정점에 가까운 시기 | 에너지, 소재, 필수소비재 |
| 침체기 (Recession) | 경기가 수축하는 시기 | 필수소비재, 유틸리티, 헬스케어 |

- LLM이 한국 경제 현황(금리, 환율, GDP, 수출 등)을 종합하여 **현재 국면을 진단**
- 유리한 업종 / 불리한 업종을 **구체적으로 제시**
- 데이터 기반이 아닌 **LLM 지식 기반** 분석이므로 참고용으로 활용

### action=compare (종목 vs KOSPI 비교) — "이 종목이 시장보다 잘하고 있나?"
```
action=compare, name="삼성전자"
action=compare, name="카카오"
```
분석 항목:
| 기간 | 비교 내용 | 의미 |
|------|---------|------|
| 1개월 | 종목 수익률 vs KOSPI 수익률 | 단기 상대 강도 |
| 3개월 | 종목 수익률 vs KOSPI 수익률 | 중기 상대 강도 |
| 6개월 | 종목 수익률 vs KOSPI 수익률 | 장기 상대 강도 |

- **초과수익률(알파)** = 종목 수익률 - KOSPI 수익률
- 알파가 양수 = 시장보다 잘하고 있음 (아웃퍼폼)
- 알파가 음수 = 시장보다 못하고 있음 (언더퍼폼)

**출력 예시:**
```
1개월: 삼성전자 +3.2% / KOSPI +1.5% / 초과수익 +1.7%
3개월: 삼성전자 +8.1% / KOSPI +5.3% / 초과수익 +2.8%
6개월: 삼성전자 -2.0% / KOSPI +3.1% / 초과수익 -5.1%
```

---

## 이 도구를 쓰는 에이전트들

### 1. CIO (투자분석처장)
**언제 쓰나?** 업종 배분 전략을 세울 때, 포트폴리오 리밸런싱 시점을 판단할 때
**어떻게 쓰나?**
- `action=full`로 시장 전체 강세/약세 업종 파악
- `action=rotation`으로 현재 경기 국면에 맞는 업종 확인
- `action=compare`로 보유 종목이 시장 대비 괜찮은지 점검

**실전 시나리오:**
> CEO가 "요즘 시장 분위기 어때? 어디에 투자하면 좋을까?" 라고 물으면:
> 1. `sector_rotator action=full` → 시총 상위 50종목 순위 확인
> 2. 결과: 반도체/IT 종목이 TOP 10 독점, 금융/에너지는 BOTTOM
> 3. `sector_rotator action=rotation` → 현재 확장기 초중반 → IT/반도체 유리
> 4. `sector_rotator action=momentum` → 한미반도체, SK하이닉스 모멘텀 점수 최상위
> 5. 보고: "현재 확장기 국면으로 IT/반도체 섹터가 강세. 시총 상위 50종목 중 반도체 관련주가 3개월 수익률 TOP 10 독점. 모멘텀 점수도 최상위. 반도체 비중 확대를 추천합니다. 반면 금융/에너지는 약세 전환 중이므로 비중 축소 권장."

### 2. 시황분석 Specialist
**언제 쓰나?** CIO에게 시장 현황 브리핑을 준비할 때, 업종별 자금 흐름을 추적할 때
**어떻게 쓰나?**
- `action=momentum`으로 자금 유입 업종 탐지
- `action=compare`로 CIO가 관심 있는 종목의 상대 강도 분석
- `action=full`로 주간 시황 보고서용 데이터 수집

**실전 시나리오:**
> CIO가 "카카오 계속 들고 있어도 될까?" 라고 지시하면:
> 1. `sector_rotator action=compare, name="카카오"` → 1개월 -5%, KOSPI +2%, 알파 -7%
> 2. `sector_rotator action=momentum` → 카카오 모멘텀 점수 하위 5 (거래량도 감소)
> 3. `sector_rotator action=full` → 카카오가 속한 플랫폼/IT서비스 약세, 반도체만 강세
> 4. 보고: "카카오는 1/3/6개월 모두 KOSPI 대비 언더퍼폼. 모멘텀 점수 하위 5위. 같은 IT 내에서도 반도체만 강세이고 플랫폼은 약세. 포지션 축소를 권장하며, 전환 시 반도체 섹터가 현재 모멘텀 최상위입니다."

---

## 파라미터 정리

| 파라미터 | 필수 | 타입 | 설명 |
|---------|------|------|------|
| action | O | string | full / ranking / momentum / rotation / compare |
| name | X | string | 종목명. **compare 액션에서만 필수** (예: "삼성전자") |
| days | X | integer | 분석 기간 (기본값: full/ranking=30+90일 조합, momentum=30일, compare=30/90/180일 자동) |

## 주의사항
- **장 마감 후 데이터 기준**입니다. 실시간 데이터가 아닙니다.
- full/ranking은 시총 상위 **50종목**, momentum은 상위 **30종목**을 조회합니다. pykrx API를 종목 수만큼 호출하므로 **응답 시간이 30초~1분** 걸릴 수 있습니다.
- pykrx의 업종 지수 API(`get_index_ohlcv_by_date`)가 실패할 경우, 자동으로 **시가총액 기반 대안 방식**으로 전환합니다. 결과는 업종 지수가 아닌 개별 종목 수준입니다.
- rotation 액션은 **pykrx 데이터 없이 LLM 지식만으로** 경기 국면을 판단합니다. 참고용이며 절대적 기준이 아닙니다.
- compare 액션에서 `name` 파라미터를 빼면 에러가 납니다. 반드시 비교할 종목명을 넣으세요.
- KOSPI 종목만 지원합니다. 코스닥 업종 분석은 별도의 도구가 필요합니다.
