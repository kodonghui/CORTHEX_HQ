# Quality Rubric — AI 에이전트 품질 검수 패턴

> CORTHEX HQ 운영에서 검증된 AI 출력물 품질 검수 설계.
> 새 프로젝트에서 AI 에이전트 품질을 관리할 때 복사해서 쓸 것.

---

## 핵심 교훈 — "ID를 써야 한다"

### 문제: D1 채점 시 전수검사 루프

AI 에이전트를 "D1 (논리적 연결 부족)" 기준으로 재검수 지시하면,
AI는 **모든 항목을 처음부터 다시 채점**해버린다.

→ 결과: 통과했던 항목이 뒤집힘, 점수 일관성 없음, 무한 루프

### 해결: ID(Individual Discrimination) 방식

- 재검수 시 **반려된 항목의 ID만 명시**해서 넘긴다
- "D1 반려된 종목분석가(id: spec_002)만 재평가"
- 통과한 항목은 건드리지 않음

```python
# 잘못된 방식 ❌
"D1 기준 미달이니 전체 재검수"

# 올바른 방식 ✅
targeted_hybrid_review(failed_ids=["spec_002", "spec_004"])
```

---

## 루브릭 구조 — 5개 기준

CORTHEX에서 검증된 채점 기준. 도메인에 맞게 이름만 바꿔서 쓸 것.

| 코드 | 기준 | 점수 | 내용 |
|------|------|------|------|
| D1 | 논리 연결 | 필수 | 결론과 데이터 간 인과관계가 명확한가 |
| Q2 | 균형 시나리오 | 1점 | 긍정/부정 양면 시나리오가 있는가 |
| Q3 | 수치화 | 1점 | 리스크/기회를 숫자로 표현했는가 |
| Q4 | 실행 전략 | 1점 | 구체적 행동 지침이 있는가 |
| Q5 | 출처 투명성 | 1점 | 데이터 출처를 밝혔는가 |

- **D1 미충족 = 즉시 반려** (나머지 Q는 채점 안 함)
- **Q 합산 3점 이상 = 통과**

---

## 설계 원칙

### 1. 채점자는 별도 에이전트
보고서 작성자가 자기 글을 채점하면 안 됨.
QA 에이전트는 작성자와 **완전히 분리**된 독립 판정관.

### 2. 블라인드 채점
채점 시 작성자 이름/소속 숨김 → 내용만으로 판단.

### 3. 재작업 시 이전 보고서 첨부
재작업 지시 시 원본 보고서 전문을 함께 전달.
"정확했던 수치는 변경 금지" 명시.

### 4. 반려 사유 → 즉시 학습
반려 사유를 `warnings` 카테고리에 저장 → 다음 호출 시 자동 주입.
같은 실수 반복 방지.

---

## 경계값 주의사항

- D1 기준을 너무 좁게 쓰면 → 모든 보고서 반려 (기준 조정 필요)
- D1 기준을 너무 넓게 쓰면 → 허위합격 (의미없는 QA)
- 검증: 첫 배포 후 통과율 30~70% 나오면 기준이 적절한 것

---

## NEXUS 캔버스와 연계

품질 루브릭 결과를 NEXUS 캔버스에 시각화하면
"어떤 에이전트가 어떤 기준에서 자주 떨어지는지" 한눈에 파악 가능.
→ `docs/starter-kit/02-nexus-visualization.md` 참조
