# 07. 코드 전수검사 프로토콜

> CORTHEX HQ 운영에서 검증된 전수검사 방법론.

---

## 전수검사란?

- **전수검사 ≠ grep 키워드 검색** — "이상 없음" 선언하면 안 됨
- **전수검사 = 파일을 Read 도구로 처음부터 끝까지 전부 읽고, 각 함수/로직을 직접 이해하며 검토**
- grep은 "어디 있는지 찾기"용. 실제 검사는 반드시 Read로 읽어야 함

---

## 5단계 프로토콜

**1단계: 파일 전체 읽기 (건너뛰기 금지)**
- 마지막 줄까지 다 읽었는지 확인

**2단계: 함수별 입출력 검증**
- 각 API 함수의 입력 형식이 실제 SDK 규격과 맞는지
- 함수 호출 결과를 사용하는 곳까지 추적

**3단계: 모델명 검증**
- 허용된 모델명 목록과 하나씩 대조
- "있을 것 같은" 모델명 지어내기 절대 금지

**4단계: 중복/누락 확인**
- 같은 API 엔드포인트 두 번 정의 여부
- async 함수에서 await 빠진 곳, await 두 번 쓴 곳

**5단계: 수정 전 반드시 확인**
- 해당 코드가 다른 곳에서 어떻게 호출되는지 추적
- 수정 후 grep으로 구버전 문자열 0건 검증

---

## 팀 규모 가이드

| 파일 크기 / 작업 규모 | 서브에이전트 수 |
|-------------------|------------|
| ~500줄 / 단일 버그 | 2명 |
| ~3000줄 / 기능 점검 | 3명 |
| ~5000줄 / 전체 검사 | 4명 |
| 5000줄+ | 4명 고정 (초과 금지) |

---

## 전수검사에서 쌓인 교훈

| 카테고리 | 교훈 |
|---------|------|
| 배포/서버 | `git pull` 금지 → `git fetch + git reset --hard` |
| FastAPI | 엔드포인트 중복 정의 → 두 번째 무시. 추가 전 grep 확인 |
| 배치 | OpenAI 파일 업로드: `file=("batch.jsonl", bytes)` 튜플 형식 |
| 하드코딩 | yaml 단일 소스에서 동적으로 읽을 것 |
| 모델명 | "있을 것 같은" 모델명 지어내기 금지 |
| 팀 작업 | 같은 파일 두 팀원 수정 금지 |
| 데이터 | `data/*.json` 저장 금지 → `save_setting(key, value)` 사용 |

---

## 시작 전 체크리스트

1. `docs/project-status.md` 읽기
2. `docs/updates/` 최근 2~3개 읽기
3. 파일 담당 명확히 배정 (중복 금지)

## 완료 후 체크리스트

1. QA 금지 모델명 0건 확인
2. 커밋 + 푸시 + 배포 ([완료] 태그)
3. `docs/updates/` 작성 + `docs/project-status.md` 갱신
