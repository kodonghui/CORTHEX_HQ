# 2026-02-26 TODO

---

## ✅ knowledge 정비 + read_knowledge 도구

> **맥락**: knowledge/ 폴더 파일들이 에이전트에 주입되지 않아 팀장들이 리트마스터를 전혀 참고 못하고 있었음.
> 매 요청마다 주입하면 토큰 낭비 (~2,000~3,000/요청). on-demand 도구 방식으로 해결.

- ✅ `knowledge/leet_master/product_info.md` GitHub 저장소 완전 분석 후 채움
  - 서비스 정의, 타겟, 기능 현황, 크레딧 구조, 경쟁사, 가설, 팀장별 관여 범위
- ✅ `src/tools/read_knowledge.py` 신규 구현 (division/file 파라미터, LLM 호출 없음)
- ✅ pool.py + tools.yaml + agents.yaml 등록 (5개 팀장: 전략/법무/마케팅/금융분석/콘텐츠)
- ✅ config JSON 캐시 삭제 (서버 재시작 시 YAML에서 재생성)

---

## ✅ 전수검사 마스터 플랜 Phase 0~4

### Phase 0 — 즉시 수정
- ✅ 0-1: CIO 보고서 잘림 — max_tokens에 thinking budget 포함하도록 수정
- ✅ 0-2: Soul Evolution 자동 승인 — 제안 즉시 auto_approved + 소울 업데이트
- ✅ 0-3: Soul Gym 24/7 — 5분 간격 상시 루프로 변경

### Phase 1 — QA 검수 개선
- ✅ QA 보고서 스니펫 3000→8000자 (잘림 방지)
- ✅ QA 판정 한국어→영어 PASS/FAIL (파싱 취약점 제거)

### Phase 2 — 코드 전수검사 + 레거시 정리
- ✅ 2-1: agents.yaml spawn_agent 4곳 제거 (625→397줄)
- ✅ 2-2: 도구 131개 전수 매핑 확인 (유령 0개)
- ✅ 2-3: SNS 16개 엔드포인트 확인 (9동작/3조건부/3스텁)
- ✅ 2-4: 핸들러 26개 전부 마운트 확인 (고아 0개)
- ✅ 2-5: JS/HTML "처장→팀장" + "전문가4명" 레거시 전부 제거
- ✅ 2-6: arm_server.py "처장→팀장" 81건 일괄 치환
- ✅ 일회성 스크립트 2개 삭제

### Phase 3 — UX/UI 전면 개편 (대표님 32개 항목)

#### ✅ Phase A — 즉시 수정 (9건)
- ✅ A-1: window.confirm() 18곳 → 커스텀 모달 교체
- ✅ A-2: 대화 비우기 시 목록에서도 즉시 삭제
- ✅ A-3: 기밀문서 tier 필터 삭제 (부서 필터만 유지)
- ✅ A-4: CTO dormant 에이전트 UI 비노출 + C-level 호칭 정리
- ✅ A-5: 관심종목 시장별 전체선택/해제 버튼 추가
- ✅ A-6: 전략실 '활동로그'→'교신로그' + 통신로그 교신 서브탭 삭제
- ✅ A-7: 전략실 매매전략 탭 + 모달 삭제
- ✅ A-8: 기밀문서 목록에 제목 표시 + 내용부 제목 줄바꿈
- ✅ A-9: '채팅' → '지휘소' 이름 변경

#### ✅ Phase B — 메뉴/구조 재배치 (4건)
- ✅ B-1: Primary 탭: 작전현황→사령관실→전략실→통신로그→작전일지→기밀문서
- ✅ B-2: 더보기: 기밀문서 primary 승격, 전력분석/자동화/크론기지/통신국/정보국
- ✅ B-3/B-4: 뷰모드 순서: 지휘소→사무실→대시보드→AGORA→NEXUS

#### ✅ Phase C — 중간 규모 개편 (8건)
- ✅ C-1: 사이드바 flat 팀장 리스트 (ORG TREE→TEAM, 부서 계층→flat x-for)
- ✅ C-2: 작전일지 요약 제목 표시 + 원본 명령어 아래 표시
- ✅ C-3: 전력분석 새로고침 버튼 추가
- ✅ C-4: 사무실 6열→3열2행, 카드 크기 확대
- ✅ C-5: AI모델 "모드"→"변경", 팀장별 현재 모델 상태 테이블 추가
- ✅ C-6: 로그 시간 표시 개선 (이미 충분, 확인 완료)
- ✅ C-7: 통신로그 전체 텍스트 크기 증가 (text-xs→text-sm)
- ✅ C-8: 장기기억 UI (이미 전력분석 탭에 구현되어 있음, 확인 완료)

#### 🔄 Phase D — 대형 작업 (6건)
- ✅ D-1: 도구 131개 전수검수 (Phase 2에서 이미 완료 — 유령 0개)
- ✅ D-2: 동시 명령 큐 시스템
- ✅ D-3: 통신국 연결상태 + 토큰 표시
- ✅ D-4: 포트폴리오 토스형 입출금 기록
- ✅ D-5: 모바일 하단바 순서 동기화 + 더보기 '조직도'→'대시보드' 수정
- ✅ D-6: 보고서 ID #task_id 표시

#### ✅ Phase E — 연구/설계 (3건)
- ✅ E-1: 피드백 모드 (플로팅 버튼 + 클릭 좌표 저장)
- ✅ E-2: 숨겨진 기능 노출 (작전현황 시스템 기능 섹션)
- ✅ E-3: 정보국 파일 업로드 (.md/.txt/.yaml/.json, 다중 선택)

### Phase 4 — 아키텍처 품질 검토
- ✅ 4-1: arm_server.py 분석 (9,910줄, 150함수, D등급)
- ✅ 4-2: 핸들러 26개 역할 중복 없음 확인
- ✅ 4-4: AI 폴백 강화 — 404 전 프로바이더 확대 + 429 크로스 프로바이더 전환
- ⬜ 4-3: cutting-edge 기술 재평가 (Phase 5로 이관)
- ⬜ 4-5: 노션 실제 저장 검증 (대표님 CIO 분석 실행 후)

---

## ✅ 긴급 수정
- ✅ Anthropic 스트리밍 필수 오류 수정 — 빌드#598

## ✅ 긴급 버그 수정 (Phase C 작업 중 발견)
- ✅ 기밀문서 내용부 제목에서 .md 확장자 + 날짜 접두사 제거
- ✅ 전략실 교신로그 글씨체 너무 작음 → text-[10px]→text-xs 등 전체 증가
- ✅ 즉시분석 토스트 '활동로그'→'교신로그' 수정
- ✅ 전략실 도구로그 이모지 겹침 + 글씨 크기 증가

## ⬜ 이관 (미완료)

- ✅ Phase C (8건) 완료
- ⬜ Phase D 나머지 (D-2, D-3, D-4, D-6) — 백엔드 작업 필요
- ⬜ Phase 5 새 기능 — Phase 0~4 완료 + 배포 후 착수
- ⬜ 노션 DB 실제 저장 검증
- ⬜ 채팅 블로킹 이슈 — D-2 동시 명령(명령 큐)으로 해결 예정
- ⬜ Soul Gym Dry Run 테스트
- ⬜ 즉시분석 재테스트 (스트리밍 수정 빌드#598 이후)

---

## 🔴 Phase 6 — 대표님 2026-02-26 검수 33개 항목 (새 세션)

> 맥락: Phase 3에서 완료 표시됐으나 여전히 불완전한 항목 재확인 + 신규 항목 추가
> 모두 새 워크트리에서 작업 예정 (`claude/phase6-ux` or 항목별 분리)

### 신규 미구현 (처음 나온 것)

- ✅ **N-1: 도구 4분류 전수** — 137개 도구 전수 분류 (API 62 / LLM 52 / LOCAL 18 / STUB 5), tools.yaml category 필드 추가
- ✅ **N-2: 넥서스 mermaid 시스템 플로우차트** — 3D 맵 + mermaid 플로우 + 비주얼 캔버스 3모드 전환. mermaid: CEO→서버→AI→에이전트(부서별)→도구→외부서비스
- ✅ **N-3: 정보국 드래그앤드롭 파일 업로드** — 세션3에서 완료
- ✅ **N-4: 진화시스템 웹 실시간 로그** — 세션3에서 완료
- ✅ **N-5: 피드백 모드 피그마급** — 세션3에서 완료
- ✅ **N-6: 작전현황↔대시보드 역할 명시** — home에 "대시보드 상세 보기" 링크 + 대시보드에 "실시간 대시보드 — 30초 자동 갱신" 부제 추가
- ✅ **N-7: 왼쪽바 도구함 카테고리 그룹화** — API(초록)/LLM(시안)/LOCAL(보라)/STUB(회색) 4그룹 컬러 분류
- ✅ **N-8: 아고라 독립 viewMode** — switchTab→viewMode='agora' 분리, ESC 핸들러 추가, 모바일 더보기 시트에 추가
- ✅ **N-9: 보고서 QA 반려/재작성** — DB version/parent_task_id/rejected_sections 3컬럼 + /api/tasks/{id}/rewrite + UI 섹션 반려 입력
- ✅ **N-10: 모바일 반응형 전수** — grid-cols 고정 12개소 sm: 반응형 추가, 팝업/패널 max-w, AGORA 모바일 패널 숨김
- ✅ **N-11: 통신로그+전략실 타임라인 UX** — 세로선+도트+접이식 카드 타임라인 레이아웃 (통신로그 3탭 + 전략실 교신로그)

### 재확인 항목

- ✅ **R-1: 대화 비우기 목록 제거** — 세션3에서 PATCH+DELETE 폴백 수정
- ✅ **R-2: 작전일지 제목 요약** — _extract_title_summary() 헬퍼: 마크다운 헤더/첫 문장 추출 (content[:200] → 1줄 요약)
- 🔄 **R-3: 전력분석 데이터 업데이트** — 대표님 지시로 제외
- ✅ **R-4: 통신국 .env 오류** — 세션3에서 텍스트 수정
- ✅ **R-5: 동시 명령 실행** — 코드 리뷰: commandQueue FIFO 큐 정상 동작 확인 (수정 불필요)
- ✅ **R-6: 장기기억 UI 접근성** — 세션3에서 버튼 크기 + 안내 텍스트 추가

### ✅ 검증 완료 (코드 확인으로 실제 완료 확인)

- ✅ 삭제 팝업 커스텀 모달 (window.confirm 0개 확인)
- ✅ 기밀문서 필터 부서만 유지
- ✅ CYO 잔재 HTML에서 0건 확인
- ✅ 더보기 순서: 전력분석/자동화/크론기지/통신국/정보국
- ✅ 관심종목 시장별 전체선택
- ✅ 전략실 '활동로그'→'교신로그' (코드 확인)
- ✅ 전략실 매매전략 탭 (탭 목록에 없음 확인)
- ✅ 기밀문서 목록 에이전트 이름 표시
- ✅ 뷰모드 순서: 지휘소→사무실→대시보드→AGORA→NEXUS (코드 확인)
- ✅ 상단 탭 순서: 작전현황→사령관실→전략실→통신로그→작전일지→기밀문서
- ✅ '채팅'→'지휘소' 변경 (코드 확인)

### 우선순위 (권고 순서)

| 우선 | 항목 | 이유 |
|-----|------|------|
| 🔴 즉시 | R-1, R-3, R-4 | 대표님이 직접 문제 확인하신 것 |
| 🟠 이번 주 | N-4(텔레그램 진화로그), N-5(피드백 모드), R-6(장기기억 UX) | 매일 불편 체감 |
| 🟡 다음 | N-1(도구분류), N-7(왼쪽바), N-8(아고라), N-6(작전현황/대시보드) | 구조 설계 필요 |
| 🔵 설계 후 | N-2(넥서스 mermaid), N-9(ID시스템), N-10(모바일), N-11(로그UX) | 대형 작업 |

---

## ⬜ Instagram Meta 앱 설정 (SNS 연동 선행 작업)

> 맥락: 인스타그램 콘텐츠 게시 API 연동을 위해 Meta 개발자 포털에서 수동으로 해야 할 작업. 비즈니스 인증 검토 중(1주일 경과) + 이용 사례가 광고 API로 잘못 설정됨.

### Part A: 인스타그램 이용 사례 추가 (5분)

**1단계.** `developers.facebook.com` 접속 → 오른쪽 상단 **"내 앱"** 클릭 → **Corthex-Hq** 클릭

**2단계.** 왼쪽 메뉴에서 **"이용 사례"** 클릭
(영어면 "Use cases")

**3단계.** 오른쪽에 **"이용 사례 추가"** 파란 버튼 클릭

**4단계.** 검색창에 `Instagram content` 입력
→ **"Instagram 콘텐츠 게시"** (Instagram content publishing) 선택
→ **"추가"** 클릭

**5단계.** 추가된 이용 사례 옆 **"설정"** 클릭
→ **권한** 탭에서 아래 2개 **"추가"** 버튼 클릭:
- `instagram_business_basic`
- `instagram_content_publish`

---

### Part B: 액세스 토큰 발급 (10분)

**1단계.** 같은 페이지 왼쪽 메뉴 → **"도구"** → **"그래프 API 탐색기"** 클릭
(영어면 "Graph API Explorer")

**2단계.** 오른쪽 상단 드롭다운에서 **"Corthex-Hq"** 선택되어 있는지 확인

**3단계.** **"사용자 또는 페이지 액세스 토큰 생성"** 클릭
→ 팝업에서 아래 권한 체크:
- ✅ `instagram_business_basic`
- ✅ `instagram_content_publish`
- ✅ `pages_read_engagement`

**4단계.** **"토큰 생성"** 클릭 → 본인 계정으로 로그인 → 승인

**5단계.** 화면에 나타난 긴 토큰 값 전체 복사

---

### Part C: 토큰 GitHub Secrets 등록 (2분)

GitHub → CORTHEX_HQ 저장소 → **Settings** → **Secrets and variables** → **Actions**
→ **"New repository secret"**:
- Name: `INSTAGRAM_ACCESS_TOKEN`
- Value: 복사한 토큰 붙여넣기

> 완료 후 Claude에게 말하면 코드 연결 + 발행 테스트까지 진행.

---

## ✅ 세션 3 — 일괄 버그수정 + 신규 기능 + 명칭 정리

### 버그 수정
- ✅ R-1: 대화 비우기 PATCH 응답 확인 + DELETE 폴백 (corthex-app.js)
- ✅ R-4: 통신국 ".env" → "서버 환경변수" 텍스트 수정 (index.html)
- ✅ R-6: 장기기억 "기억" 버튼 크기 개선 + 안내 텍스트 추가 (index.html)

### 신규 기능
- ✅ N-3: 정보국 드래그앤드롭 파일 업로드 (index.html + corthex-app.js)
- ✅ N-4: 진화시스템 웹 실시간 로그 — SSE/WebSocket broadcast + REST API + 전력분석 패널 (arm_server.py + corthex-app.js + index.html)
- ✅ N-5: 피드백 모드 피그마급 — 클릭 핀 + 말풍선 인라인 입력 + 핀 목록/삭제 (corthex-app.js + index.html)

### 코드 정리
- ✅ CIO→팀장 명칭 35곳 정리 (config/*.yaml, src/*, web/* — 주석·문자열만, 변수명 유지)

### ARGOS 후속 (세션 2 연속)
- ✅ ARGOS↔도구 6중 중복 해결 — _argos_reader.py 공통 헬퍼 + 5개 도구 DB 캐시 우선 (PR#621)
- ✅ ARGOS 수집 타임아웃 수정 (PR#624) + 순차 수집 DB lock 방지 (PR#625)
