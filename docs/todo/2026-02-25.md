# 2026-02-25 TODO

> 블라인드 채점 기반 전체 품질 개선 프로젝트 (13 Phase)

---

## ✅ 2/25 완료

### Phase 0~1: 프롬프트 레벨 (즉시 효과)
- ✅ 아키텍처 문서 6개 생성 (`docs/architecture/quality-improvement/`)
- ✅ CLAUDE.md: 알고리즘/다이어그램 표준 작업 방식 규칙 추가
- ✅ CEO 아이디어 #008~#012 기록 (`docs/ceo-ideas.md`)
- ✅ Soul 5개 파일 수정 (CIO + 전문가4) — BLUF + 도구출력 + 차트 + 재작업 데이터 규칙
- ✅ `config/agents.yaml` — CTO 5명 dormant: true
- ✅ `config/quality_rules.yaml` — D1 판정 보조 강화

### Phase 2: 스폰 필터링 (#9)
- ✅ `cross_agent_protocol.py` — register_valid_agents dict 기반 변환
- ✅ dormant 에이전트 자동 차단 (_request + _handoff)
- ✅ 같은 부서=직접, 다른 부서=처장 경유 리다이렉트
- ✅ `mini_server.py` — _build_agents_from_yaml에 superior_id, dormant 필드 추가

### Phase 3: 반려/재작업/학습 (#12, #16)
- ✅ QA 불합격 시: 교신로그 broadcast + 기밀문서(반려사유) 저장
- ✅ 반려 학습: warnings 카테고리에 교훈 즉시 저장 → 다음 호출 자동 주입
- ✅ 재작업 프롬프트: 이전 보고서 전문 첨부 + 부분수정 지시 ("정확했던 수치 변경 금지")
- ✅ 재작업 완료: 기밀문서(v2) 저장 + 활동로그 "🔄 재작업 보고서 제출" 기록

### Phase 4: 검수 로그 통합 (#10, #10-2)
- ✅ 항목별 개별 로그(10줄+) → 전문가당 1건 통합 로그
- ✅ 프론트: qa_detail 레벨 검수 탭 표시 + 메시지 기반 ✅/❌ 아이콘 구분

### Phase 5: 로그 소실 (#1)
- ✅ 프론트 메모리 100→300건 (corthex-app.js 3곳)
- ✅ DB 보관 1,000→5,000건 (db.py)

### Phase 8: CIO 7단계 워크플로우 (#14)
- ✅ (1) 처장 독자분석 → 기밀문서 저장 (보고서1_독자분석)
- ✅ (2) 전문가 보고서 각각 → 기밀문서 저장 (보고서1)
- ✅ (5)(6) 반려/재작업 = Phase 3에서 구현
- ✅ (7) CIO 최종 = 이미 기존 코드에서 저장됨

### 기존 코드 버그 발견 + 수정
- ✅ 재작업 도구 로그 변수명 버그: `_rw_agent_id` → `_aid` (정의 안 된 변수 사용)

---

### Phase 7: 모의투자 활성화 (#20+21)
- ✅ 기본값 변경: `auto_execute=True`, `enable_mock=True`, `enable_real=False`
- ✅ UI: 체크박스 3개 → 3단 라디오 (실거래/모의투자/가상투자)
- ✅ 상단 배너: 2가지(모의/실) → 3가지(실거래/모의투자/가상투자) 표시 구분
- ✅ CIO 자동실행 토글 분리 (라디오와 독립)

---

### Phase 10: Soul 자동 진화 크론 (B안)
- ✅ `soul_evolution_handler.py` — Sonnet warnings 분석 + 소울 변경 제안 + 승인/거부 API
- ✅ 크론 등록: 매주 일요일 03:00 KST (_cron_loop에 직접 추가)
- ✅ 텔레그램 알림: 제안 도착 시 자동 발송
- ✅ 웹 UI: 전력분석 탭에 SOUL EVOLUTION 섹션 (수동 실행 + 승인/거부 버튼)
- ✅ 승인 시: DB에 소울 업데이트 (`soul_{agent_id}`) + warnings 초기화

### Phase 11: 분석 품질 대시보드
- ✅ DB: `get_quality_scores_timeline()` + `get_top_rejection_reasons()` 쿼리
- ✅ API: `/api/quality/scores` + `/api/quality/top-rejections`
- ✅ 웹 UI: 전력분석 탭에 QUALITY DASHBOARD 섹션 (요약 카드 + Chart.js 시간 추이 + 반려 Top 5)

### Phase 12: 부서 간 협업 로그
- ✅ DB: `collaboration_logs` 테이블 + CRUD 함수
- ✅ `cross_agent_protocol.py`: 리다이렉트 발생 시 콜백으로 DB 기록
- ✅ API: `/api/collaboration/logs` + `/api/collaboration/summary`

### Phase 13: 테스트
- ✅ `test_spawn_filter.py` 13건: 에이전트 등록, 별칭 매핑, dormant 차단, 부서 라우팅
- ✅ `test_rework.py` 12건: 메모리 CRUD, 품질검수, 타임라인, 협업 로그, 텍스트 추출
- ✅ **25건 전체 통과**

---

### P2 전수검사 + 대표님 논의 항목 수정
- ✅ #2: 검수 시작 로그 → `_quality_review_specialists()` 시작 시 `qa_start` 로그 + SSE 브로드캐스트
- ✅ #3~5: CIO팀 통신로그 색상 구분 (에이전트별 5색) + 발신자 표기 `getCioShortName()` 통일
- ✅ #6: 기밀문서 CPO 누락 → 부서 필터에 `publishing` 추가
- ✅ #20: 모의투자 매매 0건 → 기본값 auto_execute=True + enable_mock=True로 변경
- ✅ #21: 매매모드 프론트 UI → 3단 라디오 구현 완료

### P2 전수검사 결과 (개별 상태)
- ✅ P2-1: decisions 저장 → JSON→DB 전환 완료
- ✅ P2-2: 교신로그 탭 전환 → 4탭 독립 구조, 버그 없음 (2/24 개수불일치는 별도 수정됨)
- ✅ P2-3: 교신로그 도구 표시 → #495에서 수정
- ✅ P2-4: CIO 독자분석 병렬 → asyncio.gather 완전 구현 (Phase 0~8)
- ⚠️ P2-5: 새로고침 분석 재연결 → SSE 재연결은 구현됨, UI 상태만 리셋 (낮은 우선순위)
- ⚠️ P2-6: 시세 SSE → 30초 폴링만 구현 (기능 추가 수준)
- ✅ P2-7: CIO 목표가 산출 → 프롬프트+파싱+관심종목 반영 완전 구현
- ✅ P2-8: 실거래 UI → 빌드#371 완료
- ✅ P2-9: 포트폴리오 → VECTOR+KIS 연동 완료
- ✅ P2-10: CIO 성과 탭 → trading_handler.py API 8개 존재
- ⚠️ P2-11: 종목 차트 → 모달로 구현됨 (슬라이드패널은 UX 선호)
- ✅ P2-12: order_size → 0=CIO 비중 자율 (CLAUDE.md 규칙, 정상)

---

## 🔜 낮은 우선순위 (기능 개선)
- ⬜ P2-5: 새로고침 시 분석 상태 유지 (SSE는 됨, UI 상태 복원)
- ⬜ P2-6: 시세 실시간 SSE (현재 30초 폴링)
- ⬜ P2-11: 종목 차트 모달 → 슬라이드패널 변경
- ⬜ 노션 DB 속성명 불일치 수정

---

## ✅ 설계실 탭 + 뼈대 플로우차트 (2026-02-25 추가)

- ✅ 뼈대 다이어그램 5종 (knowledge/flowcharts/ + docs/architecture/flowcharts/)
- ✅ 설계실 탭 — 3분할 Mermaid 에디터 + 실시간 렌더링 + 줌/패닝
- ✅ CLAUDE.md — 최신 레퍼런스 분석 규칙 추가

## ✅ NEXUS 대개편 (2026-02-25 추가)

- ✅ 설계실 → NEXUS 이름 변경 + 3모드 구현 (빌드#558)
- ✅ 2D 에디터 모드 제거 (대표님 피드백: "아무것도 안 보인다")
- ✅ 3D 뷰 전면 개편 — 에이전트만 → 전체 시스템 7개 카테고리 70+ 노드 (탭/부서/에이전트/API/저장소/서비스/프로세스)
- ✅ 3D 노드: 색깔 점 → SpriteText 사각형 라벨 (한글 이름 표시)
- ✅ 캔버스 노드 더블클릭 이름 수정 기능
- ✅ NEXUS 전체화면 오버레이 — 채팅/사무실/대시보드 옆 NEXUS 버튼, ESC로 닫기
- ✅ 조직도 탭 삭제 — NEXUS 3D 시스템 맵으로 대체
- ✅ 설계 문서 저장: `docs/architecture/nexus-design.md` (재사용용)
- ✅ CEO 아이디어 #009 기록: `docs/ceo-ideas.md`

## ⬜ 이관 (미완료)

- ⬜ **노션 DB 속성명 실제 검증** — 서버 디버그 API로 확인한 결과 코드 수정 완료했으나, 노션 MCP 미연결이라 실제 저장 동작 검증 필요
- ⬜ **NEXUS MCP 연동** — 캔버스 JSON을 Claude가 읽어서 시각적 논의 가능하게 (MCP 연결 시)
