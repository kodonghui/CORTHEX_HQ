# 2026-02-25 TODO

> 블라인드 채점 기반 전체 품질 개선 프로젝트 (13 Phase)

---

## ✅ 2/25 완료

### Phase 0~1: 프롬프트 레벨 (즉시 효과)
- ✅ 아키텍처 문서 6개 생성 (`docs/architecture/quality-improvement/`)
- ✅ CLAUDE.md: 알고리즘/다이어그램 표준 작업 방식 규칙 추가
- ✅ CEO 아이디어 #008~#012 기록 (`docs/ceo-ideas.md`)
- ✅ Soul 5개 파일 수정 (CIO + 전문가4) — BLUF + 도구출력 + 차트 + 재작업 데이터 규칙
- ✅ `config/agents.yaml` — CTO 5명 dormant: true
- ✅ `config/quality_rules.yaml` — D1 판정 보조 강화

### Phase 2: 스폰 필터링 (#9)
- ✅ `cross_agent_protocol.py` — register_valid_agents dict 기반 변환
- ✅ dormant 에이전트 자동 차단 (_request + _handoff)
- ✅ 같은 부서=직접, 다른 부서=처장 경유 리다이렉트
- ✅ `arm_server.py` — _build_agents_from_yaml에 superior_id, dormant 필드 추가

### Phase 3: 반려/재작업/학습 (#12, #16)
- ✅ QA 불합격 시: 교신로그 broadcast + 기밀문서(반려사유) 저장
- ✅ 반려 학습: warnings 카테고리에 교훈 즉시 저장 → 다음 호출 자동 주입
- ✅ 재작업 프롬프트: 이전 보고서 전문 첨부 + 부분수정 지시 ("정확했던 수치 변경 금지")
- ✅ 재작업 완료: 기밀문서(v2) 저장 + 활동로그 "🔄 재작업 보고서 제출" 기록

### Phase 4: 검수 로그 통합 (#10, #10-2)
- ✅ 항목별 개별 로그(10줄+) → 전문가당 1건 통합 로그
- ✅ 프론트: qa_detail 레벨 검수 탭 표시 + 메시지 기반 ✅/❌ 아이콘 구분

### Phase 5: 로그 소실 (#1)
- ✅ 프론트 메모리 100→300건 (corthex-app.js 3곳)
- ✅ DB 보관 1,000→5,000건 (db.py)

### Phase 8: CIO 7단계 워크플로우 (#14)
- ✅ (1) 처장 독자분석 → 기밀문서 저장 (보고서1_독자분석)
- ✅ (2) 전문가 보고서 각각 → 기밀문서 저장 (보고서1)
- ✅ (5)(6) 반려/재작업 = Phase 3에서 구현
- ✅ (7) CIO 최종 = 이미 기존 코드에서 저장됨

### 기존 코드 버그 발견 + 수정
- ✅ 재작업 도구 로그 변수명 버그: `_rw_agent_id` → `_aid` (정의 안 된 변수 사용)

---

### Phase 7: 모의투자 활성화 (#20+21)
- ✅ 기본값 변경: `auto_execute=True`, `enable_mock=True`, `enable_real=False`
- ✅ UI: 체크박스 3개 → 3단 라디오 (실거래/모의투자/가상투자)
- ✅ 상단 배너: 2가지(모의/실) → 3가지(실거래/모의투자/가상투자) 표시 구분
- ✅ CIO 자동실행 토글 분리 (라디오와 독립)

---

### Phase 10: Soul 자동 진화 크론 (B안)
- ✅ `soul_evolution_handler.py` — Sonnet warnings 분석 + 소울 변경 제안 + 승인/거부 API
- ✅ 크론 등록: 매주 일요일 03:00 KST (_cron_loop에 직접 추가)
- ✅ 텔레그램 알림: 제안 도착 시 자동 발송
- ✅ 웹 UI: 전력분석 탭에 SOUL EVOLUTION 섹션 (수동 실행 + 승인/거부 버튼)
- ✅ 승인 시: DB에 소울 업데이트 (`soul_{agent_id}`) + warnings 초기화

### Phase 11: 분석 품질 대시보드
- ✅ DB: `get_quality_scores_timeline()` + `get_top_rejection_reasons()` 쿼리
- ✅ API: `/api/quality/scores` + `/api/quality/top-rejections`
- ✅ 웹 UI: 전력분석 탭에 QUALITY DASHBOARD 섹션 (요약 카드 + Chart.js 시간 추이 + 반려 Top 5)

### Phase 12: 부서 간 협업 로그
- ✅ DB: `collaboration_logs` 테이블 + CRUD 함수
- ✅ `cross_agent_protocol.py`: 리다이렉트 발생 시 콜백으로 DB 기록
- ✅ API: `/api/collaboration/logs` + `/api/collaboration/summary`

### Phase 13: 테스트
- ✅ `test_spawn_filter.py` 13건: 에이전트 등록, 별칭 매핑, dormant 차단, 부서 라우팅
- ✅ `test_rework.py` 12건: 메모리 CRUD, 품질검수, 타임라인, 협업 로그, 텍스트 추출
- ✅ **25건 전체 통과**

---

### P2 전수검사 + 대표님 논의 항목 수정
- ✅ #2: 검수 시작 로그 → `_quality_review_specialists()` 시작 시 `qa_start` 로그 + SSE 브로드캐스트
- ✅ #3~5: CIO팀 통신로그 색상 구분 (에이전트별 5색) + 발신자 표기 `getCioShortName()` 통일
- ✅ #6: 기밀문서 CPO 누락 → 부서 필터에 `publishing` 추가
- ✅ #20: 모의투자 매매 0건 → 기본값 auto_execute=True + enable_mock=True로 변경
- ✅ #21: 매매모드 프론트 UI → 3단 라디오 구현 완료

### P2 전수검사 결과 (개별 상태)
- ✅ P2-1: decisions 저장 → JSON→DB 전환 완료
- ✅ P2-2: 교신로그 탭 전환 → 4탭 독립 구조, 버그 없음 (2/24 개수불일치는 별도 수정됨)
- ✅ P2-3: 교신로그 도구 표시 → #495에서 수정
- ✅ P2-4: CIO 독자분석 병렬 → asyncio.gather 완전 구현 (Phase 0~8)
- ✅ P2-5: 새로고침 복구 → CIO팀 working 감지 시 runningNow 자동 활성화
- ✅ P2-6: 시세 푸시 → watchlist prices 조회 시 WebSocket price_update 자동 broadcast
- ✅ P2-7: CIO 목표가 산출 → 프롬프트+파싱+관심종목 반영 완전 구현
- ✅ P2-8: 실거래 UI → 빌드#371 완료
- ✅ P2-9: 포트폴리오 → VECTOR+KIS 연동 완료
- ✅ P2-10: CIO 성과 탭 → trading_handler.py API 8개 존재
- ✅ P2-11: 종목 차트 → 이미 슬라이드패널 구현 (translate-x-full, max-w-420px)
- ✅ P2-12: order_size → 0=CIO 비중 자율 (CLAUDE.md 규칙, 정상)

---

### P2 잔여 + 노션 수정 (2차)
- ✅ P2-5: 새로고침 복구 → CIO팀 agent_status working 시 runningNow 자동 활성화
- ✅ P2-6: 시세 WebSocket 푸시 → watchlist prices 조회 시 자동 broadcast (price_update 이벤트)
- ✅ P2-11: 종목 차트 → 이미 슬라이드패널로 구현됨 (translate-x-full 애니메이션, max-w-420px)
- ✅ 노션 DB 속성명 3건 수정: 에이전트→담당자, Date→날짜, 부서/태그 속성 제거 (DB에 없음)

---

## ✅ 설계실 탭 + 뼈대 플로우차트 (2026-02-25 추가)

- ✅ 뼈대 다이어그램 5종 (knowledge/flowcharts/ + docs/architecture/flowcharts/)
- ✅ 설계실 탭 — 3분할 Mermaid 에디터 + 실시간 렌더링 + 줌/패닝
- ✅ CLAUDE.md — 최신 레퍼런스 분석 규칙 추가

## ✅ NEXUS 대개편 (2026-02-25 추가)

- ✅ 2D Mermaid 에디터 제거 (대표님: "아무것도 안 보인다")
- ✅ 3D 시스템 맵 대개편: 에이전트 29개 점 → 시스템 전체 70개 노드 (7카테고리 SpriteText 라벨)
- ✅ 캔버스 더블클릭 노드 이름 편집
- ✅ 풀스크린 오버레이 (fixed z-50, ESC 닫기)
- ✅ 헤더 4번째 버튼 (채팅/사무실/대시보드/NEXUS)
- ✅ 조직도 탭 삭제 (NEXUS 3D가 대체)
- ✅ 설계 문서: `docs/architecture/nexus-design.md`
- ✅ CEO 아이디어 #009 기록

## ✅ 긴급 버그 4건 + 사유 특정 재검수 (2026-02-25)

- ✅ **CIO 타임아웃 300→600초** — 7단계 워크플로우에서 시간 부족 문제
- ✅ **CSO 무단 스폰 차단** — CSO→CIO 기본 크론 수정
- ✅ **QA D1 전원 불합격** — D1 기준 "도구사용→논리연결"로 변경
- ✅ **크론 삭제 안 됨** — deleted_schedules DB 기록 추가
- ✅ **사유 특정 재검수** — `targeted_hybrid_review()` 구현, 반려 항목(D1/Q3 등)만 재채점, 통과 항목 점수 유지

## ✅ AI 크레딧 소진 자동 폴백 (2026-02-25)

- ✅ **400 크레딧 에러 감지 → 자동 전환** — Anthropic 소진 시 Google/OpenAI로 즉시 폴백
- ✅ **소진 프로바이더 기억** — `mark_provider_exhausted()` 세션 동안 건너뜀
- ✅ **리셋 API** — `/api/debug/reset-exhausted-providers` 충전 후 초기화
- ✅ **디버그 표시** — `/api/debug/ai-providers`에 소진 상태 🔴 표시

## ⬜ 이관 (미완료)

- ⬜ **노션 DB 속성명 실제 검증** — 서버 디버그 API로 확인한 결과 코드 수정 완료했으나, 노션 MCP 미연결이라 실제 저장 동작 검증 필요. 대표님이 CIO 분석 실행 후 노션에 데이터 올라가는지 확인
- ⬜ **NEXUS MCP 연동** — Claude가 NEXUS 캔버스 JSON을 읽어서 시스템 이해 + 대표님과 시각적 논의

---

## ✅ 2/25 추가 완료 (오후)

- ✅ CORTHEX v4.00.000 대개편 배포 (빌드#574)
  - 전문가 22명 해고, 6팀장 체제 확립
  - 팀장 Soul 강화 (전문가 지식 흡수)
- ✅ 노션 DB 프로퍼티 매핑 수정 배포 (빌드#575)
  - 에이전트 산출물 DB 컬럼명 수정
  - 비서실장만 비서실 DB, 나머지 팀장→에이전트 산출물 분리 확인

## ✅ Soul Gym 경쟁 진화 시스템 (2026-02-25)

- ✅ DB 스키마: `soul_gym_rounds` 테이블 + 함수 3개
- ✅ 엔진: `web/soul_gym_engine.py` (변이 생성/벤치마크/채점/진화)
- ✅ API: 5개 엔드포인트 (`web/handlers/soul_gym_handler.py`)
- ✅ 크론: 월요일 03:00 KST 자동 실행
- ✅ UI: 전력분석 탭 SOUL GYM 섹션
- ✅ 설계 문서: `docs/architecture/soul-gym-algorithm.md`

## ✅ 팀장 단독 분석 + QA 게이트 + 벤치마크 (2/25 저녁~)

- ✅ 전문가 위임 제거 — `_MANAGER_SPECIALISTS` 비움, `_call_agent()` 직접 호출
- ✅ 비서실장 QA 게이트 — `_chief_qa_review()` 5항목 검수 (결론/근거/리스크/형식/논리)
- ✅ `thinking.type: enabled → adaptive` — Claude API deprecation 대응
- ✅ Soul Gym 벤치마크 설계 — `docs/architecture/soul-gym-benchmarks.md` 6팀장 맞춤
- ✅ 멈춘 분석 정리 — `/api/trading/bot/stop` 호출, idle 복구

## ⬜ 이관 (미완료)

- ⬜ 노션 실제 저장 동작 검증 — CIO 분석 실행 후 양쪽 DB 확인
- ⬜ Soul Gym Dry Run 테스트 — 배포 후 서버에서 실행 확인
- ⬜ NEXUS MCP 연동
- ⬜ 즉시분석 재테스트 — thinking.type 수정 후 전체 흐름(분석→QA→매매) 확인
