# 2026-02-23 TODO

> 2/22 미완료 항목 이관 + 리팩토링 진행

---

## ✅ 2/23 완료

### 리팩토링 Step 1: 브로드캐스트 헬퍼 추출 (PR#493)
- ✅ `web/ws_manager.py` 생성 (방송실 — 브로드캐스트 코드 1곳으로 통합)
- ✅ `mini_server.py` 30곳 복사-붙여넣기 코드 → `wm.broadcast()` 1줄 호출로 교체
- ✅ PR#493 머지 + 배포

### 리팩토링 Step 2: 전역 상태 관리 (PR#494)
- ✅ `web/state.py` 생성 — AppState 클래스 + 싱글턴 app_state
- ✅ 44개 전역변수 → AppState로 통합
- ✅ `mini_server.py`에서 `global` 키워드 15개 제거
- ✅ PR#494 머지 + 배포

### 리팩토링 Step 3+4: 메모리+에러 (PR#495)
- ✅ TTL 기반 메모리 자동 정리 (10분 주기)
- ✅ AI 호출 180초 타임아웃 추가
- ✅ `_notion_log` 트리밍 버그 수정 (alias 깨짐 방지)
- ✅ graceful shutdown 추가 (cancel_all_bg_tasks)
- ✅ `except Exception: pass` 38곳 → logger.debug 로깅
- ✅ PR#495 머지 + 배포

### 리팩토링 Step 5~7: 핸들러 분리 (PR#497)
- ✅ `web/handlers/` 디렉토리 + 20개 핸들러 파일 생성
- ✅ 144 endpoints 분리
- ✅ mini_server.py 11,906줄 → 8,527줄 (28% 축소)
- ✅ PR#497 머지 + 배포

### 리팩토링 Step 8~11: 마무리
- ✅ ai_handler.py: models.yaml에서 가격 자동 로드
- ✅ ai_handler.py: TOOL_RESULT_MAX_CHARS 상수화
- ✅ WebSocket 메시지 64KB 크기 제한
- ✅ Step 9 (Config 이중화): deploy.yml에 이미 존재 → 추가 작업 불필요
- ✅ Step 11 (graceful shutdown): Step 3에서 완료

### 노션 corthex.hq 전환
- ✅ .env.local 노션 API 키 교체 (elddlwkd → corthex.hq)
- ✅ GitHub Secrets 4개 업데이트 (NOTION_API_KEY, DB_SECRETARY, DB_OUTPUT, DEFAULT_DB_ID)
- ✅ corthex.hq 노션 페이지 2개 업데이트 (아키텍처 + 기술 문서)

### 문서 작성
- ✅ CLAUDE.md 정비 (메모리 금지, 기술 설명 규칙)
- ✅ `docs/refactoring-guide.md`: 비개발자용 리팩토링 가이드
- ✅ `docs/ceo-ideas.md`: #005~#006 추가
- ✅ `docs/REFACTORING_PLAN.md`: 진행 일지 전체 기록
- ✅ `docs/project-status.md` 업데이트
- ✅ 이 TODO 파일 업데이트

---

## ➡️ 2/22에서 이관 (리팩토링 외)

### 대표님이 직접 해야 할 것 🔴
- ✅ 유튜브 채널 생성 완료 (2026-02-23) → OAuth 연동 대기
- ~~네이버 카페~~ → 삭제 결정 (2026-02-23)
- ⬜ 이미지 스타일 레퍼런스 제공 (AI 인플루언서 모델 이미 생성 → 스타일 확정 필요)
- ~~Kling 3.0 API~~ → Replicate로 대체 결정 (립싱크 등 Replicate가 처리)
- ✅ Replicate API 토큰 발급 + $10 결제 완료 (2026-02-23)

### Claude가 할 것 (리팩토링 후 → 보류, Step 12~14 우선)
- ⏸️ 도구 전면 재건 (209개 → ~114개) — 보류
- ⏸️ 이미지 스타일 개선 — 보류 (대표님 AI 인플루언서 모델 활용 예정)
- ⏸️ 네이버 블로그/티스토리 발행 테스트 — 보류

### 전수검사 미수정 항목
- ⬜ P2-2: 교신로그 탭 전환 버그
- ⬜ P2-3: 교신로그 도구 사용 표시
- ⬜ P2-4~P2-12 (9건)
- ⬜ 직원 모델 설정 '권장' 버튼 안 먹힘

### 🔄 진행 중 (Step 12~14)
- 🔄 리팩토링 Step 12: index.html 구조 정리 (10,666줄 → 컴포넌트 분리)
- ⬜ 리팩토링 Step 13: 멀티턴 대화 기능
- ⬜ 리팩토링 Step 14: 아키텍처 맵 대시보드

### 장기 (보류)
- ⬜ 사령관실 내부통신 C안
- ⬜ 전략실 교신로그 C안
