# 2026-02-24 TODO

> 2/23 미완료 이관 + P0 버그 수정

---

## ✅ 2/24 완료

### P0 버그 3건 수정 (전문가 즉사 + QA 허위합격 + CIO 도구 미사용)
- ✅ 버그#1: `_apply_openai_strict_inline` NameError — 모듈 레벨로 이동 (ai_handler.py)
- ✅ 버그#2: QA 검수 대상 0명인데 "전원 합격" — 유효카운트 체크 추가 (mini_server.py)
- ✅ 버그#3: CIO 종합 시 도구 미전달 — allowed_tools 로드 + ask_ai에 전달 (mini_server.py)
- ✅ 전 부서(CIO/CSO/CMO/CPO) 자동 적용 확인 (공용 함수 `_manager_with_delegation()`)
- ✅ 문서 작성: `docs/updates/2026-02-24_P0-전문가즉사-버그수정.md`
- ✅ `docs/project-status.md` P0 → 해결됨으로 업데이트
- ✅ CLAUDE.md: 활동 로그 API + KST 날짜 규칙 추가

### CLAUDE.md 개선
- ✅ `/api/activity-logs` API 대문짝만하게 기재
- ✅ 한국 시간(KST) 기준 규칙 추가

---

### 웹 풀 최적화 C안 (6단계)
- ✅ Step 1: nginx gzip + 정적파일 30일 캐시 (deploy.yml)
- ✅ Step 2: 폰트 최적화 — CSS @import 제거, Noto Serif KR 폐지, preload 전환
- ✅ Step 3: CDN 지연 로드 — Chart.js/Mermaid/Marked → `_loadScript()` 동적 로드
- ✅ Step 4: init() API 11→3개, SSE 2→1개 통합, CIO 3초 폴링 제거
- ✅ Step 5: HTML x-show → x-if 전환 (8개 탭, DOM ~4,800줄 절감)
- ✅ Step 6: CLAUDE.md 성능 코딩 규칙 6개 추가

---

### 로그 시스템 버그 6건 수정 (야간 분석 모니터링 중 발견)
- ✅ 버그#1: COMMS LOG 중복 표시 — ID 정규화 (dl_ 접두사 통일)
- ✅ 버그#2+3: 전략실 활동로그 실시간 미반영 + 0건 — WS→trading 라우팅 추가
- ✅ 버그#4: 통신로그 개수 불일치 — 배타적 카테고리(활동/교신/검수/도구)로 변경
- ✅ 버그#5: 활동로그 삭제 실패 — 테이블명 activity_log→activity_logs 수정
- ✅ 버그#6: QA D1 허위 판정 — QA content에 tools_used 첨부
- ✅ 문서 작성: `docs/updates/2026-02-24_로그-버그-6건-수정.md`

### CIO 독자 분석 워크플로우 개선
- ✅ CIO 종합 프롬프트 변경: 취합만 → 독자 도구 분석 + 종합
- ✅ 전문가 전원 실패 시: CIO가 도구로 직접 분석하여 보고서 작성
- ✅ 일부 실패 시: CIO가 에러 영역 도구로 보완 + 성공자 종합
- ✅ 전원 성공 시: CIO가 도구로 검증 + 전문가 종합

### 5건 통합 수정 (야간 분석 모니터링 중 발견)
- ✅ 처장 독자분석 5번째 병렬 태스크 (CEO 아이디어 — mini_server.py)
- ✅ 전략실 통신로그 ID 중복 수정 3곳 (corthex-app.js)
- ✅ Q1 "데이터 정확성" → "시의성" 변경 (quality_rules.yaml)
- ✅ D2 "리스크 구체적 명시" 완전 삭제 + 번호 재정리
- ✅ C3 "할루시네이션" 완전 삭제 + 번호 재정리
- ✅ CLAUDE.md: 처장 독자분석 규칙 + 1분 모니터링 규칙 추가
- ✅ docs/ceo-ideas.md #007 추가

## 🔄 진행 중
- 🔄 커밋 + 푸시 + 배포 + 검증

---

## 🔜 다음 할 일
- ⬜ 배포 후 CIO 재분석 (종목 2개만) — 처장 독자분석 + QA 규칙 검증
- ⬜ 블라인드 모델 품질 비교 테스트 (대표님 보고서 제공 대기)

---

## 💬 대표님 논의사항 (2/24 야간, 구현 대기)

### 로그/데이터
1. ⬜ **로그 소실 문제**: 시간 지나면 로그 사라짐. 전략실 CIO팀 통신로그 전부 확인 + 활동로그 vs 통신로그 개수 차이 원인 분석
2. ⬜ **검수 시작 로그**: QA 시작 시에도 로그 기록. 전 직원 작업 "시작" 시 로그 기록 (현재는 완료만). API vs 서버 구현 방법 확인

### UI/UX
3. ⬜ **통신로그 교신로그 UX/UI**: 다른 탭이랑 디자인 달라서 어색 → 통일
4. ⬜ **CIO팀 통신로그 색상**: CIO와 전문가 전부 초록색 → 교신로그처럼 역할별 색 구분
5. ⬜ **발신자 표기 불일치**: P2P는 "투자"(투자분석처장 CIO), 위임은 "CI"(CIO 투자분석처장) → 통일

### 기능 버그
6. ⬜ **기밀문서탭 CPO 없음**: 기밀문서 탭에서 CPO(출판기록처장) 누락
7. ⬜ **크론기지 삭제 불가**: 대표님이 삭제해도 계속 나옴. DB 강제 저장 확인
8. ⬜ **도구호출 n/5 표기**: 제한 없앴는데 통신로그+CIO팀 통신로그 모두 "n/5" 표시

### 구조적 문제
9. ⬜ **전문가 스폰 문제**: CIO가 아카이브 전문가(Gemini Flash, publishing 부서)를 스폰함. 도구 사용 가능하다고 아무나 스폰하면 안 됨 → 부서/역할 기반 필터링 필요
10. ⬜ **검수 로그 통합**: 한 사람당 검수 로그 한번에 전부 기록 (예: C1~C4 + D1~D3 + Q1~Q2 + 합불(점수) 를 로그 1건으로)
10-2. ⬜ **검수 로그 아이콘 오류**: 합격한 전문가의 개별 항목도 전부 빨간 X로 표시됨. 통과 항목은 녹색 체크, 과락 항목만 빨간 X로 구분해야 함
11. ⬜ **재작업 시 전원 spawn 안 됨**: 전원 재작업 지시했는데 전원 spawn이 안 되는 원인 조사
12. ⬜ **반려 교신로그 누락**: 검수 반려(재작업 지시) 시 교신로그에 기록되어야 함. 반려사유도 기밀문서에 남길 것. 반려사유는 구체적으로 특정하여 재작업 전문가가 전수검사 없이 해당 부분만 수정 가능하도록
13. ⬜ **보고서 파싱 검증 (처장급 검수 시)**: 전문가가 노션에 글 쓰는 형태로 보고서를 올리면, **CIO 등 처장급 모델이 그 보고서를 읽고 파싱해서 검수할 수 있는지** 검증 필요. 핵심은 C급 모델이 아니라 처장급(GPT-5.2-pro 등)이 노션 마크다운/리치텍스트를 정확히 파싱하여 내용 기반 검수를 수행하는지 여부
    13-2. ⬜ **보고서 차트/시각화 지원**: 전문가가 분석 시 차트(matplotlib 등)를 생성한 경우, (1) 기밀문서/보고서 탭에서 차트를 시각적으로 볼 수 있어야 함 (현재는 텍스트만), (2) CIO 등 처장이 차트를 파싱/해석하여 검수에 활용할 수 있는지 검증 필요 — 이미지 인식 가능한 모델인지, base64 등으로 전달 가능한지 분석
15. ⬜ **재작업 spawn 직렬 문제**: 검수 반려 후 재작업 시 전문가가 병렬 spawn 안 되고 한 명씩 직렬로 spawn됨 (한 명 끝나야 다음 명 시작). 도구 사용 불 켜졌다 꺼지고 다음 불 켜지는 패턴. 병렬 gather로 수정 필요 → **코딩 완료, 배포 대기**
16. ⬜ **재작업 보고서 기밀문서 저장**: 반려 후 재작업한 전문가 보고서가 기밀문서 탭에 올라와야 함 (현재 미저장)
17. ⬜ **SerpAPI 90% 소진 → serper.dev 전환**: 코드(`src/tools/real_web_search.py`)는 이미 serper.dev 우선 + SerpAPI 폴백으로 구현 완료. **문제는 서버에 `SERPER_API_KEY` 환경변수가 없어서 serper.dev를 건너뛰고 SerpAPI만 쓴 것.** 해결: GitHub Secrets에 `SERPER_API_KEY=3ab803ded8d61720cce31d13f288dfafc701691b` 등록 + deploy.yml에 env 추가 → 다음 배포 시 자동 반영
14. ⬜ **CIO 분석 워크플로우 재설계 + 문서 체계**: 현재 구조를 아래 7단계로 재설계. 각 단계의 산출물이 별개 기밀문서로 남아야 함:
    - (1) CIO 선판단 문서(cio보고서1) — 전문가 지시 전 독자 판단. 기밀문서 저장
    - (2) CIO 독자분석 (재귀적 자기분석) + 전문가 병렬 분석
    - (3) CIO 독자분석 보고서(cio보고서2) + 전문가 보고(전문가보고서1)
    - (4) 전문가 보고서 검수 → 통과/반려
    - (5) 반려 시: 반려사유 특정 + 업무 재지시 + 반려사유 보고서(cio보고서3). 기밀문서 저장
    - (6) 전문가 재작업 → 반려 부분만 수정 후 재제출(전문가보고서2)
    - (7) CIO가 (3)+(6) 전부 통합한 최종 종합 보고서(cio보고서4) 작성

---

### CLAUDE.md / 문서
18. ✅ **CLAUDE.md 다이어트**: 314줄→140줄. 상세 참조(API URL, 시크릿 목록, 모델표, 보고 템플릿, 비유 사전)는 `docs/claude-reference.md`로 분리. 규칙 자체는 하나도 삭제 안 함. 배포 대기

---

### 2/23에서 이관 (미완료)
- ⬜ P2-2: 교신로그 탭 전환 버그
- ⬜ P2-4~P2-12 (9건)
- ⬜ 직원 모델 설정 '권장' 버튼 안 먹힘
- ⬜ 노션 DB 속성명 불일치 수정

### 장기 (보류)
- ⏸️ 도구 전면 재건 (209개 → ~114개)
- ⏸️ 이미지 스타일 개선
- ⏸️ 네이버 블로그/티스토리 발행 테스트
