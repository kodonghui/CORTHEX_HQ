# 2026-03-02 완료 기록

## ✅ sister(누나) 계정 4가지 버그 수정 (PR #728, 빌드 #759)

근본 원인: 로그인 토큰에 org 정보 없음 → 백엔드가 누나/CEO 구분 불가

1. **saju 에이전트 안 보임** → index.html "준비중" 하드코딩 → 4명(executive/eden/zoe/sage) 실제 렌더링
2. **대화 세션 CEO와 공유** → conversation_handler.py에 `get_auth_org()` 인증 필터 추가
3. **작전일지 공유** → activity_handler.py에 `get_auth_org()` 인증 필터 추가
4. **비서실장 누나 화면 표시** → index.html `x-show="auth.role !== 'sister'"` 추가

인프라: auth_handler.py `_extract_token()` 통합(header→query→쿠키) + `get_auth_org()` API 신설 + corthex-app.js 쿠키 토큰 저장

## ✅ 로그아웃 버튼 표시 수정 (PR #729, 빌드 #760)

원인: 배포→서버 재시작→세션 소멸→bootstrapMode=true→로그인 성공해도 안 바뀜
수정: corthex-app.js 로그인 성공 시 `this.auth.bootstrapMode = false` 추가

## ✅ v5.1 Config-driven Workspace Architecture (PR #730, 빌드 #762)

**핵심**: role if/else 하드코딩 전면 폐기 → config/workspaces.yaml 설정 기반 동적 렌더링

1. **workspaces.yaml 신규** — CEO(4섹션: 비서실장+리트마스터+사주+금융) / sister(1섹션: 사주냥팀 Eden/Zoe/Sage) 프로파일
2. **GET /api/workspace-profile** — 로그인 시 role → 프로파일 매핑 반환. config_loader.py에 load_workspace_profiles() 추가
3. **JS role if/else 17곳 제거** — `auth.role === 'sister'` → `workspace.orgScope`, `workspace.sidebarFilter`, `workspace.mentionFilter` 사용
4. **HTML x-show role 제거** — `x-show="auth.role !== 'sister'"` → `x-show="workspace.sidebarFilter === 'ceo'"` + cli_owner 기반 필터
5. **yaml2json.py** — workspaces 변환 추가 (배포 시 JSON 자동 생성)
6. **CLAUDE.md 정리** — v3 잔재(처장=5번째분석가) 제거, v5.1 워크스페이스 규칙 반영
7. **architecture.md 동기화** — sidebarFilter/mentionFilter org→cli_owner 기반 코드 예시 수정

아키텍처 원칙: 네이버 모델(같은 기능, 다른 데이터) + 슬랙 모델(cli_owner 기반 내 CLI 직원만)
새 사람 추가 = workspaces.yaml 프로파일 1개 + 인증 추가. 코드 수정 0줄.
