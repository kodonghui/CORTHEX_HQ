# 팀 에이전트 규칙

> CLAUDE.md에서 분리된 상세 문서. 팀 작업 시 이 파일을 Read로 읽고 따를 것.

## 기본 원칙
- **평소에는 팀 없이 일반 세션으로 작업** — 작은 작업에 팀은 낭비
- CEO가 "팀으로 해줘" 하면 기본팀(3명) 구성
- CEO가 인원수 지정하면 그대로 따를 것
- 인원 제한 없음 — 작업 규모에 따라 필요한 만큼 투입

### 팀을 쓰지 않아도 되는 상황
- 버그 1~3개 수정, 한 파일만 수정, 간단한 UI 수정
- 3~5줄 이하 수정이면 소신 발언: "직접 하는 게 더 빠릅니다"

## 기본팀 (3명)

| 팀원 | 코드명 | 담당 파일 | 역할 |
|------|--------|----------|------|
| 팀원1 | **FE** | index.html, CSS, Alpine.js | 화면, 디자인, 다크/밝은 모드 |
| 팀원2 | **BE** | arm_server.py, db.py, src/tools/, config/*.yaml | API, DB, 도구, 서버 로직 |
| 팀원3 | **QA** | 전체 | 수정 결과 검증, 파일 충돌 확인 |

### 확장 역할 (필요할 때만)

| 코드명 | 담당 | 언제 추가? |
|--------|------|-----------|
| **TOOL** | src/tools/ 도구 개발, tools.yaml 스키마 | 새 도구 만들 때 |
| **DEVOPS** | deploy.yml, nginx, 서버 설정 | 배포/인프라 문제 |
| **PLAN** | 구조 설계, 작업 순서 결정 | 큰 기능 기획 |

## 서브에이전트 규칙

### 활용 규칙
- 모든 팀원은 서브에이전트(Task 도구)를 적극 활용
- 코드 탐색, 파일 검색, 구조 분석 → 서브에이전트에게
- 팀원 본인은 판단 + 수정에 집중
- 서브에이전트 2개 이상 병렬로 돌려서 조사 시간 단축

### Git 금지 규칙 (매우 중요!)
- **서브에이전트는 git 명령어 절대 금지**
  - ❌ `git checkout`, `git branch`, `git commit`, `git push`, `git stash`, `git merge`
  - ✅ 파일 읽기(Read/Grep/Glob), 파일 수정(Edit/Write), Bash(git 제외)
- **모든 git 작업은 팀장만 수행**
- **이유**: 서브에이전트가 `git checkout` 실행 → 작업 디렉토리 전체 변경 → 다른 에이전트 수정사항 전부 유실 (2026-02-19 실제 사고)
- 팀원 spawn 프롬프트에 반드시 포함: "git 명령어 사용 금지"

## 팀 작업 효율 규칙
- **같은 파일 두 팀원 동시 수정 금지** — 팀장이 파일별 담당 명확히 배정
- 다른 팀원 담당 파일 건드려야 하면 팀장에게 먼저 알릴 것
- 작업 끝나면 즉시 보고, 다음 이슈 받을 것

## 팀장 직접 vs 에이전트 위임

| 작업 유형 | 처리 방식 | 이유 |
|---------|---------|------|
| Soul 작성, 아키텍처, CLAUDE.md, 현황 파악 | **팀장 직접** | 전체 맥락 필요 |
| UI 컴포넌트, 단순 버그, 리팩토링, YAML 수정 | **에이전트 위임** | 스펙만 명확하면 됨 |

### 위임 시 프롬프트 필수 항목
1. 파일 경로 + 수정 위치 (줄번호)
2. API 스펙
3. 출력 형태
4. 담당 파일 한정
5. 완료 조건 + SendMessage 보고

## 팀장 운용 체크포인트

**spawn 직후**: 파일 담당 중복 확인 → CEO에게 "팀원 작업 중" 알림
**보고 수신 즉시**: 처리 + 다른 팀원 영향 있으면 SendMessage
**중간 커밋 트리거**: 팀원 1명 완료 / 파일 3개+ 수정 / 치명적 버그 수정 (중간 커밋에 [완료] 금지)

### 팀 해산 체크리스트
- [ ] 모든 팀원 완료 보고 수신
- [ ] QA 금지 모델명 grep 0건
- [ ] docs/project-status.md 갱신 + CLAUDE.md 교훈 추가
- [ ] [완료] 태그 커밋 + 푸시
- [ ] deploy.yml 트리거 확인
- [ ] 빌드 번호 확인 → CEO 보고

## 컴팩트(세션 압축) 대비

### 컴팩트란?
대화 길이가 컨텍스트 창(~200K 토큰)에 가까워지면 이전 대화를 요약·압축. **압축 시 모든 백그라운드 팀원이 사라짐.**

### 대비 전략
- **커밋 타이밍**: 팀원 3명+ 완료 / 파일 3개+ 수정 / CEO 화제 전환 → 즉시 커밋
- **팀원 결과물**: 채팅 말고 파일(`docs/updates/`)에 저장 후 한 줄 요약만
- **세션 분할**: 세션당 1~2개 영역만. `project-status.md` + `updates/`로 맥락 복구
- **팀원 수 ≤ 9명** 유지

### 컴팩트 후 복구
1. `docs/project-status.md` + `docs/updates/` 최신 2~3개 읽기
2. `git status` → 미커밋 있으면 바로 커밋
3. 팀원 결과 파일 확인 후 이어서 진행
