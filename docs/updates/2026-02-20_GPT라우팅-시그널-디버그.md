# GPT 라우팅 디버그 + 시그널 파싱 + 도구호출 확대 + 교신로그 SSE

- **날짜**: 2026-02-20
- **버전**: 3.02.001
- **빌드**: #358 → #359 → #360
- **브랜치**: claude/fix-cio-400-schema, claude/fix-signal-parse-comms, claude/fix-gpt-routing-debug

---

## 변경 사항

### 빌드 #358: 도구 스키마 호환성
- tools.yaml → JSON 변환 시 `type: None` 자동 제거
- GPT-5.2 strict 모드에서 400 에러 나던 문제 해결

### 빌드 #359: 시그널 파싱 + 자동매매
- `_parse_cio_signals()`: CIO 보고서에서 [시그널] 패턴 추출
- 자동매매 실행 로직: paper trading + KIS 실거래 주문
- 교신로그 SSE broadcast: `_delegate_to_specialists()`에서 위임/보고 시 SSE 전송

### 빌드 #360: 디버그 시스템 + 파싱 보완
- **"조건부 매수" regex 수정**: `\|\s*[^\|]*?(매수|매도|관망)` — 수식어 앞에 붙어도 매칭
- **도구 호출 제한 5→10회**: 기술적분석 Specialist가 5회에서 잘려서 보고서 미완성 → 10회로 확대
- **디버그 엔드포인트 3개**:
  - `/api/debug/ai-providers` — AI 프로바이더 연결 상태 (GPT/Claude/Gemini)
  - `/api/debug/agent-calls` — 최근 AI 호출 10건 (모델, 프로바이더, 비용)
  - `/api/debug/cio-signals` — 시그널 파싱 상태
- **교신로그 SSE 실시간**: LIVE 표시, 위임(노랑)/보고(초록) 색 구분, 15건 표시
- **CLAUDE.md 업데이트**: 디버그 URL 규칙 간결화, 업데이트/버그리포트 기록 규칙 추가

---

## 발견된 핵심 버그

### GPT 0회 문제 (미해결)
- CIO팀(5명) 전원 GPT 모델 설정인데, 대시보드에서 Claude 6회 / GPT 0회
- `_pick_fallback_model()`: OpenAI 사용 불가 시 Claude로 자동 대체
- 서버에 openai v2.21.0 + API 키 모두 확인됨 → 런타임 초기화 실패 의심
- `/api/debug/ai-providers` 결과로 원인 확인 가능

### 기술적분석 Specialist 보고서 미제출 (수정 완료)
- 원인: 도구 호출 5회 제한 → 기술적분석 워크플로우는 5~6회 필요
- 수정: 5→10회 확대 (Anthropic, OpenAI, Gemini 3곳 모두)

### 시그널 탭 비어있던 문제 (수정 완료)
- 원인: CIO가 "조건부 매수" 형식 사용 → regex에서 매칭 실패
- 수정: `[^\|]*?` 로 수식어 허용

---

## 다음 할 일 (우선순위)

1. **P0**: GPT 0회 원인 확인 (CEO가 디버그 URL 확인 대기)
2. **P1**: CLAUDE.md 다이어트 (500줄 → 핵심만)
3. **P2**: 전략실 전수검사 (P2-1~P2-8, project-status.md 참조)
