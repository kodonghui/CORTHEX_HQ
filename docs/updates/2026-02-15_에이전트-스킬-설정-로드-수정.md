# 에이전트 스킬 표시 문제 완전 해결

## 작업 날짜
2026-02-15

## 작업 브랜치
claude/fix-config-loading

## 변경 사항 요약

### 뭘 했는지
대시보드에서 **모든 에이전트가 "도구를 사용하지 않습니다"**로 표시되던 문제를 완전히 해결했습니다.

### 문제가 뭐였는지 (총 3가지 원인)

| 순서 | 원인 | 설명 |
|------|------|------|
| 1 | **경로 불일치** | 서버가 `/home/ubuntu/CORTHEX_HQ/web/`(git 저장소)에서 실행되는데, JSON 파일은 `/home/ubuntu/config/`에 생성됨 → 서버가 파일을 못 찾음 |
| 2 | **PyYAML 환경 분리** | 시스템 Python에는 PyYAML이 설치되어 있지만, 서버가 사용하는 Python 환경(가상환경)에서는 yaml 모듈을 못 씀 |
| 3 | **YAML 구문 오류** | deploy.yml 안에 Python 코드를 직접 넣으면서 들여쓰기가 깨져 GitHub가 워크플로우 파일을 못 읽음 |

### 어떻게 해결했는지

1. **`config/yaml2json.py` (변환 스크립트)** — git 저장소 config 폴더와 복사된 config 폴더 **양쪽 모두에** JSON 파일을 생성하도록 수정
2. **`deploy.yml` (배포 스크립트)** — 시스템 Python(`/usr/bin/python3`)으로 변환 스크립트 실행 (가상환경의 PyYAML 미설치 우회)
3. **`web/arm_server.py` (서버 코드)** — JSON 파일 우선 읽기 + YAML 폴백 로직 추가 (PyYAML 없이도 동작)
4. **`.gitignore`** — 자동 생성되는 JSON 파일(`config/agents.json`, `config/tools.json`)을 무시 목록에 추가

### 확인 결과
- `/api/agents/schedule_specialist` → `allowed_tools: ["calendar_tool", "skill_writing_plans", "skill_executing_plans"]` ✅
- `/api/agents/cmo_manager` → 27개 도구 정상 표시 ✅
- `/api/debug/config` → `agents_detail_count: 29`, `tools_list_count: 154` ✅

## 현재 상태
- 작업 완료
- 서버 배포 완료 (빌드 #42 예정)
- 모든 29명의 에이전트가 자신에게 할당된 도구를 정상적으로 보여줌

## 다음에 할 일
- 대시보드에서 각 에이전트 클릭 → 스킬 탭에서 도구 목록 정상 표시 확인
- 필요시 에이전트별 스킬 추가/제거 조정
