# 자동 배포 전수검사 — 배포 안 되던 버그 수정

## 작업 날짜
2026-02-14

## 작업 브랜치
claude/sync-multiple-computers-Nz8IR

## 변경 사항 요약

### 문제가 뭐였나? (2가지)

**문제 1: paths 필터**
- 기존에는 `web/` 폴더 안의 파일이 바뀔 때만 서버 배포가 됐음
- `web/` 밖의 파일만 바뀌면 배포 안 됨

**문제 2: GitHub 보안 정책 (진짜 원인)**
- GitHub에는 "워크플로우(자동화)가 만든 push는 다른 워크플로우를 실행시키지 않는다"는 보안 규칙이 있음
- 우리 시스템: `auto-merge`가 PR을 main에 합침 → `deploy`가 실행돼야 함
- 하지만 auto-merge가 만든 머지(push)이기 때문에 → deploy가 안 돌아감!
- 그래서 PR #52 이후로 서버 배포가 한 번도 자동 실행되지 않았음

### 뭘 바꿨나?

| 파일 | 설명 | 뭘 바꿨는지 |
|------|------|------------|
| `.github/workflows/deploy.yml` (자동 배포 설정) | 서버에 파일 올리는 자동화 | `paths` 필터 제거 → 무조건 실행 가능하게 |
| `.github/workflows/auto-merge-claude.yml` (자동 머지 설정) | PR 만들고 main에 합치는 자동화 | 머지 성공 후 → `gh workflow run deploy.yml`로 배포를 **직접 실행시키는** 코드 추가 |
| `CLAUDE.md` (클로드 작업 규칙) | 클로드가 지켜야 할 규칙 | "서버 배포 규칙" 전면 재작성 — 전체 흐름, GitHub 보안 정책 설명 포함 |
| `docs/project-status.md` (프로젝트 상태) | 현재 진행 상황 | 최신 상태로 업데이트 |

### 이제 어떻게 되나?
1. claude/ 브랜치에 [완료] 커밋 push
2. auto-merge가 PR 생성 + main에 합침
3. **합친 직후, auto-merge가 deploy를 직접 실행시킴** (이게 핵심!)
4. deploy가 서버에 SSH 접속 → 최신 코드 복사 → 서버 재시작
5. 서버(168.107.28.100) 홈페이지에 최신 내용 반영!

## 현재 상태
- 완료 (이 커밋이 main에 합쳐지면 바로 테스트됨)

## 다음에 할 일
1. 도메인(corthex.com 등) 구매 및 연결
2. HTTPS(보안 자물쇠) 설정
