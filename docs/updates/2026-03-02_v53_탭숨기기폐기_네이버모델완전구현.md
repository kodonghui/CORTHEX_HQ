# v5.3 탭 숨기기 전면 폐기 — 네이버 모델 완전 구현

**날짜**: 2026-03-02 | **브랜치**: claude/v53-tab-naver-model | **PR**: #737 | **빌드**: #779

---

## 문제

v5.2에서 `showSections`, `allowedDivisions`를 추가해 누나 계정에서 탭을 숨겼음.

이건 **네이버 모델 위반**:
> 네이버에 내 계정으로 들어가든 누나 계정으로 들어가든 탭/기능은 같다. 다른 건 데이터뿐.

누나 계정 → KIS 탭 있어야 함 (데이터 없으면 "연동 없음" 표시)
누나 계정 → 기밀문서 탭 있어야 함 (사주 문서만 보이면 됨, 탭 자체는 있어야)

---

## 수정 내용

### 제거: showSections (탭 자체 숨기기)

**`config/workspaces.yaml`**:
- `sister.showSections: [home, command, performance]` 삭제
- `viewer.showSections: []` 삭제
- `ceo.showSections: []` 삭제

**`web/static/js/corthex-app.js`**:
- `_tabAllowed()` 함수 제거
- `getPrimaryTabs()` / `getSecondaryTabs()`: `_tabAllowed` 필터 제거 → 전체 탭 반환

### 제거: allowedDivisions (기밀문서 division 버튼 숨기기)

**`config/workspaces.yaml`**:
- `sister.allowedDivisions: [saju]` 삭제
- `ceo.allowedDivisions: []` 삭제
- `viewer.allowedDivisions: []` 삭제

**`web/templates/index.html`**:
- 기밀문서 division 필터 버튼에서 `x-show="!workspace.allowedDivisions || ..."` 전부 제거
- 전체/리트마스터/스케치바이브/사주/공통 버튼 항상 표시
- 누나가 "리트마스터" 클릭 → API에서 orgScope 필터로 빈 결과 → 정상

### 수정: loadArchive (filterDivision API 전달)

**`web/static/js/corthex-app.js`**:
```javascript
// 이전: orgParam만 전달, filterDivision 무시됨
// 이후: orgScope + filterDivision 둘 다 전달
const params = new URLSearchParams();
if (this.workspace.orgScope) params.set('org', this.workspace.orgScope);
if (this.archive.filterDivision && this.archive.filterDivision !== 'all') {
  params.set('division', this.archive.filterDivision);
}
```

### 추가: CLAUDE.md 절대 규칙

```markdown
🚨 탭 숨기기 금지 (v5.3): showSections / allowedDivisions 금지.
탭은 모든 사람 동일. 데이터 격리는 orgScope만.
```

---

## 검증 체크리스트

- [ ] CEO 로그인 → 모든 탭 보임 (trading/intelligence 포함)
- [ ] 누나 로그인 → 모든 탭 보임
- [ ] 누나 기밀문서 → 사주 문서만 보임 (API orgScope 필터 by archive_handler.py)
- [ ] 누나 기밀문서 → "리트마스터" 버튼 클릭 → 빈 결과 표시 (정상)
- [ ] 누나 대시보드 → 사주 에이전트 비용만

---

## 현재 데이터 격리 현황

| 탭 | 격리 방식 | 상태 |
|----|---------|------|
| 기밀문서 | archive_handler.py `auth_org` 기반 필터 | ✅ 구현됨 |
| 대시보드 비용 | arm_server.py `get_auth_org` 기반 필터 | ✅ 빌드#773 |
| 통신국 | sns_accounts org 컬럼 | ✅ 빌드#752 |
| 작전일지 | activity_logs org 컬럼 | ✅ 빌드#752 |
| ARGOS/KIS | ❌ 미구현 — 누나 접근 시 연동 없음 빈 상태 | 🟡 BACKLOG |
| 채팅창 | conversations org 컬럼 | ✅ 빌드#752 |
