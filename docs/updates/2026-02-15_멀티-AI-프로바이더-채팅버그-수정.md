# 멀티 AI 프로바이더 지원 + 웹 채팅 버그 수정

## 버전
0.09.005

## 작업 날짜
2026-02-15

## 작업 브랜치
claude/fix-multi-provider-ai-chat

---

## 변경 사항 요약

### 버그 수정 2건

1. **웹 채팅이 아예 안 되던 버그 수정**
   - **문제**: 웹에서 메시지를 보내면 비서실장이 전혀 대답을 안 함
   - **원인**: 프론트엔드(화면)는 메시지를 `text`라는 이름으로 보내는데, 백엔드(서버)는 `content`라는 이름으로 찾고 있었음 → 서버가 항상 빈 메시지를 받은 것처럼 처리
   - **수정**: 서버가 `text`와 `content` 둘 다 확인하도록 변경

2. **텔레그램 대화가 웹 화면에 안 뜨던 버그 수정**
   - **문제**: 텔레그램으로 보낸 메시지와 AI 답변이 웹 채팅창에 안 나옴 (작업내역에만 찍힘)
   - **원인**: 텔레그램 메시지를 웹으로 전달하는 코드가 없었음
   - **수정**: 텔레그램 메시지가 오면 웹 화면에도 실시간으로 보여주도록 WebSocket(실시간 통신) 브로드캐스트 추가. 텔레그램에서 온 메시지는 "CEO 명령 (텔레그램)"으로 표시

### 기능 추가 1건

3. **멀티 AI 프로바이더 지원**
   - **이전**: Anthropic(Claude)만 사용 가능
   - **이후**: Anthropic(Claude) + Google(Gemini) + OpenAI(GPT) 3개 회사의 AI를 모두 사용 가능
   - **작동 방식**: 모델 이름 앞 글자로 자동 판별
     - `claude-*` → Anthropic API 호출
     - `gemini-*` → Google API 호출
     - `gpt-*` → OpenAI API 호출
   - **폴백(대체)**: 선택한 AI 회사의 API 키가 없으면, 사용 가능한 다른 AI로 자동 전환
   - 예: Gemini를 선택했는데 Google API 키가 없으면 → Claude로 자동 전환

---

## 수정한 파일 목록

| 파일 | 설명 |
|------|------|
| `web/ai_handler.py` (AI 두뇌) | 전면 재작성 — 3개 프로바이더 지원 + 자동 폴백 + 비용 계산 |
| `web/mini_server.py` (백엔드 서버) | 채팅 키 불일치 수정 + 텔레그램→웹 실시간 동기화 + 프로바이더 상태 API |
| `web/templates/index.html` (웹 화면) | 텔레그램 메시지 표시 + "(텔레그램)" 소스 라벨 |
| `.github/workflows/deploy.yml` (배포 설정) | google-genai/openai 패키지 설치 + GOOGLE_API_KEY 환경변수 (⚠️ 토큰 권한 문제로 미푸시) |

---

## 현재 상태

- 웹 채팅 버그 수정 → **배포 완료** (자동 머지 대기 중)
- 멀티 프로바이더 코드 → **배포 완료** (단, 서버에 google-genai/openai 패키지가 미설치 시 Anthropic만 작동)
- deploy.yml 변경 → **미푸시** (GitHub PAT에 `workflow` 권한이 없음)

## 다음에 할 일

1. deploy.yml 푸시를 위해 GitHub PAT에 `workflow` 권한 추가, 또는 GitHub 웹에서 직접 편집
2. GitHub Secrets에 GOOGLE_API_KEY 등록 확인
3. Gemini 모델로 전환하여 실제 응답 테스트
