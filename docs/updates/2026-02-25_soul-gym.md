# Soul Gym 경쟁 진화 시스템 구현 — 2026-02-25

## 개요

에이전트 소울(시스템 프롬프트)을 자동으로 진화시키는 시스템.
변이 3개를 만들어서 모의투자 벤치마크로 경쟁 → 최고 점수 자동 채택.

## 이원화 구조

| | Gym (훈련장) | 실사용 |
|--|--|--|
| 모델 | gemini-2.5-flash | 대표님 선호 모델 |
| 용도 | 모의투자 분석 벤치마크 | 실투자 + 즉시분석 |
| 비용 | $0.15/1M input | 기존 그대로 |

## 구현 파일

| 파일 | 내용 |
|------|------|
| `web/db.py` | `soul_gym_rounds` 테이블 + 함수 3개 |
| `web/soul_gym_engine.py` | 핵심 진화 엔진 (변이 생성/벤치마크/채점/진화) |
| `web/handlers/soul_gym_handler.py` | API 엔드포인트 5개 |
| `web/mini_server.py` | 크론 등록 (월요일 03:00) + include_router |
| `web/templates/index.html` | 전력분석 탭 SOUL GYM 섹션 |
| `docs/architecture/soul-gym-algorithm.md` | 설계 문서 + Mermaid 다이어그램 |

## API 엔드포인트

| Method | URL | 설명 |
|--------|-----|------|
| POST | `/api/soul-gym/evolve/{agent_id}` | 특정 에이전트 진화 |
| POST | `/api/soul-gym/evolve-all` | 전체 6명 진화 |
| GET | `/api/soul-gym/history` | 진화 기록 조회 |
| GET | `/api/soul-gym/status` | 진행 상태 확인 |
| GET | `/api/soul-gym/config` | 설정 확인 |

## 핵심 설정

- 최소 개선폭: +3점 (EvoPrompt 논문 기반, watchlist 전 종목 평균)
- 비용 캡: $20/회
- 변이: A(규칙추가), B(표현강화), C(교차)
- 기록 보존: 모든 변이 DB 저장 (DGM 방식)

## 논문 기반

- EvoPrompt (ICLR 2024) — 변이 생성 + 토너먼트
- OPRO (Google DeepMind) — 메타프롬프트에 히스토리
- DGM (Sakana AI) — 모든 변이 보존 (다양성)
