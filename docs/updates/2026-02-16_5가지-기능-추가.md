# 5가지 기능 추가 + 보좌관 이름 최종 변경

## 버전
1.03.000

## 작업 날짜
2026-02-16

## 작업 브랜치
claude/fix-multi-provider-ai-chat

## 빌드 번호
배포 대기 중

---

## 변경 사항 요약

CEO가 승인한 5가지 기능 요청을 일괄 구현한 업데이트입니다.

### 수정한 파일 목록

| 파일 | 설명 | 주요 변경 |
|------|------|----------|
| `web/mini_server.py` (시스템 백엔드) | 5가지 기능 추가 | 노션 Date, 배치 버그, 도구 메타데이터, 도구 점검, 순차 협업 |
| `web/templates/index.html` (웹 화면) | 보좌관 이름 변경 | 총괄→기록, 전략→일정 |
| `config/agents.yaml` (에이전트 설정) | 보좌관 이름 변경 | 총괄→기록, 전략→일정 |
| `souls/agents/report_specialist.md` | 기록 보좌관 Soul | 이름+동료참조 변경 |
| `souls/agents/schedule_specialist.md` | 일정 보좌관 Soul | 이름+동료참조 변경 |
| `souls/agents/relay_specialist.md` | 소통 보좌관 Soul | 동료참조 변경 |
| `souls/agents/chief_of_staff.md` | 비서실장 Soul | 부하 이름 변경 |

---

### 6가지 변경 내역

#### 1. 노션 자동 업로드 — Date 속성 추가
- **문제**: 에이전트가 노션(Notion)에 보고서를 저장할 때 날짜가 빠져있었음
- **수정**: `_save_to_notion()` 함수에 `Date` 속성 추가
- **효과**: 노션 📤 에이전트 산출물 DB에서 날짜별로 보고서를 정렬/필터링할 수 있게 됨

#### 2. 배치 체인 버그 수정 (2가지)
- **버그 A — 보고서 중복 표시**: 같은 보고서가 2번 나오던 문제
  - **원인**: `_deliver_chain_result()` 함수가 2번 호출될 수 있었음
  - **수정**: `delivered` 플래그(깃발)를 추가해서, 이미 전달된 결과는 다시 보내지 않음

- **버그 B — "응답 없음" 결과**: 배치 처리 결과가 전부 비어있던 문제
  - **원인**: 종합 보고서 작성(synthesis)이 실패하면 빈 결과를 그냥 보내고 있었음
  - **수정**: 종합 보고서가 비었으면, 전문가들의 원본 분석 결과를 대신 보여줌 (폴백)
  - **효과**: "(종합 배치 실패 — 전문가 원본 결과)" 라는 제목과 함께 실제 분석 내용이 표시됨

#### 3. 보고서 메타데이터 — 사용한 도구 표시
- **변경**: 에이전트가 보고서를 작성할 때 어떤 도구를 사용했는지 자동으로 추적
- **표시**: 보고서 하단에 "🔧 **사용한 도구**: notion_tool, serpapi_tool, ..." 형태로 표시
- **효과**: CEO가 "이 분석은 어떤 도구로 했지?" 궁금할 때 바로 확인 가능

#### 4. 도구 건강 점검
- **새 API**: `GET /api/tools/health` — 111개 도구의 상태를 한눈에 확인
- **새 명령**: 사령관실에서 "전체 도구 점검" 또는 "도구 상태" 입력
- **표시 내용**: 전체 도구 수, 정상 작동 수, API 키 미설정 수, 미로드 수
- **API 키 필요 도구**: 어떤 도구가 어떤 환경변수(예: `SERPAPI_API_KEY`)가 필요한지 표시

#### 5. 에이전트 순차 협업 (릴레이 방식)
- **기능**: 에이전트들이 순서대로 작업하는 "릴레이" 모드
- **사용법**: "순차", "단계별", "릴레이", "연계" 등의 키워드가 포함된 명령
- **동작 방식**:
  1. 비서실장이 AI에게 "어떤 순서로 누가 일하면 좋을지" 물어봄
  2. 정해진 순서대로 각 에이전트가 작업 (앞 에이전트의 결과를 다음 에이전트에게 전달)
  3. 모든 에이전트 작업이 끝나면 비서실장이 최종 종합 보고서 작성
- **예시**: "순차 분석해줘: CTO가 기술 검토 → CSO가 보안 검토 → CPO가 사업성 평가"

#### 6. 보좌관 이름 최종 변경
- **변경 내용**:
  | 이전 이름 | 새 이름 | 역할 |
  |----------|---------|------|
  | 총괄 보좌관 | **기록 보좌관** | 보고서 요약/정리 |
  | 전략 보좌관 | **일정 보좌관** | 일정/기한/미결사항 추적 |
  | 소통 보좌관 | **소통 보좌관** (유지) | 부서 간 정보 중계 |
- **변경 범위**: 백엔드 AGENTS 리스트, 종합보고서 프롬프트, 프론트엔드 이름 매핑, Soul 파일 5개 (비서실장+보좌관 3명+연락관 동료참조)

---

## 현재 상태
- 커밋 완료, 푸시 완료 → 자동 머지 + 배포 대기 중

## 다음에 할 일
- 키움증권 Open API+ 연동 (모의투자 → 실거래)
- SNS API 키 등록 (인스타그램, 유튜브)
- 도메인 연결 (corthex.com)
- HTTPS 설정 (Let's Encrypt)
