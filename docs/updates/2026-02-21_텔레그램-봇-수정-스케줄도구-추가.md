# 2026-02-21 텔레그램 봇 수정 + schedule_tool 추가

## 변경 내용

### 1. 텔레그램 봇 /start 무반응 버그 수정
- **원인**: `set_my_commands()` (API 호출)를 `initialize()` 전에 실행 → 봇 시작 실패 → 모든 명령 무반응
- **수정**: `initialize()` → `delete_webhook()` → `set_my_commands()` 순서로 변경
- **추가**: `set_my_commands` 실패해도 봇은 정상 작동하도록 try-except 보호

### 2. schedule_tool 신규 추가 (일정보좌관용)
- **목적**: 텔레그램에서 자연어로 크론 예약 관리
- **예시**: "뉴스브리핑 평일 아침 8시반으로 바꿔" → AI 파싱 → `schedule_tool(action="update", cron="30 8 * * 1-5")`
- **기능**: list(조회), create(생성), update(수정), delete(삭제), toggle(활성화/비활성화)
- **파일**: `src/tools/schedule_tool.py`, `config/tools.yaml`, `src/tools/pool.py`
- **권한**: 일정보좌관 + 비서실장에 `schedule_tool` 추가

### 3. 크론 표현식 파서 추가
- **기존**: `cron_preset` (daily_9am, weekday_9am 등) 미리 정의된 것만 지원
- **추가**: 표준 5필드 크론 표현식 직접 파싱 (`"30 8 * * 1-5"` 같은 것)
- **지원**: `*`, 숫자, 범위(`1-5`), 리스트(`1,3,5`), 간격(`*/10`)
- **하위호환**: 기존 preset 기반 스케줄도 그대로 작동

### 4. @멘션 에이전트 호출 (이미 구현됨 확인)
- 텔레그램에서 `@일정 뉴스브리핑 켜줘` → 일정보좌관이 직접 처리
- `@cto 서버 점검해줘` → CTO에게 직접 지시
- 봇 수정으로 이제 사용 가능

## 수정 파일
| 파일 | 변경 |
|------|------|
| `web/arm_server.py` | TG봇 시작순서 수정 + 크론 파서 추가 |
| `src/tools/schedule_tool.py` | 신규 생성 |
| `config/tools.yaml` | schedule_tool 스키마 추가 |
| `config/agents.yaml` | 일정보좌관+비서실장에 schedule_tool 권한 |
| `src/tools/pool.py` | schedule_tool 임포트 등록 |
| `config/*.json` | yaml2json 동기화 |

## 발견한 버그
| 버그 | 상태 |
|------|------|
| TG봇 set_my_commands가 initialize 전에 호출되어 시작 실패 | ✅ 수정 |
| 크론 표현식(cron 필드)이 무시되고 preset만 사용됨 | ✅ 수정 |
