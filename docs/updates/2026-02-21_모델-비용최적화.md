# 모델 비용 최적화 + 권장 버튼 버그 수정

- **날짜**: 2026-02-21
- **브랜치**: claude/model-optimization
- **버전**: 3.02.018

---

## 변경 내용

### 1. 전 직원 모델 재배치 (비용 최적화)
API 비용 $86 문제 해결을 위해, 최신 벤치마크(Gemini 3.1 Pro 1위, Claude 한국어 최강 등)를 기반으로 29명 에이전트의 모델과 추론 레벨을 역할별로 최적 재배치.

**변경 전 → 후 요약:**
| 모델 | 변경 전 | 변경 후 | 단가 변화 |
|------|---------|---------|-----------|
| Opus ($5/$25) | 4명 | 1명 (CTO만) | -75% |
| Sonnet ($3/$15) | 14명 | 8명 | -43% |
| Gemini 3.1 Pro ($2/$12) | 4명 | 13명 | 구글 무료 크레딧 활용 |
| Gemini 2.5 Flash ($0.15/$0.6) | 0명 | 3명 | 초저가 |
| GPT-5.2 ($1.75/$14) | 5명 | 4명 | 시황/기술적분석 → Gemini |
| Haiku ($0.8/$4) | 3명 | 0명 | Flash로 대체 |

**부서별 배치:**
- 비서실: 비서실장(Sonnet medium), 정보/일정 보좌관(Flash low), 검수관(Sonnet medium)
- 기술처: CTO(Opus high), 나머지 3명(3.1 Pro low)
- 전략처: CSO(3.1 Pro high), 시장조사(3.1 Pro low), 사업기획(3.1 Pro high), 재무(GPT-5.2 high)
- 법무처: CLO/저작권/특허(Sonnet medium) — 한국어 정밀도 필요
- 마케팅처: CMO/설문/콘텐츠/커뮤니티(3.1 Pro low) — 이미지+속도+무료크레딧
- 투자처: CIO/종목분석/리스크(GPT-5.2 high), 시황/기술적분석(3.1 Pro low)
- 출판처: CPO/사사편찬/콘텐츠편집(Sonnet medium), 아카이브(Flash low)

**reasoning_effort 최적화:**
- xhigh 완전 제거 (비용 대비 효과 미미)
- 처장급: medium~high, 실무진: low (Gemini 3.1 Pro는 low/high만 지원)

### 2. '권장' 버튼 복귀 버그 수정
대시보드에서 모델을 수동 변경한 뒤 '권장' 버튼을 누르면 원래 값으로 안 돌아가는 버그.
- **원인**: `apply_recommended_models()`가 메모리의 `AGENTS` 리스트를 읽는데, 사용자가 모델을 변경하면 이 리스트도 같이 변경됨
- **수정**: `_load_config("agents")`로 config 파일 원본에서 직접 읽도록 변경
- `get_recommended_models()` API도 동일하게 수정

---

## 수정한 파일

| 파일 | 변경 내용 |
|------|-----------|
| `config/agents.yaml` | 29명 model_name + reasoning_effort 재배치 |
| `config/agents.json` | yaml2json 변환 |
| `web/arm_server.py` | _AGENTS_FALLBACK 동기화 + 권장 버튼 버그 수정 |

---

## 예상 비용 절감 효과
- Opus 4→1명: ~$60/day → ~$15/day
- xhigh 제거: 추론 토큰 약 40% 절감
- Gemini 무료 크레딧 13명 적용: 비용 0
- **예상 총 절감: 기존 대비 60~70%**
