# 포트폴리오/CIO성과/모의매매/교신로그 7개 버그 수정 — 2026-02-21

## 기본 정보
- **날짜**: 2026-02-21
- **버전**: 3.01.005
- **브랜치**: claude/fix-log-issues
- **빌드**: 배포 후 확인

---

## 변경 사항

### 🔧 수정한 것

| 파일 | 수정 내용 |
|------|----------|
| `web/templates/index.html` | **교신로그 새로고침 시 사라지는 문제 수정** — init()에서 fetchDelegationLogs() + _connectCommsSSE() 호출 추가. 이제 Ctrl+Shift+R해도 교신로그 유지 |
| `web/mini_server.py` | **포트폴리오 환전 손익 오류 수정** — 환전(원→달러)을 손실로 계산하던 버그. 이제 보유종목 매매 손익만 계산 (KIS eval_profit 사용) |
| `web/mini_server.py` | **포트폴리오 "총 입금액" 기준 PnL 추가** — 환전과 무관한 전체 투자금 기준 손익 계산 (`portfolio_total_deposit` 설정) |
| `web/templates/index.html` | **포트폴리오 "총 입금액" 입력 필드 추가** — 초기 자금 설정 UI에 총 입금액 칸 추가 |
| `web/mini_server.py` | **CIO 성과 탭 수정** — save_cio_prediction() 호출 추가. CIO 시그널 생성 시 예측 DB에 자동 저장 → 성과 추적 시작 |
| `web/mini_server.py` | **기밀문서 전체 분석 저장** — CIO 독자 사전분석 + 최종 종합분석 전문 + 종목별 요약 모두 기밀문서에 저장 |
| `web/mini_server.py` | **모의매매 enable_real/enable_mock 설정 반영** — 서버가 체크박스 설정을 실제로 읽도록 수정. 기본 설정에도 추가 |

### 🐛 발견한 버그

| 버그 | 원인 | 상태 |
|------|------|------|
| 교신로그 새로고침 시 사라짐 | init()에서 교신로그 로드 안 함 (활동로그만 함) | ✅ 수정 완료 |
| 포트폴리오 환전 = 손실 -59.99% | 한국/미국 초기자금을 각각 첫 조회 시점 잔고로 자동 설정 | ✅ 수정 완료 |
| CIO 성과 탭 전부 0 | save_cio_prediction() 정의만 있고 호출 없음 | ✅ 수정 완료 |
| 기밀문서에 간략한 요약만 저장 | 파싱된 1줄 요약만 저장, CIO 전체 분석 미포함 | ✅ 수정 완료 |
| enable_real/enable_mock 무시 | UI 체크박스는 있지만 서버가 안 읽음 | ✅ 수정 완료 |
| 모의투자 KIS 주문 미구현 | kis_client.py에 mock order 함수 없음 | 🔴 미수정 (다음 세션) |

### 📊 현재 상태
- 포트폴리오: 보유종목 매매 손익만 표시 (환전 영향 제거)
- CIO 성과: 다음 분석부터 예측 DB에 기록 → 3일/7일 후 검증 가능
- 기밀문서: CIO 독자분석 + 종합분석 + 종목별 요약 전부 저장
- 교신로그: 새로고침 후에도 유지 + SSE 실시간

### 📋 다음에 할 일
- CEO가 포트폴리오에서 "총 입금액 = ₩500,000" 설정 필요
- KIS 모의투자 주문 함수 구현 (kis_client.py에 mock_order 추가)
- CIO 예측 3일/7일 자동 검증 로직 활성화
