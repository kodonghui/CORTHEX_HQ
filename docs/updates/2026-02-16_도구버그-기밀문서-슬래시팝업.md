# 도구 0개 버그 수정 + 기밀문서 UX 개선 + 슬래시 명령어 팝업

## 버전
1.04.000

## 작업 날짜
2026-02-16

## 작업 브랜치
claude/fix-multi-provider-ai-chat

## 빌드 번호
#154

---

## 변경 사항 요약

CEO가 보고한 4가지 이슈 수정 + 2가지 시스템 검증 완료.

### 수정한 파일 목록

| 파일 | 설명 | 주요 변경 |
|------|------|------------|
| `.gitignore` | git 무시 설정 | config JSON 무시 해제 |
| `config/tools.json` | 도구 목록 (JSON) | 새로 생성 (YAML→JSON 변환) |
| `config/agents.json` | 에이전트 목록 (JSON) | 새로 생성 |
| `config/quality_rules.json` | 품질 검수 기준 (JSON) | 새로 생성 |
| `web/arm_server.py` | 시스템 백엔드 | _load_config() 보험 로직 추가 |
| `web/db.py` | DB 함수 | list_archives()에 agent_id 추가 |
| `web/templates/index.html` | 웹 화면 | 기밀문서 한글화 + 직급필터 + 슬래시팝업 |

---

### 6가지 변경 내역

#### 1. 도구 0개 버그 — 근본 원인 해결
- **문제**: `/도구점검`이 항상 "전체 도구 0개" 반환
- **근본 원인**: `.gitignore`에 `config/tools.json`과 `config/agents.json`이 무시 설정되어 있었음
  - JSON 파일이 git에 포함 안 됨 → 서버에도 없음
  - 서버에서 YAML→JSON 변환도 실패 (PyYAML 문제)
  - 결과: `_TOOLS_LIST = []` (빈 목록)
- **수정**:
  1. `.gitignore`에서 JSON 무시 삭제
  2. 로컬에서 YAML → JSON 변환 후 커밋 (3개 파일)
  3. `_load_config()` 함수에 보험: YAML 읽은 후 JSON 자동 생성
- **결과**: 서버 로그에 "ToolPool 초기화 완료: 150개 도구 로드" 확인

#### 2. 기밀문서 — 영어 파일명 → 한글 작성자 + 날짜/시간
- **이전**: `cio_manager_synthesis_20260216_163603.md` (영어 파일명)
- **이후**: `CIO 투자분석처장 · 2/16 오후 4:36` (한글 작성자 + 시간)
- **구현**: `getArchiveAuthor()`, `formatArchiveDate()` 헬퍼 함수 추가
- `db.py`의 `list_archives()`에 `agent_id` 컬럼 추가하여 작성자 정보 제공

#### 3. 기밀문서 — 직급별 필터 추가
- **이전**: 부서 필터만 있음 (전체/CTO/CSO/CLO/CMO/CIO)
- **이후**: 부서 필터 + 직급 필터 2단 구조
  - 직급: 전체 / 임원급(C-Level) / 전문가급 / 보좌관급
  - 두 필터를 동시에 적용 가능 (예: "금융분석팀 + 전문가급만")
- **구현**: `getAgentTier()`, `getAgentTierLabel()` 함수 추가

#### 4. 슬래시 명령어 자동완성 팝업
- **이전**: 명령어를 직접 외워서 입력해야 함
- **이후**: `/` 입력하면 Discord/Slack처럼 명령어 팝업이 뜸
- **팝업에 표시되는 6개 명령어**:
  | 명령어 | 설명 |
  |--------|------|
  | `/전체 [메시지]` | 6명 처장에게 동시 지시 |
  | `/순차 [메시지]` | 에이전트 릴레이 모드 |
  | `/도구점검` | 전체 도구 상태 확인 |
  | `/배치실행` | Gemini 배치 모드 실행 |
  | `/배치상태` | 배치 작업 진행 확인 |
  | `/명령어` | 전체 명령어 목록 |
- **키보드 지원**: 화살표 ↑↓로 선택, Enter/Tab으로 삽입, Esc로 닫기

#### 5. 노션 연동 — 원인 확인
- **문제**: 에이전트 보고서가 노션에 저장 안 됨
- **원인**: GitHub Secrets에 `NOTION_API_KEY`가 등록되어 있지 않음
  - 코드는 정상 (API 키가 없으면 조용히 건너뛰는 설계)
  - CEO가 GitHub → Settings → Secrets에 노션 API 키를 추가해야 해결됨
- **코드 수정**: 없음 (설정 문제)

#### 6. 지휘 체계 검증 — 정상 확인
- **질문**: "비서실장이 스페셜리스트에게 직접 지시하나?"
- **답변**: 아니요, 정상적으로 3단계 계층 유지
  - 비서실장 → 해당 처장 → 소속 전문가들
  - 비서실장이 직접 지시하는 건 자기 소속 보좌관 3명(기록, 일정, 소통)뿐
- **코드 확인 완료**: `_manager_with_delegation()`, `_delegate_to_specialists()`, `_broadcast_to_managers()` 모두 정상

---

## 현재 상태
- 빌드 #154 배포 완료, 모든 기능 정상 동작

## 다음에 할 일
- 노션 API 키 등록 (GitHub Secrets → `NOTION_API_KEY`)
- 키움증권 Open API+ 연동
- 도메인 연결 (corthex.com)
- HTTPS 설정 (Let's Encrypt)
