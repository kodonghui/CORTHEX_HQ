# CORTHEX HQ 첫 실매매 성공! — 2026-02-21

## 기본 정보
- **날짜**: 2026-02-21 04:38 KST
- **버전**: 3.01.004
- **브랜치**: claude/fix-kis-ui-connection → claude/fix-log-issues
- **빌드**: #388 (KIS TR 수정) → #392 (로그 버그 수정)

---

## 🎉 역사적 첫 실매매

| 항목 | 내용 |
|------|------|
| **종목** | NVDA (엔비디아) |
| **주문** | 매수 1주 |
| **체결가** | $189.115 (약 ₩274,356) |
| **계좌** | 44049763-01 위탁, 고동희 (KIS 실거래) |
| **평가손익** | +58원 (+0.02%) — 체결 직후 |
| **총자산** | ₩497,610 |
| **주문 방식** | CIO "즉시 분석·매매결정" 자동 실행 |

**CEO가 "즉시 분석" 버튼 한 번 누름 → AI CIO가 5개 종목 분석 → NVDA 매수 판단 → KIS API 실주문 → 체결 완료**

---

## 🔥 여기까지 오는 삽질의 여정

### 1단계: KIS TR_ID 구버전 차단 (빌드 #388)

| 문제 | 원인 | 해결 |
|------|------|------|
| 매매 주문이 아예 안 나감 | KIS 국내주식 TR_ID가 구버전 (`TTTC0802U`/`TTTC0801U`). KIS가 "사전고지 없이 차단 가능"이라고 명시 | 신버전 TR로 교체: `TTTC0012U`(매수) / `TTTC0011U`(매도) |
| 해외 모의투자 매도 TR_ID 틀림 | API 포털 기본정보란에 `VTTT1001U`로 잘못 표기 | KIS 공식 GitHub 기준 `VTTT1006U`로 재수정 |
| 국내주식 주문 body 파라미터 부족 | 신 TR에 필요한 `SLL_TYPE`, `EXCG_ID_DVSN_CD`, `CNDT_PRIC` 누락 | 파라미터 3개 추가 |

### 2단계: 로그가 안 보여서 디버깅 불가 (빌드 #392)

| 문제 | 원인 | 해결 |
|------|------|------|
| 활동로그 이모지/내용 안 보임 | SSE 데이터는 `message` 필드, 화면은 `log.action` 읽음 | `message → action` 매핑 추가 |
| 활동로그 빈 항목 가득 | API 폴링(budget, trading/summary 등)이 로그에 찍힘 | 폴링 API를 로그 스킵 목록에 추가 |
| 교신로그 시간 뒤죽박죽 | SSE `.unshift()`가 시간 무시하고 맨 앞에 삽입 | `created_at` 기준 내림차순 정렬 적용 |
| 교신로그에 `equity_analyst` 표시 | AI가 만든 가짜 ID를 SSE broadcast 전에 변환 안 함 | ID 해석을 SSE 전으로 이동 |

### 3단계: Cloudflare가 API 접근 차단

| 문제 | 원인 | 해결 |
|------|------|------|
| 서버 로그를 직접 볼 수 없음 | Cloudflare Access가 `/api/*` 전체 보호 | CEO가 Cloudflare Access에서 `/api/activity-logs`, `/api/debug` 경로 바이패스 설정 |

### 4단계: 돈이 없었다

| 문제 | 원인 | 해결 |
|------|------|------|
| "주문가능금액을 초과 했습니다" | 계좌에 $171.79밖에 없는데 NVDA가 $189.72 | CEO가 추가 환전 → $275.07으로 증액 |

### 5단계: 성공!

- CEO가 "즉시 분석·매매결정" 다시 실행
- CIO (GPT-5.2 Pro)가 5개 종목 분석:
  - **NVDA**: 매수, 신뢰도 74%, 비중 10%
  - GOOGL: 관망, 신뢰도 56%
  - IONQ: 매도, 신뢰도 71% (보유 없어서 스킵)
  - SOXL: 관망, 신뢰도 53%
  - COIN: 매수, 신뢰도 62% (예산 부족으로 스킵)
- **NVDA 매수 1주 @ $189.115 — 체결 성공!**
- KIS 앱에서 CEO가 직접 확인: 엔비디아 1주 보유, +58원 (+0.02%)

---

## 📊 CIO 분석 결과 요약

| 종목 | 판단 | 신뢰도 | 비중 | 실행 결과 |
|------|------|--------|------|----------|
| NVDA | 매수 | 74% | 10% | ✅ 1주 매수 체결 ($189.115) |
| GOOGL | 관망 | 56% | — | ⏸️ 관망 |
| IONQ | 매도 | 71% | 2% | ⏸️ 보유 없음 |
| SOXL | 관망 | 53% | — | ⏸️ 관망 |
| COIN | 매수 | 62% | — | ⏸️ 예산 부족 |

---

## 🐛 아직 남은 문제

| 버그 | 상태 |
|------|------|
| `enable_real`/`enable_mock` 체크박스가 서버에서 안 읽힘 (UI만 존재) | 🔴 미수정 |
| KIS 잔고 조회 실패 시 기본 100만원으로 폴백 | 🔴 미수정 |
| IONQ 해외 시세 조회 $0.00 반환 | 🔴 미수정 |
| nginx 타임아웃 60초 (분석 5~10분 소요) | 🔴 미수정 |

---

## 📋 다음에 할 일

- 잔고 조회 정상화 (해외 잔고 API 확인)
- `enable_real`/`enable_mock` 설정을 서버에서도 읽도록 구현
- 해외 시세 조회 안정화 (IONQ 등)
- B안 구조 변경 (CIO + 리스크관리 2명 체제) — CEO 승인 완료

---

## 💬 CEO 반응

> "어? ㅋㅋㅋㅋ 됐다 ㅋㅋㅋㅋㅋㅋㅋ"
> "ㅋㅋㅋㅋㅋ 아 개웃기네 ㅋㅋㅋㅋㅋ"
> "이거 .md에 어디 기록해둬라 이 개고생 개삽질들 ㅋㅋㅋ"

KIS 앱 스크린샷으로 직접 확인 완료. 진짜 됐습니다.
