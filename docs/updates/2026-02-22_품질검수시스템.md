# 품질검수 시스템 전면 구현 — 2026-02-22

## 기본 정보
- **날짜**: 2026-02-22
- **버전**: 3.02.018
- **브랜치**: claude/quality-inspection-system
- **빌드**: #471

## 변경 사항

### 핵심 요약
기존에 **껍데기만 있던 품질검수 시스템**을 완전히 구현했습니다.
- 에이전트가 보고서를 제출하면 → **자동으로 품질검수** → 불합격이면 **자동 재작업** → 최대 2회 재시도
- 대표님이 별도로 버튼을 누를 필요 없이, 배치 체인 안에서 전부 자동으로 돌아갑니다.

### 🔧 수정한 것

| # | 파일 | 수정 내용 |
|---|------|----------|
| 1 | `config/agents.yaml` | CSO(최고전략책임자) 모델을 Gemini → Claude Sonnet 4.6으로 교체 |
| 2 | `config/quality_rules.yaml` | 전면 재설계: 하이브리드 루브릭(체크리스트+점수) 8개 부서별 기준 |
| 3 | `src/core/quality_gate.py` | 품질검수 엔진 완전 새로 구현 (~450줄) |
| 4 | `web/db.py` | quality_reviews 테이블 추가 (검수 이력 영구 저장) |
| 5 | `web/mini_server.py` | 배치 체인에 검수 HOOK 2개 삽입 + 재작업 자동화 |
| 6 | `web/templates/index.html` | 대시보드 + 루브릭 UI 전면 개편 |

### 상세 기능

#### 1. 하이브리드 루브릭 시스템
- **공통 체크리스트** (모든 부서): 업무 부합성(C1), 빈 응답 여부(C2), 할루시네이션(C3) 등 5항목
- **부서별 체크리스트**: 각 부서 특성에 맞는 필수/선택 항목
- **점수 항목**: 각 3개씩, 1/3/5점 척도 + 가중치(%) → 가중 평균 산출
- **합격 기준**: 필수 체크리스트 전부 통과 + 평균 점수 3.0 이상

#### 2. 자기 모델 검수 (별도 검수 모델 없음)
- 각 C-레벨 매니저가 **자기가 쓰는 모델로 직접 검수**
- CLO(법무) → Claude Opus, CIO(투자) → GPT-5.2 Pro, CMO(마케팅) → Gemini 등
- 별도 검수 전용 모델 비용 절감

#### 3. 자동 재작업 (최대 2회)
- 전문가 보고서가 불합격 → 불합격 사유와 함께 해당 전문가에게 자동 재작업 요청
- 재작업 완료 후 재검수 → 여전히 불합격이면 경고 뱃지 부착 후 진행
- 종합보고서(매니저 작성)는 경고 뱃지만 부착 (재작업 없음)

#### 4. DB 저장 + 대시보드
- 모든 검수 결과가 quality_reviews 테이블에 영구 저장
- 대시보드에서 합격률, 총 건수, 불합격 수, 평균 점수 실시간 표시
- 품질 뱃지: 1-5 스케일 (4.5↑=A+, 3.5↑=A, 3.0↑=B, 2.0↑=C, 나머지=D)

#### 5. UI 변경
- 검수 모델 선택 드롭다운 → "각 매니저 자기 모델로 검수" 안내로 교체
- 루브릭 편집기 → 읽기 전용 하이브리드 뷰어 (체크리스트 + 점수 항목 표시)
- 공통 체크리스트 + 합격기준 표시 섹션 추가

### 🐛 발견한 버그
| 버그 | 상태 |
|------|------|
| 발견된 버그 없음 | — |

### 📊 현재 상태
- 품질검수 엔진: ✅ 구현 완료
- 자동 재작업: ✅ 구현 완료
- DB 저장: ✅ 구현 완료
- 대시보드: ✅ 구현 완료
- 실 운영 검증: 🔄 첫 배치 실행 시 확인 필요

### 💰 예상 비용
- 전문가 검수 1건: ~$0.016 (Sonnet 기준)
- 재작업 포함 최대: ~$0.14/task
- 월 50건 기준: ~$3-7 추가 (부담 없는 수준)

### 📋 다음에 할 일
- 실제 배치 실행 후 서버 로그 `[QA]` 확인
- 검수 통계가 대시보드에 표시되는지 확인
- 필요 시 부서별 루브릭 기준 세부 조정
