# 리팩토링 Step 1 + 노션 corthex.hq 전환 + CLAUDE.md 정비 — 2026-02-23

## 기본 정보
- **날짜**: 2026-02-23
- **버전**: 3.02.018
- **브랜치**: claude/refactor-step1-broadcast
- **빌드**: 배포 후 갱신

## 변경 사항

### 핵심 요약
1. **리팩토링 Step 1 완료**: mini_server.py에 30곳 복사-붙여넣기된 브로드캐스트 코드를 `ws_manager.py` 1곳으로 통합
2. **노션 API 키 전환**: elddlwkd(개인) → corthex.hq(회사) 워크스페이스로 전면 교체
3. **CLAUDE.md 정비**: 메모리 금지 규칙 + 기술 설명 규칙 추가
4. **비개발자용 리팩토링 가이드 작성**: `docs/refactoring-guide.md`
5. **CEO 아이디어 #005~#006 추가**: 메모리 금지 원칙 + 리팩토링 설명 원칙

### 수정한 파일

| # | 파일 | 수정 내용 |
|---|------|----------|
| 1 | `web/ws_manager.py` | **신규** — WebSocket/SSE 브로드캐스트 매니저 (방송실) |
| 2 | `web/mini_server.py` | 30곳 브로드캐스트 루프 → `wm.broadcast()` 호출로 교체 |
| 3 | `.env.local` | 노션 API 키 corthex.hq로 교체 + DB ID 추가 |
| 4 | `CLAUDE.md` | 메모리 금지 규칙 최상단 추가, 기술 설명 규칙 추가 |
| 5 | `docs/project-status.md` | 리팩토링 진행 상황 + 오늘 작업 내역 |
| 6 | `docs/refactoring-guide.md` | **신규** — 비개발자용 리팩토링 가이드 (왜/어떻게/뭐가좋아지나) |
| 7 | `docs/ceo-ideas.md` | #005 메모리 금지 원칙 + #006 리팩토링 설명 원칙 추가 |

### GitHub Secrets 변경

| Secret | 변경 내용 |
|--------|----------|
| `NOTION_API_KEY` | elddlwkd → corthex.hq 키로 교체 |
| `NOTION_DB_SECRETARY` | corthex.hq 비서실 DB ID 등록 |
| `NOTION_DB_OUTPUT` | corthex.hq 에이전트 산출물 DB ID 등록 |
| `NOTION_DEFAULT_DB_ID` | corthex.hq 기본 DB ID 등록 |

### 노션 페이지 업데이트 (corthex.hq 워크스페이스)

| 페이지 | ID | 추가 내용 |
|--------|-----|----------|
| CORTHEX 아키텍처 | `30a56b49-78dc-8147-...` | 서버 구조, 리팩토링 진행 상황, 용어 설명 |
| CORTHEX 기술 문서 | `30a56b49-78dc-81ad-...` | 리팩토링 계획, 기능 체크리스트, 용어 설명 |

### 발견한 버그

| 버그 | 상태 |
|------|------|
| 노션 MCP 연결 2개 중 `claude_ai_Notion`이 elddlwkd에 연결됨 | ✅ 대표님이 disconnect 처리 |

### 다음에 할 일
- Step 2: 전역 상태 관리 모듈 (44개 전역변수 → AppState 클래스)
- Step 3~14: 리팩토링 나머지 단계 순차 진행
