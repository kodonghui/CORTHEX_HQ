# 버그 4개 수정 — 진행률 %, AI 응답 표시, UI 레이아웃

## 버전
0.09.001

## 작업 날짜
2026-02-18

## 작업 브랜치
claude/bugfix-progress-ai-response-ui

---

## 변경 사항 요약

CEO가 발견한 4가지 버그를 모두 수정했습니다.

### 수정한 파일

| 파일 | 역할 | 변경 내용 |
|------|------|----------|
| `web/app.py` (백엔드 서버) | AI 작업 실행 | 버그 1·2 수정: 잘못된 에이전트 상태 초기화 코드 삭제 |
| `web/templates/index.html` (웹 대시보드) | 화면 전체 | 버그 1·2·3·4 수정: Alpine.js 반응성, WS 재연결 폴링, 메시지 키, UI 레이아웃 |

---

### 버그 1 & 2: 사이드바 및 채팅창에 진행률(%) 안 뜨는 문제

**증상**: 에이전트가 일하는 동안 사이드바와 채팅창에 항상 0%로 고착됨

**원인 1 — app.py (레이스 컨디션)**
- 명령을 받자마자 작업 시작 전에 모든 에이전트를 즉시 "대기(idle)" 상태로 리셋하는 코드가 있었음
- 작업을 백그라운드에 넘기기 전에 이미 리셋해버리니 진행률이 표시될 틈이 없었음
- **수정**: 해당 리셋 코드 7줄 삭제 (작업 완료 후에 리셋하는 코드는 이미 올바르게 있었음)

**원인 2 — index.html (Alpine.js 반응성 문제)**
- JavaScript(프론트엔드)에서 에이전트 진행률 정보를 객체에 직접 추가하는 방식으로 저장
- Alpine.js(화면 자동 업데이트 엔진)는 기존 객체에 **새 항목을 추가하는 것을 감지 못함**
- **수정**: 객체 전체를 새로 교체하는 방식(spread operator)으로 변경 → Alpine.js가 변화를 확실히 감지

**수정 코드 요약:**
```javascript
// 수정 전 (감지 안 됨)
this.activeAgents[d.agent_id] = { status, progress, detail };

// 수정 후 (전체 교체 → 감지됨)
this.activeAgents = { ...this.activeAgents, [d.agent_id]: { status, progress, detail } };
```

---

### 버그 3: 대화창에 AI 응답이 안 뜨는 문제

**증상**: CEO 명령만 보이고 AI가 일은 다 했는데 결과가 안 뜸

**원인 1 — WS(실시간 통신) 재연결 중 결과 유실**
- AI 작업 도중 인터넷 연결이 잠깐 끊겼다가 다시 연결될 때
- 끊겨 있는 동안 완료된 작업 결과를 받지 못함
- **수정**: 재연결 시 `/api/tasks/{작업ID}` API를 조회해서 놓친 결과를 다시 가져오는 로직 추가

**원인 2 — 메시지 목록 키(key) 충돌**
- 메시지 목록을 화면에 그릴 때 순서 번호(0, 1, 2...)로 각 메시지를 구분
- "처리중" 메시지가 사라지고 "결과" 메시지가 추가될 때 번호가 겹쳐서 DOM(화면 구조) 재사용 혼란 발생
- **수정**: 각 메시지에 고유 ID(생성 시각 기반)를 부여해서 확실하게 구분

---

### 버그 4: 입력창 하단 버튼들이 다른 행에 있어서 지저분한 문제

**증상**: 프리셋 버튼, 내보내기 버튼이 제각각 다른 줄에 놓임

**원인**: `flex-wrap`(내용이 넘치면 자동으로 다음 줄로 내림) 설정이 있어서 버튼들이 줄바꿈됨

**수정**: 레이아웃 구조 변경
- 프리셋 버튼 영역: 가로 스크롤(overflow-x-auto)로 처리 → 줄바꿈 없이 옆으로 스크롤
- 내보내기 버튼: 항상 맨 오른쪽 끝에 고정(shrink-0)
- 결과: 한 줄에 깔끔하게 정렬됨

---

## 현재 상태
- 4가지 버그 수정 완료
- 커밋 및 배포 완료

## 다음에 할 일
- 서버(http://168.107.28.100) 에서 4가지 수정 사항 직접 확인
- 진행률 %, AI 응답 정상 표시 여부 확인
- 다음 우선 작업: 에이전트 소울 설정, 노션 API 연결
