# 2026-03-02 Mermaid 파서 수정 + 빠른 배포 세팅

## 작업 내용

### 1. Mermaid→Drawflow 파서 버그 수정 (PR #751, 빌드 #814)

**문제**: "맞아" 클릭 후 노드 이름이 B/C/D/E (Mermaid 변수명)로 표시되고, 모두 파란 사각형

**원인**: `A([시작]) --> B{결정 분기}` 같은 인라인 노드 정의가 포함된 엣지 라인을 파서가 처리 못함
- 엣지 regex `^([\w]+)\s*--[->]+\s*([\w]+)` → `A([시작])`의 `(` 때문에 매칭 실패
- 결과: B, C, D, E가 자동으로 ID를 레이블로, system 타입으로 폴백

**수정**: `parseNodeToken` 헬퍼 함수 도입
- 엣지 라인에서 src/tgt 토큰 전체를 캡처 후 모양+레이블 동시 추출
- `[[label]]` 이중 대괄호 (Mermaid subroutine) → system 타입 추가
- `/label\` 평행사변형 → 슬래시 제거해서 레이블 정리

**파일**: `web/static/js/corthex-app.js` - `_parseMermaidNodes()`

---

### 2. SSH 빠른 배포 스크립트 (PR #752, 빌드 #815)

**문제**: 버그 하나 고칠 때마다 GitHub Actions 3분 대기

**해결**: `deploy-fast.sh` 스크립트 생성
- `~/.ssh/config`에 이미 corthex-hq.com SSH 설정됨 확인
- git push → SSH 직접 접속 → git reset --hard → systemctl restart → 헬스체크
- 소요 시간: ~30초

**사용법**: `bash deploy-fast.sh` (main 브랜치에서)

**주의**: env 파일(API 키) 갱신 안 됨 → 새 API 키 추가 시엔 GitHub Actions 사용
