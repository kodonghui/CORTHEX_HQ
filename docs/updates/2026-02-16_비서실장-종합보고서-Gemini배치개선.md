# 비서실장 종합 보고서 시스템 + Gemini Batch API 개선

## 버전
1.01.000

## 작업 날짜
2026-02-16

## 작업 브랜치
claude/fix-multi-provider-ai-chat

## 빌드 번호
#146

---

## 변경 사항 요약

### 1. 비서실장 종합 보고서 시스템

**뭐가 바뀌었나요?**

CEO가 "전체 출석체크"같은 브로드캐스트 명령을 내리면, 기존에는 6개 처장 보고서가 그냥 쭉 나열되었습니다.
이제는 **비서실장이 모든 보고를 종합해서 CEO용 보고서 1개를 만들어줍니다**.

**비서실장 종합 보고서 구조:**
- **핵심 요약** — 전체 상황을 1~2문장으로 요약
- **부서별 한줄 요약** — 6개 부서를 표(테이블)로 한눈에 정리
- **CEO 결재/결정 필요 사항** — CEO가 결정해야 할 것만 체크리스트로 추출
- **특이사항/리스크** — 위험요소만 따로 모음
- **비서실 보좌관 보고** — 총괄/전략/소통 보좌관 각 1줄 요약

**채널별 분리:**
- **사령실(웹)** / **텔레그램**: 비서실장 종합 보고서만 표시
- **기밀문서 탭**: 각 처장의 상세 보고서 전체를 필터로 확인 가능
- 보고서 하단에 "상세 보고서 N건이 기밀문서에 저장되었습니다" 안내 표시

### 2. 비서실 보좌관 브로드캐스트 포함

**문제**: 비서실 보좌관 3명(총괄/전략/소통)이 브로드캐스트에 응답하지 않았음
**원인**: `_MANAGER_SPECIALISTS` 딕셔너리(사전)에 비서실(`chief_of_staff`) 키가 빠져있었음
**해결**: `chief_of_staff` 키를 추가하여 보좌관 3명도 동시 호출 대상에 포함

### 3. Gemini Batch API 개선

**문제**: Gemini 배치 요청에 `generationConfig`(온도, 최대 출력 길이)가 빠져있었음
**해결**: CEO가 제공한 Google Apps Script 참고하여 다음 설정을 추가:
- `temperature: 0.3` (낮을수록 일관성 있는 답변)
- `max_output_tokens: 4096` (최대 출력 길이)

---

## 수정된 파일

| 파일 | 설명 | 변경 내용 |
|------|------|----------|
| `web/mini_server.py` (미니 서버) | 웹 서버 백엔드 | `_broadcast_to_managers()` 함수 전체 재작성 + `_MANAGER_SPECIALISTS`에 비서실 추가 |
| `web/ai_handler.py` (AI 처리기) | AI API 호출 담당 | Gemini 배치 요청에 `generation_config` 추가 |
| `docs/project-status.md` (프로젝트 현황) | 현재 상태 기록 | 항목 47~48 추가, 버전/빌드 번호 갱신 |

---

## 현재 상태

- 비서실장 종합 보고서 시스템: **구현 완료, 배포됨 (빌드 #146)**
- Gemini 배치 API 개선: **구현 완료, 배포됨**
- 텔레그램 연동: **이미 구현되어 있음** (추가 작업 불필요)

---

## 다음에 할 일

1. 서버에서 "전체 출석체크" 실제 테스트 (비서실장 종합 보고서 확인)
2. 키움증권 Open API+ 연동 (모의투자 → 실거래)
3. 노션 API 키 등록 + 보고 시스템 활성화
4. 도메인(corthex.com 등) 연결
