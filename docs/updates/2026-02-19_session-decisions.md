# 2026-02-19 세션 결정사항 + 진행 컨텍스트

> **목적**: 컴팩트(대화 압축) 대비. 이 파일을 읽으면 세션 맥락을 완전히 복구할 수 있음.
> **브랜치**: 아직 브랜치 미생성 (논의 중 — 논의 끝나면 생성 예정)
> **배포**: 논의 다 끝난 후 한번에 배포

---

## 결정된 사항 (구현 대기 중)

### 1. 에이전트 간 P2P 협업 (B안 승인)
- **내용**: 각 에이전트가 필요하면 다른 에이전트를 도구로 직접 호출
- **구현 위치**: `config/tools.yaml`에 `ask_agent` 도구 추가 + `ai_handler.py` + `mini_server.py`
- **우선순위**: 중간 (설계 논의 중)

### 2. 내부통신 실시간화 (SSE 방식 — 승인)
- **내용**: 5초 폴링 → SSE(Server-Sent Events) 즉시 반영으로 교체
- **구현**: BE에 `EventSourceResponse`, FE에 `EventSource` 구독
- **수정 파일**: `mini_server.py` + `index.html`

### 3. 인터벌 누수 버그 수정 (승인)
- **위치**: `index.html`의 `toggleDelegationLog()` 함수
- **수정**: `setInterval` 전에 `if (this._delegationPollTimer) clearInterval(this._delegationPollTimer)` 추가

### 4. 처장급 독자 분석 강화 (승인, 논의 중)
- **4-1 (CIO)**: 좁게 승인 — 투자처(CIO + 전문가 4명) 범위에서 CIO 독자 분석 먼저
- **4-2 (CMO 등 전체 처장)**: 모든 처장이 독자 분석을 하고 있는지, 종합만 하는지 확인 필요
  - 아이디어 A안: 각 처장이 1단계 독자 분석 → 2단계 팀원 보고서 → 3단계 통합
  - 아이디어 B안: 처장 응답에 "처장 의견" 섹션 명시적 분리
  - **CEO 질문에 아직 대답 못한 것**: "처장들이 독자 분석하는지, 종합만 하는지 알 수 있냐?"
  - → 코드 확인 + 현황 보고 후 방향 결정 예정

### 5. 자동매매 버튼 재설계 (논의 중)
- **새 기능 요구사항**:
  1. 버튼 누르면 → 자동매매 실행 여부 결정 (매수/매도/보류)
  2. 왜 그 결정을 했는지 보고서 작성
  3. 기밀문서 자동 저장
  4. 시그널 탭 하단에 접이식 목록 (날짜+제목만, 클릭하면 내용 펼침)
- **아직 최종 UI 디자인 미결정**

### 6. 활동로그 부서별 색상 (승인)
- **색상 매핑**:
  - 비서실: 흰색/기본
  - CIO (투자분석처): 노란색 `hq-yellow`
  - CMO (마케팅처): 보라색 `hq-purple`
  - CTO (기술개발처): 파란색 `hq-accent`
  - CLO (법무처): 빨간색 `hq-red`
  - CHO (인사처): 초록색 `hq-green`
  - CSO (전략기획처): 주황색 (있으면 `hq-orange`, 없으면 amber)
- **수정 파일**: `index.html`

### 7. 협업 진행 패널 (A안 승인)
- **위치**: 시그널 탭 내부 (분석 요청 시 하단에 트리 구조 표시)
- **내용**: CIO → 전문가1/2/3/4 진행 상태 + 현재 단계

### 8. 기밀문서 필터 A+B 모두 구현 (승인)
- **A안**: 부서 탭 + 중요도 드롭다운 (전체/임원급/일반)
- **B안**: 태그 시스템 (#임원급 #전략실 #긴급 등, 다중 선택)
- **문서 구조 변경**: `tags: ["임원급", "전략실"]` 배열 추가 필요
- **수정 파일**: `index.html`, `mini_server.py`

### 9. 오타 수정 (승인)
- "실거래 ▼ ∨" → 중복 화살표 제거
- **수정 파일**: `index.html`

### 10. 리트마스터 통합 (보류 — 투두)
- **결정**: 일단 별도 Claude 세션에서 진행
- **TODO**: CORTHEX 기능 완성 후 기술개발처(CTO팀)에 GitHub API 도구 추가해서 통합

### 11. 실거래/모의 비교 버그 수정 (승인)
- **원인**: `kis_client.py`의 `get_balance()`가 `"available"` 필드 미반환
- **수정**: 성공 시 `"available": True`, 에러 시 `"available": False` 추가
- **수정 파일**: `web/kis_client.py`

---

## 아직 논의 중인 것들

### 4-2. 처장들 독자 분석 여부
- CEO: "CMO 등이 종합만 하는지, 독자 분석도 하는지 알 수 있어?"
- 현재 파악 필요: `_manager_with_delegation()` 함수에서 처장이 어떻게 동작하는지
- 후보 방향: 처장 응답에 "처장 의견" 섹션 명시 OR 2단계 분석 구조 추가

### 5. 버튼 UI 최종 디자인
- CEO: 버튼 누르면 (1) 매매 결정 + (2) 보고서 → 접이식으로 아래에 표시
- 아직 구체적 디자인 미결정

### 8. 기밀문서 태그 UI 디자인
- A+B 모두 구현이지만 어떻게 보여줄지 최종 확정 필요

---

## 구현 예정 순서 (논의 끝나면 한번에 팀 투입)

1. 간단 버그: 인터벌 누수(3), 오타(9), kis available 버그(11)
2. FE 중간: 활동로그 색상(6), 협업 패널(7), 기밀문서 필터(8)
3. FE+BE 큰 것: 내부통신 실시간(2), 자동매매 버튼 재설계(5)
4. BE 아키텍처: 처장 독자 분석(4), P2P 협업(1)

---

## 투두 리스트

- [ ] 리트마스터 통합 (보류 — CORTHEX 완성 후)
- [ ] P2P 협업 구현 (B안) — 아키텍처 설계 필요
- [ ] 작업 큐 (동시 작업 지원) — 13번 관련
