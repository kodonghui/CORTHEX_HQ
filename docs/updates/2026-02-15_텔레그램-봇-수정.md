# 텔레그램 봇 한국어 명령어 수정 + anthropic 설치 오류 해결

## 버전
0.08.001

## 작업 날짜
2026-02-15

## 작업 브랜치
claude/fix-anthropic-install

---

## 변경 사항 요약

### 문제 1: anthropic 패키지 설치 충돌
- **증상**: 서버에서 `pip install anthropic` 실행 시 `typing_extensions 4.10.0` 패키지를 제거 못 해서 실패
- **원인**: Ubuntu 시스템 패키지(`typing_extensions`)와 pip이 충돌 — "RECORD 파일이 없어서 제거 불가" 에러
- **해결**: `deploy.yml`의 pip install 명령에 `--ignore-installed` 플래그 추가 (기존 패키지 무시하고 새로 설치)
- **결과**: anthropic v0.79.0 정상 설치됨

### 문제 2: 텔레그램 봇 시작 실패
- **증상**: 서버 로그에 `[TG] 봇 시작 실패: Command '실시간' is not a valid bot command` 에러
- **원인**: 텔레그램 봇 명령어(CommandHandler)는 **영어(a-z), 숫자(0-9), 밑줄(_)만** 허용. 한국어(`실시간`, `배치`)는 사용 불가
- **영향**: 봇 전체가 시작되지 않아 `/start`, `/help` 등 모든 명령어 사용 불가
- **해결**:
  - `CommandHandler("실시간", ...)` 과 `CommandHandler("배치", ...)` 제거
  - 대신 `handle_message()` 함수 안에서 텍스트가 "실시간" 또는 "배치"이면 모드 전환하도록 변경
  - `/help` 메시지에 모드 전환 안내 추가
- **결과**: `[TG] 봇 시작 완료!` 확인됨

---

## 수정한 파일

| 파일 | 설명 |
|------|------|
| `.github/workflows/deploy.yml` | 배포 스크립트 — `--ignore-installed` 플래그 추가 (이전 커밋) |
| `web/mini_server.py` | 미니 서버 — 한국어 명령어를 MessageHandler로 이동 |
| `docs/project-status.md` | 프로젝트 상태 파일 — 버전 0.08.001로 업데이트 |

---

## 현재 상태

- **텔레그램 봇**: 정상 작동 (빌드 #84)
- **웹 대시보드**: 정상 접속 가능 (http://168.107.28.100)
- **AI 기능**: **아직 비활성화** — `ANTHROPIC_API_KEY`가 서버에 전달되지 않음
  - GitHub Secrets에 `ANTHROPIC_API_KEY` 이름으로 키가 등록되어 있는지 확인 필요

---

## CEO 확인 필요 사항

1. **GitHub Secrets 확인**:
   - GitHub → CORTHEX_HQ → Settings → Secrets and variables → Actions
   - `ANTHROPIC_API_KEY` 이름으로 Anthropic API 키가 등록되어 있는지 확인
   - (이전에 다른 이름으로 추가했을 수도 있음)
2. **텔레그램 봇 테스트**: 텔레그램에서 `/start`, `/help` 보내서 응답 확인
3. **모드 전환 테스트**: "실시간" 또는 "배치" 메시지 보내서 모드 전환 확인
