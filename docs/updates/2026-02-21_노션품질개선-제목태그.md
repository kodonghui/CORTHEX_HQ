# 노션 품질 개선 — 제목/태그/소통 규칙

- **날짜**: 2026-02-21
- **브랜치**: claude/notion-quality-improvement
- **버전**: 3.02.018

---

## 변경 내용

### 1. 노션 제목 품질 개선
- `_extract_notion_title()` 필터 강화: "죄송", "오류", "에러", "실패" 등 부적절한 문구로 시작하는 줄 자동 건너뜀
- `ask_ai()` 전역 제목 규칙 주입: 모든 에이전트에 "보고서 첫 줄은 주제 요약 제목" 규칙 자동 적용
- 프롬프트 29개 개별 수정 불필요 → 서버에서 일괄 처리 (서버 우선 원칙)

### 2. 노션 태그 자동화
- `_save_to_notion()`에서 부서(division) 기반 자동 태그 생성
  - `finance.investment` → #투자처, `leet_master.strategy` → #전략실 등 7개 부서
- 역할(role) 기반 태그: manager → #임원급, specialist → #전문가급
- 에이전트 규칙 변경 없이 서버 코드 5줄로 해결

### 3. 출판-마케팅 소통 규칙 (spawn 강제)
- 콘텐츠 Specialist: 외부 발행 시 spawn_agent로 editor_specialist 교정 필수
- 커뮤니티 Specialist: 동일 규칙 적용
- allowed_tools에 spawn_agent 추가

### 4. Gemini 3.1 Pro reasoning high로 상향
- 11명 에이전트: low → high (구글 무료 크레딧 + 저렴한 단가 활용)
- 이미 high였던 CSO, 사업기획은 그대로 유지

### 5. CLAUDE.md "서버 우선 원칙" 추가
- 기계적 처리(태그, 제목, 형식)는 서버에서 구현
- 에이전트는 "생각하는 일"에 집중

---

## 수정한 파일

| 파일 | 변경 내용 |
|------|-----------|
| `web/arm_server.py` | 제목 필터 강화 + 태그 자동화 |
| `web/ai_handler.py` | 전역 제목 규칙 주입 |
| `config/agents.yaml` | Gemini high + spawn 규칙 + spawn_agent 도구 |
| `config/agents.json` | yaml2json 변환 |
| `CLAUDE.md` | 서버 우선 원칙 추가 |
