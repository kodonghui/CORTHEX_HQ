# 2026-03-01 — v5 에이전트 리네임 + CLI 라우팅 보호

**PR**: #724 | **브랜치**: claude/v5-agent-rename | **상태**: 머지 대기

---

## 변경 내용

### 1. 에이전트 ID 전면 리네임 (33파일)
| 구 ID | 신 ID | 한국명 |
|-------|-------|--------|
| cso_manager | leet_strategist | 전략팀장 |
| clo_manager | leet_legal | 법무팀장 |
| cmo_manager | leet_marketer | 마케팅팀장 |
| cio_manager | fin_analyst | 금융분석팀장 |
| cpo_manager | leet_publisher | 콘텐츠팀장 |

- PATTERN-8 검증 통과: 레거시 ID 0건
- scripts/rename_agents.sh 작성 (자동화 스크립트)

### 2. saju 본부 에이전트 4명 추가
- `saju_executive` — CEO 계정, 사주냥 사업본부장
- `saju_eden` — sister 계정, 마케팅·사업기획 전략가
- `saju_zoe` — sister 계정, 콘텐츠·커뮤니케이션
- `saju_sage` — sister 계정, 분석·리서치

### 3. CLI 라우팅 보호 (_can_command)
- `agent_router.py`에 `_can_command(session_role, agent_id)` 추가
- sister 로그인 시 `chief_of_staff` / CEO 에이전트(`cli_owner: ceo`) 접근 차단
- WebSocket 연결 시 `?token=...` 파라미터 → `session_role` 추출 체인 완성
  - `arm_server.py` WS 핸들러 → `_run_agent_bg()` → `_process_ai_command()`

### 4. batch_system.py 전역 삭제
- `web/batch_system.py` 삭제 (배치 API 방식 CLI 전환으로 불필요)
- `arm_server.py`, `scheduler.py`, `telegram_bot.py` 참조 제거
- `agent_router.py`는 기존 `try/except ImportError` fallback으로 자동 처리

### 5. scripts/migrate_v5.py 신규
- DB 백업(corthex_backup_v4_{ts}.db) → 기존 데이터 삭제 → org 컬럼 추가 → sns_accounts 생성
- `--dry-run` 옵션 지원
- **실행 방법**: PR 머지 + 배포 완료 후 서버에서 `python scripts/migrate_v5.py`

---

## 남은 v5 작업 (다음 세션)
- 실서버 `migrate_v5.py` 실행
- FR-5/6: index.html 채팅/기밀문서 org 필터링 UI
- FR-9/10: API org 파라미터 지원 (통신국/작전일지)
- FR-11: @Eden/@Zoe/@Sage → org 라우팅
