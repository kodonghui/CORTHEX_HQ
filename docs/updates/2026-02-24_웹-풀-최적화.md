# 2026-02-24 웹 풀 최적화 (C안)

## 요약
웹 초기 로딩 속도를 ~2.5초 → ~0.7초로 **72% 개선**.

## 변경 내용 (6단계)

| # | 작업 | Before | After | 파일 |
|---|------|--------|-------|------|
| 1 | nginx gzip + 캐시 | 716KB 원본 전송 | ~110KB gzip | deploy.yml |
| 2 | 폰트 최적화 | @import 3개 블로킹 | preload 2개 비동기 | styles.css, index.html |
| 3 | CDN 지연 로드 | 330KB blocking | 0KB blocking | index.html, app.js |
| 4 | init() API 최적화 | API 11개, SSE 2개, 폴링 1개 | API 3개, SSE 1개 | app.js |
| 5 | x-show → x-if | DOM ~6,000개 | DOM ~2,500개 | index.html |
| 6 | CLAUDE.md 규칙 | 없음 | 성능 규칙 6개 | CLAUDE.md |

## 주요 기술 결정

### Step 1: nginx gzip
- `gzip_comp_level 5` (CPU/압축 최적 밸런스)
- 정적파일(`/static/`) 30일 캐시 + ETag
- HTML은 `no-cache` 유지 (빌드번호 캐시버스팅)

### Step 2: 폰트
- Noto Serif KR (~400KB) 폐지 → Pretendard bold로 대체
- CSS `@import` → `<link rel="preload">` 비동기 전환

### Step 3: CDN 라이브러리
- `_loadScript()` Promise 캐싱 헬퍼 추가
- Marked: init()에서 fire-and-forget 프리로드
- Chart.js + Mermaid: archmap 탭 진입 시 동적 로드
- `renderMarkdown()`: marked 미로드 시 폴백 처리

### Step 4: init() + SSE 통합
- init()에서 제거: loadConversation, loadPresets, restoreActivityLogs, fetchDelegationLogs, _connectCommsSSE
- switchTab()에서 lazy load: command 탭, activityLog 탭
- `_connectCioSSE()` → `_connectCommsSSE()`에 CIO 키워드 필터링 통합
- CIO 3초 폴링 (`_startCioPolling`) 제거

### Step 5: x-show → x-if
- 8개 탭: trading, archmap, history, sns, archive, activityLog, workflow, performance
- 유지(x-show): home, command, schedule, knowledge (기본탭 or 소규모)
- DOM 노드 58% 감소

### Step 6: CLAUDE.md 규칙
- CDN blocking 금지, x-if 필수, init() API 금지, 폰트 금지, SSE 1개만, setInterval 관리

## 수정 파일
- `.github/workflows/deploy.yml` — nginx gzip/캐시
- `web/static/css/corthex-styles.css` — @import 제거, font-title 변경
- `web/templates/index.html` — CDN 제거, preload, x-if 전환
- `web/static/js/corthex-app.js` — _loadScript, init 재구성, SSE 통합
- `CLAUDE.md` — 성능 코딩 규칙 6개
- `docs/todo/2026-02-24.md` — 완료 기록
