# 6가지 추가 기능 — 비용 실시간 반영 + 서버명 + 배치 개선 + 노션 + 텔레그램

## 버전
1.05.000

## 작업 날짜
2026-02-17

## 작업 브랜치
claude/fix-multi-provider-ai-chat

## 변경 사항 요약

빌드 #163(배치 시스템 7가지 수정) 이후 **6가지 추가 기능**을 구현했습니다.

### 수정된 파일
| 파일 | 역할 | 변경 내용 |
|------|------|----------|
| `web/arm_server.py` (백엔드 서버) | 비용, 서버명, 초록불, 노션, 텔레그램 | 6가지 수정 전부 |
| `web/templates/index.html` (화면) | 배치 타이머, 서버명 | 타이머 UI + 서버명 |

### 수정 상세

| # | 작업 | 설명 |
|---|------|------|
| 1 | **배치 펜딩 중 초록불 유지** | 배치가 Anthropic/OpenAI/Google 서버에서 처리되는 동안(수십 분) 에이전트 옆에 초록불이 계속 깜빡이도록 수정. 결과가 아직 없는 전문가에게 "배치 처리 중..." 상태 표시 |
| 2 | **배치 진행 타이머 UI** | 배치 명령 후 대화창 위에 노란 배너 표시: "📦 3단계: 전문가 분석 | 03:42" 형태로 현재 단계 + 경과 시간을 실시간 표시 |
| 3 | **$0.0000 비용 실시간 반영** | 에이전트가 작업 완료할 때마다 `cost_update` 이벤트를 화면에 전송. 우측 상단 금액이 실시간으로 올라감 |
| 4 | **서버명 "ARM 서버"로 변경** | "arm_server" → "ARM 서버"로 5곳 수정 (화면, API, 주석 등). Oracle Cloud ARM 서버(4코어 24GB)에 맞게 업데이트 |
| 5 | **노션 DB 2개 + 로그** | 비서실 DB(`36880ed0...`)와 에이전트 산출물 DB(`4c20dd05...`) 2개 연결. `/api/notion-log`에서 최근 20건 저장 성공/실패 확인 가능 |
| 6 | **텔레그램 신규 명령어 5개** | `/models` (3단계 인라인 버튼으로 전원 모델 변경), `/status` (배치 진행 목록), `/budget` (오늘 비용/한도 변경), `/pause` (AI 중단), `/resume` (AI 재개) |

### 텔레그램 /models 3단계 흐름
```
/models → 프로바이더 선택 (🟣 Anthropic / 🟢 OpenAI / 🔵 Google)
  → 모델 선택 (Opus 4.6 / Sonnet 4.5 / Haiku 4.5 등)
  → 추론 강도 선택 (xhigh / high / low / 없음)
  → DB 저장 + "전원 모델을 XXX로 변경했습니다" 확인
```

### 지원 모델 목록 (/models에서 선택 가능)
| 프로바이더 | 모델 | 추론 강도 |
|-----------|------|----------|
| Anthropic | Claude Opus 4.6 | xhigh, high, low, 없음 |
| Anthropic | Claude Sonnet 4.5 | high, low, 없음 |
| Anthropic | Claude Haiku 4.5 | (없음) |
| OpenAI | GPT-5 | xhigh, high, low, 없음 |
| OpenAI | GPT-5 Mini | (없음) |
| Google | Gemini 3 Pro Preview | high, low, 없음 |
| Google | Gemini 2.5 Pro | high, low, 없음 |
| Google | Gemini 2.5 Flash | (없음) |

## 현재 상태
6가지 추가 기능 모두 완료. 커밋 + 푸시 후 자동 배포 예정.

## 다음에 할 일
- 서버 배포 후 비용 표시가 실시간으로 올라가는지 확인
- 텔레그램에서 /models 3단계 버튼 테스트
- 텔레그램에서 /pause → /resume AI 중단/재개 테스트
- 배치 명령 후 노란 타이머 배너가 표시되는지 확인
- 노션 저장이 작동하는지 /api/notion-log에서 확인
- 노션 DB에 속성(열) 자동 생성은 Notion API에서 지원하지 않으므로, CEO가 직접 노션에서 "작성자", "부서", "보고 유형", "상태", "날짜" 열을 추가해야 함 (또는 서버가 알아서 넣고, 없는 속성은 노션이 무시함)
