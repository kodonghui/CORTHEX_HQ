# 웹 메시지 무응답 버그 수정 + Gemini/GPT 멀티 프로바이더 지원

## 버전
0.09.005

## 작업 날짜
2026-02-15

## 작업 브랜치
claude/investigate-test-messages-Jlm13

## 변경 사항 요약

### 문제 1: 웹에서 메시지 보내면 비서실장이 무응답
CEO가 웹 화면에서 "테스트"를 입력하고 보냈는데, 비서실장(AI)이 아무 응답을 하지 않았습니다.

**원인**: 프론트엔드(화면)는 `text`라는 이름으로 보냈는데, 백엔드(서버)는 `content`라는 이름으로 찾고 있었습니다. 이름이 달라서 메시지가 매번 빈 문자열이 되고, AI한테 전달조차 안 됨.

**수정**: 백엔드가 `content` 또는 `text` 둘 다 받도록 1줄 수정.

### 문제 2: Gemini/GPT 모델 선택 시 AI 호출 불가
Gemini나 GPT 모델을 선택해도, 서버가 Anthropic(Claude) API만 지원해서 실제 호출이 안 됐습니다.

**원인**: ai_handler.py가 Anthropic 전용이었음. Gemini/GPT 모델을 선택하면 Anthropic API에 Gemini 모델명을 보내게 되어 에러 발생.

**수정**: ai_handler.py를 **멀티 프로바이더**(여러 AI 회사 동시 지원) 구조로 전면 확장:
- **Anthropic (Claude)**: 기존 그대로 지원
- **Google (Gemini)**: `google-generativeai` 패키지 + `GOOGLE_API_KEY` 환경변수
- **OpenAI (GPT)**: `openai` 패키지 + `OPENAI_API_KEY` 환경변수
- 모델 이름 앞부분으로 자동 판별: `claude-*` → Anthropic, `gemini-*` → Google, `gpt-*` → OpenAI
- API 키나 패키지가 없으면 "○○ API 키가 설정되지 않았습니다" 안내 메시지 표시

### 수정한 파일
| 파일 | 설명 | 변경 내용 |
|------|------|----------|
| `web/mini_server.py` | 백엔드 서버 | WebSocket 메시지 키 호환 + API 키 상태에 Google 추가 |
| `web/ai_handler.py` | AI 호출 핸들러 | Anthropic 전용 → 멀티 프로바이더 (Anthropic/Google/OpenAI) 확장 |

## Gemini/GPT 사용하려면
서버 환경변수에 API 키를 추가해야 합니다:
- **Gemini**: `GOOGLE_API_KEY` (Google AI Studio에서 무료 발급 가능)
- **GPT**: `OPENAI_API_KEY` (OpenAI 대시보드에서 발급)
- 서버에 해당 패키지도 설치해야 함: `pip install google-generativeai openai`

## 현재 상태
- 수정 완료, 커밋 + 푸시 완료
- Claude 모델은 ANTHROPIC_API_KEY가 있으면 바로 작동
- Gemini/GPT는 각각 API 키 + 패키지 설치 필요

## 다음에 할 일
- 배포 후 웹에서 메시지 응답 확인
- Gemini 사용하려면 GOOGLE_API_KEY 등록 + google-generativeai 패키지 설치
