# 키움증권 자동매매 시스템 프레임워크 구축

## 버전
0.12.000

## 작업 날짜
2026-02-16

## 작업 브랜치
claude/fix-multi-provider-ai-chat

---

## 변경 사항 요약

### 1. 자동매매 시스템 백엔드 (arm_server.py)

키움증권 자동매매를 위한 전체 백엔드 프레임워크를 구축했습니다. API 연결은 나중에 하고, 기능(뼈대)을 먼저 전부 만들었습니다.

**새로 추가된 API 15개:**

| API | 하는 일 |
|-----|---------|
| `GET /api/trading/summary` | 트레이딩 대시보드 요약 (한 화면에 다 보여주는 데이터) |
| `GET /api/trading/portfolio` | 포트폴리오 조회 (보유 종목, 현금, 수익률) |
| `POST /api/trading/portfolio` | 포트폴리오 설정 (초기 자금 등) |
| `POST /api/trading/portfolio/reset` | 모의투자 초기화 (처음부터 다시) |
| `GET /api/trading/strategies` | 매매 전략 목록 |
| `POST /api/trading/strategies` | 매매 전략 추가/수정 |
| `DELETE /api/trading/strategies/{id}` | 매매 전략 삭제 |
| `PUT /api/trading/strategies/{id}/toggle` | 전략 활성/비활성 토글 |
| `GET /api/trading/watchlist` | 관심 종목 목록 |
| `POST /api/trading/watchlist` | 관심 종목 추가 |
| `DELETE /api/trading/watchlist/{ticker}` | 관심 종목 삭제 |
| `POST /api/trading/order` | 모의 주문 실행 (매수/매도) |
| `GET /api/trading/history` | 거래 내역 |
| `GET /api/trading/signals` | AI 매매 시그널 목록 |
| `POST /api/trading/signals/generate` | AI가 매매 시그널 생성 |
| `GET /api/trading/settings` | 자동매매 설정 |
| `POST /api/trading/settings` | 자동매매 설정 저장 |
| `POST /api/trading/bot/toggle` | 자동매매 봇 ON/OFF |
| `GET /api/trading/bot/status` | 자동매매 봇 상태 |

**핵심 기능:**
- **모의투자 포트폴리오**: 초기 자금(기본 5천만원) 설정 후 매수/매도 가능. 평균 단가 자동 계산, 보유 종목 관리
- **매매 전략 관리**: RSI, MACD, 골든크로스, 볼린저밴드, 가치투자, 모멘텀 등 전략 등록. 매수/매도 조건, 손절/익절, 대상 종목 설정
- **관심 종목**: 종목코드, 목표 가격, 알림 타입 등록
- **AI 시그널**: 관심종목과 활성 전략을 기반으로 AI가 매매 시그널 자동 생성
- **자동매매 봇**: 5분 간격으로 전략 스캔, 장 시간(09:00~15:20)에만 작동
- **리스크 관리**: 종목당 최대 비중, 일일 최대 거래 횟수, 일일 최대 손실, 기본 손절/익절 설정

---

### 2. 자동매매 프론트엔드 (전략실 탭)

**"전략실" (TRADING OPS)** 신규 탭을 추가했습니다. 6개 서브탭으로 구성:

| 서브탭 | 내용 |
|--------|------|
| 대시보드 | 자동매매 봇 상태 배너, 포트폴리오 요약 카드 4개, 보유종목+최근거래 2단 레이아웃, 시그널 미리보기 |
| 포트폴리오 | 자산 요약 바(초기자금/현금/평가금액/손익), 보유종목 상세 테이블(7열), 초기화 버튼 |
| 매매 전략 | 전략 카드 목록, 활성/비활성 토글, 매수/매도 조건 표시, 대상 종목 태그 |
| 관심종목 | 종목 카드 그리드, 목표 가격, 매수/매도 바로가기 버튼 |
| 거래내역 | 전체 거래 내역 테이블(시간/구분/종목/수량/단가/금액/손익/전략) |
| 시그널 | AI 분석 시그널 목록, 새 시그널 생성 버튼 |

**모달 4개 추가:**
1. **주문 실행**: 매수/매도 선택, 종목코드, 수량, 가격 입력
2. **전략 추가**: 전략명, 유형, 지표, 매수/매도 조건, 손절/익절, 대상 종목
3. **관심종목 추가**: 종목코드, 종목명, 목표 가격, 메모
4. **설정**: 포지션 한도, 일일 제한, 손절/익절, 장 시간, 자동 손절/익절/모의투자 토글

---

## 현재 상태

| 항목 | 상태 |
|------|------|
| 모의투자 (가짜 돈으로 연습) | ✅ 작동 |
| 키움증권 API 연결 (진짜 주식 거래) | ❌ 미연결 (나중에) |
| 기존 투자분석팀(5명 AI) 연동 | ✅ AI 시그널 생성 연동 |
| 자동매매 봇 엔진 | ✅ 프레임워크 완성 (실제 매매는 API 연결 후) |
| 데이터 저장 (SQLite DB) | ✅ 모든 데이터 영구 저장 |

---

## 수정한 파일 목록

| 파일 | 설명 |
|------|------|
| `web/arm_server.py` | 자동매매 API 15개 추가 (포트폴리오/전략/관심종목/주문/시그널/봇) |
| `web/templates/index.html` | "전략실" 탭 + 6개 서브탭 + 모달 4개 추가 |
| `docs/project-status.md` | 프로젝트 현재 상태 업데이트 |

---

## 다음에 할 일
1. 키움증권 Open API+ 연동 (API 키 발급 → 실제 주문 연결)
2. pykrx 도구와 실시간 가격 연동 (관심종목 현재가 자동 업데이트)
3. 자동매매 봇에 실제 전략 실행 로직 추가
4. 소울 추가 보강 (CEO 요청)
5. 노션 API 키 등록 + 보고 시스템 활성화
