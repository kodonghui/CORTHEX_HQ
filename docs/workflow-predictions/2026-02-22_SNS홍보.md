# CORTHEX 첫 SNS 홍보 — 워크플로우 전수검사 예측도

**날짜**: 2026-02-22 (일)
**검사자**: Claude 수석 (코드 전수검사 기반 예측)

---

## CEO 입력 메시지

```
"CORTHEX가 왔다고 사람들의 이목을 끌만한 컨텐츠를 만들어서 네이버 블로그 등
각종 SNS에 올려. 아마 인스타그램은 안될거야. 그건 빼고. 게시글,이미지, 동영상을
어서 우리의 첫 홍보를 해보자고. 우리는 리트마스터를 시작으로 언어 시험/수험에
혁신을 가져올거야. 그리고 별개로 ai 인플루언서로 활동할거야. 근데 꼭 두 내용이
막 어울리지 않게 병렬적일 필요는 없고 잘 조합을 하던 뭐를 빼던 아무튼 우리
회사를 알려봐."
```

---

## 전체 워크플로우 예측 다이어그램

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                    PHASE 1: 메시지 수신 + 라우팅
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ┌─────────────────────────────────────────────────┐
  │  CEO 채팅창에서 메시지 입력 + 전송 버튼 클릭      │
  │  (index.html → sendMessage() → WebSocket 전송)   │
  └─────────────────┬───────────────────────────────┘
                    │ WebSocket: { type:"command", text:"CORTHEX가..." }
                    ▼
  ┌─────────────────────────────────────────────────┐
  │  arm_server.py: /ws 엔드포인트 수신              │
  │  → create_task() → task_id 생성                  │
  │  → _process_ai_command() 호출                    │
  └─────────────────┬───────────────────────────────┘
                    │
                    ▼
  ┌─────────────────────────────────────────────────┐
  │  ① 슬래시 명령어 체크 → 해당 없음 (일반 텍스트)   │
  │  ② 브로드캐스트 체크 → 해당 없음                  │
  │     ("전체", "출석" 등 키워드 없음)               │
  │  ③ @직접지정 체크 → 해당 없음 (target=null)       │
  │  ④ 자동 라우팅 → _route_task() 호출              │
  └─────────────────┬───────────────────────────────┘
                    │
                    ▼
  ┌─────────────────────────────────────────────────┐
  │  _classify_by_keywords() — 키워드 매칭            │
  │                                                   │
  │  메시지에 포함된 키워드:                           │
  │  ✅ "SNS" → cmo_manager                          │
  │  ✅ "콘텐츠" → cmo_manager                       │
  │  ✅ "홍보" → cmo_manager                          │
  │                                                   │
  │  결과: cmo_manager (키워드 매칭, 비용 $0)          │
  └─────────────────┬───────────────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │  라우팅 결과:          │
        │  agent_id: cmo_manager│
        │  method: "키워드"      │
        │  cost: $0.00          │
        └───────────┬───────────┘
                    │
                    ▼

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
              PHASE 2: 비서실장 → CMO 위임
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ┌─────────────────────────────────────────────────┐
  │  비서실장: "CMO(마케팅고객처장)에게 위임 중..."      │
  │  → WebSocket broadcast: { status: "working" }    │
  │  → _manager_with_delegation("cmo_manager", text) │
  └─────────────────┬───────────────────────────────┘
                    │
                    ▼

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
            PHASE 3: CMO → 전문가 3명 병렬 위임
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ┌─────────────────────────────────────────────────┐
  │  CMO (claude-sonnet-4-6): 전문가 위임 시작        │
  │  → _delegate_to_specialists("cmo_manager", text) │
  │  → asyncio.gather (3명 동시 호출)                │
  └───┬──────────────────┬──────────────────┬───────┘
      │                  │                  │
      ▼                  ▼                  ▼
  ┌────────────┐   ┌────────────┐   ┌────────────┐
  │ 설문리서치  │   │ 콘텐츠      │   │ 커뮤니티    │
  │ Specialist │   │ Specialist │   │ Specialist │
  │            │   │            │   │            │
  │ 모델:      │   │ 모델:      │   │ 모델:      │
  │ (기본값)    │   │ gemini-    │   │ (기본값)    │
  │            │   │ 3.1-pro    │   │            │
  └─────┬──────┘   └─────┬──────┘   └─────┬──────┘
        │                │                │
        │  (동시 실행)    │                │
        ▼                ▼                ▼

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         PHASE 4: 각 전문가의 작업 (도구 자동호출)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌─────────────────────────────────────────────────────────────┐
│  🔍 설문리서치 Specialist                                    │
│  allowed_tools: real_web_search, naver_datalab, ...         │
│                                                              │
│  예상 행동:                                                   │
│  ① real_web_search("LEET 수험 시장 규모 2026")              │
│  ② naver_datalab("리트 수험생 트렌드")                       │
│  ③ 시장 분석 보고서 작성                                     │
│                                                              │
│  산출물: "LEET 시장 분석 + 타겟 독자 프로파일"                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  🎨 콘텐츠 Specialist  ⭐ 핵심 에이전트                       │
│  allowed_tools: gemini_image_generator,                      │
│                 gemini_video_generator,                       │
│                 sns_manager, spawn_agent                      │
│  모델: gemini-3.1-pro-preview (reasoning: high)              │
│                                                              │
│  예상 행동 (도구 호출 루프, 최대 5회):                         │
│                                                              │
│  루프 1️⃣ gemini_image_generator 호출                         │
│     → action: "banner" or "social_post"                      │
│     → topic: "CORTHEX 론칭 — AI 언어 시험 혁신"              │
│     → style: "tech"                                          │
│     → 결과: 이미지 파일 → /api/media/images/gemini_xxx.png    │
│                                                              │
│  루프 2️⃣ gemini_video_generator 호출                         │
│     → action: "reels"                                        │
│     → prompt: "CORTHEX HQ 론칭 영상"                          │
│     → ⚠️ 5분 폴링 대기! (veo-3.1-generate-preview)           │
│     → 결과: 영상 파일 → /api/media/videos/veo_xxx.mp4         │
│                                                              │
│  루프 3️⃣ spawn_agent("editor_specialist", 교정 요청)          │
│     → 출판기록처 편집전문가에게 글 교정 위임                    │
│     → ⚠️ 이게 실제로 작동하는지 확인 필요                      │
│                                                              │
│  루프 4️⃣ sns_manager(action=submit) — 네이버 블로그            │
│     → platform: "naver_blog"                                  │
│     → title: "CORTHEX가 왔다 — AI가 바꾸는 언어 시험 해설"     │
│     → body: "<게시글 본문>"                                    │
│     → tags: ["CORTHEX", "리트마스터", "AI", "LEET"]           │
│     → media_urls: ["/api/media/images/xxx.png"]               │
│     → 결과: 승인 큐에 등록 (request_id 발급)                  │
│                                                              │
│  루프 5️⃣ sns_manager(action=submit) — 다른 플랫폼들            │
│     → 티스토리, 유튜브, 카카오 등 반복                        │
│                                                              │
│  산출물: 콘텐츠 초안 + 이미지 URL + 영상 URL + 승인 큐 등록    │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  👥 커뮤니티 Specialist                                       │
│  allowed_tools: naver_datalab, sns_manager(query), ...       │
│                                                              │
│  예상 행동:                                                   │
│  ① naver_datalab("수험생 커뮤니티 반응")                     │
│  ② sns_manager(action=queue) — 기존 게시 이력 확인            │
│  ③ 최적 게시 시간대/플랫폼 추천                              │
│                                                              │
│  산출물: "최적 게시 전략 + 해시태그 추천"                      │
└─────────────────────────────────────────────────────────────┘

      │                  │                  │
      └────────┬─────────┴────────┬─────────┘
               │  3명 결과 수집    │
               ▼                  ▼

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
            PHASE 5: CMO 검수 + 종합 보고서
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ┌─────────────────────────────────────────────────┐
  │  CMO (claude-sonnet-4-6): 종합 보고서 작성        │
  │                                                   │
  │  입력:                                            │
  │  ├─ 설문리서치: "시장 분석 + 타겟 프로파일"        │
  │  ├─ 콘텐츠: "초안 + 이미지 + 영상 + 승인큐 ID"    │
  │  └─ 커뮤니티: "게시 전략 + 해시태그"               │
  │                                                   │
  │  산출물:                                           │
  │  "CEO님, 콘텐츠 3종이 작성되었습니다.              │
  │   ① 네이버 블로그 — 승인 대기 중 (ID: xxx)        │
  │   ② 티스토리 — 승인 대기 중 (ID: yyy)             │
  │   ③ 영상(릴스) — 생성 완료 (/api/media/videos/...)│
  │   COMM STATION에서 승인해주세요."                  │
  └─────────────────┬───────────────────────────────┘
                    │
                    ▼

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
           PHASE 6: 노션 저장 + CEO 채팅에 결과 표시
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ┌─────────────────────────────────────────────────┐
  │  자동 저장:                                       │
  │  ├─ 노션 "에이전트 산출물" DB × 3건 (전문가별)     │
  │  ├─ 노션 "비서실" DB × 1건 (CMO 종합보고서)       │
  │  ├─ SQLite archive 저장                           │
  │  └─ 텔레그램 CEO에게 자동 전송                     │
  │                                                   │
  │  WebSocket → CEO 채팅 화면에 결과 표시             │
  │  "📋 CMO (마케팅고객처장) 보고 (소속 전문가 3명)"  │
  └─────────────────┬───────────────────────────────┘
                    │
                    ▼

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
              PHASE 7: CEO 승인 (수동 행동 필요!)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  CEO가 해야 할 일:

  ┌─────────────────────────────────────────────────┐
  │  1. COMM STATION 클릭 (좌측 사이드바)             │
  │  2. "승인 대기열" 탭 선택                          │
  │  3. 각 항목 확인:                                  │
  │     ┌─────────────────────────────────────┐       │
  │     │ 📝 네이버 블로그                      │       │
  │     │ "CORTHEX — AI 언어 시험 혁신"         │       │
  │     │ 상태: ⏳ 대기                         │       │
  │     │ 이미지 미리보기: [gemini_xxx.png]     │       │
  │     │                                       │       │
  │     │  [✅ 승인]  [❌ 거절]                  │       │
  │     └─────────────────────────────────────┘       │
  │                                                   │
  │  4. [승인] 클릭 → 상태: "승인됨"                   │
  │  5. [🚀 발행] 버튼 클릭 → 실제 SNS 게시           │
  └─────────────────┬───────────────────────────────┘
                    │
                    ▼

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
           PHASE 8: 실제 SNS 발행 (플랫폼별)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  🚀 발행 클릭 시:

  ┌────────────────────────────────────┐
  │ 네이버 블로그                       │
  │ 방식: Selenium (headless Chrome)   │
  │ 인증: NAVER_ID + NAVER_PW          │
  │ 흐름: 로그인 → 글쓰기 → 제목 입력  │
  │       → 본문 입력 → 태그 → 발행    │
  │ ⚠️ 위험: Selenium 선택자 변경 가능 │
  └────────────────────────────────────┘

  ┌────────────────────────────────────┐
  │ 티스토리                            │
  │ 방식: API                           │
  │ 인증: KAKAO_ID + KAKAO_PW          │
  │ 흐름: OAuth → 글 작성 API          │
  └────────────────────────────────────┘

  ┌────────────────────────────────────┐
  │ 유튜브 (영상)                       │
  │ 방식: YouTube API                   │
  │ 인증: YOUTUBE_CLIENT_ID 등          │
  │ 흐름: 영상 업로드 → 메타데이터 설정 │
  └────────────────────────────────────┘
```

---

## 웹 UI에서 CEO가 보게 될 화면 (시간순)

### 화면 1: 채팅 화면 (0초)
```
┌──────────────────────────────────────────────┐
│ [채팅]                                        │
│                                                │
│ 👤 CEO: CORTHEX가 왔다고 사람들의 이목을      │
│    끌만한 컨텐츠를 만들어서...                  │
│                                                │
│ ⏳ 비서실장이 명령을 접수했습니다.              │
│    → CMO(마케팅처장)에게 위임 중...             │
└──────────────────────────────────────────────┘
```

### 화면 2: 에이전트 작업 진행 (5~30초)
```
┌──────────────────────────────────────────────┐
│ [좌측 에이전트 상태 패널]                      │
│                                                │
│ 🟢 비서실장 — CMO에게 위임 완료                │
│ 🔄 CMO — 전문가 위임 중...                     │
│ 🔄 설문리서치 — 시장 분석 중...                 │
│ 🔄 콘텐츠 — gemini_image_generator 실행 중...  │
│ 🔄 커뮤니티 — 트렌드 분석 중...                │
└──────────────────────────────────────────────┘
```

### 화면 3: 결과 표시 (30초~5분)
```
┌──────────────────────────────────────────────┐
│ 📋 CMO (마케팅고객처장) 보고                    │
│    (소속 전문가 3명 동원)                       │
│ ──────────────────────────                     │
│ [종합 보고서 내용]                              │
│                                                │
│ 생성된 콘텐츠:                                  │
│ - 네이버 블로그 게시글 (승인 대기)               │
│ - 이미지 3장 (링크)                             │
│ - 영상 1개 (링크)                               │
│                                                │
│ COMM STATION에서 확인해주세요.                  │
└──────────────────────────────────────────────┘
```

### 화면 4: COMM STATION 승인 대기열
```
┌──────────────────────────────────────────────┐
│ COMM STATION > 승인 대기열                     │
│                                                │
│ ┌──────────────────────────────────────┐       │
│ │ 📝 naver_blog | ⏳ 대기               │       │
│ │ "CORTHEX — AI 언어 시험 혁신"          │       │
│ │ 요청자: 콘텐츠 Specialist              │       │
│ │ [이미지 미리보기]                       │       │
│ │                                        │       │
│ │  [✅ 승인]  [❌ 거절]                   │       │
│ └──────────────────────────────────────┘       │
│                                                │
│ ┌──────────────────────────────────────┐       │
│ │ 📝 tistory | ⏳ 대기                   │       │
│ │ "리트마스터 — AI가 만드는 해설의 미래"  │       │
│ │  [✅ 승인]  [❌ 거절]                   │       │
│ └──────────────────────────────────────┘       │
└──────────────────────────────────────────────┘
```

### 화면 5: 미디어 갤러리 탭
```
┌──────────────────────────────────────────────┐
│ COMM STATION > 미디어                          │
│                                                │
│ 🖼️ 이미지 (3)                                 │
│ ┌──────┐  ┌──────┐  ┌──────┐                  │
│ │      │  │      │  │      │                   │
│ │ 배너 │  │소셜  │  │ 썸네 │                   │
│ │ 이미지│  │포스트│  │ 일   │                   │
│ └──────┘  └──────┘  └──────┘                  │
│                                                │
│ 🎬 영상 (1)                                    │
│ ┌────────────────┐                             │
│ │  ▶ 릴스 영상   │                             │
│ │  8초 | 1080p   │                             │
│ └────────────────┘                             │
└──────────────────────────────────────────────┘
```

---

## 예상 시간 + 비용

| 단계 | 예상 시간 | 예상 비용 |
|------|---------|---------|
| 라우팅 (키워드) | 0.1초 | $0.00 |
| 설문리서치 Specialist | 10~20초 | ~$0.02 |
| 콘텐츠 Specialist | 30초~5분 | ~$0.05~$0.15 |
| └ 이미지 생성 (나노바나나 Pro) | 5~15초 | Google API 과금 |
| └ 영상 생성 (Veo 3.1) | 1~5분 | ~$0.80~$3.20 |
| └ spawn_agent(editor) | 10~20초 | ~$0.02 |
| └ sns_manager(submit) × N | 1초/건 | $0.00 |
| 커뮤니티 Specialist | 10~20초 | ~$0.02 |
| CMO 종합 | 10~15초 | ~$0.03 |
| 노션 저장 | 2~5초 | $0.00 |
| **합계** | **1~6분** | **~$0.15 + 미디어 과금** |

---

## ⚠️ 예상 실패 지점 (코드 기반 분석)

### 🔴 높은 위험 (거의 확실히 문제)

| # | 문제 | 근거 | 영향 |
|---|------|------|------|
| 1 | **Veo 3.1 영상 생성 시간 초과** | 10분 폴링 제한 (max_polls=60, 10초 간격). 서버 측 WebSocket 응답 대기 중 타임아웃 가능 | 영상 없이 결과 반환 |
| 2 | **content_specialist가 도구를 안 쓸 수 있음** | AI가 도구 호출을 "결정"하는 것. 프롬프트에 "이미지 만들어"라고 명시 안 되어 있으면 텍스트만 작성하고 끝낼 수 있음 | 이미지/영상 없는 텍스트만 산출 |
| 3 | **"인스타 빼고"를 AI가 모름** | CEO 메시지에 포함돼 있지만, AI가 읽더라도 인스타용 콘텐츠를 만들 수 있음 (시스템 프롬프트에 제한 없음) | 인스타 콘텐츠도 승인큐에 올라감 |

### 🟡 중간 위험

| # | 문제 | 근거 | 영향 |
|---|------|------|------|
| 4 | **spawn_agent(editor) 실패 가능** | spawn_agent 도구가 실제로 _call_agent를 호출하는지, 아니면 도구 내부에서 별도 처리하는지 확인 필요 | 교정 없이 제출 |
| 5 | **Selenium 네이버 블로그 발행 실패** | 서버에 Chrome/ChromeDriver 설치 여부 미확인. 네이버 로그인 CAPTCHA 가능 | 발행 시 에러 |
| 6 | **영상이 승인큐에 안 들어감** | sns_manager submit 시 media_urls에 영상 URL을 넣어야 하는데, AI가 이 파라미터를 빼먹을 수 있음 | 텍스트만 승인큐에 |

### 🟢 낮은 위험

| # | 문제 | 근거 | 영향 |
|---|------|------|------|
| 7 | **노션 저장 실패** | 비동기 저장이라 실패해도 메인 흐름 중단 안 됨 | 노션에 기록 누락 |
| 8 | **텔레그램 전송 실패** | 마찬가지로 비동기 | CEO가 텔레그램에서 못 봄 |

---

## 선제 보강 완료 (빌드 #460)

| # | 실패 지점 | 보강 내용 |
|---|----------|----------|
| 2 | 도구 미호출 | content_specialist 프롬프트에 "반드시 gemini_image_generator, gemini_video_generator 호출" 명시 |
| 3 | 인스타 제외 무시 | CMO + content_specialist 프롬프트에 "CEO 플랫폼 제외 지시 최우선" 추가 |
| 1 | Veo 타임아웃 | max_polls 30→60 (5분→10분), 타임아웃 시 에러→"진행 중" 메시지로 변경 |

---

## 🎯 테스트 시 확인 체크리스트

- [ ] 채팅 메시지 전송 → 라우팅 결과가 cmo_manager인지
- [ ] 전문가 3명 호출되는지 (에이전트 상태 패널 확인)
- [ ] 콘텐츠 Specialist가 gemini_image_generator 호출하는지
- [ ] 이미지가 실제로 /api/media/images/에 저장되는지
- [ ] gemini_video_generator 호출되는지 (시간 오래 걸림 주의)
- [ ] sns_manager(submit) 호출 → 승인 큐에 등록되는지
- [ ] COMM STATION 승인 대기열에 항목 표시되는지
- [ ] 이미지/영상 미리보기가 승인 큐에서 보이는지
- [ ] [승인] → [🚀 발행] 플로우가 작동하는지
- [ ] 인스타그램이 제외되었는지
- [ ] 노션에 산출물 저장되는지
- [ ] 텔레그램으로 결과 전송되는지

---

## 🔍 실제 테스트 결과 (예측 vs 현실)

> 테스트 후 여기에 기록

| 예측 | 실제 | 일치? | 비고 |
|------|------|-------|------|
| | | | |
