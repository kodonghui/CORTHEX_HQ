# 핸드오프 — v5.3.1 Claude Code 에이전트 파이프라인 구축 (빌드 #773~#781)

**날짜**: 2026-03-02 (KST) | **최신 빌드**: #781

---

## 이번 세션에서 완료한 것

### 빌드 #779 — v5.3 탭 숨기기 전면 폐기 (네이버 모델 완전 구현)
- `showSections`, `allowedDivisions` workspaces.yaml/JS/HTML 전부 제거
- 탭 전부 표시 (숨기기 = 네이버 모델 위반)
- 기밀문서 division 버튼: x-show 조건 제거, orgScope로만 데이터 필터
- loadArchive(): orgScope + filterDivision 함께 API 전달
- CLAUDE.md + architecture.md 탭 숨기기 금지 명시

### 빌드 #780 — 인사말 하드코딩 제거
- `getGreeting()`: "고동희 대표님" 하드코딩 → `auth.user.name` 동적 사용
- `auth_handler.py`: user_name → DB 설정값(`ceo_display_name`/`sister_display_name`) 우선
- 누나 로그인 → "좋은 아침입니다, 누나" 표시

### 빌드 #781 — Claude Code 에이전트 파이프라인 구축
`.claude/agents/` 에이전트 5개 추가:

| 에이전트 | 역할 | 발동 |
|---------|------|------|
| `spec-validator` | 구현 vs 스펙 검증 | "검증해", 커밋 전 |
| `claude-md-checker` | 아키텍처 위반 감지 (Haiku) | 코드 수정 후 |
| `investigator` | 버그 조사 전용 (읽기 전용) | "원인 파악해" |
| `corthex-pm` | 방향성 → 요구사항 자동화 | "만들어", "추가해" |
| `reality-check` | 완료 현실 점검 | 커밋 전 |

인프라:
- `.claude/settings.json`: PreToolUse Bash 훅 추가
- `.claude/scripts/safety-guard.sh`: git push --force main 등 차단
- `CLAUDE.md`: 에이전트 파이프라인 규칙 추가

---

## 현재 미해결 / 검증 필요

### 🟡 실제 로그인 검증 미완 (코드 됐지만 눈으로 확인 안 됨)
- CEO 로그인 → 모든 탭 보임 (trading/intelligence 포함)
- 누나 로그인 → 모든 탭 보임 + "좋은 아침입니다, 누나" 표시
- 누나 기밀문서 → 사주 문서만 (리트마스터 클릭 → 빈 결과)
- 누나 대시보드 → 사주 에이전트 비용만

### 🟡 ARGOS/KIS 탭 누나 접속 시 빈 상태 UX
- 누나가 ARGOS/KIS 탭 들어가면 "연동 없음" 표시 구현 안 됨
- 빈 상태로 표시되는 것 확인 필요

---

## 현재 .claude/agents/ 전체 목록

```
.claude/agents/
├── log-analyzer.md         (Haiku) — 서버 로그 분석
├── security-reviewer.md    (Sonnet) — 보안 위반 감지
├── spec-validator.md       (Sonnet) — 구현 vs 스펙 검증 ← 신규
├── claude-md-checker.md    (Haiku)  — 아키텍처 규칙 준수 ← 신규
├── investigator.md         (Sonnet) — 버그 조사 전용 ← 신규
├── corthex-pm.md           (Sonnet) — PM 자율화 ← 신규
└── reality-check.md        (Sonnet) — 완료 현실 점검 ← 신규
```

## 파이프라인 규칙 (CLAUDE.md에 추가됨)

```
새 기능: corthex-pm → 구현 → spec-validator + claude-md-checker → 커밋
버그:    investigator → 수정 → spec-validator → 커밋
완료 전: reality-check → "됐겠지" 금지
```

---

## 오늘 논의된 미래 방향 (BACKLOG 추가 권장)

- **CORTHEX SaaS화 (D안)**: 이메일 초대 + 역할 관리 UI + DB users 테이블. Python 유지. SQLite → PostgreSQL 전환 포함.
- **인사말 이름 설정 UI**: 설정 페이지에서 `ceo_display_name`, `sister_display_name` 변경 가능하게

---

## 다음 세션 시작 프롬프트

```
안녕. docs/handoff/2026-03-02_v531-에이전트파이프라인-핸드오프.md 읽어.
최신 빌드: #781. 미해결: 실제 로그인 검증.
대표님이 CEO/누나 로그인 후 탭 전부 보이는지, 인사말 맞게 나오는지 확인 먼저 해달라고 해.
```
