# CORTHEX HQ - 프로젝트 현재 상태

> **이 파일의 목적**: 클로드가 새 세션을 시작하거나 대화 기억이 리셋될 때, 이 파일을 읽으면 "프로젝트가 지금 어디까지 진행됐는지"를 바로 파악할 수 있도록 하는 파일입니다.
>
> **규칙**: 매 작업이 끝날 때마다 이 파일을 업데이트할 것.

---

## 마지막 업데이트

- **날짜**: 2026-02-20 (오후 세션 2차)
- **버전**: `3.02.001` (GPT 라우팅 디버그 + 시그널 파싱 + 도구 10회)
- **최신 빌드**: #360
- **작업 브랜치**: `claude/fix-gpt-routing-debug` (main에 머지 완료)
- **접속 주소**: https://corthex-hq.com

---

## 🔴 긴급 TODO — 전략실 전수검사 (CEO 승인 완료)

### 핵심 버그 (반드시 수정)

| # | 버그 | 원인 | 심각도 |
|---|------|------|--------|
| **P2-1** | **매매 결정(decisions) 저장 안 됨** | `run_trading_now()`에서 signals는 저장하는데 decisions 변환/저장 로직 누락 | 🔴 치명적 |
| **P2-9** | **포트폴리오에 매수 미반영** | CEO가 한화솔루션 1주 수동 매수했는데 holdings=[] | 🔴 높음 |
| **P2-12** | **order_size가 10,000원** | 기본값 1,000,000원이어야 하는데 10,000원으로 되어있음 | 🟡 중간 |

### 디버그 URL 결과 (2026-02-20 CEO 확인)

| URL | 결과 |
|-----|------|
| `/api/debug/ai-providers` | **전원 정상** (anthropic✅, openai✅, google✅) — 지금은 GPT 정상 |
| `/api/debug/cio-signals` | 시그널 7개 저장됨, **decisions 0건** ← 핵심 버그 |
| `/api/trading/decisions` | `{"decisions":[]}` ← 비어있음 |
| `/api/trading/settings` | auto_execute:true, enable_real:true, enable_mock:true, **order_size:10000** |
| `/api/trading/portfolio` | kr: ₩250,010 / us: $171.79 / **holdings: []** (한화솔루션 미반영) |
| `/api/trading/mock/balance` | ₩100,000,000 정상 |

### GPT 0회 원인 확정

- 오전 10:09~10:44에 4번 분석 실행 → 전부 **API 400 에러** (도구 스키마 `type:None` 버그)
- 에러 시 Claude로 폴백 → Claude 카운트만 올라감
- 빌드#358에서 스키마 버그 수정 후 11:06부터 전문가 정상 호출
- **현재 OpenAI "정상"** → 다음 분석 시 GPT로 호출될 것

### 전수검사 범위 (P2-1 ~ P2-12, CEO 전원 승인)

| # | 영역 | 수정 내용 |
|---|------|---------|
| P2-1 | decisions 저장 버그 | 시그널 → 결정 변환 로직 추가 (매매 안 됨 근본 원인) |
| P2-2 | 교신로그 탭 전환 버그 | SSE 연결 유지 + 데이터 보존 |
| P2-3 | 교신로그 도구 사용 표시 | 대화창처럼 실시간 도구 호출 표시 |
| P2-4 | CIO 독자 분석 병렬 실행 | 전문가 대기 중 CIO도 독자 분석 |
| P2-5 | 새로고침 시 분석 재연결 | Ctrl+Shift+R 대응 |
| P2-6 | 시세 새로고침 SSE (B안) | 1분 폴링 → SSE 실시간 |
| P2-7 | CIO 목표가 산출 | 관심종목에 CIO가 산출한 목표가 표시 |
| P2-8 | 실거래 UI 확대 + 레이아웃 C안 | 2행2열 + 큰 글자 + 한국장\|미국장 |
| P2-9 | 포트폴리오 반영 버그 | KIS 당일 매수 반영 확인 |
| P2-10 | CIO 성과 탭 전수검사 | 승률, 수익률, 자기보정 |
| P2-11 | 종목 클릭 차트 (C안 슬라이드패널) | 일봉/분봉 차트 + CIO 시그널 요약 |
| P2-12 | order_size 10,000원 수정 | 기본값 1,000,000원으로 복구 |

---

## CEO 확정 설계 결정 (반복 설명 금지!)

### 실거래 UI C안 (2026-02-20 승인)
- **2행 2열 레이아웃**: 실거래(한국장|미국장) / 모의투자(한국장|미국장)
- **크기 확대**: 잔고 숫자 text-5xl, 카드 패딩 넉넉하게, 실감나는 크기
- **스크롤 허용**: 카드 하나하나를 크게

### 종목 클릭 차트 C안 (2026-02-20 승인)
- 종목 클릭 → 오른쪽에서 슬라이드 패널
- 일봉 차트 (기본) / 시간별 차트 (토글)
- 현재가 + 등락률 + 거래량 + 이동평균선 + CIO 시그널

### 사령관실 C안 + 전략실 C안 (2026-02-20 승인)
- **사령관실 내부통신 C안**: SSE 상시 + P2P 실시간 + 뱃지 + 네트워크 다이어그램 + 검색/필터
- **전략실 교신로그 C안**: 분석별 그룹핑 + 사령관실 통합 (사령관실 C안 이후)

### 시세/디버그/목표가 (2026-02-20)
- 시세 새로고침 **B안**(SSE) CEO 동의
- 디버그 URL: 어디든 버그 시 그때그때 만들어서 CEO에게 적극 제공
- 관심종목 목표가 무시 → CIO가 분석 후 목표가 산출하도록

### "지금 분석" C안 (2026-02-19 확정)
- 대시보드 "지금 분석" 버튼 → CIO+전문가4명 분석 → 매매 결정 일지 → 전략실 협업로그

---

## CIO 분석 현황 (2026-02-20)

### 오늘 분석 실행 7회
- 10:09~10:44: 4회 실패 (API 400 → 도구 스키마 버그)
- 11:06, 11:59: 성공했으나 기술적분석 보고서 미제출 (도구 5회 제한)
- 12:44: **완전 성공** (CIO + 전문가 4명 전원 정상, 비용 $2.09)

### 보고서 품질 (12:44 분석 기준)
- 보고서 5개 전부 정상 생성 (CEO 수석실 아카이브에 저장됨)
- CIO가 전문가 보고서를 교차검증하고 지적사항 4개 제시
- Kelly Criterion 비중 산출, 교차검증 매트릭스 등 설계대로 작동
- **문제**: 보고서는 나오는데 decisions에 저장 안 돼서 시그널탭/매매 미반영

### CIO 최종 시그널 (12:44 기준)
| 종목 | 시그널 | 신뢰도 |
|------|--------|--------|
| SK하이닉스 | 매수 | 78% |
| 한화솔루션 | 매도 | 71% |
| 삼성전자 | 조건부 매수 | 69% |
| 두산에너빌리티 | 조건부 매수 | 62% |
| LG | 관망 | 46% |
| 한화시스템 | 관망 | 43% |

---

## 기타 미완료

- **P1**: CLAUDE.md 다이어트 (500줄 → 핵심만) — 전수검사 후 또는 중간에 같이
- **미커밋**: src/tools/gemini_*.py 8개 (CMO 이미지 도구)
- **사령관실 C안**: 전략실 전수검사 이후

---

## 프로젝트 기본 정보

- **저장소**: https://github.com/kodonghui/CORTHEX_HQ
- **서버**: Oracle Cloud ARM 24GB (corthex-hq.com)
- **현재 버전**: 3.02.001
- **에이전트**: 29명 (5개 부서)
- **도구**: 154개
- **DB**: SQLite (서버: /home/ubuntu/corthex.db)
