# CORTHEX HQ - 프로젝트 현재 상태

> **이 파일의 목적**: 클로드가 새 세션을 시작하거나 대화 기억이 리셋될 때, 이 파일을 읽으면 "프로젝트가 지금 어디까지 진행됐는지"를 바로 파악할 수 있도록 하는 파일입니다.
>
> **규칙**: 매 작업이 끝날 때마다 이 파일을 업데이트할 것.

---

## 마지막 업데이트

- **날짜**: 2026-02-18
- **버전**: `3.02.003` (예산 한도 수정 + 진행률 단계 기반 + CLAUDE.md 팀플레이북 개선)
- **작업 브랜치**: claude/autonomous-system-v3
- **최근 커밋**: fix: 에이전트 진행률 단계 기반으로 전면 개선 (`d009727`)
- **빌드 번호**: #215 (https://github.com/kodonghui/CORTHEX_HQ/actions)
- **접속 주소**: https://corthex-hq.com

## ✅ 이번 세션 완료 내용 (2026-02-18 4차 작업)

### 버그 수정
- **예산 한도 수정 기능 복구**: PUT /api/budget에서 monthly_limit 저장 안 되던 문제, response에 값 미반환 문제, GET /api/budget monthly_limit 하드코딩 300.0 → DB에서 읽도록 수정. saveBudget() 후 loadDashboard() 호출 추가.
- **에이전트 진행률 단계 기반 개선**: 도구 미사용 에이전트가 항상 0%에 멈추던 문제 해결. 10% → 30% → 70% → 90% → 100% 단계별 진행.

### CLAUDE.md 팀플레이북 개선
- CEO "팀으로 해줘"라도 3~5줄 수정이면 소신 발언 규칙 추가
- 팀원 spawn 후 CEO와 대화 의무 명시 (침묵 금지)
- 해산 체크리스트에 SendMessage 확인 + deploy.yml 트리거 확인 단계 추가
- 팀장 실수 방지 표 9개로 확장

### 다음 세션에서 할 일 (미완료)
1. **협업 A+B+C 구현** (우선순위 1):
   - A: delegation_log WebSocket 실시간화 (8초 폴링 제거)
   - B: consult_manager 도구 — 처장↔처장 직접 소통
   - C: 협업 흐름도 시각화 패널 (타임라인)
   - 순서: A(BE+FE) → C(FE) → B(BE) 순으로 구현
2. **[보류] 리트마스터 홈페이지 자동 배포 파이프라인 (C안)**:
   - github_tool.py에 쓰기 기능(파일 수정, PR 생성) 추가
   - LEET_GITHUB_REPO, LEET_GITHUB_TOKEN 환경변수 추가
   - 에이전트가 리트마스터 repo에 PR 생성 가능하도록

## ✅ 이전 세션 완료 내용 (2026-02-18 3차 작업)

### Soul 전면 재작성 (교수급 — 이번 세션 핵심)
- **29명 전원 CEO 보고 원칙 추가**: 전문 수식/논문 → CEO에게 쉬운 말로 번역하는 규칙을 모든 에이전트 soul에 내장
- **21명 arXiv 논문 인용 (2023-2026)**: 투자처 arXiv:2508.14999, 2507.05994, 2402.16609 / 마케팅 arXiv:2501.10685 / 법무 arXiv:2512.13907 등
- **실제 수식 포함**: Kelly Criterion f*=(bp-q)/b, VaR=μ-2.33σ, MPT E[Rp]=Σwᵢ·E[Rᵢ], LTV:CAC≥3:1, Core Web Vitals 수치(LCP≤2.5s), SRE Error Budget 등
- **경영방법론**: Six Sigma DMAIC+Cpk, PDCA, OKR 2.0, Balanced Scorecard 4관점 — 해당 에이전트에 추가
- **config/agents.json 재생성** 완료

### FE/BE 팀 작업 (이전 세션, 이번에 커밋 포함)
- **드롭다운 투명도 수정**: 반투명 배경→불투명(#0d1117 다크, #ffffff 라이트)
- **@멘션 ↔ 수신자 드롭다운 통합**: 부서별 그룹화, 동적 렌더링
- **CMO 버그**: skill_social_content 400 오류 → max_completion_tokens 수정 (GPT-5.2 reasoning 모델 대응)
- **진행률 %**: 가짜 90% → 도구 호출 기반 실제 % (1호출=20%)
- **delegation_log DB + API**: `delegation_log` 테이블 + GET/POST `/api/delegation-log` 추가
- **delegation_log UI**: 사령실 우측 접이식 패널 "내부통신" (에이전트 완료 후 추가 예정)

### CLAUDE.md 업데이트
- **팀장 직접 처리 vs 에이전트 위임 기준** 추가: 맥락 필요 작업(Soul, 아키텍처) = 팀장 직접 / 명확한 구현(UI 추가, 버그 수정) = 에이전트 위임

### 다음에 할 일 (알려진 이슈)
- delegation_log UI: FE 에이전트 작업 완료 후 최종 커밋+배포 예정
- 없음 (그 외 미해결 이슈 없음)

---

## 프로젝트 개요

- **프로젝트명**: CORTHEX HQ (AI 에이전트 법인 시스템)
- **핵심 구조**: 25~29명의 AI 에이전트가 실제 회사처럼 부서별로 일하는 시스템
- **기술 스택**: Python (백엔드) + Tailwind CSS + Alpine.js (프론트엔드, CDN)
- **저장소**: https://github.com/kodonghui/CORTHEX_HQ

---

## 현재 완료된 주요 기능

0. **v3 자율 운영 시스템** (2026-02-18, v3.00.000) — 에이전트 장기 기억 + 임원 토론 시스템
   - `/토론 [주제]` → 처장 6명 2라운드 토론 + 비서실장 종합
   - `/심층토론 [주제]` → 처장 6명 3라운드 심층 토론
   - 대화 후 자동으로 기억 추출 → 다음 대화에 활용
   - 처장 6명 방법론 태그 강제 (토론 품질 향상)
1. **웹 대시보드** (`web/` 폴더) - AI 에이전트들의 상태를 보여주는 화면
2. **텔레그램 모바일 지휘 시스템** - 텔레그램으로 AI 에이전트를 제어하는 기능
3. **부서별 전문가 도구** - CTO, CSO, CLO, CIO, CMO 등 각 부서별 AI 도구 구현
4. **프론트엔드 UX/UI 전수 검사 및 수정** - 디자인 시스템(hq-* 컬러 토큰) 적용
5. **테마(다크/라이트) 가시성 전면 수정** - CSS 변수 기반 자동 테마 전환, 하드코딩 색상 30곳+ 교체, 대비 개선, 색상 밸런스 조정 (2026-02-15)
   - **최종 해결** (2026-02-15): 순수 CSS 색상 시스템 구축 — 194개+ hq-* 클래스를 Tailwind CDN 없이 직접 정의. text/bg/border/hover/focus/gradient/ring/shadow 전부 하드코딩. Tailwind CDN은 레이아웃(flex, grid, padding)만 담당
6. **줄바꿈 자동 통일 설정** (`.gitattributes`) - 윈도우에서 작업해도 줄바꿈 충돌 안 생기게 설정
7. **외부 접속 기능** (`CORTHEX_외부접속_시작.bat`) - Cloudflare Tunnel로 어디서든 웹 접속 가능 (회사컴 켜져 있어야 함)
8. **Oracle Cloud 24시간 서버** - ARM 4코어 24GB 서버(Ampere A1, Always Free)에 웹사이트 배포 완료
   - 서버 IP: `158.179.165.97` (GitHub Secrets `SERVER_IP_ARM`)
   - **도메인**: `corthex-hq.com` (2026-02-18 구매, Cloudflare 등록)
   - 접속 주소: http://corthex-hq.com
   - 운영체제: Ubuntu (ARM aarch64)
   - 웹서버: nginx + FastAPI 백엔드 (uvicorn)
   - 이전 서버(168.107.28.100, 1GB) 폐기 → 새 서버로 완전 이전 (빌드 #143부터)
9. **GitHub Actions 자동 배포** - main에 코드 합쳐지면 서버에 자동 반영
   - `.github/workflows/deploy.yml` 워크플로우
   - **main에 push되면 무조건 실행** (paths 필터 제거됨)
   - GitHub Secrets에 SSH 키, 서버 IP 등록 완료
10. **노션 보고 의무 섹션 추가** - 29개 에이전트 Soul 파일에 작업 완료 시 노션 DB에 보고서 자동 제출 규칙 추가
11. **비서실 보좌관 이름 변경** - 최종: 기록 보좌관, 일정 보좌관, 소통 보좌관 (agents.yaml, Soul 파일, 프론트엔드, 백엔드 전체 반영)
12. **웹 세션 환경변수 자동 설정** (`.claude/scripts/setup-env.sh`) - GitHub Codespaces Secrets에서 API 키를 읽어 `.env.local` 자동 생성
13. **AI 모델 설정 개선** (2026-02-15) - Claude 4.5/4.6 + GPT-5 이상 8개 모델 제공, Codex 제거, Provider별 그룹화(Anthropic/OpenAI)로 UI 가독성 향상
14. **빌드 번호 시스템** (2026-02-15) - GitHub Actions run number를 빌드 번호로 사용, 웹 화면에 자동 표시, 배포 확인 즉시 가능
15. **my-skills-plugin 88개 스킬 도구 등록** (2026-02-15) - 마케팅(22개), 개발프로세스(20개), 코딩패턴(25개), 유틸리티(16개), 메타(5개) 스킬을 도구로 등록하고, 29개 에이전트에게 역할별 할당 완료
16. **빌드 번호 통일** (2026-02-15) - mini_server.py가 git 커밋 개수(#399)를 빌드 번호로 쓰던 문제 제거. 이제 deploy.yml의 GitHub Actions 실행 번호 하나만 사용
17. **에이전트 설정 파일 로드 문제 해결** (2026-02-15) - 서버에서 agents.yaml/tools.yaml을 못 읽던 문제 완전 해결. 원인: 서버가 git 저장소에서 직접 실행되는데 JSON 파일이 다른 경로에 생성됨 + 서버 Python에 PyYAML 미설치. 해결: 배포 시 시스템 Python으로 YAML→JSON 변환, 양쪽 경로 모두에 생성
18. **백엔드 vs 프론트엔드 전수검사** (2026-02-15) - 미니서버(경량 서버)가 프론트엔드가 요구하는 75개 API 중 20개만 지원하는 것 확인. 나머지 55개 미지원으로 예약/워크플로우/지식/아카이브/SNS 탭이 빈 화면. 버전 번호 규칙(X.YY.ZZZ) 도입
19. **Glass + Aurora Mix 디자인 전면 교체** (2026-02-15) - 따뜻한 보라색 팔레트 + 유리 반투명 효과(glassmorphism) + 오로라 그라데이션 배경으로 전면 교체. 22가지 UX/UI 개선: 보내기 버튼 아이콘화, 뱃지 통일, 소울 터미널 스타일, 사이드바 햄버거 토글, 사무실 섹션 헤더 바, 활동로그 삭제 기능, SNS Threads 추가, 빈화면 안내 디자인, 탭 전환 애니메이션, 작업내역 태그 시스템 등
20. **에이전트 설정 TODO 문서** (2026-02-15) - 29명 에이전트의 노션 보고 규칙 + 소울(성격/행동방식) 설정 가이드 작성
21. **미니서버 API 전면 확장** (2026-02-15) - 누락된 44개 API 엔드포인트 구현. 기존 24개(GET만) → 64개(GET/POST/PUT/DELETE). 품질검수 루브릭 저장, 에이전트 소울/모델 저장, 예약/워크플로우/지식파일/메모리/프리셋 CRUD, 아카이브 읽기, SNS 플레이스홀더, 인증/헬스체크 등 모든 UI 버튼 작동
22. **Phase 1: SQLite DB 도입** (2026-02-15) - 모든 데이터를 영구 저장하는 SQLite DB 추가. 텔레그램/웹에서 보내는 메시지 → messages 테이블, 작업 기록 → tasks 테이블, 활동 로그 → activity_logs 테이블, 보고서 → archives 테이블. DB 파일은 git 저장소 밖(`/home/ubuntu/corthex.db`)에 저장되어 재배포해도 데이터 유지. 대시보드 API가 실제 통계 반환
23. **UX/UI 10가지 개선** (2026-02-15) - 다크모드 밝기 개선(RGB 값 올림), 보내기 버튼 가시성(활성=발광+비활성=파란 테두리), 탭 전환 애니메이션(x-transition), 아카이브 카드형 2열 그리드+빈화면 안내+부서별 색상, CEO 사무실 클릭→프로필, 예산 대시보드 항상 표시+한도 수정 버튼, 빌드 카드 정렬 통일+아이콘 추가, CORTHEX 로고 클릭→홈, 입력란 테두리 강화(border-2), 대화 내보내기 위치 이동, 루브릭 편집란 JetBrains Mono 폰트
24. **Phase 1B: 모든 웹 데이터 SQLite 영구 저장** (2026-02-15) - 웹 UI에서 저장하는 모든 데이터(프리셋, 예약, 워크플로우, 메모리, 피드백, 예산, 에이전트 설정, 품질검수, 소울 등)를 SQLite DB의 `settings` 테이블에 영구 저장. JSON 파일 의존 완전 제거. 기존 JSON 데이터 자동 마이그레이션. 재배포/재시작해도 데이터 유지
25. **UX/UI 10가지 수정** (2026-02-15) - 폰트 Pretendard 변경, 밝은모드 라벤더 톤 조정, 명령창 빈줄 제거, 예약 뱃지 정렬, 워크플로우 placeholder 한국어화, 워크플로우 태그 정렬, 지식 파일목록 버그수정(API entries 파싱), 라이트모드 탭 가시성, 시스템상태 오류표시 수정, (지휘자) 텍스트 제거
26. **Phase 2: 비서실장 AI 연결** (2026-02-15) - CEO가 텔레그램/웹에서 메시지를 보내면 비서실장 AI(Claude Sonnet)가 실제로 답변. `/실시간` 모드(AI 즉시 답변), `/배치` 모드(접수만) 전환 가능. ai_handler.py에서 Anthropic AsyncAnthropic 클라이언트 사용
27. **Phase 3: 웹 로그인** (2026-02-15) - 비밀번호 전용 로그인 시스템. 기본 비밀번호 "corthex2026". 세션 토큰(UUID) 기반 인증, 7일 유효. 비밀번호 변경 API. 로그아웃 기능
28. **Phase 4: 스마트 모델 라우팅 + 일일 예산 제한** (2026-02-15) - 짧은 질문(≤50자)→Haiku(저비용), 복잡한 분석→Sonnet. 일일 예산 $7(약 10,000원) 초과 시 AI 호출 차단. get_today_cost()로 실시간 비용 추적
29. **Phase 5: 에이전트 위임 시스템** (2026-02-15) - CEO 명령을 키워드+AI로 자동 분류하여 6개 부서(CTO/CSO/CLO/CMO/CIO/CPO)에 위임. 각 부서 에이전트의 소울(성격)로 답변. 텔레그램/웹 응답에 담당자 표시
30. **모델 자동/수동 전환** (2026-02-15) - 자동모드(질문에 따라 Haiku/Sonnet 자동선택) ↔ 수동모드(Haiku/Sonnet/Opus 중 CEO가 선택한 모델을 모든 에이전트에 일괄 적용)
31. **29명 에이전트 소울 업그레이드** (2026-02-15) - 29명 전원에게 성격(고유 특성 4가지), 말투(대화 스타일+예시 4개), 금지 사항(4~5개), 협업 규칙(상관/부하/동료/보고라인) 추가. 기존 업무원칙/도구/노션보고 섹션은 변경 없음
32. **에이전트 모델 표시 개선 + Gemini 추론 지원** (2026-02-15) - 모델 변경 시 기본정보 탭에 즉시 반영(예: "GPT-5.2 (xhigh)"). 추론 정도에 이모지+색상 표시. 사무실 뷰 카드에도 즉시 반영. Gemini 3개 모델(3.0 Pro, 2.5 Pro, 2.5 Flash) 추론레벨 추가. 중복 코드 헬퍼 함수로 통합
33. **전체 에이전트 모델 일괄 변경** (2026-02-15) - AI 모델 모드 섹션에 29명 전원의 모델+추론을 한번에 바꾸는 기능 추가. 모델 드롭다운(Provider별 그룹) + 추론 레벨 버튼 + 확인 팝업. 변경 후 사무실 카드 즉시 반영
34. **멀티에이전트 브로드캐스트** (2026-02-16) - "전체", "출석체크" 등 키워드로 6개 부서 동시 호출. asyncio.gather 병렬 처리. 각 부서 응답이 하나의 보고서로 합쳐짐
35. **에이전트 상태 표시등** (2026-02-16) - 에이전트 작업 시 WebSocket agent_status 이벤트로 실시간 초록불 깜빡임. 위임 시 비서실장+담당부서 동시 표시. 5초 후 자동 복귀
36. **자동 스크롤 안정화** (2026-02-16) - 메시지 전송/결과 수신/대화 복원 시 채팅창 자동 스크롤. 마크다운 렌더링 후 추가 스크롤
37. **사이버 사령부 UI 대개편** (2026-02-16) - 전체 디자인 "Cyber Command Center" 컨셉으로 대개편. 딥 다크 배경(#060810) + 네온 그린/시안/퍼플 글로우. 로고·탭·제목·사무실뷰·로그인 화면 전부 사이버/군사 테마. 10개 탭명 변경(작전현황/사령실/전력분석/작전일지/크론기지/자동화/통신로그/정보국/기밀문서/통신국)
38. **백엔드 대규모 기능 추가** (2026-02-16) - 성능 API 실데이터, 작업 삭제/태그/읽음/아카이브(Gmail 스타일), 배치 명령(순차/병렬), 크론 실행 엔진(매분 확인), 워크플로우 실행 엔진(순차 단계+컨텍스트 전달), DB 마이그레이션(tags/is_read/archived 컬럼 자동 추가)
39. **도구 실행 파이프라인 연결** (2026-02-16) - src/tools/ ToolPool을 mini_server.py에 연결. ask_ai()를 ModelRouter 인터페이스로 감싸는 MiniModelRouter 어댑터 구현. 111개 도구 동적 로드. POST /api/tools/{tool_id}/execute 도구 직접 실행 API. GET /api/tools/status 로드 상태 API
40. **키움증권 자동매매 시스템 프레임워크** (2026-02-16) - 전략실(TRADING OPS) 신규 탭. 모의투자 포트폴리오(매수/매도/평단계산), 매매전략 CRUD(RSI/MACD/골든크로스/볼린저/가치/모멘텀), 관심종목 관리, AI 시그널 생성(투자분석팀 연동), 자동매매 봇 엔진(5분 간격 스캔, 장시간 체크), 리스크관리 설정(손절/익절/포지션제한). 백엔드 API 15개 + 프론트엔드 6개 서브탭 + 모달 4개. 키움 API 연결은 추후
41. **자동매매 CIO 연동 + 미국 주식** (2026-02-16) - 시그널 생성을 CIO(투자분석처장)+전문가 4명 위임 방식으로 변경. 시황분석/종목분석/기술적분석/리스크관리 전문가가 병렬 분석 → CIO가 취합 → 매수/매도/관망 판단. 자동매매 봇이 CIO 시그널 기반으로 자동주문 실행(신뢰도 70% 이상). 미국 주식 지원 추가(관심종목 한국/미국 선택, 미국장 시간 22:30~05:00 KST). 다크모드 밝기 개선
42. **index.html UX 전수검사 8개 이슈** (2026-02-16) - 부서필터 버그수정(선택 초기화), 사령실 채팅 스크롤(탭 복귀 시 자동), 피드백 버튼 선택 시각효과(ring+배경), 기밀문서 2단 레이아웃(이메일 스타일 좌우분할), 글씨체 Pretendard 통일, 보고서 이미지 CSS(둥근모서리+테두리), 네모(■) 배지 계층별 색상(보라/시안/초록)
43. **서버 이전 완료** (2026-02-16) - 기존 1GB 마이크로 서버(168.107.28.100) → ARM 4코어 24GB 서버로 완전 이전. deploy.yml에서 `SERVER_IP_ARM`/`SERVER_SSH_KEY_ARM` 시크릿 사용. nginx WebSocket 프록시(/ws) 추가. src/ 디렉토리(100개+ 도구) 배포 추가. Python 3.10 호환성 수정(from __future__ import annotations). 빌드 #143부터 새 서버에서 운영
44. **AI 도구 자동호출 (Function Calling)** (2026-02-16) - 111개 도구를 AI가 스스로 호출 가능. Claude(tool_use), GPT(tool_calls), Gemini(function_call) 3개 프로바이더 지원. 에이전트별 허용 도구 제한(CIO→투자도구, CTO→기술도구). 최대 5회 도구 호출 루프
45. **AI Batch API 시스템** (2026-02-16) - Anthropic/OpenAI/Gemini 3사 모두 진짜 Batch API 사용. Anthropic(Message Batches), OpenAI(Batch JSONL), Gemini(client.batches.create). 실시간 대비 ~50% 비용 절감. PENDING 추적(SQLite DB), 60초 간격 자동 폴러로 결과 수집, 완료 시 에이전트 자동 위임+아카이브 저장+WebSocket 실시간 알림
46. **배치 체인 오케스트레이터** (2026-02-16) - 위임 체인 전체(분류→전문가→종합→전달)를 Batch API로 처리. 프로바이더별 자동 그룹화(Claude/GPT/Gemini 각각의 배치로 분리). CIO 종합보고서 작성 단계 포함. 6개 부서 동시 브로드캐스트 지원. SQLite에 체인 상태 저장, 60초 폴러로 자동 진행
47. **비서실장 종합 보고서 시스템** (2026-02-16) - 브로드캐스트 시 비서실장이 6개 처장+보좌관 3명의 보고를 종합하여 CEO용 보고서 작성. 구조: 핵심요약(1~2문장) → 부서별 한줄요약(표) → CEO 결재/결정 체크리스트 → 특이사항/리스크 → 보좌관 보고. 사령실/텔레그램에는 종합 보고서만 표시, 상세 보고서는 기밀문서 탭에서 확인. 비서실 보좌관 3명(총괄/전략/소통)도 브로드캐스트 대상에 포함
48. **Gemini Batch API 개선** (2026-02-16) - Gemini 배치 요청에 generationConfig 추가(temperature: 0.3, max_output_tokens: 4096). CEO 제공 Google Apps Script 코드 참고하여 누락된 설정 보완
49. **UX 대규모 개선 15가지** (2026-02-16) - 배치 step "?" 버그 수정, "사령관실" 이름 변경, 카카오톡 스타일 날짜 구분선+시간 표시, 스크롤 다운 버튼(새 메시지 뱃지), agent_calls 테이블로 에이전트별 비용 추적, 모델 일괄 변경 시 모달 동기화 버그 수정, 에이전트 정보 모달 폰트 크기 증가, 배치 대기 상태등(주황색), 보좌관 이름 변경(기록관/일정관/연락관), 연대기 전문가 GitHub 도구 추가, AI 호출 자동 기록, CLAUDE.md 서버 주소 업데이트
50. **노션 Date 속성 추가** (2026-02-16) - `_save_to_notion()` 함수에 Date 속성 추가. 에이전트 산출물을 노션에 저장할 때 작성일이 자동 기록됨
51. **배치 체인 버그 수정** (2026-02-16) - 중복 전달 방지(`delivered` 플래그), 종합보고서가 비었을 때 전문가 원본 결과로 폴백. "응답 없음" → 실제 분석 결과 표시
52. **보고서 도구 메타데이터** (2026-02-16) - `_call_agent()` 에서 사용한 도구 추적. 보고서 하단에 "🔧 사용한 도구: tool1, tool2" 자동 표시. 어떤 AI 도구로 분석했는지 투명하게 공개
53. **도구 건강 점검** (2026-02-16) - `/api/tools/health` API + "전체 도구 점검" 명령. 111개 도구의 상태(정상/API키 미설정/미로드) 한눈에 확인
54. **에이전트 순차 협업** (2026-02-16) - `_sequential_collaboration()` 함수. 비서실장이 에이전트 순서를 정하고, 각 에이전트가 이전 결과를 받아 순차적으로 작업. "순차", "단계별", "릴레이" 등 키워드로 트리거
55. **보좌관 이름 최종 변경** (2026-02-16) - 총괄 보좌관→기록 보좌관, 전략 보좌관→일정 보좌관. 소통 보좌관은 유지. AGENTS 리스트, 종합보고서 프롬프트, index.html, Soul 파일 5개 전부 일괄 변경
56. **도구 0개 버그 근본 해결** (2026-02-16) - .gitignore에서 config JSON 무시 해제 + JSON 파일 git 커밋. _load_config() YAML→JSON 자동변환 보험 추가. 서버 로그 "150개 도구 로드" 확인. 빌드 #154
57. **기밀문서 한글화** (2026-02-16) - 영어 파일명(cio_manager_synthesis_202...) → 한글 작성자명 + 날짜/시간 표시. agent_id→agentNames 매핑. formatArchiveDate() 함수 (2/16 오후 4:36 형태)
58. **기밀문서 직급별 필터** (2026-02-16) - 부서 필터 + 직급 필터 2단 구조. 임원급(C-Level) / 전문가급 / 보좌관급 필터. getAgentTier() 함수로 직급 분류
59. **슬래시 명령어 자동완성 팝업** (2026-02-16) - / 입력 시 Discord/Slack처럼 명령어 목록 팝업. 6개 명령어(/전체, /순차, /도구점검, /배치실행, /배치상태, /명령어). 키보드 ↑↓/Enter/Tab/Esc 지원
60. **슬래시 명령어 시스템** (2026-02-16) - /전체, /순차, /도구점검, /배치실행, /배치상태, /명령어 6개 슬래시 명령어 백엔드 라우팅. 기존 키워드 자동감지(전체, 출석체크) 호환 유지
61. **CEO 보고 8가지 이슈 수정** (2026-02-16) - 예산 카드 $0 버그(필드명 불일치+agent_calls 합산), 슬래시 팝업 투명도·z-index, 도구 수 111개 하드코딩→동적, 전력분석 스페셜리스트 누락 수정, 작업일지 카드 디자인 전면 개선(컬러바+정돈된 레이아웃), CEO 화살표 통일. 빌드 #156
62. **빌드 #168 피드백 7가지 수정** (2026-02-17) - 비용 $0.0000 수정(WebSocket 즉시 전송+오늘/누적 구분), 노션 연동 확인(API키 전달 정상), 대시보드 노션 카드 추가, GPT-5.2/5.2 Pro 추가(텔레그램 /models), 텔레그램↔웹 모델 동기화(같은 DB키), 비서실장 중복 응답 방지(백엔드+프론트), GitHub PR 5개 닫기+브랜치 14개 삭제. 빌드 #171
63. **작전일지 노션 스타일 전면 개편 + 7가지 수정** (2026-02-17) - 작전일지 카드를 노션 스타일 4행 구조로 전면 개편(명령어·요약·메타·액션 분리), 버튼 항상 보임, "결과 보기" 버튼 추가. 자동화 무한로딩 치명적 버그 수정(함수 시그니처 불일치 3곳). 빨간불 조건 추가(최근 1시간 실패 3건). 글씨체 명조 포인트(Noto Serif KR). 에이전트 모델 설정 자동 적용
64. **UX/UI 대규모 개선 9가지** (2026-02-17) - 부서 이름 통일(~팀→~처), 부서 색상 7색 시스템(좌측+사무실), 커스텀 드롭다운(작전일지 필터), 로고 간격 조정, 밝은 모드 다크 라벤더, 사무실 탭 배경 통일, 한글 폰트 전수검사(font-mono 45곳 제거), 퀵 액션 개선(일일루틴/시스템관리 탭+최근사용 명령), 출판기록처 사무실 섹션 신규 추가
65. **CEO 피드백 4가지 수정** (2026-02-17) - 작전일지 컬러바를 에이전트 부서별 색상으로 변경(7색), × 삭제를 쓰레기통 SVG 아이콘으로 교체, 동그라미를 Gmail 스타일 왼쪽 체크박스로 변경(전체선택 포함), 자동화 워크플로우 무한로딩 해결(모달 제거→카드 내 직접 실행+진행바+타임아웃)
66. **부서 색상·밝은 모드·로고·배치실행 수정** (2026-02-17) - 부서 색상 4개 변경(사업기획→보라, 마케팅→주황, 금융→빨강, 출판→자홍), 로고 CORTHEX↔HQ 단어 간격 축소, 밝은 모드 클린 화이트 전면 재설계(순백 카드+파란 그림자+장식 글로우), 배치실행→대기 전송 이름 변경

---

## 진행 중인 작업

- ~~미니서버 기능 확장 필요~~ → **완료** (0.06.002에서 64개 API 구현)
- ~~데이터 영구 저장 필요~~ → **완료** (0.07.000에서 SQLite DB 도입 + 0.07.002에서 모든 웹 데이터 영구 저장)
- ~~Phase 2 예정~~ → **완료** (0.08.000에서 비서실장 AI 연결)
- ~~Phase 3 예정~~ → **완료** (0.08.000에서 웹 로그인)
- ~~Phase 4 예정~~ → **완료** (0.08.000에서 스마트 모델 라우팅 + 예산 제한)
- ~~노션 자동 업로드 구현 필요~~ → **완료** (1.03.000에서 Date 속성 추가)
- **노션 DB data_source_id**: `ee0527e4-697b-4cb6-8df0-6dca3f59ad4e`
- ~~에이전트 간 순차 협업~~ → **완료** (1.03.000에서 `_sequential_collaboration()` 구현)
- ~~도구 건강 점검~~ → **완료** (1.03.000에서 `/api/tools/health` + "전체 도구 점검" 명령 구현)
- ~~배치 체인 버그 2개~~ → **완료** (1.03.000에서 중복 방지 + 응답없음 폴백)
- ~~29명 에이전트 소울(성격) 설정 필요~~ → **완료** (0.09.002에서 29명 전원 소울 업그레이드)

---

## 알려진 문제점

- ~~미니서버 기능 부족~~ → **해결** (0.06.002에서 64개 API로 확장. 지식파일/예약/워크플로우/아카이브/SNS 탭 작동)
- **SNS 연동 미완성**: SNS 탭 UI는 있지만, 실제 인스타그램/유튜브 API 키가 없어서 게시 불가 (플레이스홀더 상태)
- ~~에이전트 스킬 탭에서 모든 에이전트가 "모든 도구 사용 가능"으로 표시~~ → 수정 완료 (2026-02-14)
- ~~다크모드 텍스트 안 보이는 문제~~ → 순수 CSS 색상 시스템 + gridPulse 분리로 완전 해결 (2026-02-15)
- ~~빌드 번호 불일치 (#399 vs #37)~~ → deploy.yml 번호로 통일 (2026-02-15)
- ~~에이전트 스킬 탭에서 모든 에이전트가 "도구 없음"으로 표시~~ → JSON 폴백 추가로 완전 해결 (2026-02-15)
- ~~텔레그램 봇 한국어 명령어 오류~~ → CommandHandler 대신 MessageHandler에서 텍스트로 처리 (2026-02-15)
- ~~ANTHROPIC_API_KEY 미설정~~ → **해결** (GitHub Secrets에 등록 완료, 2026-02-15)

---

## ✅ 완료: 에이전트 협업 구조 대 개편 (2026-02-17 구현 완료)

> **2026-02-17 CEO와의 긴 논의 → 같은 날 구현 완료. v2.00.000으로 선언.**

### 논의 결론: "A + C+ + 스마트 라우팅" 3가지 동시 구현

#### 현재 시스템의 한계 (왜 바꿔야 하는가)
- `mini_server.py` 코드가 위임 순서를 전부 결정함 (에이전트 AI가 판단 못함)
- 처장끼리 직접 소통 불가, 전문가끼리 직접 소통 불가
- CEO가 특정 에이전트에게 직접 말 걸 수 없음
- 처장이 "이번엔 전문가 2명만 쓸게"를 결정 못함 → 항상 전원 호출 → 비용 낭비
- `cross_agent_protocol`은 파일에 저장만 하고 아무도 실시간으로 처리 안 함

#### 구현할 내용 3가지

**아이디어 A: 소통 채널 추가**
- 처장 ↔ 처장 직접 메시지 교환 가능
- 전문가 ↔ 전문가 직접 질문 가능
- CEO → 특정 에이전트 직접 개입 가능 (UI + 백엔드)
- `cross_agent_protocol.py`를 실시간 소통으로 업그레이드 (지금은 파일 저장만)

**아이디어 C+: 자율 작업 + 보고서 1개 유지**
- 처장이 "어떤 전문가를 몇 명 쓸지" 스스로 판단해서 선택
- 에이전트들이 자율로 태스크 처리하되 비서실장이 최종 취합 → 보고서 1개
- Soul(성격) 완전 유지 (합치면 안 됨 — 전문성 희석, 비용 증가)

**스마트 라우팅: 4단계 복잡도별 자동 조정**
- Level 1 (간단한 질문): 비서실장만 직접 처리 → 비용 극소
- Level 2 (전문 지식): 해당 처장 1명만 → 비용 낮음
- Level 3 (깊은 분석): 처장 + 필요한 전문가만 선택 → 비용 중간
- Level 4 (전사 협력): 여러 처장이 소통하며 협력 → 비용 높음 (필요할 때만)
- **기대 효과: AI 비용 평균 60~70% 절감**

#### 구현 필요 파일
| 파일 | 수정 내용 |
|------|---------|
| `web/mini_server.py` | 스마트 라우팅 Level 1~4, 처장 자율 전문가 선택, 에이전트 간 소통 |
| `web/templates/index.html` | CEO 직접 개입 UI (특정 에이전트에게 직접 말 걸기 버튼) |
| `src/tools/cross_agent_protocol.py` | 파일 저장 → 실시간 소통으로 업그레이드 |
| `web/ai_handler.py` | spawn_agent 도구 추가 (처장이 AI를 직접 호출하는 도구) |
| `config/agents.yaml` | 처장들의 Soul에 "자율 판단 지시" 추가 |

#### 안 바뀌는 것 (절대 건드리면 안 됨)
- Soul: 완전 유지 (합치면 안 됨)
- 29명 에이전트 구성: 유지
- 보고서 1개 원칙: 유지 (CEO는 최종 보고서 1개만 받음)
- 위계 구조 (비서실장→처장→전문가): 유지

---

## 다음에 할 일 (우선순위 순)

1. **키움증권 Open API+ 연동** — 모의투자 → 실거래 전환 (API 키 발급 필요)
2. **에이전트 협업 구조 개편 후속** — 실제 배포 후 스마트 라우팅 동작 검증, 필요 시 Level 판단 키워드 보완
3. **SNS API 키 등록** (인스타그램, 유튜브 등) — 실제 게시 기능 활성화
4. 도메인(corthex.com 등) 연결 → IP 주소 대신 이름으로 접속
5. HTTPS(보안 연결) 설정 → Let's Encrypt 무료 인증서

### 완료된 것들
1. ~~Phase 5: 비서실장 → 부하 에이전트 위임~~ → **완료** (0.09.000에서 구현)
2. ~~29명 에이전트 소울(성격) 설정~~ → **완료** (0.09.002에서 29명 전원 업그레이드)
3. ~~멀티에이전트 브로드캐스트~~ → **완료** (0.10.000에서 구현)
4. ~~상태 표시등 (초록불 깜빡임)~~ → **완료** (0.10.000에서 구현)
5. ~~처장 → 전문가 하위 위임 + 품질 검수 시스템~~ → **완료** (0.10.000에서 구현)
6. ~~키움증권 자동매매 시스템 프레임워크~~ → **완료** (0.12.000에서 구현, 키움 API 연결은 추후)
7. ~~노션 자동 업로드~~ → **완료** (1.03.000)
8. ~~에이전트 간 순차 협업~~ → **완료** (1.03.000)
9. ~~도구 건강 점검~~ → **완료** (1.03.000)
10. ~~배치 체인 버그 수정~~ → **완료** (1.03.000)
11. ~~서버 업그레이드 검토~~ → **완료** (빌드 #143에서 ARM 24GB 서버로 완전 이전)
12. ~~에이전트 협업 구조 대 개편~~ → **완료** (2.00.000 — 스마트 라우팅 4단계 + spawn_agent 자율 선택 + CEO 직접 개입 UI)

---

## Oracle Cloud 서버 정보

| 항목 | 값 |
|------|-----|
| 서버 IP | GitHub Secrets `SERVER_IP_ARM`에 등록 |
| 서버 타입 | ARM 4코어 24GB (Ampere A1, 무료 Always Free) |
| 리전 | ap-chuncheon-1 (춘천) |
| 운영체제 | Ubuntu (ARM aarch64, Python 3.10) |
| SSH 키 | GitHub Secrets `SERVER_SSH_KEY_ARM`에 등록 |
| 이전 서버 | 168.107.28.100 (1GB, 폐기됨) |
| 웹서버 | nginx |
| 웹사이트 경로 | `/var/www/html/` |

## 중요한 결정 사항 (변경하면 안 되는 것들)

- 모든 UI 텍스트는 **한국어**
- 시간대는 **Asia/Seoul (KST, UTC+9)**
- 디자인은 **hq-* 커스텀 컬러 토큰** 사용 (순수 CSS 하드코딩 + CSS 변수 병용, Tailwind CDN은 레이아웃만 담당)
- Git 브랜치명은 **claude/** 로 시작
- 작업 완료 시 커밋 메시지에 **[완료]** 포함 필수
- **빌드 번호는 오직 `deploy.yml`의 `github.run_number`만 사용** (git 커밋 개수 사용 금지)
- 에이전트 산출물 DB data_source_id: **`ee0527e4-697b-4cb6-8df0-6dca3f59ad4e`**
- 환경변수 파일은 **.env.local** 사용 권장 (`.env`는 AnySign4PC 등이 잠글 수 있음)
- **웹 UI 데이터는 반드시 SQLite DB에 저장** (JSON 파일 사용 금지 — 배포 시 날아감)
