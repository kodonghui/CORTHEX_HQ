# CORTHEX HQ - 프로젝트 현재 상태

> **이 파일의 목적**: 클로드가 새 세션을 시작하거나 대화 기억이 리셋될 때, 이 파일을 읽으면 "프로젝트가 지금 어디까지 진행됐는지"를 바로 파악할 수 있도록 하는 파일입니다.
>
> **규칙**: 매 작업이 끝날 때마다 이 파일을 업데이트할 것.

---

## 마지막 업데이트

- **날짜**: 2026-02-21 (콘텐츠 파이프라인 세션)
- **버전**: `3.02.004`
- **최신 빌드**: 배포 후 갱신
- **작업 브랜치**: claude/corthex-monetization-strategy-AQzvU
- **접속 주소**: https://corthex-hq.com

---

## 🎉 첫 실매매 성공! (2026-02-21 04:38 KST)

**NVDA(엔비디아) 1주 매수 @ $189.115 — KIS 실계좌 체결 완료!**

- CIO(GPT-5.2 Pro)가 5개 종목 자동 분석 → NVDA 매수 판단(신뢰도 74%) → KIS API 주문 → 체결
- CEO가 KIS 앱에서 직접 확인: 보유잔고 1주, +58원(+0.02%)
- 상세 기록: `docs/updates/2026-02-21_첫-실매매-성공.md`

---

## 오늘 완료한 작업 (2026-02-21)

| 빌드 | PR | 내용 |
|------|-----|------|
| 배포 후 | — | **📰 콘텐츠 파이프라인 구축** — 분석→작성→편집→CEO승인→발행 자동화 (API 6개 + 대시보드 UI) |
| 배포 후 | — | **🔍 전수검사 9건 버그 수정** — 모델명/가격/IndexError/JSON→DB/중복정의/메모리누수/토큰만료/타임존 |
| 배포 후 | — | **총자산 이중 계산 수정** — 한국 `total_eval`이 해외자산 포함 → 한국 현금+보유종목만 계산 |
| 배포 후 | — | **관심종목 전체 분석** — `[:10]` 제한 제거, 전 종목 CIO 분석 |
| 배포 후 | — | **CIO 성과 예측 현재가 저장** — 검증 기준가 추가 + 에러 로깅 |
| #394 | #416 | **7개 버그 수정** — 교신로그/포트폴리오/CIO성과/기밀문서/모의매매 |
| #388 | #414 | **KIS 국내주식 TR_ID 신버전 교체** — 구TR(TTTC0802U) → 신TR(TTTC0012U). 매매 안 된 핵심 원인 |
| #392 | #414 | **통신로그 버그 5건 수정** — 활동로그/교신로그/P2P ID/폴링 노이즈 |

## 이전 작업 (2026-02-20 저녁 세션)

| 빌드 | PR | 내용 |
|------|-----|------|
| #366 | #387 | 대시보드 슬리피지 간소화 + 최근거래/교신로그 확대 + 작전일지 삭제 버튼 |
| #367 | #388 | **VECTOR(trading_executor) 도구 구현** — CIO가 직접 매수/매도 주문 실행 |
| #368 | #389 | 포트폴리오 초기화 버튼 추가 |
| #369-370 | #390 | **수동 매매 KIS 실주문 연동** + 가상/실거래 모드 구분 + 주문 모달 한국/미국 선택 |
| 수동배포 | — | KIS 모의투자 키 3개 GitHub Secrets 등록 (MOCK_APP_KEY/SECRET/ACCOUNT) |
| #371 | #395 | 실/모의 비교 탭 레이아웃 변경 → 실거래(한국|미국) / 모의투자(한국|미국) |

### 주요 변경 파일
- `web/kis_client.py` — KIS TR_ID 신버전 교체, 해외 모의투자 매도 TR 수정
- `web/templates/index.html` — 통신로그 통합, 활동로그 SSE 수정, 교신로그 정렬
- `web/mini_server.py` — 폴링 노이즈 스킵, JSON 파싱 에러 처리
- `src/tools/cross_agent_protocol.py` — P2P 에이전트 ID 사전 해석
- `src/tools/trading_executor.py` — VECTOR 도구 (CIO → KIS API 주문)
- `docs/kis-api-reference.md` — KIS 공식 TR_ID 참고 문서 신규

---

## 🔴 CEO 지시 TODO (2026-02-20 저녁 — 자러가기 전 지시)

### Phase 1: 전수검사

CORTHEX HQ 프로그램 전체 전수검사:
- 버그 및 미작동 기능 수정
- @멘션, 크론, 자동화 점검
- 대화 맥락 이해 (에이전트 이전 대화 기억)
- 직원들 자기 작업 기억하게 하기
- batch, 텔레그램 등 각종 기능 점검
- 필요시 아이디어/옵션/추천 후 추천안대로 코딩 (CEO 컨펌 불필요)

### Phase 2: 도구 개발

| 대상 | 수량 | 상세 |
|------|------|------|
| CMO 이미지 생성 도구 | 8개 | Gemini 기반 (기존 gemini_*.py 8개 미커밋 파일 활용) |
| CTO 교수급 도구 | 5개 | 기술개발처 전문 도구 |
| CSO 교수급 도구 | 5개 | 사업기획처 전문 도구 |
| CPO 교수급 도구 | 5개 | 출판·기록처 전문 도구 |
| 비서실 교수급 도구 | 3개 | 비서실 전문 도구 |

### Phase 3: 등록 및 배포

- tools.yaml + agents.yaml 등록
- yaml2json 실행
- 커밋 + 푸시 + 배포
- CEO에게 최종 보고 (이슈 + 수정 내용)

---

## 이전 전수검사 항목 (P2-1 ~ P2-12)

| # | 영역 | 상태 |
|---|------|------|
| P2-1 | decisions 저장 버그 | ✅ JSON→DB 전환 완료 |
| P2-2 | 교신로그 탭 전환 버그 | 미수정 |
| P2-3 | 교신로그 도구 사용 표시 | 미수정 |
| P2-4 | CIO 독자 분석 병렬 실행 | 미수정 |
| P2-5 | 새로고침 시 분석 재연결 | 미수정 |
| P2-6 | 시세 새로고침 SSE (B안) | 미수정 |
| P2-7 | CIO 목표가 산출 | 미수정 |
| P2-8 | 실거래 UI 확대 + 레이아웃 C안 | ✅ 빌드#371에서 레이아웃 변경 |
| P2-9 | 포트폴리오 반영 버그 | ✅ VECTOR + 수동매매 KIS 연동으로 해결 |
| P2-10 | CIO 성과 탭 전수검사 | 미수정 |
| P2-11 | 종목 클릭 차트 (C안 슬라이드패널) | 미수정 |
| P2-12 | order_size 10,000원 수정 | 미수정 |

---

## CEO 확정 설계 결정 (반복 설명 금지!)

### 실거래 UI C안 (2026-02-20 승인)
- **2행 2열 레이아웃**: 실거래(한국|미국) / 모의투자(한국|미국) — ✅ 빌드#371 적용
- **크기 확대**: 잔고 숫자 text-5xl, 카드 패딩 넉넉하게
- **스크롤 허용**: 카드 하나하나를 크게

### 사령관실 C안 + 전략실 C안 (2026-02-20 승인)
- **사령관실 내부통신 C안**: SSE 상시 + P2P 실시간 + 뱃지 + 네트워크 다이어그램 + 검색/필터
- **전략실 교신로그 C안**: 분석별 그룹핑 + 사령관실 통합 (사령관실 C안 이후)

### 시세/디버그/목표가 (2026-02-20)
- 시세 새로고침 **B안**(SSE) CEO 동의
- 디버그 URL: 어디든 버그 시 그때그때 만들어서 CEO에게 적극 제공
- 관심종목 목표가 무시 → CIO가 분석 후 목표가 산출하도록

### "지금 분석" C안 (2026-02-19 확정)
- 대시보드 "지금 분석" 버튼 → CIO+전문가4명 분석 → 매매 결정 일지 → 전략실 협업로그

---

## GitHub Secrets 현황

| 분류 | Secret 이름 | 상태 |
|------|------------|------|
| KIS 실거래 | APP_KEY, APP_SECRET, ACCOUNT, IS_MOCK | ✅ 등록 |
| KIS 모의투자 | MOCK_APP_KEY, MOCK_APP_SECRET, MOCK_ACCOUNT | ✅ 2026-02-20 등록 |
| AI | ANTHROPIC, OPENAI, GOOGLE, GEMINI | ✅ 등록 |
| 전체 | 50+ 시크릿 | ✅ 완료 |

---

## 프로젝트 기본 정보

- **저장소**: https://github.com/kodonghui/CORTHEX_HQ
- **서버**: Oracle Cloud ARM 24GB (corthex-hq.com)
- **현재 버전**: 3.02.002
- **에이전트**: 29명 (5개 부서)
- **도구**: 89개 등록 (tools.yaml 기준)
- **DB**: SQLite (서버: /home/ubuntu/corthex.db)
- **미커밋**: src/tools/gemini_*.py 8개 (CMO 이미지 도구) + docs/defining-age.md + docs/monetization.md
