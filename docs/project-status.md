# CORTHEX HQ - 프로젝트 현재 상태

> **목적**: 새 세션 시작 시 현재 상태 즉시 파악용. 매 작업 완료 시 업데이트.
> **아카이브**: `docs/archive/project-status-archive.md` (2/20~2/23 기록)

---

## 마지막 업데이트

- **날짜**: 2026-02-26
- **버전**: `4.00.000`
- **빌드**: #609 (Phase 6 ARGOS + 정보국 배포됨)
- **서버**: https://corthex-hq.com

---

## 🔴 전수검사 + 정비 마스터 플랜 (대표님 승인 2026-02-25)

> **원칙**: 새 기능 추가 전에 지금 있는 것부터 제대로 고친다.

### Phase 0 — 즉시 수정

| # | 내용 | 파일 | 상태 |
|---|------|------|------|
| 0-1 | **CIO 보고서 잘림** — max_tokens에 thinking budget 포함 → 응답 384토큰만 남음. `max_tokens = budget + 16384`로 수정 | `web/ai_handler.py` | ✅ |
| 0-2 | **Soul Evolution 자동 승인** — 제안 즉시 auto_approved + 소울 업데이트 + warnings 초기화 | `web/handlers/soul_evolution_handler.py` | ✅ |
| 0-3 | **Soul Gym 24/7 상시 운영** — `_soul_gym_loop()` 5분 간격 상시 루프. 비용: 라운드당 ~$0.012 | `web/arm_server.py` | ✅ |
| 0-4 | **conversation_id 전달 버그** | `web/arm_server.py` | ✅ 빌드#594 |

### Phase 1 — CIO 반려 원인 분석 + 검수 시스템 점검 ✅

**수정 완료**:
- QA 보고서 스니펫 3000→8000자 (잘림 방지)
- QA 판정 키워드: 한국어 "승인/반려" → 영어 PASS/FAIL (파싱 취약점 제거)
- 최근 CIO 분석 로그 없어 실제 반려 사례 미확인 (다음 분석 실행 시 확인)

### Phase 2 — 기능 다이어트 + 코드 전수검사 ✅

**전수검사 결과**:
- 2-1: agents.yaml spawn_agent 4곳 제거 + CIO name 수정 → **-380줄**
- 2-2: 도구 **131개** 전수 매핑 정상 (유령 0개)
- 2-3: SNS 16개 엔드포인트 → 9개 동작, 3개 조건부, 3개 스텁(의도적 설계)
- 2-4: 핸들러 **26개** 전부 마운트됨 (고아 0개)
- 2-5: JS/HTML "처장→팀장", "전문가4명" 레거시 전부 제거
- 2-6: 로그 117건 일관 사용 중 (변경 불필요)
- arm_server.py "처장→팀장" **81건** 일괄 치환 (텔레그램코드 보호)
- 일회성 스크립트 2개 삭제

### Phase 3 — UX/UI 전면 개편 🔄 진행중

**목표**: 대표님 32개 개선 항목 전부 구현.
**상태**: Phase A+B+C+D+E 전체 완료. 기밀문서 전면개편 + 금융분석팀장 이름 통일.

| Phase | 내용 | 상태 |
|-------|------|------|
| **A** | confirm 모달, 대화삭제, tier필터, CTO제거, 전체선택, 교신로그, 매매전략삭제, 기밀문서, 지휘소 이름변경 (9건) | ✅ |
| **B** | 탭순서 변경, 더보기 재구성, AGORA/NEXUS 순서, 뷰모드 순서 (4건) | ✅ |
| **C** | 사이드바 flat, 작전일지 요약, 전력분석 새로고침, 사무실 3열2행, AI모델변경, 로그시간, 통신로그UX, 장기기억(이미존재) (8건) | ✅ |
| **D** | 도구검수(Phase2완료), D-2동시명령, D-3통신국, D-4포트폴리오, **D-5모바일✅**, D-6보고서ID (6건) | ✅ |
| **E** | E-1피드백모드, E-2숨겨진기능, E-3정보국파일업로드 (3건) | ✅ |
| **추가** | 기밀문서 카드 전면개편(팀명\|담당자/날짜\|제목/시간\|용량) + 금융분석팀장 이름 통일 | ✅ |

### Phase 4 — 아키텍처 품질 검토 ✅

**전수검사 결과**:
- 4-1: arm_server.py **9,910줄** 150함수 — D등급 모놀리스. 분리 대상: 배치체인(1,695줄), 텔레그램(702줄), 트레이딩(1,626줄). 리팩토링 14단계 중 Step 1 완료(7%)
- 4-2: 핸들러 26개 전부 마운트됨, 역할 중복 없음
- 4-4: **AI 폴백 강화 완료** — 404 전 프로바이더 확대(Anthropic/Google/OpenAI 체인) + 429 5회 실패 시 자동 크로스 프로바이더 전환
- 4-3: 17-cutting-edge → Phase 5에서 재평가
- 4-5: 노션 연동 → 대표님 CIO 분석 실행 후 검증 예정

### Phase 6 — 매매 엔진 혁신 + 정보국 (2026-02-26 대표님 승인)

> **핵심 통찰**: AI가 "심부름(데이터 수집)+생각(판단)"을 동시에 하고 있었음. 서버가 심부름, AI는 생각만 하는 구조로 전환.

#### 완료 (2026-02-26)
| # | 내용 | 빌드 |
|---|------|------|
| 6-0 | **실거래 버그 3종**: calibration_factor NameError(핵심), use_mock_kis 누락, QA 재분석 로직 추가 | #22426154426 |
| 6-1 | **정량 신뢰도(Quant Score)**: RSI/MACD/볼린저/거래량/추세 → 서버 수식 계산 → AI는 ±15%p 조정만 | #22426738142 |
| 6-2 | **가격 트리거 자동매매**: 매수 체결 시 손절(-5%)/익절(+10%) 자동 등록, 1분마다 가격 모니터링 → 발동 시 자동 주문 | #22426738142 |
| 6-3 | **도구 전수검사**: 131개 도구 3분류 완료 (`docs/architecture/tool-server-flow.md/.html`) | — |
| 6-4 | **CLAUDE.md 다이어그램 규칙**: .md + .html 뷰어 반드시 함께 생성 | — |
| 6-5 | **ARGOS 수집 레이어**: DB 테이블 5개 + cron_loop 수집 (1분/30분/1시간/1일) | ✅ #609 |
| 6-6 | **도구 서버화 Phase 2**: `/api/argos/price,news,dart,macro` DB 캐시 서빙 | ✅ #609 |
| 6-7 | **신뢰도 완전 서버화**: `/api/argos/confidence/{ticker}` (Quant+Cal+Bayesian+ELO) | ✅ #609 |
| 6-8 | **ARGOS 정보국 탭 + 상단 상태바**: 항상보임 바 + intelligence 탭 전체 | ✅ #609 |
| 6-9 | **강화학습 파이프라인**: 월간 AI 패턴 분석 크론 + 기존 7일 ELO 파이프라인 | ✅ #609 |

#### 아키텍처 원칙 (확정)
- **서버 우위 47개**: pykrx/yfinance/API/수식 → AI 호출 없이 직접
- **서버+AI 51개**: 서버가 수집 → AI가 해석. 역할 분리
- **AI 우위 33개**: 해석/판단/생성만. 배치 처리로 호출 최소화
- **데이터 3계층**: 수집층(ARGOS 상시) → 계산층(지표 서버 계산) → 판단층(AI)
- **플로우차트**: `docs/architecture/intelligence-plan.html` 참조

### Phase 5 — 새 기능 추가 (Phase 0~4 완료 후)

| # | 내용 | 상세 |
|---|------|------|
| 5-1 | **NEXUS 재설계** — 왼쪽: Mermaid 시스템 플로우차트 (기능이 어떻게 돌아가는지), 오른쪽: Excalidraw SketchVibe 캔버스 (대표님 손그림 → Claude 정식 다이어그램) | 3D→2D 전환 확정 (`knowhow/14`) |
| 5-2 | **Soul Gym 전 팀장 확장** — 6팀장 맞춤 벤치마크 (`docs/architecture/soul-gym-benchmarks.md`) |
| 5-3 | **신기술 도입** — 17번에서 확정된 것들 |
| 5-4 | **arm_server.py 이름 변경** + 추가 리팩토링 |

---

## 🔍 별도 진행 — SketchVibe 특허 조사

- **법무팀장 + 전략팀장 합동 조사** 지시 대기 중
- 법무팀장: 선행기술 재조사 + 청구항 설계 + 출원 절차 상세 + 비용
- 전략팀장: 시장 분석(TAM/SAM/SOM) + 사업 모델 + ROI + 타이밍
- **핵심 결론**: 통합 파이프라인(스케치+말→다이어그램→config→배포)은 전 세계에 없음 (2026-02-25 확인)
- **위험**: tldraw Computer/Agent Starter Kit이 확장되면 위협 가능 → 선점 필요
- **미결**: 변리사 선임 150~300만원, 상표 출원 ~50만원

---

## ✅ 최근 완료

| 날짜 | 내용 | 빌드 |
|------|------|------|
| 02-26 | Phase 6 전체(6-5~6-9): ARGOS 수집+정보국UI+신뢰도서버화+RL파이프라인 | #609 |
| 02-26 | 정량신뢰도+가격트리거 자동매매+실거래버그3종 수정 | #22426738142 |
| 02-26 | 도구 전수검사 131개 + HTML 뷰어 + CLAUDE.md 규칙 | — |
| 02-26 | UX Phase D(4건)+E-1+기밀문서 개편+CIO 이름 수정 | #22426521917 |
| 02-26 | UX Phase C(8건) + D-5 모바일 + 긴급버그4건 | 배포 대기 |
| 02-26 | UX 전면개편 Phase A(9건)+B(4건) | #598 |
| 02-26 | Anthropic 스트리밍 필수 오류 수정 | #598 |
| 02-26 | Phase 0~4 전수검사 + AI 폴백 강화 | #597 |
| 02-26 | arm_server.py 리네임 | #596 |
| 02-25 | conversation_id 전달 버그 수정 | #594 |
| 02-25 | Soul Gym 경쟁 진화 시스템 | #591 |
| 02-25 | v4 대개편 (6팀장 체제) | #575 |
| 02-25 | AI 크레딧 소진 자동 폴백 | #575 |
| 02-24 | P0 버그 3건 + 로그 버그 6건 | — |

---

## ⬜ 미완료 이관

- **노션 DB 실제 저장 검증** — Phase 4-5에서 처리
- **NEXUS 재설계** — Phase 5-1에서 처리 (3D→2D + Excalidraw)

---

## 🔴 CTO — 동면 상태

> 2026-02-22 대표님 지시. 용도 확정까지 CTO 관련 작업 보류.

---

## 🎉 첫 실매매 (2026-02-21)

NVDA 1주 @ $189.115 — KIS 실계좌 체결 완료

---

## CEO 확정 설계 결정

| 항목 | 결정 |
|------|------|
| 실거래 UI | 2행 2열: 실거래(한국\|미국) / 모의투자(한국\|미국) |
| 사령관실 | SSE 상시 + P2P 실시간 + 뱃지 + 네트워크 다이어그램 |
| 디버그 URL | 버그 시 즉석 생성 → 대표님에게 적극 제공 |
| CIO 목표가 | CIO가 분석 후 직접 산출 |
| order_size: 0 | CIO 비중 자율 (정상! 변경 금지) |
| NEXUS | 2D 전환: 왼쪽 시스템 플로우차트 + 오른쪽 Excalidraw |
| Soul Evolution | 자동 승인 (CEO 승인 불필요) |
| Soul Gym | 24/7 상시 운영 |

---

## 프로젝트 기본 정보

| 항목 | 값 |
|------|-----|
| 저장소 | https://github.com/kodonghui/CORTHEX_HQ |
| 서버 | Oracle Cloud ARM **200GB** (corthex-hq.com) ← 2026-02-26 업그레이드 |
| 버전 | 4.00.000 |
| 에이전트 | 7명 (6팀장 체제) |
| 도구 | 131개 (tools.yaml 기준, Phase 2 전수 매핑 확인) |
| DB | SQLite (/home/ubuntu/corthex.db) |
| GitHub Secrets | 50+ 전부 등록 완료 |
