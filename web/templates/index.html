<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>CORTHEX HQ - Cyber Command Center</title>
  <!-- Ìè∞Ìä∏: preload ÎπÑÎèôÍ∏∞ Î°úÎìú (CSS @import ÏàúÏ∞® Î∏îÎ°úÌÇπ Ï†úÍ±∞) -->
  <link rel="preload" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css"></noscript>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <!-- Tailwind JIT (blocking ÌïÑÏàò ‚Äî Ï†úÍ±∞ Î∂àÍ∞Ä) -->
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <!-- Marked, Chart.js, Mermaid: ÎèôÏ†Å Î°úÎìú (_loadScript) ‚Äî blocking Ï†úÍ±∞ -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'hq-bg': 'rgb(var(--hq-bg) / <alpha-value>)',
            'hq-surface': 'rgb(var(--hq-surface) / <alpha-value>)',
            'hq-panel': 'rgb(var(--hq-panel) / <alpha-value>)',
            'hq-border': 'rgb(var(--hq-border) / <alpha-value>)',
            'hq-border-light': 'rgb(var(--hq-border-light) / <alpha-value>)',
            'hq-accent': 'rgb(var(--hq-accent) / <alpha-value>)',
            'hq-cyan': 'rgb(var(--hq-cyan) / <alpha-value>)',
            'hq-purple': 'rgb(var(--hq-purple) / <alpha-value>)',
            'hq-green': 'rgb(var(--hq-green) / <alpha-value>)',
            'hq-yellow': 'rgb(var(--hq-yellow) / <alpha-value>)',
            'hq-red': 'rgb(var(--hq-red) / <alpha-value>)',
            'hq-text': 'rgb(var(--hq-text) / <alpha-value>)',
            'hq-muted': 'rgb(var(--hq-muted) / <alpha-value>)',
          }
        }
      }
    }
  </script>
  <!-- PWA -->
  <link rel="manifest" href="/static/manifest.json">
  <meta name="theme-color" content="#0a0a0f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CORTHEX HQ">
  <link rel="apple-touch-icon" href="/static/images/corthex-logo-256.png">
  <link rel="stylesheet" href="/static/css/corthex-styles.css?v=BUILD_NUMBER_PLACEHOLDER">
  <script defer src="/static/js/corthex-app.js?v=BUILD_NUMBER_PLACEHOLDER"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="text-hq-text h-screen flex flex-col overflow-hidden"
      x-data="corthexApp()" x-init="init()">

  <!-- ‚ïê‚ïê‚ïê Top Bar ‚ïê‚ïê‚ïê -->
  <header class="h-14 glass border-b border-hq-border flex items-center justify-between px-5 shrink-0 z-20">
    <div class="flex items-center gap-4">
      <!-- Sidebar Toggle -->
      <button @click="sidebarOpen = !sidebarOpen"
              class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-hq-panel/50 transition-colors text-hq-muted hover:text-hq-text"
              :title="sidebarOpen ? 'ÏÇ¨Ïù¥ÎìúÎ∞î Ï†ëÍ∏∞' : 'ÏÇ¨Ïù¥ÎìúÎ∞î ÌéºÏπòÍ∏∞'">
        <svg x-show="sidebarOpen" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5"/>
        </svg>
        <svg x-show="!sidebarOpen" x-cloak class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5"/>
        </svg>
      </button>
      <!-- Logo (ÌÅ¥Î¶≠ ‚Üí Ìôà) -->
      <div class="flex items-center gap-2.5 cursor-pointer hover:opacity-80 transition-opacity"
           @click="viewMode = 'chat'; activeTab = 'command'; $nextTick(() => scrollToBottom()); setTimeout(() => scrollToBottom(), 300)">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="logoGrad" x1="0" y1="0" x2="32" y2="32">
              <stop offset="0%" stop-color="#00ff88"/>
              <stop offset="50%" stop-color="#00e6ff"/>
              <stop offset="100%" stop-color="#8c64ff"/>
            </linearGradient>
          </defs>
          <path d="M16 2L28 9V23L16 30L4 23V9L16 2Z" stroke="url(#logoGrad)" stroke-width="1.5" fill="none"/>
          <path d="M16 6L24 10.5V21.5L16 26L8 21.5V10.5L16 6Z" stroke="url(#logoGrad)" stroke-width="1" fill="none" opacity="0.5"/>
          <circle cx="16" cy="16" r="4" fill="url(#logoGrad)" opacity="0.8"/>
          <circle cx="16" cy="16" r="2" fill="rgb(10 12 18)"/>
          <line x1="16" y1="12" x2="16" y2="6" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="19.5" y1="14" x2="24" y2="10.5" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="19.5" y1="18" x2="24" y2="21.5" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="16" y1="20" x2="16" y2="26" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="12.5" y1="18" x2="8" y2="21.5" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="12.5" y1="14" x2="8" y2="10.5" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
        </svg>
        <div>
          <div class="text-base font-bold tracking-wider gradient-text font-mono flex items-center gap-1"><span>CORTHEX</span><span>HQ</span></div>
        </div>
      </div>
      <div class="flex items-center gap-2 header-build-badge">
        <span class="text-[10px] text-hq-muted bg-hq-surface border border-hq-border rounded-md px-2 py-0.5">ÎπåÎìú #BUILD_NUMBER_PLACEHOLDER</span>
        <span class="text-[10px] text-hq-cyan/85 bg-hq-cyan/5 border border-hq-cyan/20 rounded-md px-2 py-0.5">CEO Í¥ÄÏ†ú</span>
      </div>
    </div>

    <!-- Î°úÍ∑∏ÏïÑÏõÉ Î≤ÑÌäº (Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÏù¥Í≥† Î∂ÄÌä∏Ïä§Ìä∏Îû© Î™®ÎìúÍ∞Ä ÏïÑÎãê ÎïåÎßå) -->
    <template x-if="auth.token && !auth.bootstrapMode">
      <button @click="doLogout()"
              class="text-[10px] text-hq-muted hover:text-hq-red border border-hq-border hover:border-hq-red/30 rounded-md px-2 py-0.5 transition mr-2"
              title="Î°úÍ∑∏ÏïÑÏõÉ">Î°úÍ∑∏ÏïÑÏõÉ</button>
    </template>

    <div class="flex items-center gap-5">
      <!-- System Status (click ‚Üí health popover) -->
      <div class="flex items-center gap-2 relative">
        <template x-if="systemStatus === 'idle'">
          <div @click="showHealthPopover = !showHealthPopover; if(showHealthPopover) loadHealth()"
               class="flex items-center gap-2 bg-hq-green/10 border border-hq-green/20 rounded-lg px-3 py-1 cursor-pointer hover:bg-hq-green/20 transition">
            <span class="w-2 h-2 rounded-full bg-hq-green"></span>
            <span class="text-xs font-medium text-hq-green">ÎåÄÍ∏∞</span>
          </div>
        </template>
        <template x-if="systemStatus === 'working'">
          <div @click="showHealthPopover = !showHealthPopover; if(showHealthPopover) loadHealth()"
               class="flex items-center gap-2 bg-hq-yellow/10 border border-hq-yellow/20 rounded-lg px-3 py-1 cursor-pointer hover:bg-hq-yellow/20 transition">
            <span class="w-2 h-2 rounded-full bg-hq-yellow pulse-dot"></span>
            <span class="text-xs font-medium text-hq-yellow">Ï≤òÎ¶¨Ï§ë</span>
            <span x-show="commandQueue.length > 0" class="text-[10px] font-mono text-hq-yellow/70 ml-1" x-text="'+' + commandQueue.length + 'ÎåÄÍ∏∞'"></span>
          </div>
        </template>
        <template x-if="systemStatus === 'error'">
          <div @click="showHealthPopover = !showHealthPopover; if(showHealthPopover) loadHealth()"
               class="flex items-center gap-2 bg-hq-red/10 border border-hq-red/20 rounded-lg px-3 py-1 cursor-pointer hover:bg-hq-red/20 transition">
            <span class="w-2 h-2 rounded-full bg-hq-red"></span>
            <span class="text-xs font-medium text-hq-red">Ïò§Î•ò</span>
          </div>
        </template>
        <!-- Health Popover -->
        <div x-show="showHealthPopover" @click.outside="showHealthPopover = false" x-transition
             class="absolute top-full mt-2 right-0 w-72 glass border border-hq-border rounded-xl p-4 shadow-xl z-30"
             style="display: none;">
          <h4 class="text-xs font-bold text-hq-text uppercase tracking-wider mb-3">ÏãúÏä§ÌÖú ÏÉÅÌÉú ÏÉÅÏÑ∏</h4>
          <template x-if="healthData">
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-xs text-hq-muted">Ï†ÑÏ≤¥</span>
                <span class="text-xs font-bold" :class="(healthData.status === 'ok' || healthData.overall === 'ok') ? 'text-hq-green' : (healthData.status === 'warning' || healthData.overall === 'warning') ? 'text-hq-yellow' : 'text-hq-red'"
                      x-text="(healthData.status === 'ok' || healthData.overall === 'ok') ? 'Ï†ïÏÉÅ' : (healthData.status === 'warning' || healthData.overall === 'warning') ? 'Í≤ΩÍ≥†' : 'Ïò§Î•ò'"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-hq-muted">ÏÑúÎ≤Ñ</span>
                <span class="text-xs" x-text="healthData.mode || 'ARM ÏÑúÎ≤Ñ'"></span>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.agents !== undefined">
                <span class="text-xs text-hq-muted">Îì±Î°ù ÏóêÏù¥Ï†ÑÌä∏</span>
                <span class="text-xs text-hq-accent" x-text="healthData.agents + 'Î™Ö'"></span>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.telegram !== undefined">
                <span class="text-xs text-hq-muted">ÌÖîÎ†àÍ∑∏Îû®</span>
                <span class="text-xs" x-text="healthData.telegram ? 'Ïó∞Í≤∞Îê®' : 'ÎØ∏Ïó∞Í≤∞'"></span>
              </div>
              <!-- Î∂ÑÏÑù ÏÉÅÌÉú + Ï§ëÏßÄ Î≤ÑÌäº -->
              <div class="flex items-center justify-between">
                <span class="text-xs text-hq-muted">Î∂ÑÏÑù ÏÉÅÌÉú</span>
                <template x-if="trading.runningNow || trading.analyzingSelected">
                  <button @click="stopAnalysis()" class="text-[10px] px-2 py-0.5 bg-red-600 hover:bg-red-700 text-white rounded-full font-bold transition-colors">
                    üõë Ï§ëÏßÄ
                  </button>
                </template>
                <template x-if="!trading.runningNow && !trading.analyzingSelected">
                  <span class="text-[10px] text-hq-muted">ÎåÄÍ∏∞ Ï§ë</span>
                </template>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.model_router !== undefined">
                <span class="text-xs text-hq-muted">Î™®Îç∏ ÎùºÏö∞ÌÑ∞ (Í≤ΩÎ°ú Î∞∞Ï†ï)</span>
                <span class="text-xs" x-text="healthData.model_router ? '‚úÖ' : '‚ùå'"></span>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.registry !== undefined">
                <span class="text-xs text-hq-muted">ÏóêÏù¥Ï†ÑÌä∏ Î†àÏßÄÏä§Ìä∏Î¶¨ (Îì±Î°ùÏÜå)</span>
                <span class="text-xs" x-text="healthData.registry ? '‚úÖ' : '‚ùå'"></span>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.knowledge_mgr !== undefined">
                <span class="text-xs text-hq-muted">ÏßÄÏãù Í¥ÄÎ¶¨Ïûê</span>
                <span class="text-xs" x-text="healthData.knowledge_mgr ? '‚úÖ' : '‚ùå'"></span>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.agent_count !== undefined">
                <span class="text-xs text-hq-muted">Îì±Î°ùÎêú ÏóêÏù¥Ï†ÑÌä∏</span>
                <span class="text-xs text-hq-accent" x-text="healthData.agent_count + 'Î™Ö'"></span>
              </div>
              <template x-if="healthData.checks && healthData.checks.length > 0">
                <div class="border-t border-hq-border/50 pt-2 mt-2 space-y-1">
                  <template x-for="check in healthData.checks" :key="check.name || check">
                    <div class="flex items-center justify-between">
                      <span class="text-[11px] text-hq-muted" x-text="check.name || check"></span>
                      <span class="text-[11px]" :class="check.ok ? 'text-hq-green' : 'text-hq-red'" x-text="check.ok ? '‚úÖ' : '‚ùå'"></span>
                    </div>
                  </template>
                </div>
              </template>
            </div>
          </template>
          <template x-if="!healthData">
            <div class="text-xs text-hq-muted text-center py-2">Î°úÎî© Ï§ë...</div>
          </template>
        </div>
      </div>

      <!-- Metrics -->
      <div class="flex items-center gap-4 header-metrics">
        <div class="flex items-center gap-1.5">
          <svg class="w-3.5 h-3.5 text-hq-green/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          <span class="text-xs font-mono text-hq-green" x-text="'$' + totalCost.toFixed(4)"></span>
        </div>
        <div class="flex items-center gap-1.5">
          <svg class="w-3.5 h-3.5 text-hq-purple/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/></svg>
          <span class="text-xs font-mono text-hq-text/90" x-text="totalTokens.toLocaleString()"></span>
        </div>
      </div>

      <!-- Connection -->
      <div class="flex items-center gap-1.5" :class="wsConnected ? 'text-hq-green' : 'text-hq-red'">
        <span class="w-1.5 h-1.5 rounded-full" :class="wsConnected ? 'bg-hq-green' : 'bg-hq-red'"></span>
        <span class="text-[11px] header-conn-text" x-text="wsConnected ? 'Ïó∞Í≤∞Îê®' : 'ÎÅäÍπÄ'"></span>
      </div>

      <!-- View Toggle: ÏßÄÌúòÏÜå/ÏÇ¨Î¨¥Ïã§/ÎåÄÏãúÎ≥¥Îìú -->
      <div class="flex items-center bg-hq-surface border border-hq-border rounded-lg header-view-toggle">
        <button @click="if(dashboardRefreshTimer){clearInterval(dashboardRefreshTimer);dashboardRefreshTimer=null;} viewMode = 'chat'"
                :class="viewMode === 'chat' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                class="px-3 py-1 text-xs font-semibold rounded-l-lg transition-colors">ÏßÄÌúòÏÜå</button>
        <button @click="if(dashboardRefreshTimer){clearInterval(dashboardRefreshTimer);dashboardRefreshTimer=null;} viewMode = 'office'"
                :class="viewMode === 'office' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                class="px-3 py-1 text-xs font-semibold border-x border-hq-border transition-colors">ÏÇ¨Î¨¥Ïã§</button>
        <button @click="viewMode = 'dashboard'; loadDashboard(); if(dashboardRefreshTimer){clearInterval(dashboardRefreshTimer);} dashboardRefreshTimer = setInterval(() => loadDashboard(), 30000)"
                :class="viewMode === 'dashboard' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                class="px-3 py-1 text-xs font-semibold border-r border-hq-border transition-colors">ÎåÄÏãúÎ≥¥Îìú</button>
        <button @click="viewMode = 'agora'; $nextTick(() => { if(typeof openAgora === 'function') openAgora(); if(typeof _loadAgoraStatus === 'function') _loadAgoraStatus(); })"
                :class="viewMode === 'agora' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-accent'"
                class="px-3 py-1 text-xs font-semibold border-r border-hq-border transition-colors tracking-wider">AGORA</button>
        <button @click="openNexus()"
                :class="nexusOpen ? 'bg-[#e879f9]/20 text-[#e879f9]' : 'text-hq-muted hover:text-[#e879f9]'"
                class="px-3 py-1 text-xs font-semibold rounded-r-lg transition-colors tracking-wider">NEXUS</button>
      </div>

      <!-- Dark/Light Toggle -->
      <button @click="toggleTheme()" class="text-hq-muted hover:text-hq-text transition" title="Îã§ÌÅ¨/ÎùºÏù¥Ìä∏ Î™®Îìú Ï†ÑÌôò">
        <svg x-show="darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
        <svg x-show="!darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
        </svg>
      </button>

      <!-- Quality Settings Button -->
      <button @click="showQualitySettings = true; loadQualityRules()"
              class="text-hq-muted hover:text-hq-text transition" title="ÌíàÏßà Í≤ÄÏàò ÏÑ§Ï†ï">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
      </button>
    </div>
  </header>
  <div class="h-[2px] bg-gradient-to-r from-hq-cyan via-hq-accent to-hq-purple shrink-0"></div>

  <!-- ARGOS ÏÉÅÎã® ÏÉÅÌÉúÎ∞î ÏÇ≠Ï†úÎê® (2026-02-26) -->

  <!-- ‚ïê‚ïê‚ïê Toast Notifications ‚ïê‚ïê‚ïê -->
  <div class="fixed top-16 right-4 z-50 space-y-2 max-w-sm" style="pointer-events:none;">
    <template x-for="toast in toasts" :key="toast.id">
      <div :class="[
        toast.visible ? 'toast-in' : 'toast-out',
        toast.type === 'success' ? 'border-hq-green/40 bg-hq-green/10' :
        toast.type === 'error' ? 'border-hq-red/40 bg-hq-red/10' :
        toast.type === 'warning' ? 'border-hq-yellow/40 bg-hq-yellow/10' :
        'border-hq-accent/40 bg-hq-accent/10'
      ]" class="glass border rounded-xl px-4 py-3 text-sm shadow-lg" style="pointer-events:auto;">
        <div class="flex items-center gap-2">
          <span class="w-2 h-2 rounded-full shrink-0"
                :class="toast.type==='success'?'bg-hq-green':toast.type==='error'?'bg-hq-red':toast.type==='warning'?'bg-hq-yellow':'bg-hq-accent'"></span>
          <span class="flex-1 text-hq-text text-sm" x-text="toast.message"></span>
          <button @click="removeToast(toast.id)" class="text-hq-muted hover:text-hq-text text-lg leading-none ml-2">&times;</button>
        </div>
      </div>
    </template>
  </div>

  <!-- ‚ïê‚ïê‚ïê Connection Lost Banner ‚ïê‚ïê‚ïê -->
  <div x-show="connectionLost" x-transition
       class="bg-hq-red/15 border-b border-hq-red/30 text-center py-2 text-sm text-hq-red shrink-0 flex items-center justify-center gap-2">
    <span class="w-2 h-2 bg-hq-red rounded-full pulse-dot"></span>
    ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ï°åÏäµÎãàÎã§. Ïû¨Ïó∞Í≤∞ ÏãúÎèÑÏ§ë... (<span x-text="reconnectAttempt"></span>Ìöå)
  </div>

  <!-- ‚ïê‚ïê‚ïê Main Layout ‚ïê‚ïê‚ïê -->
  <div class="flex flex-1 overflow-hidden">

    <!-- ‚ïê‚ïê‚ïê Left Panel: Organization ‚ïê‚ïê‚ïê -->
    <!-- Î™®Î∞îÏùº Ïò§Î≤ÑÎ†àÏù¥ Î∞∞Í≤Ω -->
    <div x-show="sidebarOpen && window.innerWidth <= 768" x-cloak
         @click="sidebarOpen = false"
         class="fixed inset-0 bg-black/50 z-30 md:hidden"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"></div>
    <aside x-show="sidebarOpen"
           x-transition:enter="transition-all ease-out duration-300"
           x-transition:enter-start="opacity-0 -translate-x-full w-0"
           x-transition:enter-end="opacity-100 translate-x-0 w-[280px]"
           x-transition:leave="transition-all ease-in duration-200"
           x-transition:leave-start="opacity-100 translate-x-0 w-[280px]"
           x-transition:leave-end="opacity-0 -translate-x-full w-0"
           class="w-[280px] bg-hq-surface border-r border-hq-border flex flex-col shrink-0 overflow-hidden max-md:fixed max-md:top-14 max-md:left-0 max-md:bottom-0 max-md:z-40 max-md:shadow-2xl">

      <!-- Team (flat) -->
      <div class="flex-1 overflow-y-auto scrollbar-thin p-4 space-y-1.5">
        <div class="flex items-center justify-between px-2 mb-3">
          <div class="text-[10px] font-bold text-hq-muted uppercase tracking-[0.15em] font-mono">TEAM</div>
          <div class="text-[10px] text-hq-muted">6Î™Ö</div>
        </div>
        <!-- ÏóêÏù¥Ï†ÑÌä∏ ÏÉÅÌÉú ÏöîÏïΩ -->
        <div class="flex items-center gap-3 px-2 py-2 mb-3 rounded-lg bg-hq-panel border border-hq-border/30 text-[10px]">
          <span class="flex items-center gap-1 text-hq-green"><span class="w-1.5 h-1.5 rounded-full bg-hq-green animate-pulse"></span> <span x-text="Object.values(activeAgents).filter(a => a.status === 'working').length"></span> ÌôúÎèô</span>
          <span class="flex items-center gap-1 text-hq-yellow"><span class="w-1.5 h-1.5 rounded-full bg-hq-yellow"></span> <span x-text="Object.values(activeAgents).filter(a => a.status === 'idle').length"></span> ÎåÄÍ∏∞</span>
        </div>

        <!-- CEO -->
        <div class="mb-3">
          <div @click="showCeoProfile = true" class="flex items-center gap-2.5 px-3 py-2.5 rounded-xl bg-gradient-to-r from-hq-accent/10 to-hq-purple/10 border border-hq-accent/20 cursor-pointer hover:border-hq-accent/40 hover:from-hq-accent/15 hover:to-hq-purple/15 transition-all">
            <div class="agent-avatar bg-gradient-to-br from-hq-accent to-hq-purple text-white">
              CEO
            </div>
            <div class="flex-1">
              <div class="text-sm font-semibold text-hq-text font-mono">CEO</div>
              <div class="text-[10px] text-hq-muted font-mono">COMMANDER</div>
            </div>
            <span class="text-[10px] text-hq-muted/85">&#9654;</span>
          </div>
        </div>

        <!-- ÌåÄÏû• 6Î™Ö (flat list) -->
        <div class="space-y-1">
          <template x-for="id in ['chief_of_staff','cio_manager','cso_manager','clo_manager','cmo_manager','cpo_manager']" :key="id">
            <div :id="'agent-' + id" @click="openAgentConfig(id)"
                 class="flex items-center gap-2.5 px-3 py-2.5 rounded-xl border border-transparent cursor-pointer transition-all duration-200 hover:bg-hq-panel/25 hover:border-hq-border"
                 title="ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏¬∑Ï∂îÎ°†¬∑ÏÜåÏö∏ ÏÑ§Ï†ï Í∞ÄÎä•">
              <div class="w-8 h-8 rounded-lg flex items-center justify-center text-[10px] font-bold shrink-0"
                   :class="{'bg-amber-500/20 text-amber-400': id==='chief_of_staff', 'bg-red-500/20 text-red-400': id==='cio_manager', 'bg-purple-500/20 text-purple-400': id==='cso_manager', 'bg-emerald-500/20 text-emerald-400': id==='clo_manager', 'bg-orange-500/20 text-orange-400': id==='cmo_manager', 'bg-fuchsia-500/20 text-fuchsia-400': id==='cpo_manager'}"
                   x-text="getAgentInitials(id)"></div>
              <div class="flex-1 min-w-0">
                <div class="text-xs font-semibold text-hq-text" x-text="getAgentName(id)"></div>
                <div class="text-[10px] text-hq-muted font-mono truncate" x-text="getModelDisplayName(agentModels[id])"></div>
              </div>
              <span class="w-2 h-2 rounded-full shrink-0 transition-colors"
                    :class="[getAgentDotClass(id), activeAgents[id]?.status==='working' ? 'agent-working-glow' : '']"></span>
              <span x-show="activeAgents[id]?.status === 'working'"
                    class="text-[9px] font-mono text-hq-yellow shrink-0"
                    x-text="activeAgents[id]?.elapsed || '00:00'"></span>
            </div>
          </template>
        </div>


        <!-- Tool Pool -->
        <div class="mb-1.5">
          <button @click="toggleSection('tools')"
                  class="w-full text-left px-3 py-2.5 rounded-xl border transition-all duration-200"
                  :class="expanded.tools ? 'bg-orange-400/10 border-orange-400/30' : 'bg-hq-panel/15 border-transparent hover:bg-hq-panel/25 hover:border-hq-border'">
            <div class="flex items-center gap-2.5">
              <div class="w-8 h-8 rounded-lg bg-orange-400/15 flex items-center justify-center text-orange-400 shrink-0">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-xs font-semibold text-hq-text">ÎèÑÍµ¨Ìï®</div>
                <div class="text-[10px] text-hq-muted" x-text="(toolsList || []).length + 'Í∞ú ÎèÑÍµ¨'"></div>
              </div>
              <span class="text-[10px] text-hq-muted/85 transition-transform duration-200" :class="expanded.tools ? 'rotate-90' : ''">&#9654;</span>
            </div>
          </button>
          <div x-show="expanded.tools" x-collapse class="ml-3 mt-1 pl-8 border-l border-hq-red/20 space-y-0.5 max-h-48 overflow-y-auto scrollbar-thin">
            <template x-for="t in (toolsList || [])" :key="t.name">
              <div @click="showToolDetail(t)" class="flex items-center gap-2 px-2 py-1 rounded-md hover:bg-hq-red/10 transition-colors cursor-pointer">
                <span class="w-1.5 h-1.5 rounded-full bg-hq-red/40"></span>
                <span class="text-xs text-hq-text/90" x-text="t.name_ko || t.name"></span>
              </div>
            </template>
            <template x-if="!toolsList || toolsList.length === 0">
              <div class="text-[10px] text-hq-muted/80 px-2 py-2">ÏÑúÎ≤Ñ Ïó∞Í≤∞ ÌõÑ ÌëúÏãúÎê©ÎãàÎã§</div>
            </template>
          </div>
        </div>
      </div>

    </aside>

    <!-- ‚ïê‚ïê‚ïê Right Panel: Tabs + Content ‚ïê‚ïê‚ïê -->
    <main class="flex-1 flex flex-col overflow-hidden bg-hq-bg responsive-main">

      <!-- ‚ïê‚ïê‚ïê Error Alert Banner ‚ïê‚ïê‚ïê -->
      <div x-show="errorAlert.visible" x-transition
           class="bg-hq-red/15 border-b border-hq-red/30 px-5 py-2 flex items-center justify-between shrink-0" style="display:none;">
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-hq-red" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
          <span class="text-sm text-hq-red font-medium" x-text="errorAlert.message"></span>
        </div>
        <button @click="errorAlert.visible = false" class="text-hq-red/50 hover:text-hq-red text-lg">&times;</button>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab Navigation (Ï±ÑÌåÖ Î™®ÎìúÏùº ÎïåÎßå ÌëúÏãú ‚Äî Î™®Î∞îÏùºÏóêÏÑúÎäî ÌïòÎã® ÎÑ§ÎπÑ ÏÇ¨Ïö©) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat'" class="flex items-center gap-0.5 px-3 pt-2 pb-0 border-b border-hq-border bg-hq-surface shrink-0 mobile-tabs-scroll desktop-tab-bar">
        <!-- Í∏∞Î≥∏ ÌÉ≠ 5Í∞ú (#12) -->
        <template x-for="tab in getPrimaryTabs()" :key="tab.id">
          <button @click="switchTab(tab.id); showMoreTabs = false"
                  :class="activeTab === tab.id
                    ? 'text-hq-accent border-hq-accent bg-hq-accent/10 font-bold'
                    : 'text-hq-muted border-transparent hover:text-hq-text hover:bg-hq-panel/20'"
                  class="flex items-center gap-1.5 px-3 py-2 text-[11px] font-semibold border-b-2 transition-all rounded-t-lg whitespace-nowrap">
            <span x-html="tab.icon" class="w-3.5 h-3.5"></span>
            <span x-text="tab.label"></span>
          </button>
        </template>
        <!-- ÎçîÎ≥¥Í∏∞ ÎìúÎ°≠Îã§Ïö¥ -->
        <div class="relative">
          <button @click="showMoreTabs = !showMoreTabs"
                  :class="getSecondaryTabs().some(t => t.id === activeTab)
                    ? 'text-hq-accent border-hq-accent bg-hq-accent/10 font-bold'
                    : 'text-hq-muted border-transparent hover:text-hq-text hover:bg-hq-panel/20'"
                  class="flex items-center gap-1 px-3 py-2 text-[11px] font-semibold border-b-2 transition-all rounded-t-lg whitespace-nowrap">
            <span x-text="getSecondaryTabs().find(t => t.id === activeTab)?.label || 'ÎçîÎ≥¥Í∏∞'"></span>
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
          </button>
          <div x-show="showMoreTabs" @click.outside="showMoreTabs = false" x-transition
               class="absolute top-full left-0 mt-1 glass border border-hq-border rounded-xl py-1 shadow-xl z-30 min-w-[140px]" style="display:none;">
            <template x-for="tab in getSecondaryTabs()" :key="tab.id">
              <button @click="switchTab(tab.id); showMoreTabs = false"
                      :class="activeTab === tab.id ? 'bg-hq-accent/10 text-hq-accent' : 'text-hq-muted hover:text-hq-text hover:bg-hq-panel/20'"
                      class="flex items-center gap-2 w-full px-3 py-2 text-xs transition">
                <span x-html="tab.icon" class="w-3.5 h-3.5"></span>
                <span x-text="tab.label"></span>
              </button>
            </template>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab: Ìôà (Home Dashboard) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'home'" x-cloak class="flex-1 overflow-y-auto scrollbar-thin px-6 pt-8 pb-6 bg-grid tab-content-padded">
        <div class="max-w-5xl mx-auto fade-in-up">
          <div class="mb-6">
            <h1 class="text-xl md:text-2xl font-bold gradient-text mb-1 welcome-title">CYBER COMMAND CENTER</h1>
            <p class="text-sm text-hq-muted">Îπ†Î•∏ ÏöîÏïΩ ‚Äî ÏÉÅÏÑ∏ Ïã§ÏãúÍ∞Ñ Î∂ÑÏÑùÏùÄ <button @click="viewMode='dashboard'; loadDashboard()" class="text-hq-accent hover:underline">ÎåÄÏãúÎ≥¥Îìú</button>ÏóêÏÑú</p>
          </div>

          <!-- Summary Cards -->
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg bg-hq-accent/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                </div>
                <div>
                  <div class="text-xl font-bold text-hq-text" x-text="dashboard.todayTasks || 0"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">Ïò§Îäò ÏûëÏóÖ</div>
                </div>
              </div>
              <div class="flex items-center gap-2 text-[11px]">
                <span class="text-hq-green" x-text="'ÏôÑÎ£å ' + (dashboard.todayCompleted || 0)"></span>
                <span class="text-hq-muted">¬∑</span>
                <span class="text-hq-yellow" x-text="'ÏßÑÌñâ ' + (dashboard.runningCount || 0)"></span>
              </div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg bg-hq-green/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div>
                  <div class="text-xl font-bold text-hq-green" x-text="'$' + (dashboard.todayCost || 0).toFixed(4)"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">Ïò§Îäò ÎπÑÏö©</div>
                </div>
              </div>
              <div class="text-[11px] text-hq-muted">ÎàÑÏ†Å: $<span x-text="(dashboard.totalCost || 0).toFixed(2)"></span></div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg bg-hq-purple/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                </div>
                <div>
                  <div class="text-xl font-bold text-hq-text" x-text="dashboard.agentCount || 0"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">ÏóêÏù¥Ï†ÑÌä∏</div>
                </div>
              </div>
              <div class="text-[11px] text-hq-muted">6ÌåÄÏû• Ï≤¥Ï†ú</div>
            </div>
            <!-- ÎÖ∏ÏÖò Ïó∞Îèô ÏÉÅÌÉú Ïπ¥Îìú -->
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg flex items-center justify-center" :class="dashboard.notionConnected ? 'bg-hq-green/15' : 'bg-hq-red/15'">
                  <svg class="w-4.5 h-4.5" :class="dashboard.notionConnected ? 'text-hq-green' : 'text-hq-red'" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                </div>
                <div>
                  <div class="text-sm font-bold" :class="dashboard.notionConnected ? 'text-hq-green' : 'text-hq-red'" x-text="dashboard.notionConnected ? 'Ïó∞Í≤∞Îê®' : 'ÎØ∏Ïó∞Í≤∞'"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">ÎÖ∏ÏÖò Ïó∞Îèô</div>
                </div>
              </div>
              <div class="text-[11px] text-hq-muted" x-text="dashboard.notionConnected ? 'Î≥¥Í≥†ÏÑú ÏûêÎèô Ï†ÄÏû• Ï§ë' : 'API ÌÇ§ ÏÑ§Ï†ï ÌïÑÏöî'"></div>
            </div>
          </div>

          <!-- ÌÄµ Ïï°ÏÖò + AI ÏÇ¨Ïö©Îüâ + ÏãúÏä§ÌÖú ÌòÑÌô© -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-8">
            <!-- ÌÄµ Ïï°ÏÖò Ïπ¥Îìú -->
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                  <div class="w-9 h-9 rounded-lg bg-hq-cyan/15 flex items-center justify-center">
                    <svg class="w-4.5 h-4.5 text-hq-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                  </div>
                  <div>
                    <div class="text-sm font-bold text-hq-text">ÌÄµ Ïï°ÏÖò</div>
                    <div class="text-[10px] text-hq-muted uppercase tracking-wider">Î∞îÎ°ú Ïã§Ìñâ</div>
                  </div>
                </div>
                <div class="flex gap-1 bg-hq-bg rounded-lg p-0.5">
                  <button @click="quickActionTab='routine'" class="px-2 py-0.5 text-[10px] font-semibold rounded transition"
                    :class="quickActionTab==='routine' ? 'bg-hq-cyan/20 text-hq-cyan' : 'text-hq-muted hover:text-hq-text'">Î£®Ìã¥</button>
                  <button @click="quickActionTab='system'" class="px-2 py-0.5 text-[10px] font-semibold rounded transition"
                    :class="quickActionTab==='system' ? 'bg-hq-green/20 text-hq-green' : 'text-hq-muted hover:text-hq-text'">ÏãúÏä§ÌÖú</button>
                </div>
              </div>
              <div x-show="quickActionTab==='routine'" class="flex flex-wrap gap-2">
                <button @click="activeTab='command'; $nextTick(() => { inputText='Ï†Ñ Î∂ÄÏÑú ÌòÑÌô© Î≥¥Í≥†'; })"
                  class="px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-hq-cyan/10 text-hq-cyan border border-hq-cyan/20 hover:bg-hq-cyan/20 transition">
                  üè¢ Ï†Ñ Î∂ÄÏÑú ÌòÑÌô©
                </button>
                <button @click="activeTab='command'; $nextTick(() => { inputText='Ïò§Îäò ÏùºÏ†ï Î∞è ÏòàÏïΩ ÌòÑÌô© Î≥¥Í≥†'; })"
                  class="px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-hq-accent/10 text-hq-accent border border-hq-accent/20 hover:bg-hq-accent/20 transition">
                  üìÖ Ïò§Îäò ÏùºÏ†ï
                </button>
                <button @click="activeTab='command'; $nextTick(() => { inputText='ÏòàÏÇ∞ ÏÇ¨Ïö© ÌòÑÌô© Î≥¥Í≥†'; })"
                  class="px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-hq-yellow/10 text-hq-yellow border border-hq-yellow/20 hover:bg-hq-yellow/20 transition">
                  üí∞ ÏòàÏÇ∞ ÌòÑÌô©
                </button>
              </div>
              <div x-show="quickActionTab==='system'" class="flex flex-wrap gap-2">
                <button @click="activeTab='command'; $nextTick(() => { inputText='/ÎèÑÍµ¨Ï†êÍ≤Ä'; })"
                  class="px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-hq-green/10 text-hq-green border border-hq-green/20 hover:bg-hq-green/20 transition">
                  üîß ÎèÑÍµ¨ Ï†êÍ≤Ä
                </button>
                <button @click="activeTab='command'; $nextTick(() => { inputText='/Î∞∞ÏπòÏã§Ìñâ Ï†ÑÏ≤¥ Î≥¥Í≥†'; })"
                  class="px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-hq-purple/10 text-hq-purple border border-hq-purple/20 hover:bg-hq-purple/20 transition">
                  üì§ ÎåÄÍ∏∞ Ï†ÑÏÜ°
                </button>
                <button @click="activeTab='command'; $nextTick(() => { inputText='/Î∞∞ÏπòÏÉÅÌÉú'; })"
                  class="px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-hq-muted/10 text-hq-muted border border-hq-border hover:bg-hq-muted/20 transition">
                  üìã Î∞∞Ïπò ÏÉÅÌÉú
                </button>
              </div>
              <template x-if="recentCommands.length > 0">
                <div class="mt-2 pt-2 border-t border-hq-border/30">
                  <div class="text-[9px] text-hq-muted uppercase tracking-wider mb-1.5">ÏµúÍ∑º ÏÇ¨Ïö©</div>
                  <div class="flex flex-wrap gap-1.5">
                    <template x-for="(cmd, i) in recentCommands.slice(0, 3)" :key="i">
                      <button @click="activeTab='command'; $nextTick(() => { inputText=cmd; })"
                        class="px-2 py-1 text-[10px] rounded-md bg-hq-surface text-hq-muted border border-hq-border/50 hover:text-hq-text hover:border-hq-accent/30 transition truncate max-w-[140px]"
                        x-text="cmd"></button>
                    </template>
                  </div>
                </div>
              </template>
            </div>

            <!-- Ïò§Îäò AI ÏÇ¨Ïö©Îüâ Ïπ¥Îìú -->
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-9 h-9 rounded-lg bg-hq-accent/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                </div>
                <div>
                  <div class="text-sm font-bold text-hq-text" x-text="'AI Ìò∏Ï∂ú ' + (dashboard.totalAiCalls || 0) + 'Ìöå'"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">Ïò§Îäò ÏÇ¨Ïö©Îüâ</div>
                </div>
              </div>
              <!-- Î°úÎî© Ï§ë Ïä§ÌîºÎÑà -->
              <div x-show="!dashboard.loaded" class="flex items-center justify-center py-3 gap-2 text-[11px] text-hq-muted">
                <svg class="animate-spin w-3.5 h-3.5" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
                Î°úÎî© Ï§ë...
              </div>
              <!-- ÌîÑÎ°úÎ∞îÏù¥ÎçîÎ≥Ñ ÎßâÎåÄ (Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å ÌõÑ ÌëúÏãú) -->
              <div x-show="dashboard.loaded" class="space-y-1.5">
                <template x-for="p in [
                  {id:'anthropic', label:'Claude', color:'hq-purple'},
                  {id:'openai', label:'GPT', color:'hq-green'},
                  {id:'google', label:'Gemini', color:'hq-cyan'},
                ]" :key="p.id">
                  <div class="flex items-center gap-2 text-[11px]">
                    <span class="w-12 text-hq-muted truncate" x-text="p.label"></span>
                    <div class="flex-1 h-2 rounded-full bg-hq-border/50 overflow-hidden">
                      <div class="h-full rounded-full transition-all duration-500"
                        :class="'bg-' + p.color"
                        :style="'width:' + (dashboard.totalAiCalls > 0 ? Math.round((dashboard.providerCalls?.[p.id] || 0) / dashboard.totalAiCalls * 100) : 0) + '%'"></div>
                    </div>
                    <span class="w-6 text-right font-mono text-hq-muted" x-text="dashboard.providerCalls?.[p.id] || 0"></span>
                  </div>
                </template>
                <!-- Ïò§Îäò Ìò∏Ï∂ú ÏóÜÏùÑ Îïå ÏïàÎÇ¥ -->
                <div x-show="dashboard.loaded && dashboard.totalAiCalls === 0" class="text-center text-[10px] text-hq-muted/60 pt-1">Ïò§Îäò AI Ìò∏Ï∂ú ÏóÜÏùå</div>
              </div>
              <!-- ÏòàÏÇ∞ Î∞î -->
              <div class="mt-2 pt-2 border-t border-hq-border/30">
                <div class="flex items-center justify-between text-[10px] text-hq-muted mb-1">
                  <span x-text="'$' + (dashboard.todayCost || 0).toFixed(4)"></span>
                  <span x-text="'ÌïúÎèÑ $' + (dashboard.dailyLimit || 7).toFixed(0)"></span>
                </div>
                <div class="h-1.5 rounded-full bg-hq-border/50 overflow-hidden">
                  <div class="h-full rounded-full transition-all duration-500"
                    :class="(dashboard.todayCost || 0) >= (dashboard.dailyLimit || 7) ? 'bg-hq-red' : 'bg-hq-green'"
                    :style="'width:' + Math.min(100, ((dashboard.todayCost || 0) / (dashboard.dailyLimit || 7) * 100)).toFixed(1) + '%'"></div>
                </div>
              </div>
            </div>

            <!-- ÏãúÏä§ÌÖú ÌòÑÌô© Ïπ¥Îìú -->
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-9 h-9 rounded-lg bg-hq-green/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                </div>
                <div>
                  <div class="text-sm font-bold text-hq-text">ÏãúÏä§ÌÖú ÌòÑÌô©</div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">ÏÉÅÌÉú ÏöîÏïΩ</div>
                </div>
              </div>
              <div class="space-y-1.5 text-[11px]">
                <div class="flex items-center justify-between">
                  <span class="text-hq-muted">API Ïó∞Í≤∞</span>
                  <span class="text-hq-green" x-text="(dashboard.apiConnected || 0) + '/' + (dashboard.apiTotal || 5) + ' Ï†ïÏÉÅ'"></span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-hq-muted">ÎèÑÍµ¨ Î°úÎìú</span>
                  <span class="text-hq-cyan" x-text="(dashboard.toolCount || 0) + 'Í∞ú'"></span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-hq-muted">Î∞∞Ïπò</span>
                  <span>
                    <span class="text-hq-yellow" x-text="'ÎåÄÍ∏∞ ' + (dashboard.batchActive || 0)"></span>
                    <span class="text-hq-muted mx-0.5">¬∑</span>
                    <span class="text-hq-green" x-text="'ÏôÑÎ£å ' + (dashboard.batchDone || 0)"></span>
                  </span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-hq-muted">ÎÖ∏ÏÖò</span>
                  <span :class="dashboard.notionConnected ? 'text-hq-green' : 'text-hq-red'" x-text="dashboard.notionConnected ? 'Ïó∞Í≤∞Îê®' : 'ÎØ∏Ïó∞Í≤∞'"></span>
                </div>
              </div>
            </div>
          </div>

          <!-- ÏΩòÌÖêÏ∏† ÌååÏù¥ÌîÑÎùºÏù∏ ‚Äî Ï†úÍ±∞Îê® (2026-02-21, CEO ÏßÄÏãú) -->

          <!-- Feedback + Budget Row -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-8">
            <!-- CEO ÎßåÏ°±ÎèÑ Ïπ¥Îìú (#7) -->
            <div class="glass border border-hq-border rounded-xl p-5 hover-glow">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-9 h-9 rounded-lg bg-hq-yellow/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div class="flex-1">
                  <div class="text-xl font-bold text-hq-text" x-text="(feedbackStats.satisfaction_rate || 0) + '%'"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">CEO ÎßåÏ°±ÎèÑ</div>
                </div>
                <!-- ÎßåÏ°±ÎèÑ ÏãúÍ∞Å ÌëúÏãú Î∞î -->
                <div class="w-20 h-20 relative flex items-center justify-center shrink-0">
                  <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                          fill="none" stroke="rgb(var(--hq-border))" stroke-width="3"/>
                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                          fill="none" stroke="rgb(var(--hq-yellow))" stroke-width="3"
                          :stroke-dasharray="(feedbackStats.satisfaction_rate || 0) + ', 100'"/>
                  </svg>
                  <span class="absolute text-[11px] font-bold text-hq-yellow" x-text="(feedbackStats.satisfaction_rate || 0) + '%'"></span>
                </div>
              </div>
              <div class="flex items-center gap-3 text-[11px]">
                <span class="text-hq-green" x-text="'Ï¢ãÏïÑÏöî ' + (feedbackStats.good || 0)"></span>
                <span class="text-hq-muted">¬∑</span>
                <span class="text-hq-red" x-text="'ÏïÑÏâ¨ÏõåÏöî ' + (feedbackStats.bad || 0)"></span>
                <span class="text-hq-muted">¬∑</span>
                <span class="text-hq-muted" x-text="'Ï¥ù ' + (feedbackStats.total || 0) + 'Í±¥'"></span>
              </div>
            </div>
            <!-- ÏòàÏÇ∞ ÌòÑÌô© + ÏàòÏ†ï Ïπ¥Îìú (#8) -->
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg bg-hq-cyan/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                </div>
                <div class="flex-1">
                  <div class="text-sm font-bold text-hq-text">ÏòàÏÇ∞</div>
                  <div class="text-[10px] text-hq-muted">ÏùºÏùº $<span x-text="(budget.daily_limit || 0).toFixed(2)"></span> / Ïõî $<span x-text="(budget.monthly_limit || 0).toFixed(2)"></span></div>
                </div>
                <button @click="showBudgetEdit = true; budgetEditDaily = budget.daily_limit || 0; budgetEditMonthly = budget.monthly_limit || 0"
                        class="text-xs text-hq-accent hover:text-hq-accent/80 px-2 py-1 border border-hq-accent/20 rounded-lg">ÏàòÏ†ï</button>
              </div>
              <div class="w-full bg-hq-bg rounded-full h-2 mt-1">
                <div class="bg-gradient-to-r from-hq-green to-hq-yellow h-2 rounded-full transition-all"
                     :style="'width:' + Math.min(100, ((budget.today_spent || 0) / Math.max(budget.daily_limit || 1, 0.01)) * 100) + '%'"></div>
              </div>
              <div class="text-[10px] text-hq-muted mt-1">Ïò§Îäò ÏÇ¨Ïö©: $<span x-text="(budget.today_spent || 0).toFixed(4)"></span></div>
            </div>
          </div>

          <!-- E-2: ÏãúÏä§ÌÖú Í∏∞Îä• Î∞îÎ°úÍ∞ÄÍ∏∞ (Ïà®Í≤®ÏßÑ Í∏∞Îä• ÎÖ∏Ï∂ú) -->
          <div class="glass border border-hq-border rounded-xl p-5 mb-6">
            <h2 class="text-sm font-bold text-hq-text mb-3 flex items-center gap-2">
              <svg class="w-4 h-4 text-hq-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"/></svg>
              ÏãúÏä§ÌÖú Í∏∞Îä•
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
              <button @click="switchTab('performance')" class="bg-hq-bg/50 border border-hq-border/30 rounded-lg px-3 py-2.5 text-left hover:border-hq-accent/30 transition">
                <div class="text-xs font-semibold text-hq-text">Soul Gym</div>
                <div class="text-[10px] text-hq-muted mt-0.5">AI Í≤ΩÏüÅ ÏßÑÌôî ÌõàÎ†®</div>
              </button>
              <button @click="switchTab('performance')" class="bg-hq-bg/50 border border-hq-border/30 rounded-lg px-3 py-2.5 text-left hover:border-hq-accent/30 transition">
                <div class="text-xs font-semibold text-hq-text">Ïû•Í∏∞Í∏∞Ïñµ</div>
                <div class="text-[10px] text-hq-muted mt-0.5">ÌåÄÏû•Î≥Ñ Î©îÎ™®Î¶¨ Í¥ÄÎ¶¨</div>
              </button>
              <button @click="switchTab('performance')" class="bg-hq-bg/50 border border-hq-border/30 rounded-lg px-3 py-2.5 text-left hover:border-hq-accent/30 transition">
                <div class="text-xs font-semibold text-hq-text">ÌíàÏßà ÎåÄÏãúÎ≥¥Îìú</div>
                <div class="text-[10px] text-hq-muted mt-0.5">QA Í≤ÄÏàò Í≤∞Í≥º ÌòÑÌô©</div>
              </button>
              <button @click="viewMode = 'agora'" class="bg-hq-bg/50 border border-hq-border/30 rounded-lg px-3 py-2.5 text-left hover:border-hq-accent/30 transition">
                <div class="text-xs font-semibold text-hq-text">AGORA ÌÜ†Î°†</div>
                <div class="text-[10px] text-hq-muted mt-0.5">ÎÖºÎ¨∏/Ï£ºÏ†ú AI ÌÜ†Î°†</div>
              </button>
            </div>
          </div>

          <!-- Recent Completed Tasks -->
          <div class="glass border border-hq-border rounded-xl p-5 mb-6">
            <h2 class="text-sm font-bold text-hq-text mb-4 flex items-center gap-2">
              <svg class="w-4 h-4 text-hq-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              ÏµúÍ∑º ÏôÑÎ£å ÏûëÏóÖ
            </h2>
            <template x-if="dashboard.recentCompleted && dashboard.recentCompleted.length > 0">
              <div class="space-y-2">
                <template x-for="task in dashboard.recentCompleted" :key="task.task_id">
                  <div class="flex items-center justify-between p-3 bg-hq-panel rounded-lg hover:bg-hq-bg transition cursor-pointer"
                       @click="switchTab('history')">
                    <div class="flex-1 min-w-0">
                      <div class="text-sm text-hq-text truncate" x-text="task.command"></div>
                      <div class="text-[11px] text-hq-muted mt-0.5" x-text="new Date(task.created_at).toLocaleString('ko-KR', {timeZone:'Asia/Seoul'})"></div>
                    </div>
                    <div class="flex items-center gap-3 shrink-0 ml-4">
                      <span class="text-[11px] text-hq-green" x-text="task.time_seconds + 'Ï¥à'"></span>
                      <span class="text-[11px] font-mono text-hq-muted" x-text="'$' + (task.cost || 0).toFixed(4)"></span>
                    </div>
                  </div>
                </template>
              </div>
            </template>
            <template x-if="!dashboard.recentCompleted || dashboard.recentCompleted.length === 0">
              <div class="text-center py-8 text-hq-muted/80 text-sm">ÏïÑÏßÅ ÏôÑÎ£åÎêú ÏûëÏóÖÏù¥ ÏóÜÏäµÎãàÎã§</div>
            </template>
          </div>

          <!-- Quick Commands (ÌîÑÎ¶¨ÏÖã Ïπ¥Îìú Í∑∏Î¶¨Îìú) -->
          <div class="glass border border-hq-border rounded-xl p-5">
            <h2 class="text-sm font-bold text-hq-text mb-4 flex items-center gap-2">
              <svg class="w-4 h-4 text-hq-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              Îπ†Î•∏ Î™ÖÎ†π
            </h2>
            <div class="grid grid-cols-2 lg:grid-cols-3 gap-3">
              <!-- ÏÑúÎ≤Ñ ÌîÑÎ¶¨ÏÖã -->
              <template x-for="p in presets.items" :key="p.name">
                <button @click="switchTab('command'); $nextTick(() => sendPreset(p.command))"
                        class="text-left p-4 glass border border-hq-border rounded-xl hover-glow transition group">
                  <div class="text-sm font-medium text-hq-text group-hover:text-hq-accent" x-text="p.name"></div>
                  <div class="text-[11px] text-hq-muted mt-1 truncate" x-text="p.command"></div>
                </button>
              </template>
              <!-- Í∏∞Î≥∏ ÌîÑÎ¶¨ÏÖã (ÏÑúÎ≤Ñ ÌîÑÎ¶¨ÏÖãÏù¥ ÏóÜÏùÑ ÎïåÎßå ÌëúÏãú) -->
              <template x-if="!presets.items || presets.items.length === 0">
                <div class="contents">
                  <button @click="switchTab('command'); $nextTick(() => { inputText = 'Ï†Ñ Î∂ÄÏÑú ÌòÑÌô© Î≥¥Í≥†'; sendMessage(); })"
                          class="text-left p-4 glass border border-hq-border rounded-xl hover-glow transition group">
                    <div class="text-sm font-medium text-hq-text group-hover:text-hq-accent">üìä Ï†Ñ Î∂ÄÏÑú ÌòÑÌô©</div>
                    <div class="text-[11px] text-hq-muted mt-1">Ï†Ñ Î∂ÄÏÑú ÌòÑÌô© Î≥¥Í≥†</div>
                  </button>
                  <button @click="switchTab('command'); $nextTick(() => { inputText = '@ÏÇ¨ÏóÖÍ∏∞ÌöçÌåÄÏû• ÏãúÏû•Î∂ÑÏÑù ÏãúÏûë'; sendMessage(); })"
                          class="text-left p-4 glass border border-hq-border rounded-xl hover-glow transition group">
                    <div class="text-sm font-medium text-hq-text group-hover:text-hq-accent">üìä ÏãúÏû•Î∂ÑÏÑù</div>
                    <div class="text-[11px] text-hq-muted mt-1">@ÏÇ¨ÏóÖÍ∏∞ÌöçÌåÄÏû• ÏãúÏû•Î∂ÑÏÑù ÏãúÏûë</div>
                  </button>
                  <button @click="switchTab('command'); $nextTick(() => { inputText = '@ÏÇ¨ÏóÖÍ∏∞ÌöçÌåÄÏû• Î≥¥Ïïà Ïä§Ï∫î ÏãúÏûë'; sendMessage(); })"
                          class="text-left p-4 glass border border-hq-border rounded-xl hover-glow transition group">
                    <div class="text-sm font-medium text-hq-text group-hover:text-hq-accent">üõ°Ô∏è Î≥¥Ïïà Ïä§Ï∫î</div>
                    <div class="text-[11px] text-hq-muted mt-1">@ÏÇ¨ÏóÖÍ∏∞ÌöçÌåÄÏû• Î≥¥Ïïà Ïä§Ï∫î ÏãúÏûë</div>
                  </button>
                  <button @click="switchTab('command'); $nextTick(() => { inputText = '@ÎßàÏºÄÌåÖÌåÄÏû• ÎßàÏºÄÌåÖ Ï†ÑÎûµ Î∂ÑÏÑù'; sendMessage(); })"
                          class="text-left p-4 glass border border-hq-border rounded-xl hover-glow transition group">
                    <div class="text-sm font-medium text-hq-text group-hover:text-hq-accent">üìà ÎßàÏºÄÌåÖ Î∂ÑÏÑù</div>
                    <div class="text-[11px] text-hq-muted mt-1">@ÎßàÏºÄÌåÖÌåÄÏû• ÎßàÏºÄÌåÖ Ï†ÑÎûµ Î∂ÑÏÑù</div>
                  </button>
                  <button @click="switchTab('command'); $nextTick(() => { inputText = '@Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• ÏòàÏÇ∞ ÌòÑÌô© Ï†ïÎ¶¨'; sendMessage(); })"
                          class="text-left p-4 glass border border-hq-border rounded-xl hover-glow transition group">
                    <div class="text-sm font-medium text-hq-text group-hover:text-hq-accent">üí∞ ÏòàÏÇ∞ ÌòÑÌô©</div>
                    <div class="text-[11px] text-hq-muted mt-1">@Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• ÏòàÏÇ∞ ÌòÑÌô© Ï†ïÎ¶¨</div>
                  </button>
                </div>
              </template>
              <button @click="switchTab('command')"
                      class="text-left p-4 bg-hq-panel/30 rounded-xl border border-dashed border-hq-border hover:border-hq-accent/30 transition group flex items-center justify-center min-h-[60px]">
                <span class="text-sm text-hq-muted group-hover:text-hq-accent">+ ÏßÅÏ†ë Î™ÖÎ†π</span>
              </button>
            </div>
          </div>

          <!-- ÎåÄÏãúÎ≥¥Îìú ÏÉÅÏÑ∏ ÎßÅÌÅ¨ -->
          <div class="mt-6 text-center">
            <button @click="viewMode='dashboard'; loadDashboard()"
                    class="text-sm text-hq-accent/70 hover:text-hq-accent transition inline-flex items-center gap-1.5">
              <span>ÎåÄÏãúÎ≥¥Îìú ÏÉÅÏÑ∏ Î≥¥Í∏∞</span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab: Î™ÖÎ†π (Command) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'command'" x-cloak
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 translate-y-2"
           x-transition:enter-end="opacity-100 translate-y-0"
           class="flex-1 flex flex-col overflow-hidden relative">

        <!-- Chat Messages -->
        <div class="flex-1 overflow-y-auto scrollbar-thin px-6 pt-8 pb-6 space-y-4 bg-grid" id="chatArea" x-ref="chatArea" @scroll="onChatScroll($event)">

          <!-- ‚ïê‚ïê‚ïê Welcome Screen ‚ïê‚ïê‚ïê -->
          <template x-if="messages.length === 0 && viewMode === 'chat'">
            <div class="flex flex-col items-center justify-center h-full text-center fade-in-up">
              <div class="mb-6 relative">
                <svg width="72" height="72" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="drop-shadow-lg">
                  <defs><linearGradient id="heroGrad" x1="0" y1="0" x2="32" y2="32"><stop offset="0%" stop-color="#00ff88"/><stop offset="50%" stop-color="#00e6ff"/><stop offset="100%" stop-color="#8c64ff"/></linearGradient></defs>
                  <path d="M16 2L28 9V23L16 30L4 23V9L16 2Z" stroke="url(#heroGrad)" stroke-width="1.5" fill="none"/>
                  <path d="M16 6L24 10.5V21.5L16 26L8 21.5V10.5L16 6Z" stroke="url(#heroGrad)" stroke-width="1" fill="none" opacity="0.4"/>
                  <circle cx="16" cy="16" r="4" fill="url(#heroGrad)" opacity="0.8"/><circle cx="16" cy="16" r="2" fill="rgb(10 12 18)"/>
                  <line x1="16" y1="12" x2="16" y2="6" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="19.5" y1="14" x2="24" y2="10.5" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="19.5" y1="18" x2="24" y2="21.5" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="16" y1="20" x2="16" y2="26" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="12.5" y1="18" x2="8" y2="21.5" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="12.5" y1="14" x2="8" y2="10.5" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                </svg>
                <div class="absolute inset-0 bg-hq-accent/10 rounded-full blur-3xl scale-150"></div>
              </div>

              <h1 class="text-4xl font-extrabold gradient-text mb-2 tracking-tight" style="letter-spacing: 0.15em;">CYBER COMMAND</h1>
              <p class="text-lg text-hq-green/90 mb-1" x-text="greeting"></p>
              <p class="text-hq-cyan/60 text-sm mb-8 max-w-sm leading-relaxed font-mono">
                [ SYSTEM ONLINE ] 29 UNITS STANDING BY
              </p>

              <div class="flex gap-3 mb-6">
                <div class="glass border border-hq-green/30 rounded-xl px-4 py-3 hover-glow cursor-default bounce-in" style="animation-delay:0.1s">
                  <div class="text-lg font-bold text-hq-green font-mono">7</div><div class="text-[10px] text-hq-green/50 uppercase tracking-wider font-mono">DIVISION</div>
                </div>
                <div class="glass border border-hq-cyan/30 rounded-xl px-4 py-3 hover-glow cursor-default bounce-in" style="animation-delay:0.2s">
                  <div class="text-lg font-bold text-hq-cyan font-mono" x-text="agentsList.length || 29"></div><div class="text-[10px] text-hq-cyan/50 uppercase tracking-wider font-mono">AGENTS</div>
                </div>
                <div class="glass border border-hq-purple/30 rounded-xl px-4 py-3 hover-glow cursor-default bounce-in" style="animation-delay:0.3s">
                  <div class="text-lg font-bold text-hq-purple font-mono" x-text="toolsList.length || 103"></div><div class="text-[10px] text-hq-purple/50 uppercase tracking-wider font-mono">WEAPONS</div>
                </div>
                <div class="glass border border-hq-accent/30 rounded-xl px-4 py-3 hover-glow cursor-default bounce-in" style="animation-delay:0.4s">
                  <div class="text-lg font-bold text-hq-accent font-mono">3</div><div class="text-[10px] text-hq-accent/50 uppercase tracking-wider font-mono">AI ENGINE</div>
                </div>
              </div>

              <!-- Preset Category Tabs -->
              <div class="flex gap-2 mb-4">
                <template x-for="tab in presetTabs" :key="tab">
                  <button @click="presetTab = tab"
                    :class="presetTab === tab ? 'bg-hq-accent/20 border-hq-accent/40 text-hq-accent' : 'bg-hq-surface border-hq-border text-hq-muted hover:text-hq-text'"
                    class="border rounded-lg px-3 py-1.5 text-xs font-semibold transition-all" x-text="tab"></button>
                </template>
              </div>

              <!-- Preset Commands Grid -->
              <div class="grid grid-cols-2 gap-3 max-w-lg w-full max-h-[300px] overflow-y-auto scrollbar-thin">
                <template x-for="preset in getFilteredPresets()" :key="preset.name">
                  <div class="glass border border-hq-border rounded-xl px-4 py-3.5 text-left hover-lift hover-glow group relative">
                    <div @click="sendPreset(preset.command)" class="cursor-pointer">
                      <div class="flex items-center gap-2 mb-1.5">
                        <div class="w-7 h-7 rounded-lg flex items-center justify-center" :class="'bg-' + preset.color + '/15'">
                          <span class="w-3 h-3 rounded-full" :class="'bg-' + preset.color"></span>
                        </div>
                        <span class="text-sm font-semibold text-hq-text group-hover:text-hq-text transition-colors" x-text="preset.name"></span>
                      </div>
                      <p class="text-[11px] text-hq-muted leading-relaxed" x-text="preset.desc"></p>
                    </div>
                    <button x-show="preset.isServer" @click.stop="deletePreset(preset.name)"
                      class="absolute top-2 right-2 text-hq-muted/70 hover:text-hq-red text-xs transition opacity-0 group-hover:opacity-100" title="ÏÇ≠Ï†ú">&times;</button>
                  </div>
                </template>
              </div>
              <!-- Add Preset Button & Form -->
              <div class="mt-3 max-w-lg w-full">
                <button x-show="!showAddPreset" @click="showAddPreset = true"
                  class="text-xs text-hq-accent hover:text-hq-accent/80 transition">+ ÏÉà ÌîÑÎ¶¨ÏÖã Ï∂îÍ∞Ä</button>
                <div x-show="showAddPreset" x-transition class="glass border border-hq-border rounded-xl p-3 space-y-2">
                  <input x-model="newPresetName" placeholder="ÌîÑÎ¶¨ÏÖã Ïù¥Î¶Ñ" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-1.5 text-sm text-hq-text placeholder-hq-muted/70">
                  <input x-model="newPresetCommand" placeholder="Î™ÖÎ†πÏñ¥" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-1.5 text-sm text-hq-text placeholder-hq-muted/70">
                  <div class="flex gap-2">
                    <button @click="addPreset()" class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-3 py-1 text-xs">Ï∂îÍ∞Ä</button>
                    <button @click="showAddPreset = false; newPresetName = ''; newPresetCommand = ''" class="bg-hq-surface hover:bg-hq-panel text-hq-text rounded-lg px-3 py-1 text-xs">Ï∑®ÏÜå</button>
                  </div>
                </div>
              </div>
              <!-- ÌÖçÏä§Ìä∏ Ï†úÍ±∞Îê® (#17) -->

              <!-- ÏµúÍ∑º ÏôÑÎ£å ÏûëÏóÖ (ÏÉàÎ°úÍ≥†Ïπ® ÌõÑÏóêÎèÑ ÌëúÏãú) -->
              <div x-show="recentCommandTasks && recentCommandTasks.length > 0" class="mt-4 max-w-lg w-full">
                <div class="text-[10px] font-bold text-hq-muted/60 uppercase tracking-[0.15em] font-mono mb-2">LAST OPERATIONS</div>
                <div class="space-y-1.5">
                  <template x-for="task in recentCommandTasks.slice(0,3)" :key="task.task_id">
                    <div class="glass border border-hq-border/40 rounded-xl px-3 py-2 flex items-center gap-2 text-[10px]">
                      <span class="font-mono" x-text="task.status === 'completed' ? '‚úÖ' : '‚ùå'"></span>
                      <span class="flex-1 text-hq-text/70 truncate"
                            x-text="(task.agent_name || task.agent_id || '') + (task.command ? ' ¬∑ ' + task.command.slice(0,40) : '')"></span>
                      <span class="text-hq-muted/50 shrink-0 font-mono"
                            x-text="task.created_at ? new Date(task.created_at).toLocaleTimeString('ko-KR', {timeZone:'Asia/Seoul', hour:'2-digit', minute:'2-digit'}) : ''"></span>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </template>

          <!-- ‚ïê‚ïê‚ïê Messages ‚ïê‚ïê‚ïê -->
          <template x-for="(msg, i) in messages" :key="i">
            <div>

              <!-- ÎÇ†Ïßú Íµ¨Î∂ÑÏÑ† (Ïπ¥Ïπ¥Ïò§ÌÜ° Ïä§ÌÉÄÏùº) -->
              <template x-if="shouldShowDateSeparator(messages, i)">
                <div class="flex items-center my-4 gap-3">
                  <div class="flex-1 h-px bg-hq-muted/20"></div>
                  <span class="text-xs text-hq-muted/60 whitespace-nowrap" x-text="formatDate(msg.timestamp)"></span>
                  <div class="flex-1 h-px bg-hq-muted/20"></div>
                </div>
              </template>

              <!-- User message -->
              <template x-if="msg.type === 'user'">
                <div class="flex justify-end mb-4 msg-user">
                  <div class="max-w-2xl">
                    <div class="bg-gradient-to-br from-hq-accent/20 to-hq-purple/10 border border-hq-accent/20 rounded-2xl rounded-tr-md px-5 py-3.5 glow-blue">
                      <div class="flex items-center gap-2 mb-1.5">
                        <div class="w-5 h-5 rounded-md bg-gradient-to-br from-hq-accent to-hq-purple flex items-center justify-center">
                          <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                        </div>
                        <span class="text-[11px] font-bold text-hq-accent uppercase tracking-wider" x-text="msg.source === 'telegram' ? 'CEO Î™ÖÎ†π (ÌÖîÎ†àÍ∑∏Îû®)' : 'CEO Î™ÖÎ†π'"></span>
                      </div>
                      <div class="text-hq-text text-sm leading-relaxed whitespace-pre-wrap" x-text="msg.text"></div>
                      <span class="text-[10px] text-hq-muted/40 ml-2 shrink-0 self-end block text-right mt-1" x-text="formatTime(msg.timestamp)"></span>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Queued message (D-2) -->
              <template x-if="msg.type === 'queued'">
                <div class="flex justify-end mb-4 msg-queued">
                  <div class="max-w-2xl">
                    <div class="bg-gradient-to-br from-hq-yellow/10 to-amber-500/5 border border-hq-yellow/20 border-dashed rounded-2xl rounded-tr-md px-5 py-3.5">
                      <div class="flex items-center gap-2 mb-1.5">
                        <svg class="w-4 h-4 text-hq-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="text-[11px] font-bold text-hq-yellow uppercase tracking-wider">ÎåÄÍ∏∞Ïó¥</span>
                        <button @click="removeFromQueue(commandQueue.findIndex(q => q.text === msg.text))"
                                class="ml-auto text-hq-muted/50 hover:text-hq-red text-[10px] transition">Ï∑®ÏÜå</button>
                      </div>
                      <div class="text-hq-text/70 text-sm leading-relaxed whitespace-pre-wrap" x-text="msg.text"></div>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Processing indicator -->
              <template x-if="msg.type === 'processing'">
                <div class="mb-4 msg-processing">
                  <div class="max-w-3xl">
                    <div class="glass border border-hq-yellow/20 rounded-2xl rounded-tl-md px-5 py-4">
                      <div class="flex items-center gap-2 mb-3">
                        <span class="w-2 h-2 rounded-full bg-hq-yellow pulse-dot"></span>
                        <span class="text-xs font-bold text-hq-yellow uppercase tracking-wider">ÏóêÏù¥Ï†ÑÌä∏ ÏûëÏóÖÏ§ë</span>
                        <div class="ml-auto flex gap-1">
                          <span class="w-1 h-1 rounded-full bg-hq-yellow/60 pulse-dot" style="animation-delay:0s"></span>
                          <span class="w-1 h-1 rounded-full bg-hq-yellow/60 pulse-dot" style="animation-delay:0.3s"></span>
                          <span class="w-1 h-1 rounded-full bg-hq-yellow/60 pulse-dot" style="animation-delay:0.6s"></span>
                        </div>
                      </div>
                      <!-- Î¶¨ÌîÑÎ†àÏãú ÌõÑ Î≥µÏõêÎêú ÏûëÏóÖ Î™ÖÎ†πÏñ¥ ÌëúÏãú -->
                      <div x-show="msg.restoredCommand && Object.values(activeAgents).filter(a => a.status === 'working').length === 0"
                           class="text-[11px] text-hq-muted/80 italic pl-1 pb-1">
                        <span class="text-hq-yellow/70">Î≥µÏõêÎê®:</span>
                        <span x-text="msg.restoredCommand"></span>
                      </div>
                      <div class="space-y-2.5">
                        <template x-for="(status, agentId) in activeAgents" :key="agentId">
                          <div x-show="status.status === 'working'" class="fade-in cursor-pointer" @click="scrollToAgent(agentId)">
                            <div class="flex items-center justify-between mb-1">
                              <div class="flex items-center gap-2">
                                <div class="w-5 h-5 rounded-md flex items-center justify-center text-[8px] font-bold"
                                     :class="getAgentAvatarClass(agentId)" x-text="getAgentInitials(agentId)"></div>
                                <span class="text-xs text-hq-text/80 font-medium" x-text="getAgentName(agentId)"></span>
                              </div>
                              <span class="text-[10px] font-mono text-hq-yellow" x-text="Math.round(status.progress * 100) + '%'"></span>
                            </div>
                            <div x-show="status.detail" class="text-[10px] text-hq-muted mb-1 pl-7 truncate" x-text="status.detail"></div>
                            <div class="h-1 bg-hq-bg rounded-full overflow-hidden">
                              <div class="h-full rounded-full progress-bar bg-gradient-to-r from-hq-yellow to-hq-accent"
                                   :style="'width:' + (status.progress * 100) + '%'"></div>
                            </div>
                          </div>
                        </template>
                      </div>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Agent result -->
              <template x-if="msg.type === 'result'">
                <div class="mb-4 msg-result">
                  <div class="max-w-4xl">
                    <div class="glass border border-hq-green/20 rounded-2xl rounded-tl-md overflow-hidden">
                      <div class="flex items-center justify-between px-5 py-3 border-b border-hq-border/50 bg-hq-green/[0.03]">
                        <div class="flex items-center gap-2.5">
                          <div class="w-2 h-2 rounded-full bg-hq-green"></div>
                          <span class="text-xs font-bold text-hq-green tracking-wider" x-text="msg.delegation || msg.handled_by || (msg.agent_id ? getAgentName(msg.agent_id) : 'ÏãúÏä§ÌÖú')"></span>
                          <!-- D-6: Î≥¥Í≥†ÏÑú ID -->
                          <span x-show="msg.task_id" class="text-[9px] font-mono text-hq-muted/30" x-text="'#' + (msg.task_id || '').slice(0, 8)"></span>
                          <template x-if="msg.quality_score">
                            <span class="status-badge border" :class="getQualityBadge(msg.quality_score).cls" x-text="getQualityBadge(msg.quality_score).label"></span>
                          </template>
                        </div>
                        <div class="flex items-center gap-3">
                          <div class="flex items-center gap-4 text-[11px] font-mono text-hq-muted">
                            <div class="flex items-center gap-1">
                              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                              <span x-text="msg.time_seconds + 's'"></span>
                            </div>
                            <div class="flex items-center gap-1">
                              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                              <span x-text="'$' + (msg.cost || 0).toFixed(4)"></span>
                            </div>
                            <template x-if="msg.model">
                              <div class="flex items-center gap-1">
                                <span class="text-hq-accent">&#9679;</span>
                                <span x-text="msg.model.includes('-') ? msg.model.split('-')[1] : msg.model"></span>
                              </div>
                            </template>
                          </div>
                          <button @click="copyToClipboard(msg.content)" class="text-hq-muted hover:text-hq-green transition p-1" title="Î≥µÏÇ¨">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                          </button>
                          <!-- Feedback Buttons -->
                          <div class="flex items-center gap-0.5 border-l border-hq-border/40 pl-2 ml-1">
                            <button @click="sendFeedback(msg, 'good')"
                              :class="msg.feedbackRating === 'good' ? 'text-hq-green scale-110 bg-green-500/20 ring-1 ring-green-400/50 rounded' : 'text-hq-muted hover:text-hq-green'"
                              class="transition-all duration-200 p-1" :title="msg.feedbackRating === 'good' ? 'Ï¢ãÏïÑÏöî Ï∑®ÏÜå' : 'Ï¢ãÏïÑÏöî'">
                              <svg class="w-4 h-4" :fill="msg.feedbackRating === 'good' ? 'currentColor' : 'none'" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/></svg>
                            </button>
                            <button @click="sendFeedback(msg, 'bad')"
                              :class="msg.feedbackRating === 'bad' ? 'text-hq-red scale-110 bg-red-500/20 ring-1 ring-red-400/50 rounded' : 'text-hq-muted hover:text-hq-red'"
                              class="transition-all duration-200 p-1" :title="msg.feedbackRating === 'bad' ? 'ÏïÑÏâ¨ÏõåÏöî Ï∑®ÏÜå' : 'ÏïÑÏâ¨ÏõåÏöî'">
                              <svg class="w-4 h-4" :fill="msg.feedbackRating === 'bad' ? 'currentColor' : 'none'" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018c.163 0 .326.02.485.06L17 4m-7 10v2a3.5 3.5 0 003.5 3.5h.5a2 2 0 002-2v-.5c0-.966-.393-1.84-1.027-2.472L17 13V4m-7 10h2M17 4h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"/></svg>
                            </button>
                          </div>
                          <button x-show="isLongContent(msg.content)" @click="msg.collapsed = !msg.collapsed"
                            class="text-hq-muted hover:text-hq-text transition p-1" title="Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞">
                            <svg class="w-4 h-4 transition-transform" :class="msg.collapsed ? '' : 'rotate-180'" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
                          </button>
                        </div>
                      </div>
                      <div class="px-5 py-4" x-show="!msg.collapsed" x-collapse>
                        <div class="text-sm leading-relaxed markdown-body" x-html="renderMarkdown(msg.content)"></div>
                      </div>
                      <div x-show="msg.collapsed" class="px-5 py-3">
                        <div class="text-sm text-hq-muted italic">Í≤∞Í≥ºÍ∞Ä Ï†ëÌòÄÏûàÏäµÎãàÎã§. ÏúÑ Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÌéºÏπ©ÎãàÎã§. <span class="text-[11px] ml-2" x-text="'(' + (msg.content?.length || 0) + 'Ïûê)'"></span></div>
                      </div>
                      <div class="px-5 pb-2 text-right">
                        <span class="text-[10px] text-hq-muted/40" x-text="formatTime(msg.timestamp)"></span>
                      </div>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Error -->
              <template x-if="msg.type === 'error'">
                <div class="mb-4 scale-in">
                  <div class="max-w-2xl">
                    <div class="bg-hq-red/5 border border-hq-red/20 rounded-2xl rounded-tl-md px-5 py-4">
                      <div class="flex items-center gap-2 mb-2">
                        <svg class="w-4 h-4 text-hq-red" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
                        <span class="text-xs font-bold text-hq-red uppercase tracking-wider">Ïò§Î•ò</span>
                      </div>
                      <div class="text-sm text-hq-text/80" x-text="msg.text"></div>
                      <span class="text-[10px] text-hq-muted/40 block text-right mt-1" x-text="formatTime(msg.timestamp)"></span>
                    </div>
                  </div>
                </div>
              </template>

            </div>
          </template>
        </div>

        <!-- Ïä§ÌÅ¨Î°§ Îã§Ïö¥ Î≤ÑÌäº -->
        <button x-show="showScrollBtn" x-transition @click="scrollToBottomSmooth()"
          class="absolute bottom-20 right-6 z-30 w-10 h-10 rounded-full bg-hq-accent/80 hover:bg-hq-accent text-white shadow-lg flex items-center justify-center backdrop-blur-sm transition-all">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/></svg>
          <span x-show="newMsgCount > 0" x-text="newMsgCount"
            class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center"></span>
        </button>

        <!-- ÎÇ¥Î∂ÄÌÜµÏã† Ìå®ÎÑê ÏÇ≠Ï†úÎê® ‚Äî ÌÜµÏã†Î°úÍ∑∏ 4ÌÉ≠ Ï≤¥Í≥ÑÎ°ú ÎåÄÏ≤¥ (DÏïà, 2026-02-23) -->
        <div x-show="false" x-cloak
             class="absolute top-0 right-0 w-80 h-full flex flex-col z-20 border-l border-hq-border/60"
          <!-- Ìå®ÎÑê Ìó§Îçî -->
          <div class="flex items-center justify-between px-4 py-3 border-b border-hq-border/50 shrink-0">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-hq-cyan animate-pulse"></span>
              <span class="text-sm font-bold text-hq-text tracking-wide">ÎÇ¥Î∂ÄÌÜµÏã†</span>
              <span class="text-[10px] text-hq-muted/60 font-mono">DELEGATION LOG</span>
            </div>
            <div class="flex items-center gap-2">
              <button @click="fetchDelegationLogs()" title="ÏÉàÎ°úÍ≥†Ïπ®"
                      class="text-hq-muted hover:text-hq-accent transition p-1 rounded">
                <svg class="w-3.5 h-3.5" :class="delegationLogLoading ? 'animate-spin' : ''"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
              </button>
              <button @click="showDelegationLog = false" title="Îã´Í∏∞"
                      class="text-hq-muted hover:text-hq-red transition p-1 rounded">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          <!-- ÌïÑÌÑ∞ ÌÉ≠ -->
          <div class="flex gap-1 px-3 py-2 border-b border-hq-border/30 shrink-0">
            <button @click="delegationLogFilter = 'all'"
                    :class="delegationLogFilter === 'all' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                    class="text-[10px] px-2 py-1 rounded-md font-semibold transition">Ï†ÑÏ≤¥</button>
            <button @click="delegationLogFilter = 'delegation'"
                    :class="delegationLogFilter === 'delegation' ? 'bg-hq-cyan/20 text-hq-cyan' : 'text-hq-muted hover:text-hq-text'"
                    class="text-[10px] px-2 py-1 rounded-md font-semibold transition">ÏúÑÏûÑ</button>
            <button @click="delegationLogFilter = 'report'"
                    :class="delegationLogFilter === 'report' ? 'bg-hq-green/20 text-hq-green' : 'text-hq-muted hover:text-hq-text'"
                    class="text-[10px] px-2 py-1 rounded-md font-semibold transition">Î≥¥Í≥†</button>
            <button @click="delegationLogFilter = 'p2p'"
                    :class="delegationLogFilter === 'p2p' ? 'bg-hq-orange/20 text-hq-orange' : 'text-hq-muted hover:text-hq-text'"
                    class="text-[10px] px-2 py-1 rounded-md font-semibold transition">P2P</button>
            <button @click="delegationLogFilter = 'flow'"
                    :class="delegationLogFilter === 'flow' ? 'bg-hq-purple/20 text-hq-purple' : 'text-hq-muted hover:text-hq-text'"
                    class="text-[10px] px-2 py-1 rounded-md font-semibold transition">ÌùêÎ¶ÑÎèÑ</button>
          </div>
          <!-- Î°úÍ∑∏ Î™©Î°ù (Ï†ÑÏ≤¥/ÏúÑÏûÑ/Î≥¥Í≥† ÌÉ≠) -->
          <div x-show="delegationLogFilter !== 'flow'" class="flex-1 overflow-y-auto scrollbar-thin p-2.5 space-y-1.5">
            <template x-if="delegationLogs.length === 0 && !delegationLogLoading">
              <div class="text-center py-8">
                <div class="text-hq-muted/40 text-sm">ÏóêÏù¥Ï†ÑÌä∏ ÌÜµÏã† ÏóÜÏùå</div>
                <div class="text-hq-muted/30 text-[11px] mt-1">ÎåÄÌôîÎ•º ÏãúÏûëÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</div>
              </div>
            </template>
            <template x-for="log in getFilteredDelegationLogs()" :key="log.id">
              <!-- BÏïà: Ïπ¥ÎìúÌòï ‚Äî ÏôºÏ™Ω Ïª¨Îü¨ Î≥¥Îçî + Î∞úÏã†/ÏàòÏã† Ìó§Îçî + Î©îÏãúÏßÄ + ÏãúÍ∞Ñ(hover) -->
              <div class="rounded-lg border border-hq-border/20 bg-hq-panel/30 overflow-hidden transition-all hover:bg-hq-panel/60 hover:border-hq-border/40 hover:shadow-sm"
                   :style="'border-left: 3px solid ' + getDeptColor(log.sender)">
                <!-- Ìó§Îçî: Î∞úÏã† ‚Üí ÏàòÏã† + ÏÉÅÎåÄÏãúÍ∞Ñ -->
                <div class="flex items-center justify-between px-3 pt-2.5 pb-1">
                  <div class="flex items-center gap-1.5 min-w-0">
                    <span class="text-[11px] font-bold truncate max-w-[90px]"
                          :style="'color:' + getDeptColor(log.sender)"
                          x-text="getAgentName(log.sender) || log.sender"></span>
                    <svg class="w-3 h-3 text-hq-muted/40 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                    </svg>
                    <span class="text-[11px] font-semibold text-hq-text/80 truncate max-w-[90px]"
                          x-text="getAgentName(log.receiver) || log.receiver"></span>
                  </div>
                  <!-- ÏÉÅÎåÄÏãúÍ∞Ñ (hoverÏãú Ï†ïÌôïÌïú ÏãúÍ∞Ñ Ìà¥ÌåÅ) -->
                  <span class="text-[9px] text-hq-muted/50 shrink-0 ml-1 cursor-default whitespace-nowrap"
                        :title="formatTime(log.created_at)"
                        x-text="relativeTimeStr(log.created_at)"></span>
                </div>
                <!-- Î©îÏãúÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ (ÎßàÌÅ¨Îã§Ïö¥ Ï†úÍ±∞) -->
                <div class="px-3 pb-2 text-[11px] text-hq-muted/70 leading-relaxed line-clamp-2"
                     x-text="stripMarkdown(log.message)"></div>
                <!-- Ïú†Ìòï Î∞∞ÏßÄ -->
                <div class="px-3 pb-2.5">
                  <span class="text-[9px] font-bold px-1.5 py-0.5 rounded uppercase tracking-wider"
                        :class="log.source === 'cross_agent' ? 'bg-hq-orange/15 text-hq-orange' : (log.log_type === 'delegation' ? 'bg-hq-cyan/15 text-hq-cyan' : (log.log_type === 'consult' ? 'bg-hq-purple/15 text-hq-purple' : 'bg-hq-green/15 text-hq-green'))"
                        x-text="log.source === 'cross_agent' ? 'P2P' : (log.log_type === 'delegation' ? 'ÏúÑÏûÑ' : (log.log_type === 'consult' ? 'ÌòëÏùò' : 'Î≥¥Í≥†'))"></span>
                </div>
              </div>
            </template>
          </div>
          <!-- ÌùêÎ¶ÑÎèÑ ÌÉ≠ -->
          <div x-show="delegationLogFilter === 'flow'" class="flex-1 overflow-y-auto scrollbar-thin p-2.5">
            <template x-if="delegationLogs.length === 0">
              <div class="text-center py-8 text-hq-muted/60 text-[11px]">ÌòëÏóÖ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>
            </template>
            <div class="space-y-0">
              <template x-for="(log, idx) in delegationLogs.slice(0, 20)" :key="log.id || idx">
                <div class="relative pl-10">
                  <!-- ÌÉÄÏûÑÎùºÏù∏ ÏÑ∏Î°úÏÑ† -->
                  <div x-show="idx < delegationLogs.slice(0,20).length - 1"
                       class="absolute left-[14px] top-[28px] w-px bottom-[-4px] bg-hq-border/30"></div>
                  <!-- Î∞úÏã†Ïûê Ïª¨Îü¨ ÎèÑÌä∏ -->
                  <div class="absolute left-[9px] top-[10px] w-[11px] h-[11px] rounded-full border-2 border-hq-bg"
                       :style="'background:' + getDeptColor(log.sender)"></div>
                  <!-- Ïπ¥Îìú ÎÇ¥Ïö© -->
                  <div class="mb-3 pb-1">
                    <div class="flex items-center gap-1 mb-0.5">
                      <span class="text-[11px] font-bold"
                            :style="'color:' + getDeptColor(log.sender)"
                            x-text="getAgentName(log.sender) || log.sender"></span>
                      <svg class="w-3 h-3 text-hq-muted/40 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                      </svg>
                      <span class="text-[11px] font-semibold text-hq-text/80 truncate"
                            x-text="getAgentName(log.receiver) || log.receiver"></span>
                      <span x-show="log.title" class="text-[10px] text-hq-accent/70 truncate max-w-[120px]"
                            x-text="'¬∑ ' + (log.title || '')"></span>
                      <span class="ml-auto text-[9px] text-hq-muted/40 shrink-0 cursor-default"
                            :title="formatTime(log.created_at)"
                            x-text="relativeTimeStr(log.created_at)"></span>
                    </div>
                    <div class="text-[10px] text-hq-muted/60 line-clamp-2 leading-relaxed"
                         x-text="stripMarkdown(log.message)"></div>
                    <span class="inline-block mt-1 text-[9px] font-bold px-1.5 py-0.5 rounded uppercase tracking-wider"
                          :class="log.source === 'cross_agent' ? 'bg-hq-orange/10 text-hq-orange' : (log.log_type === 'delegation' ? 'bg-hq-cyan/10 text-hq-cyan' : 'bg-hq-green/10 text-hq-green')"
                          x-text="log.source === 'cross_agent' ? 'P2P' : (log.log_type === 'delegation' ? 'ÏúÑÏûÑ' : 'Î≥¥Í≥†')"></span>
                  </div>
                </div>
              </template>
            </div>
          </div>
          <!-- Ìë∏ÌÑ∞ -->
          <div class="px-4 py-2 border-t border-hq-border/30 shrink-0 flex items-center gap-2">
            <span class="w-1.5 h-1.5 rounded-full animate-pulse" :class="_commsSSE ? 'bg-hq-green' : 'bg-hq-muted/40'"></span>
            <span class="text-[10px] text-hq-muted/60" x-text="_commsSSE ? 'SSE Ïã§ÏãúÍ∞Ñ' : 'ÎåÄÍ∏∞'"></span>
            <span class="text-[10px] text-hq-muted/40 ml-auto" x-text="delegationLogs.length + 'Í±¥'"></span>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Input Bar ‚ïê‚ïê‚ïê -->
        <div class="border-t-2 border-hq-accent/20 bg-hq-surface/90 backdrop-blur-md p-4 shrink-0 shadow-[0_-4px_16px_rgb(var(--hq-shadow)/0.08)] relative z-50 chat-input-bar">
          <div class="max-w-4xl mx-auto relative">
            <!-- Ïä¨ÎûòÏãú Î™ÖÎ†πÏñ¥ ÌåùÏóÖ -->
            <div x-show="showSlashDropdown" x-transition
                 class="absolute bottom-full mb-2 left-0 w-full max-w-96 bg-[rgb(var(--hq-surface))] border border-hq-border rounded-xl overflow-hidden shadow-2xl z-[999]">
              <div class="px-4 py-2 border-b border-hq-border/30">
                <span class="text-xs text-hq-muted font-semibold tracking-wide">Î™ÖÎ†πÏñ¥</span>
              </div>
              <template x-for="(cmd, idx) in filteredSlashCommands" :key="cmd.cmd">
                <button @click="insertSlashCommand(cmd)" @mouseenter="slashSelectedIndex = idx"
                  class="w-full px-4 py-2.5 text-left flex items-center gap-3 transition-colors"
                  :class="idx === slashSelectedIndex ? 'bg-hq-accent/15' : 'hover:bg-hq-accent/5'">
                  <span class="text-lg w-7 text-center" x-text="cmd.icon"></span>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2">
                      <span class="text-hq-accent font-mono font-bold text-sm" x-text="cmd.cmd"></span>
                      <span class="text-hq-muted/60 text-xs" x-text="cmd.args"></span>
                    </div>
                    <div class="text-[13px] text-hq-muted font-medium truncate mt-0.5" x-text="cmd.desc"></div>
                  </div>
                </button>
              </template>
            </div>
            <!-- @mention dropdown -->
            <div x-show="showMentionDropdown" x-transition
                 class="absolute bottom-full mb-2 left-0 w-72 rounded-xl overflow-hidden shadow-2xl z-50"
                 :style="darkMode
                   ? 'background:#0d1117; border:1px solid #374158; box-shadow:0 8px 32px rgba(0,0,0,0.6);'
                   : 'background:#ffffff; border:1px solid #d1d5db; box-shadow:0 8px 32px rgba(0,0,0,0.12);'">
              <div class="px-3 py-1.5 text-[10px] text-hq-muted uppercase tracking-wider border-b border-hq-border/50">ÏóêÏù¥Ï†ÑÌä∏ @ Î©òÏÖò</div>
              <div class="max-h-64 overflow-y-auto">
                <template x-for="group in mentionGroups" :key="group.label">
                  <div>
                    <div class="px-3 py-1 text-[9px] text-hq-muted/70 uppercase tracking-widest font-semibold"
                         :style="darkMode ? 'background:#111827;' : 'background:#f3f4f6;'" x-text="group.label"></div>
                    <template x-for="agent in group.agents" :key="agent.id">
                      <button @click="insertMention(agent)"
                        class="w-full px-3 py-1.5 text-left text-sm flex items-center gap-2 transition-colors"
                        @mouseover="$el.style.background=darkMode ? 'rgba(99,102,241,0.15)' : 'rgba(99,102,241,0.08)'"
                        @mouseout="$el.style.background='transparent'">
                        <span class="w-6 h-6 rounded-md flex items-center justify-center text-[9px] font-bold"
                          :class="getAgentAvatarClass(agent.id)" x-text="getAgentInitials(agent.id)"></span>
                        <span class="text-hq-text text-sm" x-text="agent.name"></span>
                      </button>
                    </template>
                  </div>
                </template>
              </div>
            </div>
            <!-- ÏàòÏã†Ïûê ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ -->
            <div class="flex items-center gap-1.5 mb-1 flex-wrap">
              <select
                x-model="targetAgentId"
                class="text-xs px-2 py-1.5 rounded-lg border border-hq-border bg-hq-panel text-hq-muted
                       focus:outline-none focus:border-hq-accent/60 transition-colors cursor-pointer shrink-0
                       dark:bg-hq-panel dark:text-hq-muted"
                title="Î©îÏãúÏßÄ ÏàòÏã†Ïûê ÏÑ†ÌÉù"
              >
                <option value="">ü§ñ Ï†ÑÏ≤¥ ÏûêÎèô ÎùºÏö∞ÌåÖ</option>
                <template x-for="group in getRecipientGroups()" :key="group.label">
                  <optgroup :label="'‚îÄ‚îÄ ' + group.label + ' ‚îÄ‚îÄ'">
                    <template x-for="agent in group.agents" :key="agent.id">
                      <option :value="agent.id" x-text="agent.name"></option>
                    </template>
                  </optgroup>
                </template>
              </select>
              <!-- ÏßÅÏ†ë Ï†ÑÎã¨ Î™®Îìú ÏïàÎÇ¥ -->
              <p x-show="targetAgentId"
                 x-transition:enter="transition ease-out duration-150"
                 x-transition:enter-start="opacity-0 translate-y-1"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 class="text-[11px] text-hq-yellow font-medium">
                üìå ÏßÅÏ†ë Ï†ÑÎã¨: <span x-text="targetAgentId"></span>ÏóêÍ≤å Î∞îÎ°ú Ï†ÑÏÜ°
              </p>
            </div>
            <!-- Î∞∞Ïπò ÏßÑÌñâ ÏÉÅÌÉú Î∞∞ÎÑà (Î™®Î∞îÏùºÏóêÏÑú ÏÉÅÎã® ÌëúÏãú) -->
            <div x-show="batchProgress.active" x-transition
                 class="px-3 py-1.5 mb-1.5 rounded-lg bg-hq-yellow/10 border border-hq-yellow/30 text-xs flex items-center gap-2">
              <span class="w-1.5 h-1.5 rounded-full bg-hq-yellow animate-pulse shrink-0"></span>
              <span class="text-hq-yellow font-medium shrink-0" x-text="batchProgress.step"></span>
              <span class="text-hq-muted truncate flex-1 min-w-0" x-text="batchProgress.message"></span>
              <span class="font-mono text-hq-muted shrink-0" x-text="batchProgress.elapsed"></span>
            </div>
            <div class="flex items-end gap-2 sm:gap-3">
              <!-- Batch/Ïã§ÏãúÍ∞Ñ ÏÑ∏Í∑∏Î®ºÌä∏ ÌÜ†Í∏Ä -->
              <div class="flex rounded-xl border border-hq-border/40 overflow-hidden shrink-0 self-stretch">
                <button @click="useBatch = false"
                        class="text-xs px-2 sm:px-3 py-2 transition-all"
                        :class="!useBatch
                          ? 'bg-hq-accent/15 text-hq-accent'
                          : 'text-hq-muted/60 hover:text-hq-muted'">‚ö°<span class="hidden sm:inline"> Ïã§ÏãúÍ∞Ñ</span></button>
                <button @click="useBatch = true"
                        class="text-xs px-2 sm:px-3 py-2 transition-all"
                        :class="useBatch
                          ? 'bg-hq-purple/15 text-hq-purple'
                          : 'text-hq-muted/60 hover:text-hq-muted'">üì¶<span class="hidden sm:inline"> Batch</span></button>
              </div>
              <div class="flex-1 relative">
                <textarea x-model="inputText" x-ref="inputArea"
                  @keydown="handleInputKeydown($event)" @input="handleInputChange($event)"
                  :placeholder="systemStatus === 'working' ? 'Î™ÖÎ†π ÎåÄÍ∏∞Ïó¥Ïóê Ï∂îÍ∞ÄÎê©ÎãàÎã§...' : inputHints[inputHintIndex]"
                  rows="1"
                  class="w-full bg-hq-bg border-2 border-hq-border-light rounded-xl px-4 py-3 pr-10 text-sm text-hq-text
                         placeholder-hq-muted/70 focus:outline-none focus:border-hq-accent/60 input-glow-animated
                         disabled:opacity-40 disabled:cursor-not-allowed transition-all resize-none overflow-hidden
                         shadow-sm"
                  style="min-height:44px; max-height:200px;" autofocus></textarea>
                <div class="absolute right-3 bottom-3 text-[10px] font-mono text-hq-muted/70"
                     x-show="!inputText.trim() && systemStatus !== 'working'">Enter &#9166;</div>
              </div>
              <button @click="sendMessage()"
                :disabled="!inputText.trim()"
                :class="inputText.trim()
                  ? (systemStatus === 'working'
                    ? 'bg-gradient-to-r from-hq-yellow/80 to-amber-500/80 hover:from-hq-yellow hover:to-amber-500 text-black shadow-lg shadow-hq-yellow/30'
                    : 'bg-gradient-to-r from-hq-green/80 to-hq-cyan/80 hover:from-hq-green hover:to-hq-cyan text-black shadow-lg shadow-hq-green/30 hover:shadow-xl hover:shadow-hq-green/40')
                  : 'border-2 border-hq-accent/30 bg-hq-accent/10 text-hq-accent/40'"
                class="rounded-full w-12 h-12 flex items-center justify-center transition-all shrink-0"
                :title="systemStatus === 'working' ? 'ÎåÄÍ∏∞Ïó¥Ïóê Ï∂îÍ∞Ä' : 'Î≥¥ÎÇ¥Í∏∞'">
                <svg x-show="systemStatus !== 'working'" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5L12 3m0 0l7.5 7.5M12 3v18"/>
                </svg>
                <svg x-show="systemStatus === 'working'" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
              </button>
              <button x-show="systemStatus === 'working'" @click="cancelTask()"
                class="bg-hq-red/20 border border-hq-red/30 hover:bg-hq-red/30
                       text-hq-red rounded-xl px-6 py-3 text-sm font-semibold transition-all shrink-0 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                Ï∑®ÏÜå
              </button>
            </div>
          </div>
          <!-- ÌïòÎã® Ìà¥Î∞î: ÎÇ¥Î∂ÄÌÜµÏã† + ÌîÑÎ¶¨ÏÖã + ÎÇ¥Î≥¥ÎÇ¥Í∏∞/ÎπÑÏö∞Í∏∞ Ìïú Ìñâ -->
          <div class="flex items-center gap-2 flex-wrap mt-2 max-w-4xl mx-auto overflow-x-auto scrollbar-thin">
            <!-- ÎÇ¥Î∂ÄÌÜµÏã† Î≤ÑÌäº ÏÇ≠Ï†úÎê® (DÏïà, 2026-02-23) -->
            <template x-for="p in presets.items" :key="p.name">
              <button @click="sendPreset(p.command)"
                      class="text-[11px] bg-hq-panel border border-hq-border rounded-lg px-2.5 py-1 hover:border-hq-accent/40 hover:text-hq-accent transition text-hq-muted whitespace-nowrap shrink-0">
                <span x-text="p.name"></span>
              </button>
            </template>
            <button x-show="presets.items && presets.items.length > 0" @click="presets.showModal = true" class="text-[11px] text-hq-muted/80 hover:text-hq-accent transition px-1 shrink-0">
              <svg class="w-3.5 h-3.5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
            </button>
            <!-- ÎåÄÌôî ÏÑ∏ÏÖò Î≤ÑÌäº (ÏÉà ÎåÄÌôî + Î™©Î°ù + ÌÑ¥ Ïπ¥Ïö¥ÌÑ∞) -->
            <div class="flex items-center gap-2 shrink-0">
              <button @click="showConversationDrawer = !showConversationDrawer"
                      class="text-[10px] flex items-center gap-1 transition border rounded-lg px-2 py-1"
                      :class="showConversationDrawer ? 'border-hq-accent/40 text-hq-accent' : 'border-hq-border text-hq-muted hover:text-hq-text'">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/></svg>
                ÎåÄÌôîÎ™©Î°ù
              </button>
              <button @click="newConversation()"
                      class="text-[10px] text-hq-accent hover:text-hq-accent/80 flex items-center gap-1 transition border border-hq-accent/30 rounded-lg px-2 py-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                ÏÉà ÎåÄÌôî
              </button>
              <span x-show="conversationTurnCount > 0"
                    class="text-[9px] font-mono text-hq-muted/60 bg-hq-surface rounded px-1.5 py-0.5"
                    x-text="conversationTurnCount + 'ÌÑ¥'"></span>
            </div>
            <!-- ÎåÄÌôî ÎÇ¥Î≥¥ÎÇ¥Í∏∞ + ÎπÑÏö∞Í∏∞ (Ïò§Î•∏Ï™Ω ÎÅù) -->
            <div x-show="messages.length > 0" class="flex items-center gap-2 ml-auto shrink-0">
              <button @click="exportConversation()"
                      class="text-[10px] text-hq-muted/70 hover:text-hq-accent flex items-center gap-1 transition">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                ÎÇ¥Î≥¥ÎÇ¥Í∏∞
              </button>
              <span class="text-hq-border">|</span>
              <button @click="clearConversation()"
                      class="text-[10px] text-hq-muted/70 hover:text-hq-red flex items-center gap-1 transition">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                ÎåÄÌôî ÎπÑÏö∞Í∏∞
              </button>
            </div>
          </div>
        </div>
      <!-- ÎåÄÌôî Î™©Î°ù ÏÑúÎûç (Conversation List Drawer) -->
      <div x-show="showConversationDrawer" x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 -translate-x-full" x-transition:enter-end="opacity-100 translate-x-0"
           x-transition:leave="transition ease-in duration-150"
           x-transition:leave-start="opacity-100 translate-x-0" x-transition:leave-end="opacity-0 -translate-x-full"
           class="fixed inset-y-0 left-0 z-50 w-72 bg-hq-surface border-r border-hq-border shadow-2xl flex flex-col"
           @click.outside="showConversationDrawer = false" x-cloak>
        <div class="p-4 border-b border-hq-border flex items-center justify-between">
          <h3 class="text-sm font-bold text-hq-text">ÎåÄÌôî Î™©Î°ù</h3>
          <button @click="showConversationDrawer = false" class="text-hq-muted hover:text-hq-text">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>
        <div class="p-2 border-b border-hq-border">
          <button @click="newConversation(); showConversationDrawer = false"
                  class="w-full text-xs text-hq-accent hover:bg-hq-accent/10 flex items-center gap-2 transition rounded-lg px-3 py-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
            ÏÉà ÎåÄÌôî ÏãúÏûë
          </button>
        </div>
        <div class="flex-1 overflow-y-auto scrollbar-thin p-2 space-y-1">
          <template x-for="conv in conversationList" :key="conv.conversation_id">
            <div @click="switchConversation(conv.conversation_id)"
                 :class="currentConversationId === conv.conversation_id ? 'bg-hq-accent/10 border-hq-accent/30' : 'border-transparent hover:bg-hq-panel'"
                 class="rounded-lg border px-3 py-2 cursor-pointer transition group">
              <div class="text-xs text-hq-text font-medium truncate" x-text="conv.title"></div>
              <div class="flex items-center gap-2 mt-1">
                <span class="text-[9px] text-hq-muted font-mono" x-text="(conv.turn_count || 0) + 'ÌÑ¥'"></span>
                <span class="text-[9px] text-hq-muted" x-text="new Date(conv.updated_at).toLocaleDateString('ko-KR')"></span>
                <span x-show="conv.total_cost > 0" class="text-[9px] text-hq-muted font-mono" x-text="'$' + (conv.total_cost || 0).toFixed(3)"></span>
                <button @click.stop="deleteConversationSession(conv.conversation_id)"
                        class="ml-auto text-hq-muted/50 hover:text-hq-red opacity-0 group-hover:opacity-100 transition">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
              </div>
            </div>
          </template>
          <template x-if="conversationList.length === 0">
            <div class="text-xs text-hq-muted/60 text-center py-8">ÎåÄÌôî Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>
          </template>
        </div>
      </div>

      </div><!-- /command tab -->

      <!-- ‚ïê‚ïê‚ïê Tab: ÏÑ±Îä• (Performance) ‚ïê‚ïê‚ïê -->
      <template x-if="viewMode === 'chat' && activeTab === 'performance'"><div class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
        <div class="max-w-5xl mx-auto fade-in-up">
          <div class="flex items-center justify-between mb-4 md:mb-6">
            <div>
              <h1 class="text-lg md:text-xl font-bold text-hq-text mb-1 font-mono tracking-normal">POWER ANALYSIS</h1>
              <p class="text-xs md:text-sm text-hq-muted">ÏóêÏù¥Ï†ÑÌä∏Î≥Ñ ÏûëÏóÖ ÌÜµÍ≥ÑÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
            </div>
            <button @click="performance.loaded = false; loadPerformance()"
                    class="bg-hq-surface border border-hq-border rounded-lg px-3 py-1.5 text-xs text-hq-muted hover:text-hq-text transition flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              ÏÉàÎ°úÍ≥†Ïπ®
            </button>
          </div>

          <!-- Performance Summary Cards -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-4 md:mb-6">
            <div class="glass border border-hq-border rounded-xl p-4">
              <div class="text-xl font-bold text-hq-text" x-text="performance.totalCalls || 0"></div>
              <div class="text-[10px] text-hq-muted uppercase">Ï¥ù LLM Ìò∏Ï∂ú</div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4">
              <div class="text-xl font-bold text-hq-green" x-text="'$' + (performance.totalCost || 0).toFixed(4)"></div>
              <div class="text-[10px] text-hq-muted uppercase">Ï¥ù ÎπÑÏö©</div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4">
              <div class="text-xl font-bold text-hq-text" x-text="performance.totalTasks || 0"></div>
              <div class="text-[10px] text-hq-muted uppercase">Ï¥ù ÏûëÏóÖ</div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4">
              <div class="text-xl font-bold text-hq-cyan" x-text="(performance.avgSuccessRate || 0).toFixed(0) + '%'"></div>
              <div class="text-[10px] text-hq-muted uppercase">ÌèâÍ∑† ÏÑ±Í≥µÎ•†</div>
            </div>
          </div>

          <!-- Agent Performance Table -->
          <div class="flex items-center gap-2 mb-2 px-1">
            <svg class="w-4 h-4 text-hq-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg>
            <span class="text-xs text-hq-muted">Í∞Å ÌåÄÏû•Ïùò <span class="text-hq-purple font-semibold">Í∏∞Ïñµ</span> Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ Ïû•Í∏∞Í∏∞ÏñµÏùÑ Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§</span>
          </div>
          <div class="glass border border-hq-border rounded-xl overflow-x-auto">
            <table class="w-full text-sm min-w-[600px]">
              <thead>
                <tr class="border-b border-hq-border text-[11px] text-hq-muted uppercase">
                  <th class="text-left px-4 py-3">ÏóêÏù¥Ï†ÑÌä∏</th>
                  <th class="text-right px-4 py-3">Ìò∏Ï∂ú</th>
                  <th class="text-right px-4 py-3">ÎπÑÏö©</th>
                  <th class="text-right px-4 py-3">ÏûëÏóÖ</th>
                  <th class="text-right px-4 py-3">ÏÑ±Í≥µÎ•†</th>
                  <th class="text-right px-4 py-3">ÌèâÍ∑† ÏãúÍ∞Ñ</th>
                  <th class="px-4 py-3 w-32">ÎπÑÏö© ÎπÑÏú®</th>
                  <th class="px-4 py-3">Í∏∞Ïñµ</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="a in performance.agents" :key="a.agent_id">
                  <tr class="border-b border-hq-border/50 hover:bg-hq-panel/20">
                    <td class="px-4 py-2.5">
                      <div class="text-hq-text font-medium" x-text="a.name_ko"></div>
                      <div class="text-[10px] text-hq-muted" x-text="a.role"></div>
                    </td>
                    <td class="text-right px-4 py-2.5 font-mono text-hq-text" x-text="a.llm_calls"></td>
                    <td class="text-right px-4 py-2.5 font-mono text-hq-green" x-text="'$' + (a.cost_usd || 0).toFixed(4)"></td>
                    <td class="text-right px-4 py-2.5 font-mono text-hq-text" x-text="a.tasks_completed"></td>
                    <td class="text-right px-4 py-2.5">
                      <span class="font-mono" :class="(a.success_rate||0) >= 80 ? 'text-hq-green' : (a.success_rate||0) >= 50 ? 'text-hq-yellow' : 'text-hq-red'"
                            x-text="(a.success_rate || 0).toFixed(0) + '%'"></span>
                    </td>
                    <td class="text-right px-4 py-2.5 text-hq-muted" x-text="(a.avg_execution_seconds || 0).toFixed(1) + 'Ï¥à'"></td>
                    <td class="px-4 py-2.5">
                      <div class="h-2 bg-hq-bg rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-hq-accent to-hq-cyan rounded-full transition-all"
                             :style="'width:' + (performance.maxCost > 0 ? ((a.cost_usd || 0) / performance.maxCost * 100) : 0) + '%'"></div>
                      </div>
                    </td>
                    <td class="px-4 py-2.5 text-center">
                      <button @click="openMemoryModal(a.agent_id, a.name_ko)"
                              class="text-xs px-3 py-1.5 rounded-lg border border-hq-purple/40 text-hq-purple hover:bg-hq-purple/20 transition font-semibold flex items-center gap-1">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg>
                        Í∏∞Ïñµ
                      </button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
            <template x-if="!performance.agents || performance.agents.length === 0">
              <div class="text-center py-12 text-hq-muted/80 text-sm">ÏÑ±Îä• Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÏûëÏóÖÏùÑ Ïã§ÌñâÌïòÎ©¥ ÌÜµÍ≥ÑÍ∞Ä ÏåìÏûÖÎãàÎã§.</div>
            </template>
          </div>

          <!-- ÌíàÏßà ÎåÄÏãúÎ≥¥Îìú (Phase 11) -->
          <div class="mt-6 glass border border-hq-border rounded-xl p-4">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-sm font-bold text-hq-text font-mono">QUALITY DASHBOARD</h3>
              <button @click="loadQualityDashboard()"
                      class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-hq-cyan/20 text-hq-cyan hover:bg-hq-cyan/30 transition">ÏÉàÎ°úÍ≥†Ïπ®</button>
            </div>

            <!-- ÌíàÏßà ÏöîÏïΩ Ïπ¥Îìú -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
              <div class="bg-hq-bg rounded-lg p-3 text-center">
                <div class="text-lg font-bold text-hq-text" x-text="qualityDash.totalReviews"></div>
                <div class="text-[10px] text-hq-muted">Ï¥ù Í≤ÄÏàò</div>
              </div>
              <div class="bg-hq-bg rounded-lg p-3 text-center">
                <div class="text-lg font-bold text-hq-green" x-text="qualityDash.passRate + '%'"></div>
                <div class="text-[10px] text-hq-muted">Ìï©Í≤©Î•†</div>
              </div>
              <div class="bg-hq-bg rounded-lg p-3 text-center">
                <div class="text-lg font-bold text-hq-cyan" x-text="qualityDash.avgScore"></div>
                <div class="text-[10px] text-hq-muted">ÌèâÍ∑† Ï†êÏàò</div>
              </div>
              <div class="bg-hq-bg rounded-lg p-3 text-center">
                <div class="text-lg font-bold text-hq-red" x-text="qualityDash.failed"></div>
                <div class="text-[10px] text-hq-muted">Î∞òÎ†§ ÌöüÏàò</div>
              </div>
            </div>

            <!-- Ï†êÏàò Ï∂îÏù¥ Ï∞®Ìä∏ -->
            <div class="bg-hq-bg rounded-lg p-3 mb-3" style="height:200px">
              <canvas id="qualityScoreChart"></canvas>
            </div>

            <!-- Î∞òÎ≥µ Î∞òÎ†§ Ìï≠Î™© Top 5 -->
            <template x-if="qualityDash.topRejections.length > 0">
              <div>
                <div class="text-[10px] text-hq-muted uppercase mb-1">Î∞òÎ≥µ Î∞òÎ†§ Top 5</div>
                <template x-for="r in qualityDash.topRejections" :key="r.target_id + r.reason">
                  <div class="flex items-center gap-2 text-xs py-1 border-b border-hq-border/20">
                    <span class="text-hq-red font-mono" x-text="r.count + 'Ìöå'"></span>
                    <span class="text-hq-accent" x-text="r.target_id"></span>
                    <span class="text-hq-muted truncate" x-text="r.reason"></span>
                  </div>
                </template>
              </div>
            </template>
          </div>

          <!-- Soul ÏûêÎèô ÏßÑÌôî ÏÑπÏÖò -->
          <div class="mt-6 glass border border-hq-border rounded-xl p-4">
            <div class="flex items-center justify-between mb-3">
              <div>
                <h3 class="text-sm font-bold text-hq-text font-mono">SOUL EVOLUTION</h3>
                <p class="text-[10px] text-hq-muted">Î∞òÎ†§ ÌïôÏäµ Ìå®ÌÑ¥ Î∂ÑÏÑù ‚Üí ÏÜåÏö∏ ÏûêÎèô Í∞úÏÑ† Ï†úÏïà (Îß§Ï£º ÏùºÏöîÏùº 03:00)</p>
              </div>
              <button @click="soulEvolution.loading = true; fetch('/api/soul-evolution/run', {method:'POST'}).then(r => r.json()).then(d => { soulEvolution.loading = false; soulEvolution.message = d.message || 'Î∂ÑÏÑù ÏãúÏûëÎê®'; setTimeout(() => loadSoulEvolutionProposals(), 3000); })"
                      :disabled="soulEvolution.loading"
                      class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-hq-purple/20 text-hq-purple hover:bg-hq-purple/30 transition disabled:opacity-50">
                <span x-show="!soulEvolution.loading">ÏàòÎèô Î∂ÑÏÑù</span>
                <span x-show="soulEvolution.loading">Î∂ÑÏÑù Ï§ë...</span>
              </button>
            </div>
            <div x-show="soulEvolution.message" class="text-xs text-hq-cyan mb-2" x-text="soulEvolution.message"></div>

            <!-- ÎåÄÍ∏∞ Ï§ëÏù∏ Ï†úÏïà Î™©Î°ù -->
            <template x-if="soulEvolution.proposals.length > 0">
              <div class="space-y-3">
                <template x-for="(p, idx) in soulEvolution.proposals" :key="p.id">
                  <div class="bg-hq-bg rounded-lg p-3 border border-hq-border/50">
                    <div class="flex items-center justify-between mb-2">
                      <div>
                        <span class="text-xs font-bold text-hq-accent" x-text="p.agent_name"></span>
                        <span class="text-[10px] text-hq-muted ml-2 font-mono" x-text="p.agent_id"></span>
                      </div>
                      <span class="text-[10px] text-hq-muted" x-text="p.created_at"></span>
                    </div>
                    <div class="text-[10px] text-hq-muted mb-1">Î∞òÎ†§ Í∏∞Î°ù:</div>
                    <div class="text-xs text-hq-yellow bg-hq-yellow/5 rounded p-2 mb-2 font-mono leading-relaxed max-h-16 overflow-y-auto" x-text="p.warnings"></div>
                    <div class="text-[10px] text-hq-muted mb-1">Ï†úÏïà:</div>
                    <div class="text-xs text-hq-text bg-hq-bg rounded p-2 mb-3 border border-hq-border/30 leading-relaxed max-h-32 overflow-y-auto whitespace-pre-wrap" x-text="p.proposed_change"></div>
                    <div class="flex gap-2" x-show="p.status === 'pending'">
                      <button @click="fetch('/api/soul-evolution/approve/' + p.id, {method:'POST'}).then(r => r.json()).then(d => { if(d.success) { p.status = 'approved'; soulEvolution.message = d.message; } })"
                              class="flex-1 py-1.5 text-xs font-semibold rounded-lg bg-hq-green/20 text-hq-green hover:bg-hq-green/30 transition">ÏäπÏù∏ (ÏÜåÏö∏ ÏóÖÎç∞Ïù¥Ìä∏)</button>
                      <button @click="fetch('/api/soul-evolution/reject/' + p.id, {method:'POST'}).then(r => r.json()).then(d => { if(d.success) { p.status = 'rejected'; soulEvolution.message = 'Í±∞Î∂ÄÎê®'; } })"
                              class="flex-1 py-1.5 text-xs font-semibold rounded-lg bg-hq-red/20 text-hq-red hover:bg-hq-red/30 transition">Í±∞Î∂Ä</button>
                    </div>
                    <div x-show="p.status === 'approved'" class="text-xs text-hq-green font-semibold text-center py-1">ÏäπÏù∏Îê®</div>
                    <div x-show="p.status === 'rejected'" class="text-xs text-hq-red font-semibold text-center py-1">Í±∞Î∂ÄÎê®</div>
                  </div>
                </template>
              </div>
            </template>
            <template x-if="soulEvolution.proposals.length === 0">
              <div class="text-center py-4 text-hq-muted/60 text-xs">ÎåÄÍ∏∞ Ï§ëÏù∏ Ï†úÏïàÏù¥ ÏóÜÏäµÎãàÎã§.</div>
            </template>
          </div>
        </div>

          <!-- Soul Gym Í≤ΩÏüÅ ÏßÑÌôî ÏÑπÏÖò -->
          <div class="mt-6 glass border border-hq-border rounded-xl p-4"
               x-data="{
                 gymStatus: { idle: true, running_all: false, running_agents: [] },
                 gymHistory: [],
                 gymLoading: false,
                 gymMessage: '',
                 gymConfig: {},
                 async loadGymStatus() {
                   try {
                     const r = await fetch('/api/soul-gym/status');
                     this.gymStatus = await r.json();
                   } catch(e) {}
                 },
                 async loadGymHistory() {
                   try {
                     const r = await fetch('/api/soul-gym/history?limit=20');
                     const d = await r.json();
                     this.gymHistory = d.history || [];
                   } catch(e) {}
                 },
                 async loadGymConfig() {
                   try {
                     const r = await fetch('/api/soul-gym/config');
                     this.gymConfig = await r.json();
                   } catch(e) {}
                 },
                 async evolveAll(dryRun) {
                   this.gymLoading = true;
                   this.gymMessage = '';
                   try {
                     const r = await fetch('/api/soul-gym/evolve-all', {
                       method: 'POST',
                       headers: {'Content-Type':'application/json'},
                       body: JSON.stringify({dry_run: dryRun})
                     });
                     const d = await r.json();
                     this.gymMessage = d.message || (d.success ? 'ÏßÑÌôî ÏãúÏûëÎê®' : 'Ïã§Ìå®');
                     if (!dryRun) { setTimeout(() => { this.loadGymHistory(); this.loadGymStatus(); }, 5000); }
                   } catch(e) { this.gymMessage = 'Ïò§Î•ò: ' + e.message; }
                   this.gymLoading = false;
                 },
                 init() { this.loadGymStatus(); this.loadGymHistory(); this.loadGymConfig(); }
               }">
            <div class="flex items-center justify-between mb-3">
              <div>
                <h3 class="text-sm font-bold text-hq-text font-mono">SOUL GYM</h3>
                <p class="text-[10px] text-hq-muted">Ìà¨ÏûêÌåÄÏû• ÏÜåÏö∏ Í≤ΩÏüÅ ÏßÑÌôî (flash2.5 ¬∑ Î™®ÏùòÌà¨Ïûê ¬∑ ÏûêÎèô Ï±ÑÌÉù ¬∑ Îß§Ï£º ÏõîÏöîÏùº 03:00)</p>
              </div>
              <div class="flex gap-2">
                <button @click="evolveAll(true)"
                        :disabled="gymLoading || gymStatus.running_all"
                        class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-hq-cyan/20 text-hq-cyan hover:bg-hq-cyan/30 transition disabled:opacity-50">
                  Dry Run
                </button>
                <button @click="evolveAll(false)"
                        :disabled="gymLoading || gymStatus.running_all"
                        class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-hq-green/20 text-hq-green hover:bg-hq-green/30 transition disabled:opacity-50">
                  <span x-show="!gymStatus.running_all">Ï†ÑÏ≤¥ ÏßÑÌôî</span>
                  <span x-show="gymStatus.running_all">ÏßÑÌôî Ï§ë...</span>
                </button>
              </div>
            </div>

            <!-- ÏÉÅÌÉú/Î©îÏãúÏßÄ -->
            <div x-show="gymMessage" class="text-xs text-hq-cyan mb-2" x-text="gymMessage"></div>
            <div x-show="gymStatus.running_all" class="text-xs text-hq-yellow mb-2 animate-pulse">Í≤ΩÏüÅ ÏßÑÌôî ÏßÑÌñâ Ï§ë...</div>

            <!-- ÏÑ§Ï†ï ÏöîÏïΩ -->
            <div class="flex gap-4 text-[10px] text-hq-muted mb-3 font-mono">
              <span>Î™®Îç∏: <span class="text-hq-accent" x-text="gymConfig.gym_model || '-'"></span></span>
              <span>ÏûÑÍ≥ÑÍ∞í: <span class="text-hq-accent" x-text="'+' + (gymConfig.min_improvement || 3) + 'Ï†ê'"></span></span>
              <span>ÎπÑÏö©Ï∫°: <span class="text-hq-accent" x-text="'$' + (gymConfig.cost_cap_usd || 20)"></span></span>
            </div>

            <!-- ÏßÑÌôî Í∏∞Î°ù ÌÖåÏù¥Î∏î -->
            <template x-if="gymHistory.length > 0">
              <div class="overflow-x-auto">
                <table class="w-full text-xs">
                  <thead>
                    <tr class="text-hq-muted border-b border-hq-border/30">
                      <th class="text-left py-1.5 pr-3">ÏóêÏù¥Ï†ÑÌä∏</th>
                      <th class="text-center py-1.5 px-2">R</th>
                      <th class="text-center py-1.5 px-2">Í≤∞Í≥º</th>
                      <th class="text-center py-1.5 px-2">Ï†êÏàò</th>
                      <th class="text-center py-1.5 px-2">Î≥ÄÌôî</th>
                      <th class="text-center py-1.5 px-2">ÎπÑÏö©</th>
                      <th class="text-right py-1.5 pl-2">ÎÇ†Ïßú</th>
                    </tr>
                  </thead>
                  <tbody>
                    <template x-for="h in gymHistory" :key="h.id">
                      <tr class="border-b border-hq-border/10 hover:bg-hq-accent/5">
                        <td class="py-1.5 pr-3 font-semibold text-hq-text" x-text="h.agent_name || h.agent_id"></td>
                        <td class="text-center py-1.5 px-2 font-mono text-hq-muted" x-text="'R' + h.round_num"></td>
                        <td class="text-center py-1.5 px-2">
                          <span x-show="h.winner !== 'original'" class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-hq-green/20 text-hq-green" x-text="h.winner"></span>
                          <span x-show="h.winner === 'original'" class="px-1.5 py-0.5 rounded text-[10px] bg-hq-muted/10 text-hq-muted">Ïú†ÏßÄ</span>
                        </td>
                        <td class="text-center py-1.5 px-2 font-mono" x-text="h.score_before.toFixed(0) + '‚Üí' + h.score_after.toFixed(0)"></td>
                        <td class="text-center py-1.5 px-2 font-mono font-bold"
                            :class="h.improvement > 0 ? 'text-hq-green' : h.improvement < 0 ? 'text-hq-red' : 'text-hq-muted'"
                            x-text="(h.improvement > 0 ? '+' : '') + h.improvement.toFixed(0)"></td>
                        <td class="text-center py-1.5 px-2 font-mono text-hq-muted" x-text="'$' + h.cost_usd.toFixed(2)"></td>
                        <td class="text-right py-1.5 pl-2 text-[10px] text-hq-muted" x-text="h.created_at ? h.created_at.slice(5,16) : ''"></td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </template>
            <template x-if="gymHistory.length === 0">
              <div class="text-center py-4 text-hq-muted/60 text-xs">ÏïÑÏßÅ ÏßÑÌôî Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§. Ï≤´ Dry RunÏùÑ Ïã§ÌñâÌï¥Î≥¥ÏÑ∏Ïöî.</div>
            </template>
          </div>

          <!-- ÏßÑÌôî Ïã§ÏãúÍ∞Ñ Î°úÍ∑∏ (N-4) -->
          <div class="mt-6 glass border border-hq-border rounded-xl p-4">
            <div class="flex items-center justify-between mb-3">
              <div>
                <h3 class="text-sm font-bold text-hq-text font-mono">EVOLUTION LOG</h3>
                <p class="text-[10px] text-hq-muted">ÏßÑÌôî ÏãúÏä§ÌÖú Ïã§ÏãúÍ∞Ñ Î°úÍ∑∏ ‚Äî ÌÖîÎ†àÍ∑∏Îû® ÏïåÎ¶º ÎåÄÏã† ÏõπÏóêÏÑú ÌôïÏù∏</p>
              </div>
              <button @click="loadEvolutionLogs()" class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-hq-green/20 text-hq-green hover:bg-hq-green/30 transition">ÏÉàÎ°úÍ≥†Ïπ®</button>
            </div>
            <div class="bg-hq-bg rounded-lg border border-hq-border/50 max-h-60 overflow-y-auto scrollbar-thin">
              <template x-if="evolutionLogs.length > 0">
                <div class="divide-y divide-hq-border/30">
                  <template x-for="(log, idx) in evolutionLogs" :key="idx">
                    <div class="px-3 py-2 flex items-start gap-2 text-xs hover:bg-hq-surface/30 transition">
                      <span class="font-mono text-hq-muted/70 shrink-0 w-12" x-text="log.time"></span>
                      <span class="w-1.5 h-1.5 rounded-full mt-1.5 shrink-0"
                            :class="log.level === 'error' ? 'bg-hq-red' : log.level === 'warning' ? 'bg-hq-yellow' : 'bg-hq-green'"></span>
                      <span class="text-hq-text/90 leading-relaxed" x-text="log.message"></span>
                    </div>
                  </template>
                </div>
              </template>
              <template x-if="evolutionLogs.length === 0">
                <div class="text-center py-6 text-hq-muted/60 text-xs">ÏïÑÏßÅ ÏßÑÌôî Î°úÍ∑∏Í∞Ä ÏóÜÏäµÎãàÎã§. Soul GymÏù¥ Ïã§ÌñâÎêòÎ©¥ Ïó¨Í∏∞Ïóê Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§.</div>
              </template>
            </div>
          </div>

        </div>
      </div></template>

      <!-- ‚ïê‚ïê‚ïê Tab: ÏïÑÌÇ§ÌÖçÏ≤ò Îßµ (Architecture Map) ‚ïê‚ïê‚ïê -->
      <template x-if="viewMode === 'chat' && activeTab === 'archmap'"><div class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
        <div class="max-w-6xl mx-auto fade-in-up">

          <!-- Ìó§Îçî -->
          <div class="flex items-center justify-between mb-4">
            <div>
              <h1 class="text-lg md:text-xl font-bold text-hq-text mb-1 font-mono tracking-normal">ARCHITECTURE MAP</h1>
              <p class="text-xs md:text-sm text-hq-muted">CORTHEX HQ ÏóêÏù¥Ï†ÑÌä∏ Ï°∞ÏßÅÎèÑ ¬∑ Ïã§ÏãúÍ∞Ñ ÏÉÅÌÉú ¬∑ ÎπÑÏö© Î∂ÑÏÑù</p>
            </div>
          </div>

          <!-- Ïù¥Î≤à Îã¨ AI ÎπÑÏö© Ï¥ùÏï° (ÌûàÏñ¥Î°ú Ïπ¥Îìú) -->
          <div class="glass border border-hq-accent/30 rounded-2xl p-6 mb-6 relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-hq-accent/5 to-hq-purple/5"></div>
            <div class="relative flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
              <div>
                <div class="text-xs text-hq-muted uppercase tracking-wider mb-1" x-text="archMap.costSummary?.month_label || 'Ïù¥Î≤à Îã¨'"></div>
                <div class="text-4xl md:text-5xl font-bold font-mono text-hq-accent" x-text="'$' + (archMap.costSummary?.monthly_cost_usd || 0).toFixed(2)"></div>
                <div class="text-xs text-hq-muted mt-1">AI ÎπÑÏö© Ï¥ùÏï°</div>
              </div>
              <div class="flex gap-6">
                <div class="text-center">
                  <div class="text-lg font-bold font-mono text-hq-green" x-text="'$' + (archMap.costSummary?.today_cost_usd || 0).toFixed(4)"></div>
                  <div class="text-[10px] text-hq-muted">Ïò§Îäò</div>
                </div>
                <div class="text-center">
                  <div class="text-lg font-bold font-mono text-hq-cyan" x-text="'$' + (archMap.costSummary?.daily_avg_usd || 0).toFixed(4)"></div>
                  <div class="text-[10px] text-hq-muted">Ïùº ÌèâÍ∑†</div>
                </div>
                <div class="text-center">
                  <div class="text-lg font-bold font-mono text-hq-text" x-text="archMap.hierarchy?.total_agents || 0"></div>
                  <div class="text-[10px] text-hq-muted">ÏóêÏù¥Ï†ÑÌä∏</div>
                </div>
              </div>
            </div>
          </div>

          <!-- ÏÑúÎ∏åÌÉ≠ -->
          <div class="flex gap-1 mb-4 border-b border-hq-border">
            <button @click="archMap.subTab = 'orgchart'; $nextTick(() => renderMermaidOrgChart())"
                    :class="archMap.subTab === 'orgchart' ? 'text-hq-accent border-hq-accent' : 'text-hq-muted border-transparent hover:text-hq-text'"
                    class="px-4 py-2 text-xs font-semibold border-b-2 transition">Ï°∞ÏßÅÎèÑ</button>
            <button @click="archMap.subTab = 'status'"
                    :class="archMap.subTab === 'status' ? 'text-hq-accent border-hq-accent' : 'text-hq-muted border-transparent hover:text-hq-text'"
                    class="px-4 py-2 text-xs font-semibold border-b-2 transition">Ïã§ÏãúÍ∞Ñ ÌòÑÌô©</button>
            <button @click="archMap.subTab = 'cost'; $nextTick(() => renderCostCharts())"
                    :class="archMap.subTab === 'cost' ? 'text-hq-accent border-hq-accent' : 'text-hq-muted border-transparent hover:text-hq-text'"
                    class="px-4 py-2 text-xs font-semibold border-b-2 transition">ÎπÑÏö© Î∂ÑÏÑù</button>
          </div>

          <!-- ÏÑúÎ∏åÌÉ≠ 1: Ï°∞ÏßÅÎèÑ -->
          <div x-show="archMap.subTab === 'orgchart'" x-transition>
            <div class="glass border border-hq-border rounded-xl p-4 overflow-x-auto">
              <div class="flex items-center gap-2 mb-3">
                <span class="text-xs text-hq-muted">ÏóêÏù¥Ï†ÑÌä∏Î•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÇ¨Î†πÍ¥ÄÏã§ÏóêÏÑú ÏßÅÏ†ë ÎåÄÌôîÌï† Ïàò ÏûàÏäµÎãàÎã§</span>
              </div>
              <div id="mermaid-orgchart" class="min-h-[400px] flex items-center justify-center">
                <template x-if="!archMap.mermaidRendered">
                  <div class="text-hq-muted text-sm animate-pulse">Ï°∞ÏßÅÎèÑ Î†åÎçîÎßÅ Ï§ë...</div>
                </template>
              </div>
            </div>
            <div class="flex flex-wrap gap-3 mt-3">
              <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full" style="background:#FF6B35"></div><span class="text-[10px] text-hq-muted">CEO</span></div>
              <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full" style="background:#FFD200"></div><span class="text-[10px] text-hq-muted">ÎπÑÏÑúÏã§</span></div>
              <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full" style="background:#00E6FF"></div><span class="text-[10px] text-hq-muted">LEET Master Î≥∏Î∂Ä</span></div>
              <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full" style="background:#8C64FF"></div><span class="text-[10px] text-hq-muted">Ìà¨ÏûêÎ∂ÑÏÑù Î≥∏Î∂Ä</span></div>
              <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full" style="background:#00FF88"></div><span class="text-[10px] text-hq-muted">Ï∂úÌåêÍ∏∞Î°ù Î≥∏Î∂Ä</span></div>
            </div>
          </div>

          <!-- ÏÑúÎ∏åÌÉ≠ 2: Ïã§ÏãúÍ∞Ñ ÌòÑÌô© -->
          <div x-show="archMap.subTab === 'status'" x-transition>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
              <template x-for="dept in [
                {key:'secretary',label:'ÎπÑÏÑúÏã§',color:'hq-yellow',icon:'üèõÔ∏è'},
                {key:'strategy',label:'ÏÇ¨ÏóÖÍ∏∞ÌöçÌåÄÏû•',color:'hq-cyan',icon:'üìä'},
                {key:'legal',label:'Î≤ïÎ¨¥ÌåÄÏû•',color:'hq-cyan',icon:'‚öñÔ∏è'},
                {key:'marketing',label:'ÎßàÏºÄÌåÖÌåÄÏû•',color:'hq-cyan',icon:'üì¢'},
                {key:'finance',label:'Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû•',color:'hq-purple',icon:'üí∞'},
                {key:'publishing',label:'ÏΩòÌÖêÏ∏†ÌåÄÏû•',color:'hq-green',icon:'üìö'},
              ]" :key="dept.key">
                <div class="glass border rounded-xl p-4" :class="'border-' + dept.color + '/20'">
                  <div class="flex items-center gap-2 mb-3">
                    <span x-text="dept.icon"></span>
                    <span class="text-sm font-bold" :class="'text-' + dept.color" x-text="dept.label"></span>
                    <span class="ml-auto text-[10px] px-2 py-0.5 rounded-full"
                          :class="getDeptWorkingCount(dept.key) > 0 ? 'bg-hq-green/20 text-hq-green' : 'bg-hq-border/50 text-hq-muted'"
                          x-text="getDeptWorkingCount(dept.key) > 0 ? getDeptWorkingCount(dept.key) + 'Î™Ö ÏûëÏóÖÏ§ë' : 'ÎåÄÍ∏∞Ï§ë'"></span>
                  </div>
                  <div class="space-y-1.5">
                    <template x-for="aid in getDeptAgents(dept.key)" :key="aid">
                      <div class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-hq-panel/20 cursor-pointer transition"
                           @click="targetAgentId = aid; switchTab('command')">
                        <div class="w-2 h-2 rounded-full shrink-0"
                             :class="activeAgents[aid]?.status === 'working' ? 'bg-hq-green animate-pulse' : 'bg-hq-border'"></div>
                        <span class="text-xs text-hq-text truncate flex-1" x-text="agentNames[aid] || aid"></span>
                        <span class="text-[9px] text-hq-muted font-mono truncate max-w-[100px]" x-text="agentModels[aid] || ''"></span>
                      </div>
                    </template>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- ÏÑúÎ∏åÌÉ≠ 3: ÎπÑÏö© Î∂ÑÏÑù -->
          <div x-show="archMap.subTab === 'cost'" x-transition>
            <div class="flex gap-2 mb-4">
              <button @click="changeCostPeriod('today')"
                      :class="archMap.costPeriod === 'today' ? 'bg-hq-accent/20 text-hq-accent border-hq-accent' : 'text-hq-muted border-hq-border hover:text-hq-text'"
                      class="px-3 py-1.5 text-xs rounded-lg border transition">Ïò§Îäò</button>
              <button @click="changeCostPeriod('month')"
                      :class="archMap.costPeriod === 'month' ? 'bg-hq-accent/20 text-hq-accent border-hq-accent' : 'text-hq-muted border-hq-border hover:text-hq-text'"
                      class="px-3 py-1.5 text-xs rounded-lg border transition">Ïù¥Î≤à Îã¨</button>
              <button @click="changeCostPeriod('all')"
                      :class="archMap.costPeriod === 'all' ? 'bg-hq-accent/20 text-hq-accent border-hq-accent' : 'text-hq-muted border-hq-border hover:text-hq-text'"
                      class="px-3 py-1.5 text-xs rounded-lg border transition">Ï†ÑÏ≤¥</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="glass border border-hq-border rounded-xl p-4">
                <h3 class="text-sm font-bold text-hq-text mb-3">Î∂ÄÏÑúÎ≥Ñ ÎπÑÏö© Î∂ÑÌè¨</h3>
                <div class="h-[280px]"><canvas id="division-cost-chart"></canvas></div>
              </div>
              <div class="glass border border-hq-border rounded-xl p-4">
                <h3 class="text-sm font-bold text-hq-text mb-3">ÏóêÏù¥Ï†ÑÌä∏Î≥Ñ ÎπÑÏö© TOP 10</h3>
                <div class="h-[280px]"><canvas id="agent-cost-chart"></canvas></div>
              </div>
            </div>

            <div class="glass border border-hq-border rounded-xl overflow-x-auto mt-4">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-hq-border text-[11px] text-hq-muted uppercase">
                    <th class="text-left px-4 py-3">Î∂ÄÏÑú</th>
                    <th class="text-right px-4 py-3">ÎπÑÏö©</th>
                    <th class="text-right px-4 py-3">Ìò∏Ï∂ú Ïàò</th>
                    <th class="text-right px-4 py-3">ÏóêÏù¥Ï†ÑÌä∏</th>
                    <th class="px-4 py-3 w-32">ÎπÑÏú®</th>
                  </tr>
                </thead>
                <tbody>
                  <template x-for="d in archMap.costByDivision" :key="d.division">
                    <tr class="border-b border-hq-border/50 hover:bg-hq-panel/20">
                      <td class="px-4 py-2.5 text-hq-text font-medium" x-text="d.label"></td>
                      <td class="text-right px-4 py-2.5 font-mono text-hq-green" x-text="'$' + (d.cost_usd || 0).toFixed(4)"></td>
                      <td class="text-right px-4 py-2.5 font-mono text-hq-text" x-text="d.call_count"></td>
                      <td class="text-right px-4 py-2.5 font-mono text-hq-text" x-text="d.agent_count + 'Î™Ö'"></td>
                      <td class="px-4 py-2.5">
                        <div class="h-2 bg-hq-bg rounded-full overflow-hidden">
                          <div class="h-full bg-gradient-to-r from-hq-accent to-hq-cyan rounded-full transition-all"
                               :style="'width:' + (archMap.costByDivision.length > 0 && archMap.costByDivision[0].cost_usd > 0 ? Math.round(d.cost_usd / archMap.costByDivision[0].cost_usd * 100) : 0) + '%'"></div>
                        </div>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
              <template x-if="!archMap.costByDivision.length">
                <div class="text-center py-8 text-hq-muted/80 text-sm">ÎπÑÏö© Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. AI ÏûëÏóÖÏùÑ Ïã§ÌñâÌïòÎ©¥ ÌÜµÍ≥ÑÍ∞Ä ÏåìÏûÖÎãàÎã§.</div>
              </template>
            </div>
          </div>

        </div>
      </div></template>

      <!-- ‚ïê‚ïê‚ïê Office View (Í∞ÄÏÉÅ ÏÇ¨Î¨¥Ïã§) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'office'" x-transition.opacity.duration.200ms class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
        <div class="max-w-5xl mx-auto space-y-5 fade-in-up">

          <!-- CEO ÏÇ¨Î¨¥Ïã§ (accent) -->
          <div class="office-room glass border border-hq-accent/20 bg-hq-accent/[0.04]">
            <div class="flex items-center gap-3 mb-3 px-3 py-2.5 rounded-lg glass border-l-[3px] border-l-hq-accent border border-hq-accent/10">
              <span class="text-lg">‚ö°</span>
              <span class="text-sm font-bold text-hq-accent uppercase tracking-wider font-mono">COMMAND CENTER</span>
            </div>
            <div class="flex gap-3">
              <div class="desk-card glass border border-hq-accent/30 w-48 sm:w-[160px] cursor-pointer" @click="showCeoProfile = true">
                <div class="flex items-center justify-between mb-2">
                  <div class="agent-avatar bg-gradient-to-br from-hq-accent to-hq-purple text-white text-[10px]">CEO</div>
                  <div class="status-light status-light-working"></div>
                </div>
                <div class="text-sm font-semibold text-hq-text font-mono">CEO</div>
                <div class="text-[10px] text-hq-muted font-mono">COMMANDER (You)</div>
              </div>
            </div>
          </div>

          <!-- Ï∞∏Î™®ÏßÑ ‚Äî ÌåÄÏû• 6Î™Ö (Îã®Ïùº Í∑∏Î¶¨Îìú) -->
          <div class="office-room glass border border-hq-border/40 bg-hq-surface/30">
            <div class="flex items-center gap-3 mb-3 px-3 py-2 rounded-lg border-l-[3px] border-l-hq-purple border border-hq-purple/10 bg-hq-purple/[0.04]">
              <span class="text-base">üë•</span>
              <span class="text-xs font-bold text-hq-purple uppercase tracking-wider font-mono">CORTHEX STAFF ‚Äî ÌåÄÏû• 6Î™Ö</span>
              <span class="text-[10px] text-hq-muted ml-auto">v4.0</span>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
              <template x-for="id in ['chief_of_staff','cio_manager','cso_manager','clo_manager','cmo_manager','cpo_manager']" :key="id">
                <div class="desk-card glass border border-hq-border hover:border-hq-purple/40 cursor-pointer p-3" @click="openAgentConfig(id)">
                  <div class="flex items-center justify-between mb-2">
                    <div class="agent-avatar text-[10px]"
                         :class="{'bg-amber-500/20 text-amber-400': id==='chief_of_staff', 'bg-red-500/20 text-red-400': id==='cio_manager', 'bg-purple-500/20 text-purple-400': id==='cso_manager', 'bg-emerald-500/20 text-emerald-400': id==='clo_manager', 'bg-orange-500/20 text-orange-400': id==='cmo_manager', 'bg-fuchsia-500/20 text-fuchsia-400': id==='cpo_manager'}"
                         x-text="getAgentInitials(id)"></div>
                    <div class="status-light" :class="getAgentStatusLight(id)"></div>
                  </div>
                  <div class="text-sm font-semibold text-hq-text truncate" x-text="getAgentName(id)"></div>
                  <div x-show="agentModels[id]" class="text-[10px] text-hq-cyan/70 font-mono truncate mt-0.5" x-text="getModelDisplayName(agentModels[id])"></div>
                </div>
              </template>
            </div>
          </div>

          <!-- ARGOS ‚Äî ÏÑúÎ≤Ñ Ïã§Ìñâ ÏãúÏä§ÌÖú (zinc) -->
          <div class="office-room glass border border-zinc-500/30 bg-zinc-500/[0.03]">
            <div class="flex items-center gap-3 mb-3 px-3 py-2.5 rounded-lg glass border-l-[3px] border-l-zinc-400 border border-zinc-500/20">
              <span class="text-lg">‚öôÔ∏è</span>
              <span class="text-sm font-bold text-zinc-400 uppercase tracking-wider font-mono">ARGOS ‚Äî ÏÑúÎ≤Ñ Ïã§Ìñâ ÏãúÏä§ÌÖú</span>
              <span class="text-[10px] text-hq-muted ml-auto font-mono">24H / 100 EYES</span>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 items-start">
              <!-- ARGOS Ïπ¥Îìú -->
              <div class="desk-card glass border border-zinc-500/40 hover:border-zinc-400/60 w-full sm:w-[160px] shrink-0">
                <div class="flex items-center justify-between mb-2">
                  <div class="agent-avatar bg-zinc-700 text-zinc-300 text-[13px]">‚öô</div>
                  <div class="status-light status-light-working"></div>
                </div>
                <div class="text-sm font-bold text-zinc-300 font-mono">ARGOS</div>
                <div class="text-[10px] text-zinc-500 font-mono">SYSTEM EXECUTOR</div>
                <div class="text-[10px] text-emerald-400/80 font-mono mt-1">Oracle ARM ¬∑ 24/7</div>
              </div>
              <!-- Ïó≠Ìï† ÏÑ§Î™Ö -->
              <div class="flex-1 text-[11px] text-hq-muted/80 space-y-1 pt-1">
                <div class="flex items-center gap-1.5"><span class="text-zinc-500">‚ñ∏</span> ÌÅ¨Î°† Ïä§ÏºÄÏ§Ñ Ïã§Ìñâ (Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• Î∂ÑÏÑù ¬∑ Soul Evolution)</div>
                <div class="flex items-center gap-1.5"><span class="text-zinc-500">‚ñ∏</span> ÎÖ∏ÏÖò ÏûêÎèô Ï†ÄÏû• (ÎπÑÏÑúÏã§ ¬∑ ÏóêÏù¥Ï†ÑÌä∏ ÏÇ∞Ï∂úÎ¨º)</div>
                <div class="flex items-center gap-1.5"><span class="text-zinc-500">‚ñ∏</span> KIS API Îß§Îß§ Ïã§Ìñâ ¬∑ Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Ï∂îÏ†Å</div>
                <div class="flex items-center gap-1.5"><span class="text-zinc-500">‚ñ∏</span> ÌÖîÎ†àÍ∑∏Îû® ÏïåÎ¶º Î∞úÏÜ°</div>
                <div class="flex items-center gap-1.5"><span class="text-zinc-500">‚ñ∏</span> ÏõπÏÜåÏºì ¬∑ SSE Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞ Ïú†ÏßÄ</div>
                <div class="text-[10px] text-zinc-600 mt-2 font-mono italic">ÌåêÎã®ÏùÄ ÏóêÏù¥Ï†ÑÌä∏. Ïã§ÌñâÏùÄ ARGOS. Ïû†Îì§ÏßÄ ÏïäÎäîÎã§.</div>
              </div>
            </div>
          </div>

          <p class="text-center text-[11px] text-hq-muted/80 mt-4">ÏóêÏù¥Ï†ÑÌä∏Î•º ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏, Ï∂îÎ°† Ï†ïÎèÑ, ÏÜåÏö∏(ÏÑ±Í≤©)ÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§</p>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Dashboard View ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'dashboard'" x-transition.opacity.duration.200ms class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
        <div class="max-w-5xl mx-auto fade-in-up">

          <!-- Header -->
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-bold text-hq-text mb-1 font-mono tracking-normal">DASHBOARD</h1>
              <p class="text-sm text-hq-muted">Ïã§ÏãúÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú ‚Äî 30Ï¥à ÏûêÎèô Í∞±Ïã† ¬∑ ÏÉÅÏÑ∏ Î∂ÑÏÑù</p>
            </div>
            <button @click="loadDashboard()" class="bg-hq-surface border border-hq-border rounded-lg px-3 py-1.5 text-xs text-hq-muted hover:text-hq-text transition flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              ÏÉàÎ°úÍ≥†Ïπ®
            </button>
          </div>

          <!-- Loading -->
          <template x-if="!dashboard.loaded">
            <div class="flex items-center justify-center py-20">
              <div class="text-hq-muted flex items-center gap-2">
                <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
                ÎåÄÏãúÎ≥¥Îìú Î°úÎî© Ï§ë...
              </div>
            </div>
          </template>

          <!-- Content -->
          <template x-if="dashboard.loaded">
            <div class="space-y-6">

              <!-- Summary Cards -->
              <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">Ïò§Îäò ÏûëÏóÖ</div>
                  <div class="text-2xl font-bold text-hq-text" x-text="dashboard.todayTasks"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">ÏôÑÎ£å</div>
                  <div class="text-2xl font-bold text-hq-green" x-text="dashboard.todayCompleted"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">Ïã§Ìå®</div>
                  <div class="text-2xl font-bold text-hq-red" x-text="dashboard.todayFailed"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">ÏßÑÌñâÏ§ë</div>
                  <div class="text-2xl font-bold text-hq-yellow" x-text="dashboard.runningCount"></div>
                </div>
              </div>

              <!-- Cost & Agent Info -->
              <div class="grid grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">Ï¥ù ÎπÑÏö©</div>
                  <div class="text-lg font-bold text-hq-accent">$<span x-text="(dashboard.totalCost || 0).toFixed(2)"></span></div>
                  <div class="text-[10px] text-hq-muted mt-1" x-text="'AI Ìò∏Ï∂ú ' + (dashboard.totalAiCalls || 0) + 'Ìöå'"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">ÏóêÏù¥Ï†ÑÌä∏</div>
                  <div class="text-lg font-bold text-hq-cyan" x-text="(dashboard.agentCount || 0) + 'Î™Ö'"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">ÏãúÏä§ÌÖú ÏÉÅÌÉú</div>
                  <div class="flex items-center gap-2">
                    <span class="w-2.5 h-2.5 rounded-full" :class="dashboard.systemHealth === 'ok' ? 'bg-hq-green' : dashboard.systemHealth === 'busy' ? 'bg-hq-yellow animate-pulse' : 'bg-hq-red'"></span>
                    <span class="text-lg font-bold" :class="dashboard.systemHealth === 'ok' ? 'text-hq-green' : dashboard.systemHealth === 'busy' ? 'text-hq-yellow' : 'text-hq-red'" x-text="dashboard.systemHealth === 'ok' ? 'Ï†ïÏÉÅ' : dashboard.systemHealth === 'busy' ? 'ÏûëÏóÖÏ§ë' : 'Ïù¥ÏÉÅ'"></span>
                  </div>
                </div>
              </div>

              <!-- Budget Section (Ìï≠ÏÉÅ ÌëúÏãú) -->
              <div class="glass border border-hq-border rounded-xl p-5">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-sm font-bold text-hq-text flex items-center gap-2">
                    <span class="text-hq-yellow">$</span> ÏòàÏÇ∞ ÌòÑÌô©
                  </h3>
                  <button @click="showBudgetEdit = true; budgetEditDaily = budget.daily_limit || 0; budgetEditMonthly = budget.monthly_limit || 0"
                          class="text-xs text-hq-accent hover:text-hq-accent/80 px-2 py-1 border border-hq-accent/20 rounded-lg transition">ÌïúÎèÑ ÏàòÏ†ï</button>
                </div>
                <!-- ÌïúÎèÑ ÎØ∏ÏÑ§Ï†ï ÏïàÎÇ¥ -->
                <div x-show="!budget.daily_limit && !budget.monthly_limit" class="text-center py-4">
                  <div class="text-xs text-hq-muted mb-2">ÏòàÏÇ∞ ÌïúÎèÑÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§</div>
                  <button @click="showBudgetEdit = true; budgetEditDaily = 10; budgetEditMonthly = 200"
                          class="text-xs bg-hq-accent/10 text-hq-accent border border-hq-accent/20 rounded-lg px-3 py-1.5 hover:bg-hq-accent/20 transition">ÌïúÎèÑ ÏÑ§Ï†ïÌïòÍ∏∞</button>
                </div>
                <div class="space-y-4" x-show="budget.daily_limit || budget.monthly_limit">
                  <!-- Daily Budget -->
                  <div x-show="budget.daily_limit">
                    <div class="flex justify-between text-xs mb-1.5">
                      <span class="text-hq-muted">ÏùºÏùº ÏòàÏÇ∞</span>
                      <span class="text-hq-text font-mono">$<span x-text="(budget.daily_used || 0).toFixed(2)"></span> / $<span x-text="(budget.daily_limit || 0).toFixed(2)"></span></span>
                    </div>
                    <div class="w-full bg-hq-bg rounded-full h-2.5">
                      <div class="h-2.5 rounded-full transition-all duration-500"
                           :class="(budget.daily_used / budget.daily_limit * 100) > 80 ? 'bg-hq-red' : 'bg-hq-green'"
                           :style="'width: ' + Math.min(100, (budget.daily_used || 0) / (budget.daily_limit || 1) * 100) + '%'"></div>
                    </div>
                  </div>
                  <!-- Monthly Budget -->
                  <div x-show="budget.monthly_limit">
                    <div class="flex justify-between text-xs mb-1.5">
                      <span class="text-hq-muted">ÏõîÍ∞Ñ ÏòàÏÇ∞</span>
                      <span class="text-hq-text font-mono">$<span x-text="(budget.monthly_used || 0).toFixed(2)"></span> / $<span x-text="(budget.monthly_limit || 0).toFixed(2)"></span></span>
                    </div>
                    <div class="w-full bg-hq-bg rounded-full h-2.5">
                      <div class="h-2.5 rounded-full transition-all duration-500"
                           :class="(budget.monthly_used / budget.monthly_limit * 100) > 80 ? 'bg-hq-red' : 'bg-hq-accent'"
                           :style="'width: ' + Math.min(100, (budget.monthly_used || 0) / (budget.monthly_limit || 1) * 100) + '%'"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Model Mode Section -->
              <div class="glass border border-hq-border rounded-xl p-5">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-sm font-bold text-hq-text flex items-center gap-2">
                    <span class="text-hq-accent">&#9881;</span> AI Î™®Îç∏ Î≥ÄÍ≤Ω
                  </h3>
                </div>

                <!-- ÌòÑÏû¨ ÌåÄÏû•Î≥Ñ Î™®Îç∏ ÌòÑÌô© -->
                <div class="space-y-1.5 mb-4">
                  <template x-for="id in ['chief_of_staff','cio_manager','cso_manager','clo_manager','cmo_manager','cpo_manager']" :key="'model-'+id">
                    <div class="flex items-center justify-between px-3 py-2 rounded-lg bg-hq-bg/50 border border-hq-border/30">
                      <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full shrink-0" :class="getAgentDotClass(id)"></span>
                        <span class="text-xs font-medium text-hq-text" x-text="getAgentName(id)"></span>
                      </div>
                      <div class="flex items-center gap-2">
                        <span class="text-[10px] text-hq-cyan/70 font-mono" x-text="getModelDisplayName(agentModels[id])"></span>
                        <span x-show="agentReasonings[id]" class="text-[9px] px-1.5 py-0.5 rounded border"
                              :class="agentReasonings[id]==='low' ? 'border-hq-green/30 text-hq-green' : agentReasonings[id]==='medium' ? 'border-hq-yellow/30 text-hq-yellow' : agentReasonings[id]==='high' ? 'border-hq-purple/30 text-hq-purple' : 'border-hq-border text-hq-muted'"
                              x-text="agentReasonings[id]"></span>
                      </div>
                    </div>
                  </template>
                </div>

                <div class="flex gap-1.5 mb-3">
                  <button @click="modelMode = 'auto'; saveModelMode()"
                          :class="modelMode === 'auto' ? 'bg-hq-accent text-white' : 'bg-hq-bg text-hq-muted border border-hq-border'"
                          class="flex-1 text-xs font-bold px-3 py-2 rounded-lg transition">
                    ÏûêÎèô
                  </button>
                  <button @click="applyRecommendedModels()"
                          :class="modelMode === 'recommended' ? 'bg-hq-green text-white' : 'bg-hq-bg text-hq-muted border border-hq-border'"
                          class="flex-1 text-xs font-bold px-3 py-2 rounded-lg transition">
                    Í∂åÏû•
                  </button>
                  <button @click="modelMode = 'manual'; saveModelMode()"
                          :class="modelMode === 'manual' ? 'bg-hq-accent text-white' : 'bg-hq-bg text-hq-muted border border-hq-border'"
                          class="flex-1 text-xs font-bold px-3 py-2 rounded-lg transition">
                    ÏàòÎèô
                  </button>
                </div>
                <div x-show="modelMode === 'auto'" class="text-[10px] text-hq-muted">
                  ÏßàÎ¨∏ Í∏∏Ïù¥/ÎÇ¥Ïö©Ïóê Îî∞Îùº Haiku(Ï†ÄÎπÑÏö©) ÎòêÎäî Sonnet(Í≥†ÌíàÏßà) ÏûêÎèô ÏÑ†ÌÉù
                </div>
                <div x-show="modelMode === 'manual'" class="mt-1">
                  <div class="text-[10px] text-hq-muted">Í∞Å ÏóêÏù¥Ï†ÑÌä∏Ïóê Í∞úÎ≥Ñ ÏßÄÏ†ïÎêú Î™®Îç∏ÏùÑ ÏÇ¨Ïö©Ìï©ÎãàÎã§</div>
                  <div class="text-[10px] text-hq-accent mt-1">ÏóêÏù¥Ï†ÑÌä∏ ÌÅ¥Î¶≠ ‚Üí Î™®Îç∏ ÌÉ≠ÏóêÏÑú Í∞úÎ≥Ñ Î≥ÄÍ≤Ω Í∞ÄÎä•</div>
                </div>

                <!-- Ï†ÑÏ≤¥ Î™®Îç∏ ÏùºÍ¥Ñ Î≥ÄÍ≤Ω -->
                <div class="border-t border-hq-border mt-4 pt-4">
                  <div class="text-[11px] font-bold text-hq-text mb-2">Ï†ÑÏ≤¥ ÏóêÏù¥Ï†ÑÌä∏ Î™®Îç∏ ÏùºÍ¥Ñ Î≥ÄÍ≤Ω</div>
                  <div class="text-[10px] text-hq-muted mb-3">ÌåÄÏû• 6Î™ÖÏùò Î™®Îç∏Í≥º Ï∂îÎ°† Ï†ïÎèÑÎ•º ÌïúÎ≤àÏóê Î∞îÍøâÎãàÎã§</div>
                  <!-- Î™®Îç∏ ÏÑ†ÌÉù -->
                  <select x-model="bulkModelSelection"
                          @change="bulkReasoningOptions = _getDefaultReasoning(bulkModelSelection); bulkReasoningSelection = ''"
                          class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-xs text-hq-text mb-2">
                    <option value="">Î™®Îç∏ ÏÑ†ÌÉù...</option>
                    <template x-for="[provLabel, models] of Object.entries(getModelsByProvider())" :key="provLabel">
                      <optgroup :label="provLabel">
                        <template x-for="m in models" :key="m.name">
                          <option :value="m.name" x-text="getModelDisplayName(m.name)"></option>
                        </template>
                      </optgroup>
                    </template>
                  </select>
                  <!-- Ï∂îÎ°† Ï†ïÎèÑ -->
                  <div x-show="bulkReasoningOptions.length > 0" class="flex flex-wrap gap-1.5 mb-3">
                    <button @click="bulkReasoningSelection = ''"
                            :class="!bulkReasoningSelection ? 'bg-hq-accent/20 text-hq-accent border-hq-accent' : 'text-hq-muted border-hq-border'"
                            class="text-[10px] border rounded-md px-2 py-1 transition">Í∏∞Î≥∏</button>
                    <template x-for="lv in bulkReasoningOptions" :key="lv">
                      <button @click="bulkReasoningSelection = lv"
                              :class="bulkReasoningSelection === lv
                                ? (lv === 'none' ? 'bg-hq-muted/20 text-hq-muted border-hq-muted'
                                  : lv === 'low' ? 'bg-hq-green/20 text-hq-green border-hq-green'
                                  : lv === 'medium' ? 'bg-hq-yellow/20 text-hq-yellow border-hq-yellow'
                                  : lv === 'high' ? 'bg-hq-purple/20 text-hq-purple border-hq-purple'
                                  : 'bg-hq-red/20 text-hq-red border-hq-red')
                                : 'text-hq-muted border-hq-border'"
                              class="text-[10px] border rounded-md px-2 py-1 transition"
                              x-text="({'none':'‚õî none','low':'‚ö° low','medium':'üß† medium','high':'üî¨ high','xhigh':'üî• xhigh'})[lv] || lv"></button>
                    </template>
                  </div>
                  <!-- Ï†ÅÏö© Î≤ÑÌäº -->
                  <button @click="applyBulkModel()"
                          :disabled="!bulkModelSelection || bulkModelSaving"
                          :class="bulkModelSelection ? 'bg-hq-accent hover:bg-blue-600 text-white' : 'bg-hq-bg text-hq-muted cursor-not-allowed border border-hq-border'"
                          class="w-full text-xs font-bold px-3 py-2.5 rounded-lg transition flex items-center justify-center gap-2">
                    <span x-show="bulkModelSaving" class="animate-spin">&#8987;</span>
                    <span x-text="bulkModelSaving ? 'Î≥ÄÍ≤Ω Ï§ë...' : '6Î™Ö Ï†ÑÏ≤¥ Ï†ÅÏö©'"></span>
                  </button>

                  <!-- Í∏∞Î≥∏Í∞í Ï†ÄÏû•/Î≥µÏõê -->
                  <div class="border-t border-hq-border mt-3 pt-3 flex gap-2">
                    <button @click="saveAgentDefaults()"
                            class="flex-1 text-[10px] font-bold bg-hq-bg border border-hq-border text-hq-text hover:border-hq-accent rounded-lg px-2 py-1.5 transition">
                      ÌòÑÏû¨Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï†ÄÏû•
                    </button>
                    <button @click="restoreAgentDefaults()"
                            class="flex-1 text-[10px] font-bold bg-hq-bg border border-hq-border text-hq-muted hover:border-hq-yellow rounded-lg px-2 py-1.5 transition">
                      Í∏∞Î≥∏Í∞í Î≥µÏõê
                    </button>
                  </div>
                </div>
              </div>

              <!-- Quality Section -->
              <div class="glass border border-hq-border rounded-xl p-5" x-show="quality && quality.total_reviews">
                <h3 class="text-sm font-bold text-hq-text mb-4 flex items-center gap-2">
                  <span class="text-hq-green">&#10003;</span> ÌíàÏßà Í≤ÄÏàò
                </h3>
                <div class="grid grid-cols-4 gap-3">
                  <div class="text-center">
                    <div class="text-2xl font-bold" :class="(quality.pass_rate || 0) >= 80 ? 'text-hq-green' : 'text-hq-yellow'" x-text="(quality.pass_rate || 0).toFixed(0) + '%'"></div>
                    <div class="text-[10px] text-hq-muted">Ìï©Í≤©Î•†</div>
                  </div>
                  <div class="text-center">
                    <div class="text-2xl font-bold text-hq-text" x-text="quality.total_reviews || 0"></div>
                    <div class="text-[10px] text-hq-muted">Ï¥ù Í≤ÄÏàò</div>
                  </div>
                  <div class="text-center">
                    <div class="text-2xl font-bold text-hq-red" x-text="quality.failed || 0"></div>
                    <div class="text-[10px] text-hq-muted">Î∂àÌï©Í≤©</div>
                  </div>
                  <div class="text-center">
                    <div class="text-2xl font-bold" :class="getQualityBadge(quality.average_score).cls.split(' ').filter(c => c.startsWith('text-'))[0] || 'text-hq-text'" x-text="(quality.average_score || 0).toFixed(1)"></div>
                    <div class="text-[10px] text-hq-muted">ÌèâÍ∑† (1~5)</div>
                  </div>
                </div>
              </div>

              <!-- Deploy Status (Î∞∞Ìè¨ ÌòÑÌô©) -->
              <div class="glass border border-hq-border rounded-xl p-5">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-sm font-bold text-hq-text flex items-center gap-2">
                    <svg class="w-4 h-4 text-hq-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                    Î∞∞Ìè¨ ÌòÑÌô©
                  </h3>
                  <div class="flex items-center gap-2">
                    <button @click="loadDeployStatus()" class="text-[10px] text-hq-muted hover:text-hq-text transition">ÏÉàÎ°úÍ≥†Ïπ®</button>
                    <a href="https://github.com/kodonghui/CORTHEX_HQ/actions" target="_blank"
                       class="text-[10px] text-hq-accent hover:underline">GitHub Actions ‚Üó</a>
                  </div>
                </div>

                <!-- Î∞∞Ìè¨ ÏÉÅÌÉú Ïπ¥Îìú (Ï†ïÎ†¨ ÌÜµÏùº) -->
                <div class="grid grid-cols-3 gap-3 mb-4">
                  <div class="bg-hq-panel rounded-lg p-3 min-h-[76px] flex flex-col items-center justify-center">
                    <div class="text-[10px] text-hq-muted mb-1.5 flex items-center gap-1">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 2h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 8.172V3L8 2z"/></svg>
                      ÌòÑÏû¨ ÎπåÎìú
                    </div>
                    <div class="text-base font-bold font-mono" :class="deployStatus.status === 'success' ? 'text-hq-green' : 'text-hq-red'" x-text="deployStatus.build ? '#' + deployStatus.build : '-'"></div>
                  </div>
                  <div class="bg-hq-panel rounded-lg p-3 min-h-[76px] flex flex-col items-center justify-center">
                    <div class="text-[10px] text-hq-muted mb-1.5 flex items-center gap-1">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/></svg>
                      ÏÑúÎ≤Ñ ÏÉÅÌÉú
                    </div>
                    <div class="text-base font-bold" :class="deployStatus.status === 'success' ? 'text-hq-green' : deployStatus.status === 'loading' ? 'text-hq-yellow' : 'text-hq-red'"
                         x-text="deployStatus.status === 'success' ? 'Ï†ïÏÉÅ' : deployStatus.status === 'loading' ? 'ÌôïÏù∏Ï§ë...' : 'ÌôïÏù∏ Î∂àÍ∞Ä'"></div>
                  </div>
                  <div class="bg-hq-panel rounded-lg p-3 min-h-[76px] flex flex-col items-center justify-center">
                    <div class="text-[10px] text-hq-muted mb-1.5 flex items-center gap-1">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      ÎßàÏßÄÎßâ Î∞∞Ìè¨
                    </div>
                    <div class="text-base font-bold text-hq-text" x-text="deployStatus.time ? new Date(deployStatus.time).toLocaleString('ko-KR', {timeZone:'Asia/Seoul', month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit'}) : '-'"></div>
                  </div>
                </div>

                <!-- ÏµúÍ∑º Î∞∞Ìè¨ Î°úÍ∑∏ -->
                <div class="space-y-2" x-show="deployLogs.length > 0">
                  <div class="text-[10px] text-hq-muted font-bold uppercase tracking-wider mb-2">ÏµúÍ∑º Î∞∞Ìè¨ Í∏∞Î°ù</div>
                  <template x-for="log in deployLogs" :key="log.id">
                    <div class="flex items-center gap-3 p-2 rounded-lg bg-hq-bg border border-hq-border/30">
                      <span class="w-2 h-2 rounded-full shrink-0" :class="log.conclusion === 'success' ? 'bg-hq-green' : log.conclusion === 'failure' ? 'bg-hq-red' : 'bg-hq-yellow'"></span>
                      <div class="flex-1 min-w-0">
                        <div class="text-xs text-hq-text truncate" x-text="'#' + log.number + ' ‚Äî ' + log.title"></div>
                        <div class="text-[10px] text-hq-muted" x-text="new Date(log.time).toLocaleString('ko-KR', {timeZone:'Asia/Seoul', month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit'})"></div>
                      </div>
                      <span class="text-[10px] shrink-0" :class="log.conclusion === 'success' ? 'text-hq-green' : 'text-hq-red'" x-text="log.conclusion === 'success' ? 'ÏÑ±Í≥µ' : 'Ïã§Ìå®'"></span>
                    </div>
                  </template>
                </div>
                <div x-show="deployLogs.length === 0 && deployStatus.status !== 'loading'" class="text-center py-3">
                  <div class="text-xs text-hq-muted">Î∞∞Ìè¨ Í∏∞Î°ùÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§</div>
                  <div class="text-[10px] text-hq-muted mt-1">ÏÑúÎ≤Ñ Ïó∞Í≤∞ ÏÉÅÌÉúÎ•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî</div>
                </div>
              </div>

              <!-- Recent Completed -->
              <div class="glass border border-hq-border rounded-xl p-5" x-show="dashboard.recentCompleted && dashboard.recentCompleted.length > 0">
                <h3 class="text-sm font-bold text-hq-text mb-4">ÏµúÍ∑º ÏôÑÎ£å ÏûëÏóÖ</h3>
                <div class="space-y-2">
                  <template x-for="task in dashboard.recentCompleted.slice(0, 8)" :key="task.task_id">
                    <div class="flex items-center gap-3 p-2.5 bg-hq-panel rounded-lg">
                      <span class="w-2 h-2 rounded-full bg-hq-green shrink-0"></span>
                      <div class="flex-1 min-w-0">
                        <div class="text-sm text-hq-text truncate" x-text="task.command || task.task_id"></div>
                      </div>
                      <span class="text-[10px] text-hq-muted shrink-0" x-text="task.time_seconds ? task.time_seconds.toFixed(1) + 'Ï¥à' : ''"></span>
                    </div>
                  </template>
                </div>
              </div>

            </div>
          </template>

        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab: ÏûëÏóÖÎÇ¥Ïó≠ (History) ‚ïê‚ïê‚ïê -->
      <template x-if="viewMode === 'chat' && activeTab === 'history'"><div class="flex-1 flex flex-col overflow-hidden">
        <div class="px-4 md:px-6 pt-4 md:pt-5 pb-3 shrink-0 border-b border-hq-border bg-hq-surface">
          <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú (ÏïÑÏù¥ÏΩò + ÏÉâÏÉÅ Í∞ïÌôî) -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 max-w-5xl mx-auto mb-4">
            <!-- Ï†ÑÏ≤¥ ÏûëÏóÖ -->
            <div class="bg-hq-panel border border-hq-border/50 rounded-lg px-4 py-3 flex items-center gap-3 relative overflow-hidden">
              <div class="absolute left-0 top-0 bottom-0 w-1 bg-hq-accent rounded-l-lg"></div>
              <div class="w-9 h-9 rounded-lg bg-hq-accent/10 flex items-center justify-center shrink-0">
                <svg class="w-5 h-5 text-hq-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
              </div>
              <div>
                <div class="text-xl font-bold text-hq-text" x-text="taskHistory.items?.length || 0"></div>
                <div class="text-[10px] text-hq-muted">Ï†ÑÏ≤¥ ÏûëÏóÖ</div>
              </div>
            </div>
            <!-- ÏôÑÎ£å -->
            <div class="bg-hq-panel border border-hq-border/50 rounded-lg px-4 py-3 flex items-center gap-3 relative overflow-hidden">
              <div class="absolute left-0 top-0 bottom-0 w-1 bg-hq-green rounded-l-lg"></div>
              <div class="w-9 h-9 rounded-lg bg-hq-green/10 flex items-center justify-center shrink-0">
                <svg class="w-5 h-5 text-hq-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
              </div>
              <div>
                <div class="text-xl font-bold text-hq-green" x-text="(taskHistory.items || []).filter(t => t.status === 'completed').length"></div>
                <div class="text-[10px] text-hq-muted">ÏôÑÎ£å</div>
              </div>
            </div>
            <!-- Ïã§Ìå® -->
            <div class="bg-hq-panel border border-hq-border/50 rounded-lg px-4 py-3 flex items-center gap-3 relative overflow-hidden">
              <div class="absolute left-0 top-0 bottom-0 w-1 bg-hq-red rounded-l-lg"></div>
              <div class="w-9 h-9 rounded-lg bg-hq-red/10 flex items-center justify-center shrink-0">
                <svg class="w-5 h-5 text-hq-red" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
              </div>
              <div>
                <div class="text-xl font-bold text-hq-red" x-text="(taskHistory.items || []).filter(t => t.status === 'failed').length"></div>
                <div class="text-[10px] text-hq-muted">Ïã§Ìå®</div>
              </div>
            </div>
            <!-- Ï¥ù ÎπÑÏö© -->
            <div class="bg-hq-panel border border-hq-border/50 rounded-lg px-4 py-3 flex items-center gap-3 relative overflow-hidden">
              <div class="absolute left-0 top-0 bottom-0 w-1 bg-hq-cyan rounded-l-lg"></div>
              <div class="w-9 h-9 rounded-lg bg-hq-cyan/10 flex items-center justify-center shrink-0">
                <svg class="w-5 h-5 text-hq-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div>
                <div class="text-xl font-bold text-hq-cyan" x-text="'$' + ((taskHistory.items || []).reduce((s, t) => s + (t.cost || 0), 0)).toFixed(2)"></div>
                <div class="text-[10px] text-hq-muted">Ï¥ù ÎπÑÏö©</div>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2 md:gap-3 max-w-5xl mx-auto flex-wrap">
            <!-- Ï†ÑÏ≤¥ ÏÑ†ÌÉù Ï≤¥ÌÅ¨Î∞ïÏä§ -->
            <button @click="toggleSelectAll()"
                    class="w-[18px] h-[18px] rounded border-2 flex items-center justify-center shrink-0 transition-all duration-150 cursor-pointer"
                    :class="isAllSelected() ? 'border-hq-accent bg-hq-accent text-white' : taskHistory.selectedIds.length > 0 ? 'border-hq-accent/50 bg-hq-accent/20 text-hq-accent' : 'border-hq-muted/30 hover:border-hq-accent/50 bg-transparent'"
                    title="Ï†ÑÏ≤¥ ÏÑ†ÌÉù">
              <svg x-show="isAllSelected()" class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
              <svg x-show="taskHistory.selectedIds.length > 0 && !isAllSelected()" class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 12h14"/></svg>
            </button>
            <!-- Search -->
            <div class="flex-1 relative">
              <svg class="w-4 h-4 text-hq-muted absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
              <input type="text" x-model="taskHistory.search" @input.debounce.300ms="loadTaskHistory()"
                     placeholder="ÏûëÏóÖ Í≤ÄÏÉâ..."
                     class="w-full bg-hq-bg border border-hq-border rounded-lg pl-9 pr-4 py-2 text-sm text-hq-text placeholder-hq-muted/70 focus:outline-none focus:border-hq-accent/50">
            </div>
            <!-- Status Filter (Ïª§Ïä§ÌÖÄ ÎìúÎ°≠Îã§Ïö¥) -->
            <div class="relative" x-data="{ filterOpen: false }">
              <button @click="filterOpen = !filterOpen" @click.outside="filterOpen = false"
                      class="flex items-center gap-2 bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text hover:border-hq-accent/40 transition min-w-[110px]">
                <span x-text="({'all':'Ï†ÑÏ≤¥','completed':'ÏôÑÎ£å','failed':'Ïã§Ìå®','running':'ÏßÑÌñâÏ§ë','archived':'Î≥¥Í¥Ä'})[taskHistory.filterStatus] || 'Ï†ÑÏ≤¥'"></span>
                <svg class="w-3.5 h-3.5 text-hq-muted ml-auto transition-transform" :class="filterOpen ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
              </button>
              <div x-show="filterOpen" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 -translate-y-1" x-transition:enter-end="opacity-100 translate-y-0" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
                   class="absolute top-full left-0 mt-1 w-full bg-hq-surface border border-hq-border rounded-lg shadow-xl z-50 overflow-hidden py-1">
                <template x-for="opt in [{v:'all',l:'Ï†ÑÏ≤¥'},{v:'completed',l:'ÏôÑÎ£å'},{v:'failed',l:'Ïã§Ìå®'},{v:'running',l:'ÏßÑÌñâÏ§ë'},{v:'archived',l:'Î≥¥Í¥Ä'}]" :key="opt.v">
                  <button @click="taskHistory.filterStatus = opt.v; filterOpen = false; loadTaskHistory()"
                          class="w-full text-left px-3 py-1.5 text-sm transition"
                          :class="taskHistory.filterStatus === opt.v ? 'text-hq-accent bg-hq-accent/10 font-semibold' : 'text-hq-text hover:bg-hq-panel'">
                    <span x-text="opt.l"></span>
                    <svg x-show="taskHistory.filterStatus === opt.v" class="w-3.5 h-3.5 inline ml-1 text-hq-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"/></svg>
                  </button>
                </template>
              </div>
            </div>
            <!-- Bookmark Filter -->
            <button @click="taskHistory.bookmarkOnly = !taskHistory.bookmarkOnly; loadTaskHistory()"
                    :class="taskHistory.bookmarkOnly ? 'text-hq-yellow border-hq-yellow/30' : 'text-hq-muted border-hq-border'"
                    class="border rounded-lg px-3 py-2 text-sm transition hover:text-hq-yellow">
              &#9733;
            </button>
          </div>
          <!-- Î©ÄÌã∞ÏÖÄÎ†âÌä∏ Ïï°ÏÖòÎ∞î (ÏÑ†ÌÉù Ïãú ÌëúÏãú) -->
          <div x-show="taskHistory.selectedIds.length > 0"
               x-transition:enter="transition ease-out duration-200"
               x-transition:enter-start="opacity-0 -translate-y-2"
               x-transition:enter-end="opacity-100 translate-y-0"
               class="flex items-center gap-2 md:gap-3 max-w-5xl mx-auto mt-3 px-3 md:px-4 py-2.5 rounded-xl bg-hq-accent/10 border border-hq-accent/20 flex-wrap">
            <!-- Ï†ÑÏ≤¥ ÏÑ†ÌÉù ÌÜ†Í∏Ä -->
            <button @click="selectAllTasks()"
                    class="w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all duration-200 cursor-pointer shrink-0"
                    :class="taskHistory.selectedIds.length === taskHistory.items.length ? 'border-hq-accent bg-hq-accent text-white' : 'border-hq-accent/50 hover:border-hq-accent'"
                    title="Ï†ÑÏ≤¥ ÏÑ†ÌÉù/Ìï¥Ï†ú">
              <svg x-show="taskHistory.selectedIds.length === taskHistory.items.length" class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
            </button>
            <span class="text-sm font-bold text-hq-accent">
              <span x-text="taskHistory.selectedIds.length"></span>Í∞ú ÏÑ†ÌÉùÎê®
            </span>
            <div class="flex items-center gap-2 ml-auto">
              <button @click="bulkBookmark()"
                      class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-hq-yellow/10 text-hq-yellow border border-hq-yellow/20 hover:bg-hq-yellow/20 transition">
                &#9733; Î∂ÅÎßàÌÅ¨
              </button>
              <button @click="bulkTag()"
                      class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-hq-cyan/10 text-hq-cyan border border-hq-cyan/20 hover:bg-hq-cyan/20 transition">
                # ÌÉúÍ∑∏
              </button>
              <button @click="bulkArchive()"
                      class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-hq-muted/10 text-hq-muted border border-hq-muted/20 hover:bg-hq-muted/20 transition">
                Î≥¥Í¥Ä
              </button>
              <button @click="bulkDelete()"
                      class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-hq-red/10 text-hq-red border border-hq-red/20 hover:bg-hq-red/20 transition">
                ÏÇ≠Ï†ú
              </button>
              <button @click="taskHistory.selectedIds = []"
                      class="px-3 py-1.5 rounded-lg text-xs text-hq-muted hover:text-hq-text transition">
                ÏÑ†ÌÉù Ìï¥Ï†ú
              </button>
            </div>
          </div>
        </div>

        <div class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
          <div class="max-w-5xl mx-auto space-y-2">
            <!-- Î°úÎî© ÌëúÏãú -->
            <div x-show="taskHistory.loading" class="flex items-center justify-center py-12">
              <div class="flex items-center gap-3 text-hq-muted">
                <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
                <span class="text-sm">ÏûëÏóÖ Í∏∞Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</span>
              </div>
            </div>
            <!-- ÏóêÎü¨ ÌëúÏãú -->
            <div x-show="taskHistory.error && !taskHistory.loading" class="mb-3 flex items-center gap-2 bg-hq-red/10 border border-hq-red/20 rounded-lg px-4 py-2 text-xs text-hq-red">
              <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
              <span x-text="taskHistory.error"></span>
              <button @click="loadTaskHistory()" class="ml-auto underline hover:text-hq-text">Îã§Ïãú ÏãúÎèÑ</button>
            </div>
            <!-- ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ Î∞∞ÎÑà -->
            <div x-show="taskHistory.isSample && !taskHistory.loading" class="mb-3 flex items-center gap-2 bg-hq-yellow/10 border border-hq-yellow/20 rounded-lg px-4 py-2 text-xs text-hq-yellow">
              <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              ÎØ∏Î¶¨Î≥¥Í∏∞Ïö© ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ÏûÖÎãàÎã§ ‚Äî Ïã§Ï†ú Î™ÖÎ†πÏùÑ ÎÇ¥Î¶¨Î©¥ ÏßÑÏßú Í∏∞Î°ùÏúºÎ°ú ÎåÄÏ≤¥Îê©ÎãàÎã§
            </div>
            <!-- ‚ïê‚ïê‚ïê ÎÖ∏ÏÖò Ïä§ÌÉÄÏùº ÏûëÏ†ÑÏùºÏßÄ Ïπ¥Îìú Î∑∞ ‚ïê‚ïê‚ïê -->
            <template x-for="(group, gi) in getGroupedTaskHistory()" :key="group.label">
              <div class="mb-8">
                <!-- ÎÇ†Ïßú Íµ¨Î∂ÑÏÑ† -->
                <div class="flex items-center gap-3 mb-4 py-1">
                  <div class="w-2 h-2 rounded-full shrink-0"
                       :class="gi === 0 ? 'bg-hq-accent ring-2 ring-hq-accent/30' : 'bg-hq-muted/40'"></div>
                  <h3 class="text-xs font-bold tracking-wider shrink-0 font-title"
                      :class="gi === 0 ? 'text-hq-accent' : 'text-hq-muted'" x-text="group.label"></h3>
                  <div class="flex-1 h-px bg-hq-border/15"></div>
                  <span class="text-[10px] px-2 py-0.5 rounded-full shrink-0"
                        :class="gi === 0 ? 'text-hq-accent bg-hq-accent/8' : 'text-hq-muted/70 bg-hq-surface/50'"
                        x-text="group.items.length + 'Í±¥'"></span>
                </div>
                <!-- Ïπ¥Îìú Î¶¨Ïä§Ìä∏ -->
                <div class="space-y-3">
                  <template x-for="task in group.items" :key="task.task_id">
                    <div class="bg-hq-panel/50 border rounded-2xl overflow-hidden transition-all duration-200 hover:bg-hq-panel/80 hover:shadow-lg hover:shadow-hq-bg/40"
                         :class="taskHistory.selectedIds.includes(task.task_id) ? 'border-hq-accent/40 ring-1 ring-hq-accent/20' : 'border-hq-border/20'">
                      <!-- ÏÉÅÎã® Ïª¨Îü¨ Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ (Î∂ÄÏÑúÎ≥Ñ ÏÉâÏÉÅ, Ïã§Ìå®/ÏßÑÌñâÏ§ëÏùÄ ÏÉÅÌÉúÏÉâ) -->
                      <div class="h-[3px]"
                           :class="task.status === 'failed' ? 'bg-hq-red/60' : task.status === 'running' ? 'bg-hq-yellow/60 animate-pulse' : getTaskColorBarClass(task)"></div>
                      <div class="p-5">
                        <!-- 1Ìñâ: Ï≤¥ÌÅ¨Î∞ïÏä§ + ÏÉÅÌÉú + Î™ÖÎ†πÏñ¥ (ÌÅ∞ Í∏ÄÏî®) + ÏãúÍ∞Ñ -->
                        <div class="flex items-start gap-3">
                          <!-- Gmail Ïä§ÌÉÄÏùº Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                          <button @click.stop="toggleTaskSelect(task.task_id)"
                                  class="w-[18px] h-[18px] rounded border-2 flex items-center justify-center shrink-0 mt-0.5 transition-all duration-150 cursor-pointer"
                                  :class="taskHistory.selectedIds.includes(task.task_id) ? 'border-hq-accent bg-hq-accent text-white' : 'border-hq-muted/25 hover:border-hq-accent/50 bg-transparent'"
                                  title="ÏÑ†ÌÉù">
                            <svg x-show="taskHistory.selectedIds.includes(task.task_id)" class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
                          </button>
                          <!-- ÏÉÅÌÉú ÎèÑÌä∏ -->
                          <div class="w-3 h-3 rounded-full shrink-0 mt-1 cursor-pointer"
                               @click="taskHistory.expandedId = taskHistory.expandedId === task.task_id ? null : task.task_id; if(taskHistory.expandedId === task.task_id) loadTaskDetail(task.task_id)"
                               :class="task.status === 'completed' ? 'bg-hq-green' : task.status === 'failed' ? 'bg-hq-red' : task.status === 'running' ? 'bg-hq-yellow animate-pulse' : 'bg-hq-muted/40'"></div>
                          <!-- Î™ÖÎ†πÏñ¥ (Ï£ºÏù∏Í≥µ) -->
                          <div class="flex-1 min-w-0 cursor-pointer"
                               @click="taskHistory.expandedId = taskHistory.expandedId === task.task_id ? null : task.task_id; if(taskHistory.expandedId === task.task_id) loadTaskDetail(task.task_id)">
                            <div class="text-[15px] font-semibold text-hq-text leading-snug line-clamp-1" x-text="task.summary ? stripMarkdown(task.summary) : task.command"></div>
                            <div x-show="task.summary" class="text-xs text-hq-muted/60 line-clamp-1 mt-0.5" x-text="task.command"></div>
                          </div>
                          <!-- ÏãúÍ∞Ñ (Ïò§Î•∏Ï™Ω) -->
                          <span class="text-xs text-hq-muted/60 font-mono shrink-0 pt-0.5"
                                x-text="new Date(task.created_at || Date.now()).toLocaleTimeString('ko-KR', {timeZone:'Asia/Seoul', hour:'2-digit', minute:'2-digit'})"></span>
                        </div>

                        <!-- 3Ìñâ: Î©îÌÉÄ Ï†ïÎ≥¥ (ID + ÌÉúÍ∑∏ + ÎπÑÏö© + ÏÜåÏöîÏãúÍ∞Ñ + ÏÉÅÌÉú Î±ÉÏßÄ) -->
                        <div class="flex items-center gap-2 mt-3 ml-6 flex-wrap">
                          <!-- D-6: Î≥¥Í≥†ÏÑú ID + Î≤ÑÏ†Ñ -->
                          <span class="text-[9px] font-mono text-hq-muted/40 bg-hq-bg/50 px-1.5 py-0.5 rounded"
                                x-text="'#' + (task.task_id || '').slice(0, 8) + (task.version > 1 ? ' v' + task.version : '')"
                                :title="task.task_id + (task.parent_task_id ? ' ‚Üê ' + task.parent_task_id : '')"></span>
                          <!-- Î∞òÎ†§Îêú ÏÑπÏÖò ÌëúÏãú -->
                          <span x-show="task.rejected_sections && task.rejected_sections.length"
                                class="text-[9px] font-mono text-hq-red/60 bg-hq-red/8 px-1.5 py-0.5 rounded"
                                x-text="'Î∞òÎ†§¬ß' + (task.rejected_sections || []).join(',')"></span>
                          <!-- ÏÉÅÌÉú Î±ÉÏßÄ -->
                          <span class="text-[10px] px-2 py-0.5 rounded-full font-semibold"
                                :class="task.status === 'completed' ? 'bg-hq-green/12 text-hq-green' : task.status === 'failed' ? 'bg-hq-red/12 text-hq-red' : task.status === 'running' ? 'bg-hq-yellow/12 text-hq-yellow' : 'bg-hq-muted/12 text-hq-muted'"
                                x-text="task.status === 'completed' ? 'ÏôÑÎ£å' : task.status === 'failed' ? 'Ïã§Ìå®' : task.status === 'running' ? 'ÏßÑÌñâÏ§ë' : 'ÎåÄÍ∏∞'"></span>
                          <!-- ÌÉúÍ∑∏Îì§ -->
                          <template x-for="tag in (task.tags || []).slice(0,3)" :key="tag">
                            <span class="text-[10px] px-2 py-0.5 rounded-full bg-hq-accent/8 text-hq-accent font-medium" x-text="'#' + tag"></span>
                          </template>
                          <!-- Íµ¨Î∂ÑÏ†ê -->
                          <span x-show="task.cost || task.time_seconds" class="text-hq-muted/30 text-[10px]">&middot;</span>
                          <!-- ÎπÑÏö© -->
                          <span x-show="task.cost" class="text-[11px] font-mono"
                                :class="task.cost > 0.1 ? 'text-hq-yellow' : 'text-hq-muted/60'"
                                x-text="task.cost ? '$' + task.cost.toFixed(4) : ''"></span>
                          <!-- ÏÜåÏöîÏãúÍ∞Ñ -->
                          <span x-show="task.time_seconds" class="text-[11px] text-hq-muted/60"
                                x-text="task.time_seconds ? task.time_seconds + 'Ï¥à' : ''"></span>
                        </div>

                        <!-- 4Ìñâ: Ïï°ÏÖò Î≤ÑÌäº (Ìï≠ÏÉÅ Î≥¥ÏûÑ) -->
                        <div class="flex items-center gap-2 mt-3 ml-6">
                          <!-- Í≤∞Í≥º Î≥¥Í∏∞ Î≤ÑÌäº -->
                          <button @click="taskHistory.expandedId = taskHistory.expandedId === task.task_id ? null : task.task_id; if(taskHistory.expandedId === task.task_id) loadTaskDetail(task.task_id)"
                                  class="text-[11px] px-3 py-1 rounded-lg transition flex items-center gap-1"
                                  :class="taskHistory.expandedId === task.task_id ? 'bg-hq-accent/15 text-hq-accent' : 'bg-hq-bg/50 text-hq-muted/70 hover:text-hq-accent hover:bg-hq-accent/10'">
                            <svg class="w-3.5 h-3.5 transition-transform" :class="taskHistory.expandedId === task.task_id ? 'rotate-90' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                            <span x-text="taskHistory.expandedId === task.task_id ? 'Ï†ëÍ∏∞' : 'Í≤∞Í≥º Î≥¥Í∏∞'"></span>
                          </button>
                          <!-- ÎÇ¥Î∂Ä ÎåÄÌôî Î≤ÑÌäº (correlation_id ÏûàÏùÑ ÎïåÎßå) -->
                          <button x-show="task.correlation_id"
                                  @click.stop="loadReplay(task.correlation_id, task.task_id)"
                                  class="text-[11px] px-3 py-1 rounded-lg bg-hq-bg/50 text-hq-muted/70 hover:text-hq-accent hover:bg-hq-accent/10 transition flex items-center gap-1">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                            ÎÇ¥Î∂Ä ÎåÄÌôî
                          </button>
                          <!-- Ïä§ÌéòÏù¥ÏÑú -->
                          <div class="flex-1"></div>
                          <!-- Î∂ÅÎßàÌÅ¨ -->
                          <button @click.stop="toggleBookmark(task.task_id)"
                                  class="w-7 h-7 rounded-lg flex items-center justify-center text-sm transition"
                                  :class="task.bookmarked ? 'text-hq-yellow bg-hq-yellow/10' : 'text-hq-muted/40 hover:text-hq-yellow hover:bg-hq-yellow/5'"
                                  title="Î∂ÅÎßàÌÅ¨">&#9733;</button>
                          <!-- ÏÇ≠Ï†ú -->
                          <button @click.stop="deleteTask(task.task_id)"
                                  class="w-8 h-8 rounded-lg flex items-center justify-center text-hq-muted/30 hover:text-hq-red hover:bg-hq-red/8 transition"
                                  title="ÏÇ≠Ï†ú">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg>
                          </button>
                        </div>

                        <!-- ÌéºÏπ®: ÏÉÅÏÑ∏ Í≤∞Í≥º -->
                        <div x-show="taskHistory.expandedId === task.task_id"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 -translate-y-1"
                             x-transition:enter-end="opacity-100 translate-y-0"
                             class="mt-4 pt-4 border-t border-hq-border/15 ml-6">
                          <div class="text-sm markdown-body max-h-[500px] overflow-y-auto rounded-xl bg-hq-bg/40 p-4 border border-hq-border/10"
                               x-html="renderMarkdown(task._fullResult || '')"></div>
                          <!-- ÏóêÏù¥Ï†ÑÌä∏ Í∞Ñ ÎåÄÌôî ÌùêÎ¶Ñ (Î¶¨ÌîåÎ†àÏù¥) -->
                          <div x-show="taskHistory.replayData[task.task_id]"
                               class="mt-3 pl-4 border-l-2 border-hq-accent/20 rounded-r-lg bg-hq-bg/20 p-3">
                            <div class="text-xs text-hq-muted mb-2 font-semibold">ÏóêÏù¥Ï†ÑÌä∏ Í∞Ñ ÎåÄÌôî ÌùêÎ¶Ñ</div>
                            <div x-html="renderReplayTree(taskHistory.replayData[task.task_id])"></div>
                          </div>
                          <!-- N-9: ÏÑπÏÖò Î∞òÎ†§/Ïû¨ÏûëÏÑ± -->
                          <div x-show="task.status === 'completed'" class="mt-3 flex items-center gap-2 flex-wrap">
                            <button @click="task._rewriteOpen = !task._rewriteOpen"
                                    class="text-[10px] px-2.5 py-1 rounded-lg bg-hq-red/10 text-hq-red/70 hover:bg-hq-red/20 transition flex items-center gap-1">
                              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                              ÏÑπÏÖò Î∞òÎ†§
                            </button>
                            <span x-show="task.parent_task_id" class="text-[9px] text-hq-muted/50 font-mono">
                              ÏõêÎ≥∏: #<span x-text="(task.parent_task_id || '').slice(0,8)"></span>
                            </span>
                          </div>
                          <!-- Î∞òÎ†§ ÏûÖÎ†• Ìèº -->
                          <div x-show="task._rewriteOpen" x-transition class="mt-2 p-3 bg-hq-surface/50 border border-hq-border/20 rounded-xl space-y-2">
                            <div class="text-[10px] text-hq-muted font-semibold">Î∞òÎ†§Ìï† ÏÑπÏÖò Î≤àÌò∏ (ÏâºÌëú Íµ¨Î∂Ñ)</div>
                            <input type="text" x-model="task._rewriteSections"
                                   placeholder="Ïòà: 1, 3, 5"
                                   class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-1.5 text-xs text-hq-text placeholder-hq-muted/40 focus:border-hq-accent outline-none">
                            <input type="text" x-model="task._rewriteFeedback"
                                   placeholder="ÌîºÎìúÎ∞± (ÏÑ†ÌÉù)"
                                   class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-1.5 text-xs text-hq-text placeholder-hq-muted/40 focus:border-hq-accent outline-none">
                            <button @click="requestRewrite(task.task_id, task._rewriteSections, task._rewriteFeedback)"
                                    class="text-[10px] px-3 py-1.5 rounded-lg bg-hq-red/20 text-hq-red hover:bg-hq-red/30 transition font-semibold">
                              Ïû¨ÏûëÏÑ± ÏöîÏ≤≠
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </template>
            <!-- Îçî Î≥¥Í∏∞ Î≤ÑÌäº -->
            <div x-show="hasMoreTasks()" class="text-center py-4">
              <button @click="loadMoreTasks()"
                      class="text-xs text-hq-accent hover:text-hq-accent/80 bg-hq-accent/10 border border-hq-accent/20 rounded-lg px-6 py-2 transition">
                Îçî Î≥¥Í∏∞ (<span x-text="taskHistory.items.length - taskHistoryPage * taskHistoryPageSize"></span>Í±¥ ÎÇ®Ïùå)
              </button>
            </div>
            <template x-if="!taskHistory.items || taskHistory.items.length === 0">
              <div class="text-center py-16 relative">
                <!-- ÌîåÎ°úÌåÖ ÏùºÎü¨Ïä§Ìä∏ -->
                <div class="relative inline-block mb-6">
                  <div class="float-anim">
                    <svg class="w-20 h-20 mx-auto text-hq-accent/40" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1">
                      <rect x="2" y="3" width="20" height="14" rx="2"/>
                      <path d="M8 21h8M12 17v4"/>
                      <circle cx="12" cy="10" r="2" fill="currentColor" opacity="0.3"/>
                    </svg>
                  </div>
                  <!-- Ïû•Ïãù ÎèÑÌä∏ -->
                  <div class="absolute -top-2 -right-2 w-3 h-3 rounded-full bg-hq-green/30 float-anim" style="animation-delay:0.5s"></div>
                  <div class="absolute -bottom-1 -left-3 w-2 h-2 rounded-full bg-hq-accent/30 float-anim" style="animation-delay:1s"></div>
                  <div class="absolute top-1/2 -right-5 w-2 h-2 rounded-full bg-hq-yellow/30 float-anim" style="animation-delay:1.5s"></div>
                </div>
                <div class="text-base font-semibold text-hq-text mb-1">ÏóêÏù¥Ï†ÑÌä∏ ÎåÄÍ∏∞ Ï§ë</div>
                <div class="text-xs text-hq-muted/70 mb-6">Î™ÖÎ†πÏùÑ ÎÇ¥Î¶¨Î©¥ ÏûëÏ†Ñ Í∏∞Î°ùÏù¥ ÏåìÏûÖÎãàÎã§</div>
                <!-- Îπ†Î•∏ Î™ÖÎ†π Î≤ÑÌäº ‚Äî ÏùºÏùº Î£®Ìã¥ -->
                <div class="text-[9px] text-hq-muted/60 uppercase tracking-wider mb-2">ÏùºÏùº Î£®Ìã¥</div>
                <div class="flex flex-wrap justify-center gap-2 mb-4">
                  <button @click="inputText='Ï†Ñ Î∂ÄÏÑú ÌòÑÌô© Î≥¥Í≥†'; activeTab='command'"
                          class="text-xs bg-hq-cyan/10 text-hq-cyan border border-hq-cyan/20 rounded-full px-4 py-1.5 hover:bg-hq-cyan/20 transition">
                    üè¢ Ï†Ñ Î∂ÄÏÑú ÌòÑÌô©
                  </button>
                  <button @click="inputText='Ïò§Îäò ÏùºÏ†ï Î∞è ÏòàÏïΩ ÌòÑÌô© Î≥¥Í≥†'; activeTab='command'"
                          class="text-xs bg-hq-accent/10 text-hq-accent border border-hq-accent/20 rounded-full px-4 py-1.5 hover:bg-hq-accent/20 transition">
                    üìÖ Ïò§Îäò ÏùºÏ†ï
                  </button>
                  <button @click="inputText='ÏòàÏÇ∞ ÏÇ¨Ïö© ÌòÑÌô© Î≥¥Í≥†'; activeTab='command'"
                          class="text-xs bg-hq-yellow/10 text-hq-yellow border border-hq-yellow/20 rounded-full px-4 py-1.5 hover:bg-hq-yellow/20 transition">
                    üí∞ ÏòàÏÇ∞ ÌòÑÌô©
                  </button>
                </div>
                <!-- ÏãúÏä§ÌÖú Í¥ÄÎ¶¨ -->
                <div class="text-[9px] text-hq-muted/60 uppercase tracking-wider mb-2">ÏãúÏä§ÌÖú Í¥ÄÎ¶¨</div>
                <div class="flex flex-wrap justify-center gap-2">
                  <button @click="inputText='/ÎèÑÍµ¨Ï†êÍ≤Ä'; activeTab='command'"
                          class="text-xs bg-hq-green/10 text-hq-green border border-hq-green/20 rounded-full px-4 py-1.5 hover:bg-hq-green/20 transition">
                    üîß ÎèÑÍµ¨ Ï†êÍ≤Ä
                  </button>
                  <button @click="inputText='/Î∞∞ÏπòÏã§Ìñâ Ï†ÑÏ≤¥ Î≥¥Í≥†'; activeTab='command'"
                          class="text-xs bg-hq-purple/10 text-hq-purple border border-hq-purple/20 rounded-full px-4 py-1.5 hover:bg-hq-purple/20 transition">
                    üì§ ÎåÄÍ∏∞ Ï†ÑÏÜ°
                  </button>
                  <button @click="inputText='/Î∞∞ÏπòÏÉÅÌÉú'; activeTab='command'"
                          class="text-xs bg-hq-muted/10 text-hq-muted border border-hq-border rounded-full px-4 py-1.5 hover:bg-hq-muted/20 transition">
                    üìã Î∞∞Ïπò ÏÉÅÌÉú
                  </button>
                </div>
                <!-- ÏµúÍ∑º ÏÇ¨Ïö© Î™ÖÎ†π -->
                <template x-if="recentCommands.length > 0">
                  <div class="mt-4">
                    <div class="text-[9px] text-hq-muted/60 uppercase tracking-wider mb-2">ÏµúÍ∑º ÏÇ¨Ïö©</div>
                    <div class="flex flex-wrap justify-center gap-2">
                      <template x-for="(cmd, i) in recentCommands.slice(0, 5)" :key="i">
                        <button @click="inputText=cmd; activeTab='command'"
                                class="text-[11px] bg-hq-surface text-hq-muted border border-hq-border/50 rounded-full px-3 py-1 hover:text-hq-text hover:border-hq-accent/30 transition truncate max-w-[200px]"
                                x-text="cmd"></button>
                      </template>
                    </div>
                  </div>
                </template>
              </div>
            </template>
          </div>
        </div>
      </div></template>

      <!-- ‚ïê‚ïê‚ïê Tab: ÏòàÏïΩ (Schedule) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'schedule'" x-cloak
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 translate-y-2"
           x-transition:enter-end="opacity-100 translate-y-0"
           class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
        <div class="max-w-4xl mx-auto fade-in-up">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-bold text-hq-text mb-1 font-mono tracking-normal">CRON BASE</h1>
              <p class="text-sm text-hq-muted">Î∞òÎ≥µ ÏûëÏóÖÏùÑ ÏûêÎèôÏúºÎ°ú Ïã§ÌñâÌï©ÎãàÎã§</p>
            </div>
            <button @click="schedules.showModal = true"
                    class="bg-hq-green/20 hover:bg-hq-green/30 text-hq-green border border-hq-green/40 rounded-lg px-4 py-2 text-sm font-semibold font-mono transition">
              + NEW SCHEDULE
            </button>
          </div>

          <div class="space-y-3">
            <template x-for="s in schedules.items" :key="s.id">
              <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <div class="mb-1.5"><span class="inline-block w-2 h-2 rounded-full mr-1.5 align-middle" :class="s.enabled ? 'bg-emerald-400' : 'bg-gray-500'"></span><span class="text-sm font-semibold align-middle text-hq-text" x-text="s.name"></span></div>
                    <div class="text-[12px] text-hq-muted mb-1" x-text="s.command"></div>
                    <div class="flex items-center gap-3 text-[11px] text-hq-muted/70">
                      <span x-text="'Ï£ºÍ∏∞: ' + (s.cron_label || s.cron)"></span>
                      <span x-show="s.last_run" x-text="'ÎßàÏßÄÎßâ: ' + s.last_run"></span>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <button @click="toggleSchedule(s.id)"
                            class="text-xs px-3 py-1.5 rounded-lg border transition"
                            :class="s.enabled ? 'border-hq-yellow/30 text-hq-yellow hover:bg-hq-yellow/10' : 'border-hq-green/30 text-hq-green hover:bg-hq-green/10'"
                            x-text="s.enabled ? 'Ï§ëÏßÄ' : 'ÏãúÏûë'"></button>
                    <button @click="confirmDelete = {type:'schedule', id:s.id, name:s.name||s.command||'Ïù¥Î¶Ñ ÏóÜÏùå'}"
                            class="text-xs px-3 py-1.5 rounded-lg border border-hq-red/30 text-hq-red hover:bg-hq-red/10 transition">ÏÇ≠Ï†ú</button>
                  </div>
                </div>
              </div>
            </template>
            <template x-if="!schedules.items || schedules.items.length === 0">
              <div class="text-center py-16 text-hq-muted/80 text-sm">ÏòàÏïΩÎêú ÏûëÏóÖÏù¥ ÏóÜÏäµÎãàÎã§. ÏÉà ÏòàÏïΩÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî.</div>
            </template>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab: ÏõåÌÅ¨ÌîåÎ°úÏö∞ (Workflow) ‚ïê‚ïê‚ïê -->
      <template x-if="viewMode === 'chat' && activeTab === 'workflow'"><div class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
        <div class="max-w-4xl mx-auto fade-in-up">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-bold text-hq-text mb-1 font-mono tracking-normal">AUTOMATION</h1>
              <p class="text-sm text-hq-muted">Ïó¨Îü¨ Îã®Í≥ÑÎ•º Ïó∞Í≤∞Ìï¥ÏÑú ÏûêÎèôÌôî ÌùêÎ¶ÑÏùÑ ÎßåÎìúÏÑ∏Ïöî</p>
            </div>
            <button @click="workflows.showEditor = true; workflows.editing = null; workflows.editSteps = [{name:'', command:''}]"
                    class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm font-semibold transition">
              + ÏÉà ÏõåÌÅ¨ÌîåÎ°úÏö∞
            </button>
          </div>

          <!-- ÎßàÏßÄÎßâ Ïã§Ìñâ Í≤∞Í≥º -->
          <div x-show="workflows.lastResult" class="mb-4 rounded-xl border p-4"
               :class="workflows.lastResult?.status === 'success' ? 'bg-hq-green/5 border-hq-green/30' : 'bg-hq-red/5 border-hq-red/30'">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-2">
                <span class="text-sm" x-text="workflows.lastResult?.status === 'success' ? '‚úÖ' : '‚ùå'"></span>
                <span class="text-sm font-semibold text-hq-text" x-text="workflows.lastResult?.name"></span>
              </div>
              <button @click="workflows.lastResult = null" class="text-xs text-hq-muted hover:text-hq-text transition">&times; Îã´Í∏∞</button>
            </div>
            <div class="text-xs text-hq-muted whitespace-pre-wrap" x-text="workflows.lastResult?.message"></div>
          </div>

          <div class="space-y-3">
            <template x-for="wf in workflows.items" :key="wf.id">
              <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
                <div class="flex items-start justify-between gap-3">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 flex-wrap mb-1">
                      <span class="inline-block w-2 h-2 rounded-full bg-violet-400 shrink-0"></span>
                      <span class="text-sm font-semibold text-hq-text font-title" x-text="wf.name"></span>
                      <template x-for="(step, i) in wf.steps" :key="i">
                        <div class="flex items-center gap-1">
                          <span x-show="i > 0" class="text-hq-muted/40 text-[10px]">‚Üí</span>
                          <span class="text-[10px] bg-hq-accent/10 text-hq-accent rounded-md px-2 py-0.5 font-medium" x-text="step.name || ('Îã®Í≥Ñ ' + (i+1))"></span>
                        </div>
                      </template>
                    </div>
                    <div class="text-[12px] text-hq-muted ml-3.5" x-text="wf.description || wf.steps.length + 'Îã®Í≥Ñ'"></div>
                  </div>
                  <div class="flex items-center gap-2 shrink-0">
                    <!-- Ïã§ÏãúÍ∞Ñ/Î∞∞Ïπò Î™®Îìú ÌÜ†Í∏Ä -->
                    <div class="flex rounded-md border border-hq-border/30 overflow-hidden text-[10px]">
                      <button @click="wf._mode = 'realtime'"
                              :class="(wf._mode || 'realtime') === 'realtime' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                              class="px-2 py-1 transition">Ïã§ÏãúÍ∞Ñ</button>
                      <button @click="wf._mode = 'batch'"
                              :class="wf._mode === 'batch' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                              class="px-2 py-1 transition">Î∞∞Ïπò</button>
                    </div>
                    <!-- Ïã§Ìñâ Î≤ÑÌäº (Î∞îÎ°ú Ïã§Ìñâ) -->
                    <button @click="runWorkflowDirect(wf)"
                            :disabled="workflows.runningId === wf.id"
                            class="bg-hq-green/20 text-hq-green border border-hq-green/30 rounded-lg px-3 py-1.5 text-xs font-semibold hover:bg-hq-green/30 transition disabled:opacity-50">
                      <span x-show="workflows.runningId !== wf.id">Ïã§Ìñâ</span>
                      <span x-show="workflows.runningId === wf.id" class="flex items-center gap-1">
                        <svg class="w-3 h-3 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
                        ÏßÑÌñâÏ§ë
                      </span>
                    </button>
                    <button @click="editWorkflow(wf)"
                            class="text-xs px-3 py-1.5 rounded-lg border border-hq-border text-hq-muted hover:text-hq-text transition">ÏàòÏ†ï</button>
                    <button @click="confirmDelete = {type:'workflow', id:wf.id, name:wf.name||'Ïù¥Î¶Ñ ÏóÜÏùå'}"
                            class="text-xs px-3 py-1.5 rounded-lg border border-hq-red/30 text-hq-red hover:bg-hq-red/10 transition">ÏÇ≠Ï†ú</button>
                  </div>
                </div>
                <!-- ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ïã§Ìñâ ÏßÑÌñâ ÏÉÅÌÉú (Ïπ¥Îìú ÏïàÏóê ÌëúÏãú) -->
                <div x-show="workflows.runningId === wf.id || wf._lastResult"
                     x-transition class="mt-3 pt-3 border-t border-hq-border/20">
                  <!-- ÏßÑÌñâ Î∞î (Ïã§Ìñâ Ï§ë) -->
                  <div x-show="workflows.runningId === wf.id">
                    <div class="flex items-center gap-2 mb-1.5">
                      <div class="flex-1 bg-hq-muted/10 rounded-full h-1.5 overflow-hidden">
                        <div class="bg-hq-green h-1.5 rounded-full transition-all duration-500"
                             :style="`width: ${wf._progress || 0}%`"></div>
                      </div>
                      <span class="text-[10px] text-hq-muted shrink-0 font-mono"
                            x-text="`${wf._currentStep || 0}/${wf.steps?.length || 0}`"></span>
                    </div>
                    <div class="text-[11px] text-hq-muted" x-text="wf._progressText || 'Ï§ÄÎπÑ Ï§ë...'"></div>
                  </div>
                  <!-- Í≤∞Í≥º (ÏôÑÎ£å ÌõÑ) -->
                  <div x-show="wf._lastResult && workflows.runningId !== wf.id">
                    <button @click="wf._showResult = !wf._showResult"
                            class="text-[11px] text-hq-accent hover:text-hq-text transition flex items-center gap-1">
                      <svg class="w-3 h-3 transition-transform" :class="wf._showResult ? 'rotate-90' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                      <span x-text="wf._showResult ? 'Í≤∞Í≥º Ï†ëÍ∏∞' : 'Í≤∞Í≥º Î≥¥Í∏∞'"></span>
                      <span class="text-hq-muted ml-1" x-text="wf._resultTime || ''"></span>
                    </button>
                    <div x-show="wf._showResult" x-transition
                         class="mt-2 p-3 rounded-lg bg-hq-bg/40 border border-hq-border/20 text-xs text-hq-text/80 whitespace-pre-wrap max-h-48 overflow-y-auto markdown-body"
                         x-html="renderMarkdown(wf._lastResult || '')"></div>
                  </div>
                </div>
              </div>
            </template>
            <template x-if="!workflows.items || workflows.items.length === 0">
              <div class="text-center py-16 text-hq-muted/80 text-sm">ÏõåÌÅ¨ÌîåÎ°úÏö∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÏÉà ÏõåÌÅ¨ÌîåÎ°úÏö∞Î•º ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî.</div>
            </template>
          </div>
        </div>
      </div></template>

      <!-- ‚ïê‚ïê‚ïê ÌÜµÏã†Î°úÍ∑∏ (ÌôúÎèô Î°úÍ∑∏ + ÍµêÏã† Î°úÍ∑∏ ÌÜµÌï©) ‚ïê‚ïê‚ïê -->
      <template x-if="viewMode === 'chat' && activeTab === 'activityLog'"><div class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
        <div class="max-w-5xl mx-auto fade-in-up">
          <!-- Ìó§Îçî + ÏÑúÎ∏åÌÉ≠ -->
          <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-3">
            <div class="flex items-center gap-3 md:gap-4">
              <h2 class="text-base md:text-lg font-bold text-hq-text font-mono tracking-normal">COMMS LOG</h2>
              <!-- ÏÑúÎ∏åÌÉ≠ Ï†ÑÌôò -->
              <div class="flex bg-hq-surface border border-hq-border rounded-lg overflow-hidden flex-wrap">
                <button @click="commsLogSubTab = 'activity'"
                        :class="commsLogSubTab === 'activity' ? 'bg-hq-accent/20 text-hq-accent font-bold' : 'text-hq-muted hover:text-hq-text'"
                        class="px-3 py-1.5 text-xs font-semibold transition">
                  üìã ÌôúÎèô <span class="font-mono ml-1" x-text="activityLogs.length"></span>
                </button>
                <button @click="commsLogSubTab = 'qa'"
                        :class="commsLogSubTab === 'qa' ? 'bg-hq-green/20 text-hq-green font-bold' : 'text-hq-muted hover:text-hq-text'"
                        class="px-3 py-1.5 text-xs font-semibold transition border-l border-hq-border">
                  ‚úÖ Í≤ÄÏàò <span class="font-mono ml-1" x-text="qaLogs.length"></span>
                </button>
                <button @click="commsLogSubTab = 'tools'"
                        :class="commsLogSubTab === 'tools' ? 'bg-hq-orange/20 text-hq-orange font-bold' : 'text-hq-muted hover:text-hq-text'"
                        class="px-3 py-1.5 text-xs font-semibold transition border-l border-hq-border">
                  üîß ÎèÑÍµ¨ <span class="font-mono ml-1" x-text="toolLogs.length"></span>
                </button>
              </div>
            </div>
            <!-- ÌïÑÌÑ∞ + üóëÔ∏è ÏÇ≠Ï†ú (ÌôúÎèô Î°úÍ∑∏Ïùº Îïå) -->
            <div x-show="commsLogSubTab === 'activity'" class="flex items-center gap-3">
              <select x-model="activityLogFilter"
                      class="bg-hq-surface border border-hq-border rounded-lg px-3 py-1.5 text-xs text-hq-text min-w-[120px]">
                <option value="all">Ï†ÑÏ≤¥ ÏóêÏù¥Ï†ÑÌä∏</option>
                <template x-for="(name, id) in agentNames" :key="id">
                  <option :value="id" x-text="name"></option>
                </template>
              </select>
              <button @click="showConfirm({ title: 'ÌôúÎèô Î°úÍ∑∏ ÏÇ≠Ï†ú', message: 'ÌôúÎèô Î°úÍ∑∏Î•º Ï†ÑÏ≤¥ ÏÇ≠Ï†úÌï†ÍπåÏöî?', confirmText: 'ÏÇ≠Ï†ú', onConfirm: () => clearLogsTab('activity') })" title="ÌôúÎèô Î°úÍ∑∏ Ï†ÑÏ≤¥ÏÇ≠Ï†ú"
                      class="text-hq-muted hover:text-hq-red transition p-1 rounded">üóëÔ∏è</button>
            </div>
            <!-- üóëÔ∏è ÏÇ≠Ï†ú (Í≤ÄÏàò Î°úÍ∑∏Ïùº Îïå) -->
            <div x-show="commsLogSubTab === 'qa'" class="flex items-center gap-2">
              <button @click="showConfirm({ title: 'Í≤ÄÏàò Î°úÍ∑∏ ÏÇ≠Ï†ú', message: 'Í≤ÄÏàò Î°úÍ∑∏Î•º Ï†ÑÏ≤¥ ÏÇ≠Ï†úÌï†ÍπåÏöî?', confirmText: 'ÏÇ≠Ï†ú', onConfirm: () => clearLogsTab('qa') })" title="Í≤ÄÏàò Î°úÍ∑∏ Ï†ÑÏ≤¥ÏÇ≠Ï†ú"
                      class="text-hq-muted hover:text-hq-red transition p-1 rounded">üóëÔ∏è</button>
            </div>
            <!-- üóëÔ∏è ÏÇ≠Ï†ú (ÎèÑÍµ¨ Î°úÍ∑∏Ïùº Îïå) -->
            <div x-show="commsLogSubTab === 'tools'" class="flex items-center gap-2">
              <button @click="showConfirm({ title: 'ÎèÑÍµ¨ Î°úÍ∑∏ ÏÇ≠Ï†ú', message: 'ÎèÑÍµ¨ Î°úÍ∑∏Î•º Ï†ÑÏ≤¥ ÏÇ≠Ï†úÌï†ÍπåÏöî?', confirmText: 'ÏÇ≠Ï†ú', onConfirm: () => clearLogsTab('tools') })" title="ÎèÑÍµ¨ Î°úÍ∑∏ Ï†ÑÏ≤¥ÏÇ≠Ï†ú"
                      class="text-hq-muted hover:text-hq-red transition p-1 rounded">üóëÔ∏è</button>
            </div>
          </div>

          <!-- SSE Ïó∞Í≤∞ ÏÉÅÌÉú ÌëúÏãú -->
          <div class="flex items-center gap-2 mb-3 text-[11px]">
            <span class="w-1.5 h-1.5 rounded-full animate-pulse" :class="wsConnected ? 'bg-hq-green' : 'bg-hq-red'"></span>
            <span class="text-hq-muted/60" x-text="wsConnected ? 'Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞Îê®' : 'Ïó∞Í≤∞ ÎåÄÍ∏∞'"></span>
            <span class="w-1.5 h-1.5 rounded-full animate-pulse ml-3" :class="_commsSSE ? 'bg-hq-cyan' : 'bg-hq-muted/40'"></span>
            <span class="text-hq-muted/60" x-text="_commsSSE ? 'ÍµêÏã† SSE Ïó∞Í≤∞Îê®' : 'ÍµêÏã† SSE ÎåÄÍ∏∞'"></span>
          </div>

          <!-- ‚îÄ‚îÄ ÌôúÎèô Î°úÍ∑∏ ÏÑúÎ∏åÌÉ≠ ‚îÄ‚îÄ -->
          <div x-show="commsLogSubTab === 'activity'" class="space-y-1">
            <template x-for="(log, i) in activityLogs.filter(l => activityLogFilter === 'all' || l.agent_id === activityLogFilter).slice().reverse()" :key="i">
              <div class="flex items-center gap-3 bg-hq-surface border border-hq-border/30 rounded-lg px-4 py-2.5 hover:bg-hq-surface/80 transition">
                <div class="shrink-0 text-right" style="min-width:72px;">
                  <div class="text-[10px] font-mono text-hq-muted/60 leading-tight" x-text="log.timeDate || log.time?.split(' ')[0] || ''"></div>
                  <div class="text-[13px] font-mono font-semibold text-hq-muted leading-tight" x-text="log.timeClock || log.time?.split(' ')[1] || log.time || ''"></div>
                </div>
                <span class="w-7 h-7 rounded-md flex items-center justify-center text-[10px] font-bold shrink-0"
                      :class="getAgentAvatarClass(log.agent_id)" x-text="getAgentInitials(log.agent_id)"></span>
                <span class="text-sm font-medium shrink-0 w-24 truncate" :class="getAgentColor(log.agent_id) || 'text-hq-cyan/80'" x-text="getAgentName(log.agent_id)"></span>
                <span class="text-sm text-hq-text/90 flex-1" x-text="log.action"></span>
              </div>
            </template>
            <template x-if="activityLogs.length === 0">
              <div class="text-center text-hq-muted/80 py-12">ÏïÑÏßÅ ÌôúÎèô Î°úÍ∑∏Í∞Ä ÏóÜÏäµÎãàÎã§. ÏóêÏù¥Ï†ÑÌä∏Ïóê ÏûëÏóÖÏùÑ ÏßÄÏãúÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</div>
            </template>
          </div>

          <!-- ‚îÄ‚îÄ Í≤ÄÏàò Î°úÍ∑∏ ÏÑúÎ∏åÌÉ≠ ‚îÄ‚îÄ -->
          <div x-show="commsLogSubTab === 'qa'" class="space-y-1">
            <template x-for="(log, i) in qaLogs.slice().reverse()" :key="i">
              <div class="flex items-center gap-3 bg-hq-surface border rounded-lg px-4 py-2.5 hover:bg-hq-surface/80 transition"
                   :class="log.level === 'qa_pass' ? 'border-hq-green/30' : 'border-hq-red/30'">
                <div class="shrink-0 text-right" style="min-width:72px;">
                  <div class="text-[10px] font-mono text-hq-muted/60 leading-tight" x-text="log.timeDate || log.time?.split(' ')[0] || ''"></div>
                  <div class="text-[13px] font-mono font-semibold text-hq-muted leading-tight" x-text="log.timeClock || log.time?.split(' ')[1] || log.time || ''"></div>
                </div>
                <span class="w-7 h-7 rounded-md flex items-center justify-center text-xs font-bold shrink-0"
                      :class="log.level === 'qa_pass' ? 'bg-hq-green/20 text-hq-green' : 'bg-hq-red/20 text-hq-red'"
                      x-text="log.level === 'qa_pass' ? '‚úÖ' : '‚ùå'"></span>
                <span class="text-sm font-medium shrink-0 w-24 truncate" :class="getAgentColor(log.agent_id) || 'text-hq-cyan/80'" x-text="getAgentName(log.agent_id)"></span>
                <span class="text-sm text-hq-text/90 flex-1" x-text="log.action"></span>
              </div>
            </template>
            <template x-if="qaLogs.length === 0">
              <div class="text-center text-hq-muted/80 py-12">
                <div class="text-sm mb-1">ÏïÑÏßÅ Í≤ÄÏàò Î°úÍ∑∏Í∞Ä ÏóÜÏäµÎãàÎã§</div>
                <div class="text-[11px] text-hq-muted/50">ÏóêÏù¥Ï†ÑÌä∏ ÏûëÏóÖ Ïãú ÌíàÏßàÍ≤ÄÏàò Í≤∞Í≥ºÍ∞Ä Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§</div>
              </div>
            </template>
          </div>

          <!-- ‚îÄ‚îÄ ÎèÑÍµ¨ Î°úÍ∑∏ ÏÑúÎ∏åÌÉ≠ ‚îÄ‚îÄ -->
          <div x-show="commsLogSubTab === 'tools'" class="space-y-1">
            <template x-for="(log, i) in toolLogs.slice().reverse()" :key="i">
              <div class="flex items-center gap-3 bg-hq-surface border border-hq-border/30 rounded-lg px-4 py-2.5 hover:bg-hq-surface/80 transition">
                <div class="shrink-0 text-right" style="min-width:72px;">
                  <div class="text-[10px] font-mono text-hq-muted/60 leading-tight" x-text="log.timeDate || log.time?.split(' ')[0] || ''"></div>
                  <div class="text-[13px] font-mono font-semibold text-hq-muted leading-tight" x-text="log.timeClock || log.time?.split(' ')[1] || log.time || ''"></div>
                </div>
                <span class="w-7 h-7 rounded-md flex items-center justify-center text-xs font-bold shrink-0 bg-hq-orange/20 text-hq-orange">üîß</span>
                <span class="text-sm font-medium shrink-0 w-24 truncate" :class="getAgentColor(log.agent_id) || 'text-hq-cyan/80'" x-text="getAgentName(log.agent_id)"></span>
                <span class="text-sm text-hq-text/90 flex-1" x-text="log.action"></span>
              </div>
            </template>
            <template x-if="toolLogs.length === 0">
              <div class="text-center text-hq-muted/80 py-12">
                <div class="text-sm mb-1">ÏïÑÏßÅ ÎèÑÍµ¨ ÏÇ¨Ïö© Î°úÍ∑∏Í∞Ä ÏóÜÏäµÎãàÎã§</div>
                <div class="text-[11px] text-hq-muted/50">ÏóêÏù¥Ï†ÑÌä∏Í∞Ä APIÎ•º Ìò∏Ï∂úÌïòÎ©¥ Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§</div>
              </div>
            </template>
          </div>
        </div>
      </div></template>

      <!-- ‚ïê‚ïê‚ïê ARGOS ÌÉ≠ (Phase 6-8) ‚ïê‚ïê‚ïê -->
      <template x-if="viewMode === 'chat' && activeTab === 'intelligence'">
        <div class="flex-1 overflow-y-auto scrollbar-thin p-4 bg-grid">
          <div class="max-w-5xl mx-auto space-y-4">
            <!-- Ìó§Îçî -->
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-base font-bold text-hq-text">üì° ARGOS</h2>
                <p class="text-[11px] text-hq-muted">Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Î†àÏù¥Ïñ¥ ¬∑ AI ÌôúÎèô ¬∑ ÎπÑÏö© Ï∂îÏ†Å ¬∑ ÏóêÎü¨ Î™®ÎãàÌÑ∞ÎßÅ</p>
              </div>
              <button @click="loadIntelligence()"
                      :disabled="intelligence.loading"
                      class="text-xs px-3 py-1.5 rounded-lg bg-hq-surface border border-hq-border text-hq-muted hover:text-hq-text transition">
                <span x-text="intelligence.loading ? 'Î°úÎî© Ï§ë...' : 'ÏÉàÎ°úÍ≥†Ïπ®'"></span>
              </button>
            </div>

            <!-- ÏãúÏä§ÌÖú ÏÉÅÌÉú Ïπ¥Îìú 4Í∞ú -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              <template x-for="[type, label] in [['price','Ï£ºÍ∞Ä'], ['news','Îâ¥Ïä§'], ['dart','Í≥µÏãú'], ['macro','Îß§ÌÅ¨Î°ú']]" :key="type">
                <div class="bg-hq-panel border border-hq-border rounded-xl p-3">
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-[10px] text-hq-muted uppercase tracking-wider" x-text="label"></span>
                    <span class="text-xs" :class="(intelligence.argos[type] || {}).error ? 'text-hq-red' : 'text-hq-green'"
                          x-text="(intelligence.argos[type] || {}).error ? '‚ùå' : '‚úÖ'"></span>
                  </div>
                  <div class="text-[10px] text-hq-muted/70"
                       x-text="_fmtArgosTime((intelligence.argos[type] || {}).last) || 'ÎØ∏ÏàòÏßë'"></div>
                  <div x-show="(intelligence.argos[type] || {}).error"
                       class="text-[9px] text-hq-red/70 mt-1 truncate"
                       x-text="(intelligence.argos[type] || {}).error"></div>
                </div>
              </template>
            </div>

            <!-- ÏàòÎèô ÏàòÏßë Î≤ÑÌäº -->
            <div class="flex items-center gap-2 flex-wrap">
              <span class="text-xs text-hq-muted">Ï¶âÏãú ÏàòÏßë:</span>
              <template x-for="[type, label] in [['all','Ï†ÑÏ≤¥'], ['price','Ï£ºÍ∞Ä'], ['news','Îâ¥Ïä§'], ['dart','Í≥µÏãú'], ['macro','Îß§ÌÅ¨Î°ú']]" :key="type">
                <button @click="argosCollectNow(type)"
                        :disabled="intelligence.collectingNow"
                        class="text-[11px] px-2.5 py-1 rounded-lg border border-hq-border text-hq-muted hover:text-hq-accent hover:border-hq-accent/40 transition">
                  <span x-text="label"></span>
                </button>
              </template>
            </div>

            <!-- ÌôúÏÑ± Ìä∏Î¶¨Í±∞ -->
            <div class="bg-hq-panel border border-hq-border rounded-xl p-4">
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm font-semibold text-hq-text">üéØ ÌôúÏÑ± Ìä∏Î¶¨Í±∞</h3>
                <span class="text-[10px] text-hq-muted" x-text="intelligence.triggers.length + 'Í±¥'"></span>
              </div>
              <template x-if="intelligence.triggers.length === 0">
                <div class="text-xs text-hq-muted/60 py-2 text-center">ÌôúÏÑ± Ìä∏Î¶¨Í±∞ ÏóÜÏùå</div>
              </template>
              <template x-for="tr in intelligence.triggers" :key="tr.ticker + tr.type">
                <div class="flex items-center justify-between py-1.5 border-b border-hq-border/30 last:border-0">
                  <div class="flex items-center gap-2">
                    <span class="text-[10px] px-1.5 py-0.5 rounded"
                          :class="tr.type === 'stop_loss' ? 'bg-hq-red/15 text-hq-red' : 'bg-hq-green/15 text-hq-green'"
                          x-text="tr.type === 'stop_loss' ? 'ÏÜêÏ†à' : 'ÏùµÏ†à'"></span>
                    <span class="text-xs font-mono text-hq-text" x-text="tr.ticker"></span>
                  </div>
                  <div class="text-[11px] text-hq-muted font-mono">
                    Î™©Ìëú <span class="text-hq-text" x-text="(tr.trigger_price || 0).toLocaleString()"></span>
                  </div>
                </div>
              </template>
            </div>

            <!-- AI ÌôúÎèô ÏöîÏïΩ -->
            <div class="bg-hq-panel border border-hq-border rounded-xl p-4">
              <h3 class="text-sm font-semibold text-hq-text mb-3">ü§ñ ÏµúÍ∑º AI ÌôúÎèô</h3>
              <div class="space-y-1.5 max-h-48 overflow-y-auto scrollbar-thin">
                <template x-if="intelligence.activity.length === 0">
                  <div class="text-xs text-hq-muted/60 py-2 text-center">ÌôúÎèô ÏóÜÏùå</div>
                </template>
                <template x-for="log in intelligence.activity" :key="log.ts">
                  <div class="flex items-start gap-2 text-[11px]">
                    <span class="text-hq-muted/60 font-mono shrink-0" x-text="(log.ts || '').slice(11,16)"></span>
                    <span class="text-hq-accent/80 shrink-0" x-text="log.agent"></span>
                    <span class="text-hq-text/70 truncate" x-text="log.msg"></span>
                  </div>
                </template>
              </div>
            </div>

            <!-- ÎπÑÏö© Ï∂îÏ†Å -->
            <div class="bg-hq-panel border border-hq-border rounded-xl p-4">
              <h3 class="text-sm font-semibold text-hq-text mb-3">üí∏ ÎπÑÏö© Ï∂îÏ†Å</h3>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <div class="text-[10px] text-hq-muted mb-0.5">Ïò§Îäò</div>
                  <div class="text-lg font-bold font-mono text-hq-green" x-text="'$' + (intelligence.costs.today_usd || 0).toFixed(4)"></div>
                </div>
                <div>
                  <div class="text-[10px] text-hq-muted mb-0.5">Ïù¥Î≤à Ï£º</div>
                  <div class="text-lg font-bold font-mono text-hq-text" x-text="'$' + (intelligence.costs.week_usd || 0).toFixed(4)"></div>
                </div>
              </div>
              <!-- ÌåÄÏû•Î≥Ñ ÎπÑÏö© Î∞î -->
              <div class="space-y-1.5">
                <template x-for="ac in (intelligence.costs.per_agent || []).slice(0,8)" :key="ac.agent">
                  <div class="flex items-center gap-2">
                    <span class="text-[10px] text-hq-muted w-24 truncate" x-text="ac.agent"></span>
                    <div class="flex-1 bg-hq-bg rounded-full h-1.5">
                      <div class="bg-hq-accent h-1.5 rounded-full"
                           :style="'width:' + Math.min(100, (ac.cost / (intelligence.costs.today_usd || 0.001)) * 100) + '%'"></div>
                    </div>
                    <span class="text-[10px] font-mono text-hq-muted w-14 text-right" x-text="'$' + (ac.cost || 0).toFixed(4)"></span>
                  </div>
                </template>
              </div>
            </div>

            <!-- ÏóêÎü¨ Î°úÍ∑∏ -->
            <template x-if="intelligence.errors.length > 0">
              <div class="bg-hq-red/5 border border-hq-red/20 rounded-xl p-4">
                <h3 class="text-sm font-semibold text-hq-red mb-3">üö® ÏóêÎü¨ Î°úÍ∑∏ (24ÏãúÍ∞Ñ)</h3>
                <div class="space-y-1.5">
                  <template x-for="err in intelligence.errors" :key="err.ts">
                    <div class="text-[11px]">
                      <span class="text-hq-muted/60 font-mono" x-text="(err.ts || '').slice(11,16)"></span>
                      <span class="text-hq-red/80 ml-2" x-text="err.agent"></span>
                      <span class="text-hq-text/60 ml-2" x-text="err.msg"></span>
                    </div>
                  </template>
                </div>
              </div>
            </template>
            <template x-if="intelligence.errors.length === 0">
              <div class="text-xs text-hq-green/70 flex items-center gap-1.5">
                <span>‚úÖ</span><span>ÏµúÍ∑º 24ÏãúÍ∞Ñ ÏóêÎü¨ ÏóÜÏùå</span>
              </div>
            </template>
          </div>
        </div>
      </template>

      <!-- ‚ïê‚ïê‚ïê Knowledge View (ÏßÄÏãù Í¥ÄÎ¶¨) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'knowledge'"
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 translate-y-2"
           x-transition:enter-end="opacity-100 translate-y-0"
           class="flex-1 overflow-hidden flex bg-grid">
        <!-- Left: File Tree (ÎìúÎûòÍ∑∏Ïï§ÎìúÎ°≠ ÏßÄÏõê) -->
        <div class="w-64 border-r border-hq-border overflow-y-auto scrollbar-thin p-4 bg-hq-surface shrink-0 relative"
             @dragover.prevent="knowledge.dragOver = true"
             @dragenter.prevent="knowledge.dragOver = true"
             @dragleave.prevent="knowledge.dragOver = false"
             @drop.prevent="knowledge.dragOver = false; handleKnowledgeDrop($event)">
          <!-- ÎìúÎûòÍ∑∏Ïï§ÎìúÎ°≠ Ïò§Î≤ÑÎ†àÏù¥ -->
          <div x-show="knowledge.dragOver" x-transition.opacity
               class="absolute inset-0 z-10 bg-hq-accent/10 border-2 border-dashed border-hq-accent rounded-xl flex items-center justify-center">
            <div class="text-center">
              <svg class="w-8 h-8 text-hq-accent mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"/></svg>
              <div class="text-xs font-bold text-hq-accent">ÌååÏùºÏùÑ Ïó¨Í∏∞Ïóê ÎÜìÏúºÏÑ∏Ïöî</div>
              <div class="text-[10px] text-hq-muted mt-1">.md, .txt, .yaml, .json, .csv</div>
            </div>
          </div>
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-xs font-bold text-hq-text uppercase tracking-wider">Ï∞∏Í≥† ÏûêÎ£å</h3>
            <div class="flex items-center gap-1.5">
              <!-- E-3: ÌååÏùº ÏóÖÎ°úÎìú -->
              <button @click="$refs.knowledgeUploadInput.click()" class="text-hq-green text-xs hover:text-hq-green/80 flex items-center gap-0.5" title="Î°úÏª¨ ÌååÏùº ÏóÖÎ°úÎìú">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"/></svg>
                ÏóÖÎ°úÎìú
              </button>
              <input type="file" x-ref="knowledgeUploadInput" @change="uploadKnowledgeFile($event)" accept=".md,.txt,.yaml,.json,.csv" multiple class="hidden">
              <span class="text-hq-border">|</span>
              <button @click="knowledge.showCreateForm = !knowledge.showCreateForm" class="text-hq-accent text-xs hover:text-hq-accent/80">+ ÏÉà ÌååÏùº</button>
            </div>
          </div>
          <!-- E-3: ÏóÖÎ°úÎìú Ïãú Ìè¥Îçî ÏßÄÏ†ï (showCreateForm ÏóÜÏùÑ ÎïåÎèÑ ÌëúÏãú) -->
          <div x-show="knowledge.showCreateForm" x-transition class="mb-3 space-y-1">
            <input x-model="knowledge.newFolder" placeholder="Ìè¥ÎçîÎ™Ö" class="w-full bg-hq-bg border border-hq-border rounded-lg px-2 py-1 text-xs text-hq-text">
            <input x-model="knowledge.newFileName" placeholder="ÌååÏùºÎ™Ö" class="w-full bg-hq-bg border border-hq-border rounded-lg px-2 py-1 text-xs text-hq-text">
            <button @click="createKnowledgeFile()" class="bg-hq-accent text-white rounded-lg px-2 py-1 text-xs w-full">ÏÉùÏÑ±</button>
          </div>
          <!-- ÏóÖÎ°úÎìú Ìè¥Îçî ÏßÄÏ†ï -->
          <div class="mb-2">
            <input x-model="knowledge.uploadFolder" placeholder="ÏóÖÎ°úÎìú Ìè¥Îçî (Í∏∞Î≥∏: shared)" class="w-full bg-hq-bg border border-hq-border/50 rounded-lg px-2 py-1 text-xs text-hq-muted focus:text-hq-text focus:border-hq-accent/50 transition">
          </div>
          <template x-if="knowledge.loading">
            <div class="text-xs text-hq-muted text-center py-4">Î°úÎî© Ï§ë...</div>
          </template>
          <div class="space-y-0.5">
            <template x-for="file in knowledge.files" :key="file.folder + '/' + file.filename">
              <button @click="selectKnowledgeFile(file)"
                :class="knowledge.selectedFile && knowledge.selectedFile.folder === file.folder && knowledge.selectedFile.filename === file.filename ? 'bg-hq-accent/15 text-hq-accent' : 'text-hq-text/90 hover:bg-hq-surface'"
                class="w-full text-left px-2 py-1.5 rounded-lg text-xs transition truncate">
                <span class="text-hq-muted/80" x-text="file.folder + '/'"></span><span x-text="file.filename"></span>
              </button>
            </template>
          </div>
          <template x-if="!knowledge.loading && knowledge.files.length === 0">
            <div class="text-xs text-hq-muted/80 text-center py-4">ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§</div>
          </template>
        </div>
        <!-- Right: Editor/Viewer -->
        <div class="flex-1 overflow-y-auto scrollbar-thin p-6">
          <template x-if="knowledge.selectedFile">
            <div class="fade-in-up">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-bold text-hq-text" x-text="knowledge.selectedFile.folder + '/' + knowledge.selectedFile.filename"></h3>
                <div class="flex items-center gap-2">
                  <button @click="knowledge.editMode = !knowledge.editMode"
                    :class="knowledge.editMode ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'"
                    class="text-xs px-3 py-1 rounded-lg transition" x-text="knowledge.editMode ? 'ÎØ∏Î¶¨Î≥¥Í∏∞' : 'Ìé∏Ïßë'"></button>
                  <button x-show="knowledge.editMode" @click="saveKnowledge()" :disabled="knowledge.saving"
                    class="bg-hq-accent hover:bg-blue-600 disabled:opacity-50 text-white rounded-lg px-3 py-1 text-xs">Ï†ÄÏû•</button>
                  <button @click="deleteKnowledge()" class="text-hq-red/60 hover:text-hq-red text-xs px-2 py-1">ÏÇ≠Ï†ú</button>
                </div>
              </div>
              <div x-show="knowledge.editMode">
                <textarea x-model="knowledge.content" rows="25"
                  class="w-full bg-hq-bg border border-hq-border rounded-xl px-4 py-3 text-sm text-hq-text font-mono resize-y"></textarea>
              </div>
              <div x-show="!knowledge.editMode" class="bg-hq-surface border border-hq-border rounded-xl px-5 py-4">
                <div class="text-sm leading-relaxed markdown-body" x-html="renderMarkdown(knowledge.content)"></div>
              </div>
            </div>
          </template>
          <template x-if="!knowledge.selectedFile">
            <div class="flex items-center justify-center h-full text-hq-muted/80 text-sm">ÏôºÏ™ΩÏóêÏÑú ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
          </template>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Archive View (ÏïÑÏπ¥Ïù¥Î∏å) ‚Äî 2Îã® Î†àÏù¥ÏïÑÏõÉ ‚ïê‚ïê‚ïê -->
      <template x-if="viewMode === 'chat' && activeTab === 'archive'"><div class="flex-1 overflow-hidden p-6 bg-grid">
        <div class="max-w-7xl mx-auto fade-in-up h-full flex flex-col">
          <!-- ÏÉÅÎã®: Ï†úÎ™© + Í≤ÄÏÉâ -->
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-lg font-bold text-hq-text flex items-center gap-2 font-mono tracking-wide">
              <svg class="w-5 h-5 text-hq-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
              CLASSIFIED
              <span class="text-xs text-hq-muted font-normal ml-1" x-text="'Ï¥ù ' + archive.files.length + 'Í±¥'" x-show="archive.files.length > 0"></span>
            </h2>
            <div class="flex items-center gap-2">
              <input x-model="archive.searchCorrelation" placeholder="ÏûëÏóÖ IDÎ°ú Í≤ÄÏÉâ"
                class="bg-hq-surface border border-hq-border rounded-lg px-3 py-1.5 text-xs text-hq-text w-48" @keydown.enter="searchArchiveByCorrelation()">
              <button @click="searchArchiveByCorrelation()" class="bg-hq-accent text-white rounded-lg px-3 py-1.5 text-xs">Í≤ÄÏÉâ</button>
              <button @click="downloadArchiveZip()"
                      class="px-3 py-1.5 rounded-lg text-xs font-medium bg-hq-accent/20 text-hq-accent hover:bg-hq-accent/30 border border-hq-accent/30 transition flex items-center gap-1.5"
                      x-show="archive.files.length > 0"
                      title="ÌòÑÏû¨ ÌïÑÌÑ∞ Ï°∞Í±¥ÏúºÎ°ú ZIP Îã§Ïö¥Î°úÎìú">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>
                ZIP ÎÇ¥Î≥¥ÎÇ¥Í∏∞
              </button>
              <button @click="showDeleteAllArchiveModal = true"
                      class="px-3 py-1.5 rounded-lg text-xs font-medium bg-red-500/20 text-red-400 hover:bg-red-500/30 border border-red-500/30 transition"
                      x-show="archive.files.length > 0">
                Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
              </button>
            </div>
          </div>

          <!-- 2Îã® Î†àÏù¥ÏïÑÏõÉ (Î™®Î∞îÏùº: 1Îã®) -->
          <div class="flex gap-4 flex-1 min-h-0 archive-layout">
            <!-- ÏôºÏ™Ω: Ïπ¥Îìú Î™©Î°ù (1/3, Î™®Î∞îÏùº: Ï†ÑÏ≤¥) -->
            <div class="w-1/3 sm:min-w-[280px] overflow-y-auto scrollbar-thin pr-1 flex flex-col">
              <!-- Î∂ÄÏÑú ÌïÑÌÑ∞ (sticky) -->
              <div class="flex flex-wrap gap-1.5 mb-2 sticky top-0 z-10 pb-1" style="background: rgb(var(--hq-bg));">
                <button @click="archive.filterDivision = 'all'; loadArchive()"
                  :class="archive.filterDivision === 'all' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'"
                  class="px-2.5 py-1 text-[11px] font-semibold rounded-lg transition">Ï†ÑÏ≤¥</button>
                <template x-for="div in ['secretary','leet_master.tech','leet_master.strategy','leet_master.legal','leet_master.marketing','finance.investment','publishing']" :key="div">
                  <button @click="archive.filterDivision = div; loadArchive()"
                    :class="archive.filterDivision === div ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'"
                    class="px-2.5 py-1 text-[11px] font-semibold rounded-lg transition" x-text="getDivisionLabel(div)"></button>
                </template>
              </div>
              <!-- Ï§ëÏöîÎèÑ + ÌÉúÍ∑∏ ÌïÑÌÑ∞ -->
              <div class="flex flex-wrap gap-2 mb-3 sticky top-14 z-10 pb-1" style="background: rgb(var(--hq-bg));">
                <select x-model="archiveImportanceFilter"
                        class="bg-hq-surface border border-hq-border rounded-lg px-2 py-1 text-[10px] text-hq-text">
                  <option value="all">Ï§ëÏöîÎèÑ Ï†ÑÏ≤¥</option>
                  <option value="ÏûÑÏõêÍ∏â">ÏûÑÏõêÍ∏â</option>
                  <option value="ÏùºÎ∞ò">ÏùºÎ∞ò</option>
                </select>
                <div class="flex gap-1.5 flex-wrap items-center">
                  <template x-for="tag in ['ÏûÑÏõêÍ∏â','Ï†ÑÎûµÏã§','Í∏¥Í∏â','Í∏∞Î∞Ä','Î≥¥Í≥†ÏÑú']" :key="tag">
                    <button @click="toggleArchiveTag(tag)"
                            :class="archiveTagFilter.includes(tag) ? 'bg-hq-accent text-white border-hq-accent' : 'bg-hq-surface text-hq-muted border-hq-border'"
                            class="px-2 py-0.5 rounded text-[10px] border transition"
                            x-text="'#' + tag"></button>
                  </template>
                </div>
              </div>

              <template x-if="archive.loading">
                <div class="text-center py-8 text-hq-muted">Î°úÎî© Ï§ë...</div>
              </template>

              <!-- Î≥¥Í≥†ÏÑú Ïπ¥Îìú Î™©Î°ù (ÏÑ∏Î°ú) -->
              <div class="space-y-2 flex-1" x-show="!archive.loading">
                <template x-for="file in archive.files.filter(f => {
                  if (archive.filterDivision !== 'all' && f.division !== archive.filterDivision) return false;
                  if (archive.filterTier !== 'all') {
                    const tier = getAgentTier(f.agent_id);
                    if (archive.filterTier !== tier) return false;
                  }
                  if (archiveImportanceFilter !== 'all' && f.importance !== archiveImportanceFilter) return false;
                  if (archiveTagFilter.length > 0 && !archiveTagFilter.every(t => (f.tags||[]).includes(t))) return false;
                  return true;
                })" :key="file.division + '/' + file.filename">
                  <div @click="readArchiveReport(file)"
                    :class="archive.selectedReport && archive.selectedReport.filename === file.filename ? 'border-hq-accent bg-hq-accent/15 shadow-lg shadow-hq-accent/10 ring-1 ring-hq-accent/30 border-l-[3px] border-l-hq-accent' : 'border-hq-border/50 hover:border-hq-accent/30 hover:bg-hq-accent/5'"
                    class="group glass border rounded-xl p-3 pl-8 cursor-pointer transition-all duration-200 relative">
                    <!-- Ï≤¥ÌÅ¨Î∞ïÏä§ (hover ÎòêÎäî selectMode Ïãú ÌëúÏãú) -->
                    <div class="absolute top-2 left-2 z-10"
                         :class="archive.selectMode || archive.selectedFiles.some(f => f.division === file.division && f.filename === file.filename) ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'"
                         @click.stop="">
                      <label class="flex items-center cursor-pointer">
                        <input type="checkbox"
                               :checked="archive.selectedFiles.some(f => f.division === file.division && f.filename === file.filename)"
                               @change="e => { if(e.target.checked) { archive.selectedFiles.push(file) } else { archive.selectedFiles = archive.selectedFiles.filter(f => !(f.division === file.division && f.filename === file.filename)) } }"
                               class="sr-only">
                        <div :class="archive.selectedFiles.some(f => f.division === file.division && f.filename === file.filename) ? 'bg-hq-accent border-hq-accent' : 'bg-hq-bg border-hq-border/50'"
                             class="w-4 h-4 rounded border-2 flex items-center justify-center transition-all">
                          <svg x-show="archive.selectedFiles.some(f => f.division === file.division && f.filename === file.filename)"
                               class="w-2.5 h-2.5 text-hq-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                          </svg>
                        </div>
                      </label>
                    </div>
                    <!-- Ïï°ÏÖò Î≤ÑÌäº (Ìò∏Î≤Ñ Ïãú ÌëúÏãú) -->
                    <div class="absolute top-2 right-2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition z-10">
                      <button @click.stop="downloadArchiveReport(file)"
                              class="w-6 h-6 rounded-md flex items-center justify-center text-hq-muted/30 hover:text-hq-accent hover:bg-hq-accent/10 transition"
                              title="Îã§Ïö¥Î°úÎìú">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>
                      </button>
                      <button @click.stop="deleteArchiveReport(file)"
                              class="w-6 h-6 rounded-md flex items-center justify-center text-hq-muted/30 hover:text-hq-red hover:bg-hq-red/8 transition"
                              title="ÏÇ≠Ï†ú">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg>
                      </button>
                    </div>
                    <!-- 1Ï§Ñ: ÌåÄÎ™Ö | Îã¥ÎãπÏûê -->
                    <div class="flex items-center gap-1.5 mb-1.5">
                      <span class="status-badge text-[9px] px-1.5 py-0.5"
                        :class="file.division?.includes('tech') ? 'bg-hq-cyan/10 text-hq-cyan' :
                                file.division?.includes('strategy') ? 'bg-hq-purple/10 text-hq-purple' :
                                file.division?.includes('legal') ? 'bg-hq-red/10 text-hq-red' :
                                file.division?.includes('marketing') ? 'bg-hq-green/10 text-hq-green' :
                                file.division?.includes('finance') ? 'bg-hq-yellow/10 text-hq-yellow' :
                                'bg-hq-accent/10 text-hq-accent'"
                        x-text="getDivisionLabel(file.division)"></span>
                      <span class="text-[9px] text-hq-muted/40">|</span>
                      <span class="text-[10px] text-hq-text/80 font-medium truncate" x-text="getArchiveAuthor(file.agent_id)"></span>
                    </div>
                    <!-- 2Ï§Ñ: ÎÇ†Ïßú | Ï†úÎ™© -->
                    <div class="flex items-start gap-2 mb-1">
                      <span class="text-[10px] text-hq-muted shrink-0 pt-px font-mono" x-text="formatArchiveDateFull(file.created_at)"></span>
                      <span class="text-[10px] text-hq-muted/40 shrink-0">|</span>
                      <span class="text-xs font-semibold text-hq-text line-clamp-1 leading-tight" x-text="cleanArchiveTitle(file.filename)"></span>
                    </div>
                    <!-- 3Ï§Ñ: ÏãúÍ∞Ñ | Ïö©Îüâ -->
                    <div class="flex items-center justify-between">
                      <span class="text-[10px] text-hq-muted" x-text="formatArchiveDate(file.created_at)"></span>
                      <span class="text-[10px] text-hq-muted font-mono" x-text="file.size ? (file.size / 1024).toFixed(1) + 'KB' : ''"></span>
                    </div>
                  </div>
                </template>

                <!-- Îã§Ï§ë ÏÑ†ÌÉù Ïï°ÏÖò Î∞î -->
                <div x-show="archive.selectedFiles.length > 0"
                     class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 flex items-center gap-2 px-4 py-2.5 rounded-2xl glass border border-hq-accent/30 shadow-lg shadow-hq-accent/10 backdrop-blur-xl">
                  <span class="text-xs font-medium text-hq-accent" x-text="archive.selectedFiles.length + 'Í∞ú ÏÑ†ÌÉùÎê®'"></span>
                  <div class="w-px h-4 bg-hq-border/50"></div>
                  <button @click="downloadSelectedAsZip()"
                          class="flex items-center gap-1.5 text-xs px-3 py-1.5 rounded-lg bg-hq-accent/15 hover:bg-hq-accent/25 text-hq-accent transition font-medium">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>
                    ZIP Îã§Ïö¥Î°úÎìú
                  </button>
                  <button @click="deleteSelectedFiles()"
                          class="flex items-center gap-1.5 text-xs px-3 py-1.5 rounded-lg bg-hq-red/10 hover:bg-hq-red/20 text-hq-red transition font-medium">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg>
                    ÏÇ≠Ï†ú
                  </button>
                  <button @click="archive.selectedFiles = []"
                          class="text-xs text-hq-muted hover:text-hq-text transition px-2 py-1.5">Ï∑®ÏÜå</button>
                </div>

                <!-- Îπà ÌôîÎ©¥ ÏïàÎÇ¥ -->
                <div x-show="archive.files.filter(f => {
                  if (archive.filterDivision !== 'all' && f.division !== archive.filterDivision) return false;
                  if (archive.filterTier !== 'all' && getAgentTier(f.agent_id) !== archive.filterTier) return false;
                  if (archiveImportanceFilter !== 'all' && f.importance !== archiveImportanceFilter) return false;
                  if (archiveTagFilter.length > 0 && !archiveTagFilter.every(t => (f.tags||[]).includes(t))) return false;
                  return true;
                }).length === 0"
                     class="flex flex-col items-center justify-center py-12 text-center">
                  <div class="w-16 h-16 rounded-2xl bg-hq-purple/10 flex items-center justify-center mb-3 float-anim">
                    <svg class="w-8 h-8 text-hq-purple/50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
                  </div>
                  <div class="text-xs font-semibold text-hq-text/60 mb-1">Î≥¥Í¥ÄÎêú Î≥¥Í≥†ÏÑú ÏóÜÏùå</div>
                  <div class="text-[11px] text-hq-muted">ÏóêÏù¥Ï†ÑÌä∏ ÏûëÏóÖ ÏôÑÎ£å Ïãú ÏûêÎèô Ï†ÄÏû•Îê©ÎãàÎã§</div>
                </div>
              </div>
            </div>

            <!-- Ïò§Î•∏Ï™Ω: Î≥¥Í≥†ÏÑú ÎÇ¥Ïö© (2/3) -->
            <div class="w-2/3 overflow-y-auto scrollbar-thin">
              <template x-if="archive.content">
                <div class="glass border border-hq-border/50 rounded-xl p-6 h-full">
                  <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-bold text-hq-text break-words max-w-[60%]" x-text="cleanArchiveTitle(archive.selectedReport?.filename || '')"></h3>
                    <div class="flex items-center gap-3">
                      <button @click="copyToClipboard(archive.content)" class="text-xs text-hq-muted hover:text-hq-green transition">Î≥µÏÇ¨</button>
                      <button @click="downloadArchiveReport(archive.selectedReport)" class="text-xs text-hq-muted hover:text-hq-accent transition">Îã§Ïö¥Î°úÎìú</button>
                      <button @click="deleteArchiveReport(archive.selectedReport)" class="text-xs text-hq-muted hover:text-hq-red transition">ÏÇ≠Ï†ú</button>
                    </div>
                  </div>
                  <div class="text-sm leading-relaxed markdown-body" x-html="renderMarkdown(archive.content)"></div>
                </div>
              </template>
              <template x-if="!archive.content">
                <div class="flex items-center justify-center h-full text-hq-muted">
                  <div class="text-center">
                    <svg class="w-12 h-12 mx-auto mb-3 text-hq-purple/30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    <div class="text-sm text-hq-muted">ÏôºÏ™ΩÏóêÏÑú Î≥¥Í≥†ÏÑúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </div>
      </div></template>

      <!-- ‚ïê‚ïê‚ïê SNS Management View (SNS Í¥ÄÎ¶¨) ‚ïê‚ïê‚ïê -->
      <template x-if="viewMode === 'chat' && activeTab === 'sns'"><div class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
        <div class="max-w-5xl mx-auto fade-in-up">
          <h2 class="text-base md:text-lg font-bold text-hq-text mb-4 font-mono tracking-wide">COMM STATION</h2>
          <!-- Sub Tabs -->
          <div class="flex gap-2 mb-4 md:mb-6 overflow-x-auto scrollbar-thin pb-1">
            <button @click="sns.tab = 'status'; loadSNS()" :class="sns.tab === 'status' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1.5 text-xs font-semibold rounded-lg transition shrink-0">Ïó∞Í≤∞ ÏÉÅÌÉú</button>
            <button @click="sns.tab = 'publish'" :class="sns.tab === 'publish' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1.5 text-xs font-semibold rounded-lg transition shrink-0">Í≤åÏãúÌïòÍ∏∞</button>
            <button @click="sns.tab = 'queue'; loadSNSQueue()" :class="sns.tab === 'queue' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1.5 text-xs font-semibold rounded-lg transition shrink-0">ÏäπÏù∏ ÎåÄÍ∏∞Ïó¥</button>
            <button @click="sns.tab = 'media'; loadMediaGallery()" :class="sns.tab === 'media' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1.5 text-xs font-semibold rounded-lg transition shrink-0">ÎØ∏ÎîîÏñ¥</button>
            <button @click="sns.tab = 'events'; loadSNSEvents()" :class="sns.tab === 'events' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1.5 text-xs font-semibold rounded-lg transition shrink-0">Ïù¥Î≤§Ìä∏</button>
          </div>
          <template x-if="sns.loading">
            <div class="text-center py-8 text-hq-muted">Î°úÎî© Ï§ë...</div>
          </template>

          <!-- SNS Tab 1: Connection Status -->
          <div x-show="sns.tab === 'status' && !sns.loading">
            <div class="bg-hq-surface border border-hq-border/50 rounded-lg px-4 py-3 mb-4 text-xs text-hq-muted">
              SNS ÌîåÎû´ÌèºÏùÑ Ïó∞Í≤∞ÌïòÎ†§Î©¥ Í∞Å ÌîåÎû´ÌèºÏùò API ÌÇ§Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§. GitHub SecretsÏóê Ìï¥Îãπ ÌÇ§Î•º Îì±Î°ùÌïòÎ©¥ Î∞∞Ìè¨ Ïãú ÏÑúÎ≤Ñ ÌôòÍ≤ΩÎ≥ÄÏàòÏóê ÏûêÎèô Î∞òÏòÅÎê©ÎãàÎã§.
            </div>
            <!-- D-3: Ïó∞Í≤∞ ÏöîÏïΩ -->
            <div class="flex gap-3 mb-4">
              <div class="bg-hq-green/10 border border-hq-green/20 rounded-lg px-3 py-2 text-center flex-1">
                <div class="text-lg font-bold text-hq-green" x-text="Object.values(sns.status || {}).filter(s => s.connected).length"></div>
                <div class="text-[10px] text-hq-green/70">Ïó∞Í≤∞Îê®</div>
              </div>
              <div class="bg-hq-muted/10 border border-hq-border/30 rounded-lg px-3 py-2 text-center flex-1">
                <div class="text-lg font-bold text-hq-muted" x-text="Object.values(sns.status || {}).filter(s => !s.connected).length"></div>
                <div class="text-[10px] text-hq-muted/70">ÎØ∏Ïó∞Í≤∞</div>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <template x-for="platform in Object.keys(sns.status)" :key="platform">
                <div class="glass border rounded-xl p-4"
                     :class="(sns.status || {})[platform]?.connected ? 'border-hq-green/20' : 'border-hq-border'">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-bold text-hq-text" x-text="getSNSPlatformName(platform)"></span>
                    <span class="status-badge text-[10px] px-2 py-0.5"
                      :class="(sns.status || {})[platform]?.connected ? 'bg-hq-green/10 text-hq-green' : 'bg-hq-muted/10 text-hq-muted'"
                      x-text="(sns.status || {})[platform]?.connected ? 'Ïó∞Í≤∞Îê®' : 'ÎØ∏Ïó∞Í≤∞'"></span>
                  </div>
                  <!-- D-3: ÌïÑÏöîÌïú ÌôòÍ≤ΩÎ≥ÄÏàò + ÌÜ†ÌÅ∞ ÏÉÅÌÉú ÌëúÏãú -->
                  <div class="text-[10px] text-hq-muted/60 mb-3 font-mono"
                       x-text="'ÌïÑÏöî: ' + ((sns.status || {})[platform]?.env_key || '‚Äî')"></div>
                  <div x-show="(sns.status || {})[platform]?.token_valid === false" class="text-[10px] text-hq-yellow mb-2">ÌÜ†ÌÅ∞ ÎßåÎ£åÎê® ‚Äî Ïû¨Ïù∏Ï¶ù ÌïÑÏöî</div>
                  <button @click="connectPlatform(platform)"
                    class="w-full border hover:bg-hq-accent/20 text-hq-accent rounded-lg px-3 py-2 text-xs transition"
                    :class="(sns.status || {})[platform]?.connected ? 'bg-hq-accent/5 border-hq-accent/20' : 'bg-hq-accent/10 border-hq-accent/30'"
                    x-text="(sns.status || {})[platform]?.connected ? 'Ïû¨Ïó∞Í≤∞' : 'Ïó∞Í≤∞ÌïòÍ∏∞'"></button>
                </div>
              </template>
            </div>
          </div>

          <!-- SNS Tab 2: Publish -->
          <div x-show="sns.tab === 'publish' && !sns.loading" class="space-y-6">
            <!-- Instagram Photo -->
            <div class="glass border border-hq-border rounded-xl p-5">
              <h3 class="text-sm font-bold text-hq-text mb-3">Instagram ÏÇ¨ÏßÑ Í≤åÏãú</h3>
              <div class="space-y-2">
                <input x-model="sns.igImageUrl" placeholder="Ïù¥ÎØ∏ÏßÄ URL" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                <textarea x-model="sns.igCaption" placeholder="Ï∫°ÏÖò" rows="2" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text resize-y"></textarea>
                <button @click="postInstagramPhoto()" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-lg px-4 py-2 text-sm font-semibold">Í≤åÏãú</button>
              </div>
            </div>
            <!-- Instagram Reel -->
            <div class="glass border border-hq-border rounded-xl p-5">
              <h3 class="text-sm font-bold text-hq-text mb-3">Instagram Î¶¥Ïä§ Í≤åÏãú</h3>
              <div class="space-y-2">
                <input x-model="sns.igVideoUrl" placeholder="ÎπÑÎîîÏò§ URL" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                <textarea x-model="sns.igReelCaption" placeholder="Ï∫°ÏÖò" rows="2" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text resize-y"></textarea>
                <button @click="postInstagramReel()" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-lg px-4 py-2 text-sm font-semibold">Í≤åÏãú</button>
              </div>
            </div>
            <!-- YouTube Upload -->
            <div class="glass border border-hq-border rounded-xl p-5">
              <h3 class="text-sm font-bold text-hq-text mb-3">YouTube ÏóÖÎ°úÎìú</h3>
              <div class="space-y-2">
                <input x-model="sns.ytFilePath" placeholder="ÌååÏùº Í≤ΩÎ°ú (ÏÑúÎ≤Ñ ÎÇ¥)" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                <input x-model="sns.ytTitle" placeholder="Ï†úÎ™©" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                <textarea x-model="sns.ytDesc" placeholder="ÏÑ§Î™Ö" rows="2" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text resize-y"></textarea>
                <div class="flex gap-2">
                  <input x-model="sns.ytTags" placeholder="ÌÉúÍ∑∏ (ÏâºÌëú Íµ¨Î∂Ñ)" class="flex-1 bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                  <select x-model="sns.ytPrivacy" class="bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                    <option value="private">ÎπÑÍ≥µÍ∞ú</option>
                    <option value="unlisted">ÏùºÎ∂ÄÍ≥µÍ∞ú</option>
                    <option value="public">Í≥µÍ∞ú</option>
                  </select>
                </div>
                <button @click="postYouTubeVideo()" class="bg-red-600 hover:bg-red-700 text-white rounded-lg px-4 py-2 text-sm font-semibold">ÏóÖÎ°úÎìú</button>
              </div>
            </div>
          </div>

          <!-- SNS Tab 3: Approval Queue -->
          <div x-show="sns.tab === 'queue' && !sns.loading">
            <!-- D-3: ÎåÄÍ∏∞Ïó¥ ÏÉÅÌÉú ÏöîÏïΩ -->
            <div class="flex gap-2 mb-4 overflow-x-auto pb-1">
              <div class="bg-hq-yellow/10 border border-hq-yellow/20 rounded-lg px-3 py-1.5 text-center shrink-0">
                <span class="text-sm font-bold text-hq-yellow" x-text="(sns.queue || []).filter(q => q.status === 'pending').length"></span>
                <span class="text-[10px] text-hq-yellow/70 ml-1">ÎåÄÍ∏∞</span>
              </div>
              <div class="bg-orange-500/10 border border-orange-500/20 rounded-lg px-3 py-1.5 text-center shrink-0">
                <span class="text-sm font-bold text-orange-400" x-text="(sns.queue || []).filter(q => q.status === 'rework').length"></span>
                <span class="text-[10px] text-orange-400/70 ml-1">Ïû¨ÏûëÏóÖ</span>
              </div>
              <div class="bg-hq-green/10 border border-hq-green/20 rounded-lg px-3 py-1.5 text-center shrink-0">
                <span class="text-sm font-bold text-hq-green" x-text="(sns.queue || []).filter(q => q.status === 'approved').length"></span>
                <span class="text-[10px] text-hq-green/70 ml-1">ÏäπÏù∏</span>
              </div>
              <div class="bg-hq-cyan/10 border border-hq-cyan/20 rounded-lg px-3 py-1.5 text-center shrink-0">
                <span class="text-sm font-bold text-hq-cyan" x-text="(sns.queue || []).filter(q => q.status === 'published').length"></span>
                <span class="text-[10px] text-hq-cyan/70 ml-1">Î∞úÌñâ</span>
              </div>
            </div>
            <div class="flex items-center justify-between mb-4">
              <div class="flex gap-2">
                <template x-for="f in ['all','pending','rework','approved','published','rejected']" :key="f">
                  <button @click="sns.queueFilter = f"
                    :class="sns.queueFilter === f ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'"
                    class="px-3 py-1 text-xs rounded-lg transition"
                    x-text="f === 'all' ? 'Ï†ÑÏ≤¥' : f === 'pending' ? 'ÎåÄÍ∏∞' : f === 'rework' ? 'Ïû¨ÏûëÏóÖ' : f === 'approved' ? 'ÏäπÏù∏' : f === 'published' ? 'Î∞úÌñâ' : 'Í±∞Ï†à'"></button>
                </template>
              </div>
              <button x-show="sns.queue.length > 0" @click="sns.showClearQueueModal = true"
                class="text-[10px] text-red-400 hover:text-red-300 px-2 py-1 rounded-lg hover:bg-red-500/10 transition">Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
            </div>
            <div class="space-y-2">
              <template x-for="item in sns.queue.filter(q => sns.queueFilter === 'all' || q.status === sns.queueFilter)" :key="item.request_id">
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                      <span class="text-xs font-bold text-hq-text capitalize" x-text="item.platform || '-'"></span>
                      <span class="status-badge text-[9px]"
                        :class="item.status === 'pending' ? 'bg-hq-yellow/10 text-hq-yellow' : item.status === 'approved' ? 'bg-hq-green/10 text-hq-green' : item.status === 'published' ? 'bg-hq-cyan/10 text-hq-cyan' : item.status === 'rework' ? 'bg-hq-orange/10 text-orange-400' : 'bg-hq-red/10 text-hq-red'"
                        x-text="item.status === 'pending' ? 'ÎåÄÍ∏∞' : item.status === 'approved' ? 'ÏäπÏù∏Îê®' : item.status === 'published' ? 'Î∞úÌñâÏôÑÎ£å' : item.status === 'failed' ? 'Ïã§Ìå®' : item.status === 'rework' ? 'Ïû¨ÏûëÏóÖÏ§ë' : 'Í±∞Ï†à'"></span>
                      <span x-show="item.revision > 0" class="text-[9px] text-orange-400" x-text="'v' + (item.revision || 1)"></span>
                      <span class="text-[9px] text-hq-muted" x-text="item.requested_by ? 'ÏöîÏ≤≠: ' + item.requested_by : ''"></span>
                    </div>
                    <!-- ÎåÄÍ∏∞ ‚Üí ÏäπÏù∏/Í±∞Ï†à Î≤ÑÌäº -->
                    <div class="flex items-center gap-2" x-show="item.status === 'pending'">
                      <button @click="approveSNS(item.request_id)" class="bg-hq-green/20 text-hq-green rounded-lg px-3 py-1 text-xs hover:bg-hq-green/30">ÏäπÏù∏</button>
                      <button @click="sns.rejectingId = item.request_id" class="bg-hq-red/20 text-hq-red rounded-lg px-3 py-1 text-xs hover:bg-hq-red/30">Í±∞Ï†à</button>
                    </div>
                    <!-- ÏäπÏù∏Îê® ‚Üí Î∞úÌñâ Î≤ÑÌäº -->
                    <div class="flex items-center gap-2" x-show="item.status === 'approved'">
                      <button @click="publishSNS(item.request_id)" class="bg-hq-accent/20 text-hq-accent rounded-lg px-3 py-1 text-xs hover:bg-hq-accent/30 font-bold">üöÄ Î∞úÌñâ</button>
                    </div>
                    <!-- Î∞úÌñâÏôÑÎ£å ‚Üí ÎßÅÌÅ¨ -->
                    <div x-show="item.status === 'published' && item.result?.post_url">
                      <a :href="item.result.post_url" target="_blank" class="text-hq-cyan text-xs hover:underline">üîó Î≥¥Í∏∞</a>
                    </div>
                  </div>
                  <div class="text-sm font-semibold text-hq-text mb-1" x-text="item.content?.title || '-'"></div>
                  <div class="text-xs text-hq-muted line-clamp-3" x-text="item.content?.body?.substring(0, 200) || '-'"></div>
                  <!-- Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ -->
                  <template x-if="item.content?.image_url || item.content?.body?.includes('/api/media/images/')">
                    <div class="mt-2 rounded-lg overflow-hidden border border-hq-border/30">
                      <img :src="item.content?.image_url || item.content?.body?.match(/\/api\/media\/images\/[^\s\)]+/)?.[0] || ''"
                           class="max-h-48 w-auto object-contain bg-hq-bg/50" loading="lazy"
                           @error="$el.style.display='none'" />
                    </div>
                  </template>
                  <!-- ÏòÅÏÉÅ ÎØ∏Î¶¨Î≥¥Í∏∞ -->
                  <template x-if="item.content?.video_url || item.content?.body?.includes('/api/media/videos/')">
                    <div class="mt-2 rounded-lg overflow-hidden border border-hq-border/30">
                      <video :src="item.content?.video_url || item.content?.body?.match(/\/api\/media\/videos\/[^\s\)]+/)?.[0] || ''"
                             class="max-h-48 w-auto bg-hq-bg/50" controls preload="metadata"></video>
                    </div>
                  </template>
                  <div class="flex gap-1 mt-1 flex-wrap" x-show="item.content?.tags?.length > 0">
                    <template x-for="tag in (item.content?.tags || [])" :key="tag">
                      <span class="text-[9px] bg-hq-accent/10 text-hq-accent px-1.5 py-0.5 rounded" x-text="'#' + tag"></span>
                    </template>
                  </div>
                  <!-- Reject form -->
                  <div x-show="sns.rejectingId === item.request_id" class="mt-2 flex gap-2">
                    <input x-model="sns.rejectReason" placeholder="Í±∞Ï†à ÏÇ¨Ïú†" class="flex-1 bg-hq-bg border border-hq-border rounded-lg px-2 py-1 text-xs text-hq-text">
                    <button @click="rejectSNS(item.request_id)" class="bg-hq-red text-white rounded-lg px-3 py-1 text-xs">ÌôïÏù∏</button>
                  </div>
                  <!-- Ïû¨ÏûëÏóÖ ÏÉÅÌÉú ÌëúÏãú -->
                  <div x-show="item.status === 'rework'" class="mt-2 bg-orange-500/10 border border-orange-500/20 rounded-lg px-3 py-2">
                    <div class="text-[10px] text-orange-400 font-bold mb-1">Ïû¨ÏûëÏóÖ ÏßÑÌñâÏ§ë</div>
                    <div x-show="item.result?.reason" class="text-[10px] text-hq-muted" x-text="'Í±∞Ï†à ÏÇ¨Ïú†: ' + item.result?.reason"></div>
                  </div>
                  <!-- Í±∞Ï†à ÏÇ¨Ïú† (rejected ÏÉÅÌÉú) -->
                  <div x-show="item.status === 'rejected' && item.result?.reason" class="mt-2 bg-hq-red/10 border border-hq-red/20 rounded-lg px-3 py-2">
                    <div class="text-[10px] text-hq-red" x-text="'Í±∞Ï†à ÏÇ¨Ïú†: ' + item.result?.reason"></div>
                  </div>
                  <!-- Î∞úÌñâ Í≤∞Í≥º -->
                  <div x-show="item.result?.message" class="mt-2 text-[10px] text-hq-muted bg-hq-bg rounded px-2 py-1" x-text="item.result?.message"></div>
                </div>
              </template>
              <template x-if="sns.queue.filter(q => sns.queueFilter === 'all' || q.status === sns.queueFilter).length === 0">
                <div class="text-center text-hq-muted/80 py-8">ÎåÄÍ∏∞Ïó¥Ïù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§</div>
              </template>
            </div>
          </div>

          <!-- SNS Tab: ÎØ∏ÎîîÏñ¥ Í∞§Îü¨Î¶¨ (ÏÉùÏÑ±Îêú Ïù¥ÎØ∏ÏßÄ/ÏòÅÏÉÅ) -->
          <div x-show="sns.tab === 'media' && !sns.loading">
            <!-- ÏÉÅÎã® Ïï°ÏÖò Î∞î -->
            <div class="flex items-center justify-between mb-4">
              <div class="text-xs text-hq-muted">
                ÎÇòÎÖ∏Î∞îÎÇòÎÇò Pro(Ïù¥ÎØ∏ÏßÄ) + Veo 3.1(ÏòÅÏÉÅ)Î°ú ÏÉùÏÑ±Îêú ÎØ∏ÎîîÏñ¥ ÌååÏùºÏûÖÎãàÎã§.
              </div>
              <div class="flex items-center gap-2">
                <button x-show="(sns.mediaImages || []).length + (sns.mediaVideos || []).length > 0"
                  @click="sns.mediaSelectMode = !sns.mediaSelectMode; sns.selectedMedia = []"
                  :class="sns.mediaSelectMode ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="text-[10px] px-2 py-1 rounded-lg transition">
                  <span x-text="sns.mediaSelectMode ? 'ÏÑ†ÌÉù Ï∑®ÏÜå' : 'ÏÑ†ÌÉù'"></span>
                </button>
                <button x-show="sns.mediaSelectMode && (sns.selectedMedia || []).length > 0"
                  @click="deleteSelectedMedia()"
                  class="text-[10px] px-2 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 transition">
                  <span x-text="sns.selectedMedia.length + 'Í∞ú ÏÇ≠Ï†ú'"></span>
                </button>
                <button x-show="(sns.mediaImages || []).length + (sns.mediaVideos || []).length > 0"
                  @click="sns.showDeleteAllMediaModal = true"
                  class="text-[10px] text-red-400 hover:text-red-300 px-2 py-1 rounded-lg hover:bg-red-500/10 transition">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button>
              </div>
            </div>
            <!-- Ïù¥ÎØ∏ÏßÄ Í∞§Îü¨Î¶¨ -->
            <template x-if="(sns.mediaImages || []).length > 0">
              <div class="mb-6">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="text-sm font-bold text-hq-text">Ïù¥ÎØ∏ÏßÄ (<span x-text="sns.mediaImages.length"></span>)</h3>
                  <button x-show="sns.mediaSelectMode" @click="toggleSelectAllMedia('images')"
                    class="text-[10px] text-hq-accent hover:underline">Ï†ÑÏ≤¥ ÏÑ†ÌÉù</button>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                  <template x-for="img in sns.mediaImages" :key="img.filename">
                    <div class="glass border rounded-xl overflow-hidden group cursor-pointer relative"
                         :class="(sns.selectedMedia || []).find(m => m.filename === img.filename) ? 'border-hq-accent' : 'border-hq-border'"
                         @click="sns.mediaSelectMode ? toggleMediaItem('images', img) : window.open(img.url, '_blank')">
                      <!-- ÏÑ†ÌÉù Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                      <div x-show="sns.mediaSelectMode" class="absolute top-1.5 left-1.5 z-10">
                        <div class="w-5 h-5 rounded-md border-2 flex items-center justify-center text-xs"
                          :class="(sns.selectedMedia || []).find(m => m.filename === img.filename) ? 'bg-hq-accent border-hq-accent text-white' : 'border-hq-muted bg-black/40'">
                          <span x-show="(sns.selectedMedia || []).find(m => m.filename === img.filename)">&#10003;</span>
                        </div>
                      </div>
                      <img :src="img.url" class="w-full h-32 object-cover group-hover:scale-105 transition-transform" loading="lazy" />
                      <div class="px-2 py-1.5">
                        <div class="text-[9px] text-hq-muted truncate" x-text="img.filename"></div>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </template>
            <!-- ÏòÅÏÉÅ Í∞§Îü¨Î¶¨ -->
            <template x-if="(sns.mediaVideos || []).length > 0">
              <div class="mb-6">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="text-sm font-bold text-hq-text">ÏòÅÏÉÅ (<span x-text="sns.mediaVideos.length"></span>)</h3>
                  <button x-show="sns.mediaSelectMode" @click="toggleSelectAllMedia('videos')"
                    class="text-[10px] text-hq-accent hover:underline">Ï†ÑÏ≤¥ ÏÑ†ÌÉù</button>
                </div>
                <div class="grid grid-cols-2 gap-3">
                  <template x-for="vid in sns.mediaVideos" :key="vid.filename">
                    <div class="glass border rounded-xl overflow-hidden relative"
                         :class="(sns.selectedMedia || []).find(m => m.filename === vid.filename) ? 'border-hq-accent' : 'border-hq-border'">
                      <!-- ÏÑ†ÌÉù Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                      <div x-show="sns.mediaSelectMode" class="absolute top-1.5 left-1.5 z-10 cursor-pointer"
                           @click.stop="toggleMediaItem('videos', vid)">
                        <div class="w-5 h-5 rounded-md border-2 flex items-center justify-center text-xs"
                          :class="(sns.selectedMedia || []).find(m => m.filename === vid.filename) ? 'bg-hq-accent border-hq-accent text-white' : 'border-hq-muted bg-black/40'">
                          <span x-show="(sns.selectedMedia || []).find(m => m.filename === vid.filename)">&#10003;</span>
                        </div>
                      </div>
                      <video :src="vid.url" class="w-full h-40 object-cover" controls preload="metadata"></video>
                      <div class="px-2 py-1.5">
                        <div class="text-[9px] text-hq-muted truncate" x-text="vid.filename"></div>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </template>
            <template x-if="(sns.mediaImages || []).length === 0 && (sns.mediaVideos || []).length === 0">
              <div class="text-center text-hq-muted/80 py-8">ÏÉùÏÑ±Îêú ÎØ∏ÎîîÏñ¥Í∞Ä ÏóÜÏäµÎãàÎã§. ÏóêÏù¥Ï†ÑÌä∏ÏóêÍ≤å Ïù¥ÎØ∏ÏßÄ/ÏòÅÏÉÅ ÏÉùÏÑ±ÏùÑ ÏöîÏ≤≠Ìï¥Î≥¥ÏÑ∏Ïöî.</div>
            </template>
          </div>

          <!-- SNS Tab 4: Events -->
          <div x-show="sns.tab === 'events' && !sns.loading">
            <div class="bg-hq-surface border border-hq-border/50 rounded-lg px-4 py-3 mb-4 text-xs text-hq-muted">
              SNS Ïù¥Î≤§Ìä∏Îäî Ïó∞Í≤∞Îêú ÌîåÎû´ÌèºÏóêÏÑú Î∞úÏÉùÌïú ÌôúÎèô Í∏∞Î°ùÏûÖÎãàÎã§. Í≤åÏãúÎ¨º Î∞úÌñâ, ÎåìÍ∏Ä ÏïåÎ¶º, ÌåîÎ°úÏõå Î≥ÄÎèô Îì±Ïùò Ïù¥Î≤§Ìä∏Í∞Ä Ïó¨Í∏∞Ïóê ÏûêÎèôÏúºÎ°ú Í∏∞Î°ùÎê©ÎãàÎã§.
            </div>
            <div class="space-y-2">
              <template x-for="(event, i) in sns.events" :key="i">
                <div class="glass border border-hq-border rounded-xl px-4 py-3">
                  <div class="flex items-center gap-3">
                    <span class="text-[10px] font-mono text-hq-muted/85 shrink-0" x-text="event.time || event.timestamp || '-'"></span>
                    <span class="text-xs font-bold text-hq-cyan capitalize" x-text="event.platform || '-'"></span>
                    <span class="text-xs text-hq-text/90" x-text="event.type || event.event || '-'"></span>
                  </div>
                  <div x-show="event.data" class="text-[11px] text-hq-muted mt-1 truncate" x-text="typeof event.data === 'string' ? event.data : JSON.stringify(event.data || '').substring(0, 150)"></div>
                </div>
              </template>
              <template x-if="sns.events.length === 0">
                <div class="text-center text-hq-muted/80 py-8">Ïù¥Î≤§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§</div>
              </template>
            </div>
          </div>
        </div>
      </div></template>

      <!-- ‚ïê‚ïê‚ïê TRADING OPS (Ï†ÑÎûµÏã§) ÌÉ≠ ‚ïê‚ïê‚ïê -->
      <template x-if="viewMode === 'chat' && activeTab === 'trading'"><div class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid tab-content-padded">
        <div class="max-w-6xl mx-auto fade-in-up">

          <!-- Ìó§Îçî -->
          <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 md:mb-6 gap-3">
            <div>
              <h2 class="text-base md:text-lg font-bold text-hq-text font-mono tracking-normal">TRADING OPS</h2>
              <p class="text-xs text-hq-muted">
                ÌïúÍµ≠Ìà¨ÏûêÏ¶ùÍ∂å ÏûêÎèôÎß§Îß§ ‚Äî
                <span :class="(trading.summary.settings||{}).kis_connected ? 'text-hq-green' : 'text-hq-muted/60'"
                      x-text="(trading.summary.settings||{}).kis_connected ? 'KIS Ïó∞Í≤∞Îê®' : 'KIS ÎØ∏Ïó∞Í≤∞'"></span>
                <span x-show="trading.lastRefresh" class="text-hq-muted/50 ml-2" x-text="'¬∑ ' + trading.lastRefresh + ' Í∏∞Ï§Ä'"></span>
              </p>
            </div>
            <div class="flex items-center gap-3">
              <button @click="trading.showOrderModal = true" class="bg-hq-green/20 text-hq-green hover:bg-hq-green/30 rounded-lg px-3 py-1.5 text-xs font-semibold transition">
                üìà Ï£ºÎ¨∏ Ïã§Ìñâ
              </button>
              <button @click="resetTradingPortfolio()" class="bg-hq-red/10 text-hq-red/70 hover:bg-hq-red/20 hover:text-hq-red rounded-lg px-3 py-1.5 text-xs font-semibold transition">
                üóëÔ∏è Ï¥àÍ∏∞Ìôî
              </button>
              <button @click="trading.showSettingsModal = true; trading.settings = {...(trading.summary.settings || {})}" class="bg-hq-surface border border-hq-border hover:border-hq-accent/30 rounded-lg px-3 py-1.5 text-xs text-hq-muted transition">
                ‚öôÔ∏è ÏÑ§Ï†ï
              </button>
            </div>
          </div>

          <!-- ÏÑúÎ∏å ÌÉ≠ -->
          <div class="flex gap-2 mb-4 md:mb-6 overflow-x-auto scrollbar-thin pb-1 -mx-1 px-1">
            <template x-for="tab in [{id:'dashboard',l:'ÎåÄÏãúÎ≥¥Îìú'},{id:'actlog',l:'ÍµêÏã†Î°úÍ∑∏'},{id:'shadow',l:'Ïã§Í±∞Îûò/Î™®Ïùò ÎπÑÍµê'},{id:'portfolio',l:'Ìè¨Ìä∏Ìè¥Î¶¨Ïò§'},{id:'watchlist',l:'Í¥ÄÏã¨Ï¢ÖÎ™©'},{id:'history',l:'Í±∞ÎûòÎÇ¥Ïó≠'},{id:'signals',l:'ÏãúÍ∑∏ÎÑê'},{id:'plan',l:'ÏûëÏ†ÑÍ≥ÑÌöç'},{id:'performance',l:'Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• ÏÑ±Í≥º'}]" :key="tab.id">
              <button @click="trading.tab = tab.id" :class="trading.tab === tab.id ? 'bg-hq-accent/20 text-hq-accent border-hq-accent/30' : 'text-hq-muted border-transparent hover:text-hq-text'" class="px-3 py-1.5 text-xs font-semibold rounded-lg border transition whitespace-nowrap shrink-0" x-text="tab.l"></button>
            </template>
          </div>

          <template x-if="trading.loading">
            <div class="text-center py-12 text-hq-muted">Î°úÎî© Ï§ë...</div>
          </template>

          <!-- ‚ñ∏ ÏÑúÎ∏åÌÉ≠ 1: ÎåÄÏãúÎ≥¥Îìú -->
          <div x-show="trading.tab === 'dashboard' && !trading.loading">

            <!-- CIO ÏûêÎèôÎß§Îß§ Î∞∞ÎÑà (ÏµúÏÉÅÎã®) -->
            <div class="glass border rounded-xl p-3 md:p-4 mb-4 flex flex-col md:flex-row md:items-center justify-between gap-3"
                 :class="trading.botActive ? 'border-hq-green/40 bg-hq-green/[0.05]' : 'border-hq-border'">
              <div class="flex items-center gap-3">
                <div class="w-3 h-3 rounded-full" :class="trading.botActive ? 'bg-hq-green animate-pulse' : 'bg-hq-muted/30'"></div>
                <div>
                  <span class="text-sm font-bold" :class="trading.botActive ? 'text-hq-green' : 'text-hq-muted'"
                        x-text="trading.botActive ? 'Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• ÏûêÎèôÎß§Îß§ : Í∞ÄÎèô Ï§ë' : 'Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• ÏûêÎèôÎß§Îß§ : ÎåÄÍ∏∞'"></span>
                  <p class="text-[10px] text-hq-muted"
                     x-text="trading.botActive ? `Ìà¨ÏûêÌåÄÏû•Ïù¥ ÌïòÎ£® 2Ìöå Í¥ÄÏã¨Ï¢ÖÎ™© Î∂ÑÏÑù Ï§ë (09:10 ÌïúÍµ≠Ïû• ¬∑ ${trading.schedule?.us_time || '23:40'} ÎØ∏Íµ≠Ïû• ${trading.schedule?.us_tz || ''})` : 'ÏûêÎèôÎß§Îß§Í∞Ä Í∫ºÏ†∏ ÏûàÏäµÎãàÎã§. ÏÑ§Ï†ïÏóêÏÑú ÏºúÏÑ∏Ïöî.'"></p>
                </div>
              </div>
              <div class="flex items-center gap-2 md:gap-3 flex-wrap">
                <span class="text-[10px] px-2 py-1 rounded-full border"
                      :class="(() => { const s = trading.summary.settings||{}; if(s.enable_real && !s.paper_trading) return 'border-hq-green/30 bg-hq-green/10 text-hq-green'; if(s.enable_mock) return 'border-hq-purple/30 bg-hq-purple/10 text-hq-purple'; return 'border-hq-accent/30 bg-hq-accent/10 text-hq-accent'; })()"
                      x-text="(() => { const s = trading.summary.settings||{}; if(s.enable_real && !s.paper_trading) return 'Ïã§Í±∞Îûò'; if(s.enable_mock) return 'Î™®ÏùòÌà¨Ïûê'; return 'Í∞ÄÏÉÅÌà¨Ïûê'; })()"></span>
                <span class="text-[10px] px-2 py-1 rounded-full border"
                      :class="(trading.summary.settings||{}).kis_connected ? 'border-hq-green/30 bg-hq-green/10 text-hq-green' : 'border-hq-muted/30 bg-hq-muted/10 text-hq-muted'"
                      x-text="(trading.summary.settings||{}).kis_connected ? 'KIS Ïó∞Í≤∞' : 'KIS ÎØ∏Ïó∞Í≤∞'"></span>
                <div class="w-px h-4 bg-hq-border/50 mx-1 hidden md:block"></div>
                <button @click="runTradingNow()" :disabled="trading.runningNow"
                        class="rounded-lg px-4 py-1.5 text-xs font-bold transition bg-hq-accent text-hq-bg hover:bg-hq-accent/90 shadow-lg shadow-hq-accent/20 disabled:opacity-40 disabled:cursor-not-allowed disabled:shadow-none flex items-center gap-1.5">
                  <svg x-show="trading.runningNow" class="w-3 h-3 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
                  </svg>
                  <span x-text="trading.runningNow ? 'Î∂ÑÏÑù Ï§ë...' : 'Ï¶âÏãú Î∂ÑÏÑù¬∑Îß§Îß§Í≤∞Ï†ï'"></span>
                </button>
                <button @click="toggleTradingBot()" class="rounded-lg px-4 py-1.5 text-xs font-bold transition"
                        :class="trading.botActive ? 'bg-hq-red/20 text-hq-red hover:bg-hq-red/30' : 'bg-hq-green/20 text-hq-green hover:bg-hq-green/30'"
                        x-text="trading.botActive ? 'Ï§ëÏßÄ' : 'ÏãúÏûë'"></button>
              </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê MISSION CONTROL BOARD ‚ïê‚ïê‚ïê -->
            <div x-data="{
              mockBal: null, mockLoading: false,
              usBal: null, usLoading: false,
              usMockBal: null,
              fxRate: 1450,
              async loadMissionData() {
                this.mockLoading = true; this.usLoading = true;
                try {
                  const [mockR, usR, usMockR] = await Promise.allSettled([
                    fetch('/api/trading/mock/balance').then(r=>r.json()),
                    fetch('/api/trading/overseas/balance').then(r=>r.json()),
                    fetch('/api/trading/overseas/mock-balance').then(r=>r.json())
                  ]);
                  this.mockBal = mockR.status==='fulfilled' ? mockR.value : {available:false};
                  this.usBal = usR.status==='fulfilled' ? usR.value : {available:false};
                  this.usMockBal = usMockR.status==='fulfilled' ? usMockR.value : {available:false};
                } catch(e) {}
                this.mockLoading = false; this.usLoading = false;
              },
              krTotal() {
                const kis = (trading.summary.kis_balance||{});
                if (kis.success) {
                  // ÌïúÍµ≠ Î≥¥Ïú†Ï¢ÖÎ™©+ÌòÑÍ∏àÎßå (total_evalÏùÄ Ìï¥Ïô∏ÏûêÏÇ∞ ÏõêÌôîÌôòÏÇ∞ Ìè¨Ìï® ‚Üí usTotalÍ≥º Ïù¥Ï§ë Í≥ÑÏÇ∞Îê®)
                  const hEval = (kis.holdings||[]).reduce((s,h) => s + (h.qty||0)*(h.current_price||0), 0);
                  return (kis.cash || 0) + hEval;
                }
                if (this.mockBal && this.mockBal.available) return this.mockBal.total_eval || this.mockBal.cash || 0;
                return 0;
              },
              usTotal() {
                if(this.usBal&&this.usBal.success) return this.usBal.total_eval_usd || this.usBal.cash_usd || 0;
                if(this.usMockBal&&this.usMockBal.success) return this.usMockBal.total_eval_usd || this.usMockBal.cash_usd || 0;
                return 0;
              },
              grandTotal() { return this.krTotal() + Math.round(this.usTotal() * this.fxRate); },
              fmtKRW(v) { return '‚Ç©' + Math.round(v||0).toLocaleString(); },
              fmtUSD(v) { return '$' + (v||0).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2}); },
              fmtDual(krw, usd) { return this.fmtKRW(krw) + ' / ' + this.fmtUSD(usd); }
            }" x-init="loadMissionData(); fetch('/api/delegation-log?division=cio&limit=20').then(r=>r.ok?r.json():[]).then(d=>{$root.trading.cioLogs=Array.isArray(d)?d:[];}).catch(()=>{})">

              <!-- KPI Ïπ¥Îìú 4Í∞ú (CÏïà: ÌôïÎåÄ Î≤ÑÏ†Ñ) -->
              <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mt-3 mb-4">
                <!-- Ï¥ùÏûêÏÇ∞ -->
                <div class="glass border border-hq-accent/20 rounded-xl p-5 relative overflow-hidden">
                  <div class="absolute top-0 right-0 w-16 h-16 bg-hq-accent/5 rounded-bl-full"></div>
                  <div class="text-xs text-hq-muted mb-1">Ï¥ùÏûêÏÇ∞ (ÌïúÍµ≠+ÎØ∏Íµ≠)</div>
                  <div class="text-xl lg:text-2xl font-bold font-mono text-hq-accent" x-text="fmtKRW(grandTotal())"></div>
                  <div class="text-xs text-hq-muted/70 font-mono mt-1" x-text="usTotal() > 0 ? fmtUSD(usTotal()) + ' Ìè¨Ìï®' : 'ÌïúÍµ≠Ïû•Îßå'"></div>
                </div>
                <!-- Ïò§Îäò ÏÜêÏùµ -->
                <div class="glass border border-hq-border rounded-xl p-5 relative overflow-hidden">
                  <div class="text-xs text-hq-muted mb-1">Ïò§Îäò ÏÜêÏùµ</div>
                  <div class="text-xl lg:text-2xl font-bold font-mono"
                       :class="((trading.summary.today||{}).pnl||0) >= 0 ? 'text-hq-green' : 'text-hq-red'"
                       x-text="(((trading.summary.today||{}).pnl||0) >= 0 ? '+' : '') + fmtKRW((trading.summary.today||{}).pnl||0)"></div>
                  <div class="text-xs text-hq-muted/70 mt-1" x-text="'Í±∞Îûò ' + ((trading.summary.today||{}).trades||0) + 'Í±¥'"></div>
                </div>
                <!-- ÏàòÏùµÎ•† -->
                <div class="glass border border-hq-border rounded-xl p-5 relative overflow-hidden">
                  <div class="text-xs text-hq-muted mb-1">ÎàÑÏ†Å ÏàòÏùµÎ•†</div>
                  <div class="text-xl lg:text-2xl font-bold font-mono"
                       :class="((trading.summary.portfolio||{}).total_return||0) >= 0 ? 'text-hq-green' : 'text-hq-red'"
                       x-text="(((trading.summary.portfolio||{}).total_return||0) >= 0 ? '+' : '') + ((trading.summary.portfolio||{}).total_return||0).toFixed(2) + '%'"></div>
                  <div class="text-xs text-hq-muted/70 mt-1" x-text="(trading.summary.portfolio||{}).win_rate ? 'ÏäπÎ•† ' + ((trading.summary.portfolio||{}).win_rate||0).toFixed(0) + '%' : ''"></div>
                </div>
                <!-- ÌôòÏú® -->
                <div class="glass border border-hq-border rounded-xl p-5 relative overflow-hidden">
                  <div class="text-xs text-hq-muted mb-1">USD/KRW ÌôòÏú®</div>
                  <div class="text-xl lg:text-2xl font-bold font-mono text-hq-cyan" x-text="'‚Ç©' + fxRate.toLocaleString()"></div>
                  <div class="text-xs text-hq-muted/70 mt-1">Í∏∞Ï§ÄÌôòÏú®</div>
                </div>
              </div>

              <!-- ‚ïê‚ïê‚ïê CÏïà: 2Ìñâ 2Ïó¥ (Ïã§Í±∞Îûò/Î™®Ïùò √ó ÌïúÍµ≠/ÎØ∏Íµ≠) ‚ïê‚ïê‚ïê -->
              <!-- Row 1: Ïã§Í±∞Îûò -->
              <div class="mb-2 mt-1 flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-hq-green"></div>
                <span class="text-sm font-bold text-hq-green">Ïã§Í±∞Îûò</span>
              </div>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <!-- Ïã§Í±∞Îûò ÌïúÍµ≠Ïû• -->
                <div class="glass border border-l-4 border-hq-green/20 border-l-hq-green rounded-xl p-3 lg:p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-1.5">
                      <span class="text-sm">üá∞üá∑</span>
                      <span class="text-sm font-bold text-hq-green">ÌïúÍµ≠Ïû•</span>
                    </div>
                    <span class="text-[10px] px-1.5 py-0.5 rounded-full border"
                          :class="(trading.summary.settings||{}).kis_connected ? 'border-hq-green/30 bg-hq-green/10 text-hq-green' : 'border-hq-muted/30 text-hq-muted'"
                          x-text="(trading.summary.settings||{}).kis_connected ? 'KIS Ïó∞Í≤∞' : 'KIS ÎØ∏Ïó∞Í≤∞'"></span>
                  </div>
                  <div class="text-xl lg:text-2xl font-bold font-mono text-hq-text"
                       x-text="fmtKRW(((trading.summary.kis_balance||{}).cash || 0) + ((trading.summary.kis_balance||{}).holdings||[]).reduce((s,h) => s + (h.qty||0)*(h.current_price||0), 0))"></div>
                  <div class="flex items-center gap-3 mt-1 text-xs text-hq-muted">
                    <span x-text="'ÌòÑÍ∏à ' + fmtKRW((trading.summary.kis_balance||{}).cash || 0)"></span>
                    <span x-text="'Î≥¥Ïú† ' + ((trading.summary.kis_balance||{}).holdings||[]).length + 'Ï¢ÖÎ™©'"></span>
                  </div>
                  <div class="mt-2 space-y-1">
                    <template x-for="h in ((trading.summary.kis_balance||{}).holdings||[]).slice(0,3)" :key="h.ticker">
                      <div class="flex items-center justify-between bg-hq-surface/50 rounded px-2 py-1 cursor-pointer hover:bg-hq-accent/10 transition"
                           @click="openStockChart && openStockChart(h.ticker, h.name, 'KR')">
                        <div class="text-xs font-semibold text-hq-text truncate max-w-[120px]" x-text="h.name"></div>
                        <div class="flex items-center gap-2">
                          <span class="text-xs font-mono text-hq-text" x-text="fmtKRW(h.current_price)"></span>
                          <span class="text-xs font-mono" :class="(h.eval_profit||0)>=0?'text-hq-green':'text-hq-red'"
                                x-text="((h.eval_profit||0)>=0?'+':'') + fmtKRW(h.eval_profit||0)"></span>
                        </div>
                      </div>
                    </template>
                    <template x-if="((trading.summary.kis_balance||{}).holdings||[]).length === 0">
                      <div class="text-xs text-hq-muted/50 text-center py-2">Ïã§Í±∞Îûò Î≥¥Ïú†Ï¢ÖÎ™© ÏóÜÏùå</div>
                    </template>
                  </div>
                </div>
                <!-- Ïã§Í±∞Îûò ÎØ∏Íµ≠Ïû• -->
                <div class="glass border border-l-4 border-hq-cyan/20 border-l-hq-cyan rounded-xl p-3 lg:p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-1.5">
                      <span class="text-sm">üá∫üá∏</span>
                      <span class="text-sm font-bold text-hq-cyan">ÎØ∏Íµ≠Ïû•</span>
                    </div>
                    <span class="text-[10px] px-1.5 py-0.5 rounded-full border"
                          :class="(usBal&&usBal.success) ? 'border-hq-cyan/30 bg-hq-cyan/10 text-hq-cyan' : 'border-hq-muted/30 text-hq-muted'"
                          x-text="(usBal&&usBal.success) ? 'KIS Ïó∞Í≤∞' : 'ÎØ∏Ïó∞Í≤∞'"></span>
                  </div>
                  <div class="flex items-baseline gap-2">
                    <span class="text-xl lg:text-2xl font-bold font-mono text-hq-text" x-text="fmtUSD(usTotal())"></span>
                    <span class="text-xs font-mono text-hq-muted" x-text="usTotal() > 0 ? '‚âà ' + fmtKRW(usTotal() * fxRate) : ''"></span>
                  </div>
                  <div class="flex items-center gap-3 mt-1 text-xs text-hq-muted">
                    <span x-text="'ÌòÑÍ∏à ' + fmtUSD((usBal||{}).cash_usd || 0)"></span>
                    <span x-text="'Î≥¥Ïú† ' + ((usBal||{}).holdings||[]).length + 'Ï¢ÖÎ™©'"></span>
                  </div>
                  <div class="mt-2 space-y-1">
                    <template x-for="h in ((usBal||{}).holdings||[]).slice(0,3)" :key="h.symbol">
                      <div class="flex items-center justify-between bg-hq-surface/50 rounded px-2 py-1 cursor-pointer hover:bg-hq-accent/10 transition"
                           @click="openStockChart && openStockChart(h.symbol, h.name, 'US')">
                        <div class="flex items-center gap-1.5">
                          <span class="text-xs font-semibold text-hq-text" x-text="h.symbol"></span>
                          <span class="text-[10px] text-hq-muted truncate max-w-[80px]" x-text="h.name"></span>
                        </div>
                        <div class="flex items-center gap-2">
                          <span class="text-xs font-mono text-hq-text" x-text="fmtUSD(h.current_price)"></span>
                          <span class="text-xs font-mono" :class="(h.eval_profit||0)>=0?'text-hq-green':'text-hq-red'"
                                x-text="((h.eval_profit||0)>=0?'+':'') + fmtUSD(h.eval_profit||0)"></span>
                        </div>
                      </div>
                    </template>
                    <template x-if="((usBal||{}).holdings||[]).length === 0">
                      <div class="text-xs text-hq-muted/50 text-center py-2">Ïã§Í±∞Îûò Î≥¥Ïú†Ï¢ÖÎ™© ÏóÜÏùå</div>
                    </template>
                  </div>
                </div>
              </div>
              <!-- Row 2: Î™®ÏùòÌà¨Ïûê -->
              <div class="mb-2 flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-hq-purple"></div>
                <span class="text-sm font-bold text-hq-purple">Î™®ÏùòÌà¨Ïûê</span>
              </div>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <!-- Î™®ÏùòÌà¨Ïûê ÌïúÍµ≠Ïû• -->
                <div class="glass border border-l-4 border-hq-purple/20 border-l-hq-purple rounded-xl p-3 lg:p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-1.5">
                      <span class="text-sm">üá∞üá∑</span>
                      <span class="text-sm font-bold text-hq-purple">ÌïúÍµ≠Ïû•</span>
                    </div>
                    <span class="text-[10px] px-1.5 py-0.5 rounded-full border border-hq-purple/30 bg-hq-purple/10 text-hq-purple">Î™®Ïùò</span>
                  </div>
                  <div class="text-xl lg:text-2xl font-bold font-mono text-hq-text"
                       x-text="fmtKRW((mockBal||{}).total_eval || (mockBal||{}).cash || 0)"></div>
                  <div class="flex items-center gap-3 mt-1 text-xs text-hq-muted">
                    <span x-text="'ÌòÑÍ∏à ' + fmtKRW((mockBal||{}).cash || 0)"></span>
                    <span x-text="'Î≥¥Ïú† ' + ((mockBal||{}).holdings||[]).length + 'Ï¢ÖÎ™©'"></span>
                  </div>
                  <div class="mt-2 space-y-1">
                    <template x-for="h in ((mockBal||{}).holdings||[]).slice(0,3)" :key="h.ticker">
                      <div class="flex items-center justify-between bg-hq-surface/50 rounded px-2 py-1 cursor-pointer hover:bg-hq-accent/10 transition"
                           @click="openStockChart && openStockChart(h.ticker, h.name, 'KR')">
                        <div class="text-xs font-semibold text-hq-text truncate max-w-[120px]" x-text="h.name"></div>
                        <div class="flex items-center gap-2">
                          <span class="text-xs font-mono text-hq-text" x-text="fmtKRW(h.current_price)"></span>
                          <span class="text-xs font-mono" :class="(h.eval_profit||0)>=0?'text-hq-green':'text-hq-red'"
                                x-text="((h.eval_profit||0)>=0?'+':'') + fmtKRW(h.eval_profit||0)"></span>
                        </div>
                      </div>
                    </template>
                    <template x-if="((mockBal||{}).holdings||[]).length === 0">
                      <div class="text-xs text-hq-muted/50 text-center py-2">Î™®Ïùò Î≥¥Ïú†Ï¢ÖÎ™© ÏóÜÏùå</div>
                    </template>
                  </div>
                </div>
                <!-- Î™®ÏùòÌà¨Ïûê ÎØ∏Íµ≠Ïû• -->
                <div class="glass border border-l-4 border-hq-purple/20 border-l-hq-purple rounded-xl p-3 lg:p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-1.5">
                      <span class="text-sm">üá∫üá∏</span>
                      <span class="text-sm font-bold text-hq-purple">ÎØ∏Íµ≠Ïû•</span>
                    </div>
                    <span class="text-[10px] px-1.5 py-0.5 rounded-full border border-hq-purple/30 bg-hq-purple/10 text-hq-purple">Î™®Ïùò</span>
                  </div>
                  <div class="flex items-baseline gap-2">
                    <span class="text-xl lg:text-2xl font-bold font-mono text-hq-text"
                          x-text="fmtUSD((usMockBal||{}).total_eval_usd || (usMockBal||{}).cash_usd || 0)"></span>
                    <span class="text-xs font-mono text-hq-muted"
                          x-text="(usMockBal||{}).cash_usd ? '‚âà ' + fmtKRW(((usMockBal||{}).total_eval_usd || (usMockBal||{}).cash_usd || 0) * fxRate) : ''"></span>
                  </div>
                  <div class="flex items-center gap-3 mt-1 text-xs text-hq-muted">
                    <span x-text="'ÌòÑÍ∏à ' + fmtUSD((usMockBal||{}).cash_usd || 0)"></span>
                    <span x-text="'Î≥¥Ïú† ' + ((usMockBal||{}).holdings||[]).length + 'Ï¢ÖÎ™©'"></span>
                  </div>
                  <div class="mt-2 space-y-1">
                    <template x-for="h in ((usMockBal||{}).holdings||[]).slice(0,3)" :key="h.symbol">
                      <div class="flex items-center justify-between bg-hq-surface/50 rounded px-2 py-1 cursor-pointer hover:bg-hq-accent/10 transition"
                           @click="openStockChart && openStockChart(h.symbol, h.name, 'US')">
                        <div class="flex items-center gap-1.5">
                          <span class="text-xs font-semibold text-hq-text" x-text="h.symbol"></span>
                          <span class="text-[10px] text-hq-muted truncate max-w-[80px]" x-text="h.name"></span>
                        </div>
                        <div class="flex items-center gap-2">
                          <span class="text-xs font-mono text-hq-text" x-text="fmtUSD(h.current_price)"></span>
                          <span class="text-xs font-mono" :class="(h.eval_profit||0)>=0?'text-hq-green':'text-hq-red'"
                                x-text="((h.eval_profit||0)>=0?'+':'') + fmtUSD(h.eval_profit||0)"></span>
                        </div>
                      </div>
                    </template>
                    <template x-if="((usMockBal||{}).holdings||[]).length === 0">
                      <div class="text-xs text-hq-muted/50 text-center py-2">Î™®Ïùò Î≥¥Ïú†Ï¢ÖÎ™© ÏóÜÏùå</div>
                    </template>
                  </div>
                </div>
              </div>

              <!-- ÏµúÍ∑º Í±∞Îûò + ÍµêÏã† Î°úÍ∑∏ -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">

                <!-- ÏµúÍ∑º Í±∞Îûò -->
                <div class="glass border border-hq-border rounded-xl p-5">
                  <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-bold text-hq-text">ÏµúÍ∑º Í±∞Îûò</h3>
                    <span class="text-[11px] text-hq-muted" x-text="trading.history.length + 'Í±¥'"></span>
                  </div>
                  <template x-if="trading.history.length === 0">
                    <div class="text-center text-hq-muted/50 py-6 text-xs">ÏµúÍ∑º Í±∞Îûò ÏóÜÏùå</div>
                  </template>
                  <div class="space-y-2 max-h-64 overflow-y-auto scrollbar-thin">
                    <template x-for="t in trading.history.slice(0, 8)" :key="t.id">
                      <div class="flex items-center justify-between bg-hq-surface/50 rounded-lg px-3 py-2">
                        <div class="flex items-center gap-2">
                          <span class="text-[10px] font-bold px-2 py-0.5 rounded"
                                :class="t.action === 'buy' ? 'bg-hq-green/10 text-hq-green' : 'bg-hq-red/10 text-hq-red'"
                                x-text="t.action === 'buy' ? 'Îß§Ïàò' : 'Îß§ÎèÑ'"></span>
                          <span class="text-xs font-semibold text-hq-text" x-text="t.name"></span>
                          <span class="text-[10px] text-hq-muted" x-text="t.qty + 'Ï£º'"></span>
                        </div>
                        <div class="text-right">
                          <span class="text-[11px] font-mono text-hq-text" x-text="(t.market==='US'?fmtUSD(t.total):fmtKRW(t.total||0))"></span>
                        </div>
                      </div>
                    </template>
                  </div>
                </div>

              </div>

              <!-- Î™®ÏùòÌà¨Ïûê Ïó∞Í≤∞ ÏÉÅÌÉú Î∞î (Ïä¨Î¶¨ÌîºÏßÄÎäî Ïã§/Î™®Ïùò ÌÉ≠ÏóêÏÑú ÌôïÏù∏) -->
              <div class="glass border border-hq-border rounded-xl px-4 py-2 flex items-center justify-between mb-1">
                <div class="flex items-center gap-3">
                  <span class="text-[10px] text-hq-muted">Ïã§Í±∞Îûò vs Î™®ÏùòÌà¨Ïûê</span>
                  <span class="text-[10px] px-2 py-0.5 rounded-full"
                        :class="(mockBal&&mockBal.available) ? ((mockBal.mode||'').includes('Paper') ? 'bg-hq-surface text-hq-muted/70 border border-hq-border' : 'bg-hq-purple/10 text-hq-purple border border-hq-purple/20') : 'bg-hq-surface text-hq-muted/50'"
                        x-text="(mockBal&&mockBal.available) ? ((mockBal.mode||'').includes('Paper') ? 'Í∞ÄÏÉÅ: ' + fmtKRW(mockBal.total_eval||0) : 'Î™®Ïùò: ' + fmtKRW(mockBal.total_eval||0)) : 'Î™®Ïùò ÎØ∏Ïó∞Í≤∞'"></span>
                </div>
                <span class="text-[10px] text-hq-muted/50"
                      x-text="(mockBal&&mockBal.available) ? 'ÎπÑÍµê ‚Üí Ïã§/Î™®Ïùò ÌÉ≠' : 'ÏñëÏ™Ω Ïó∞Í≤∞ Ïãú ÎπÑÍµê Í∞ÄÎä•'"></span>
              </div>
            </div>
            <!-- /MISSION CONTROL BOARD -->

          </div>

          <!-- ‚ñ∏ ÏÑúÎ∏åÌÉ≠: ÍµêÏã†Î°úÍ∑∏ (CIOÌåÄ Ï†ÑÏö©) -->
          <div x-show="trading.tab === 'actlog' && !trading.loading">
            <div x-effect="if(trading.tab === 'actlog') loadCioActivityLog()"></div>

            <!-- Ìó§Îçî + 4ÌÉ≠ -->
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-3">
              <div class="flex items-center gap-3 md:gap-4">
                <h3 class="text-sm font-bold text-hq-text flex items-center gap-2">
                  <span class="w-2 h-2 rounded-full" :class="trading.runningNow ? 'bg-hq-yellow animate-pulse' : 'bg-hq-accent'"></span>
                  Í∏àÏúµÎ∂ÑÏÑùÌåÄ ÌÜµÏã†Î°úÍ∑∏
                </h3>
                <span x-show="trading.runningNow" class="text-[10px] text-hq-yellow animate-pulse font-semibold">‚óè LIVE</span>
                <!-- 4ÌÉ≠ -->
                <div class="flex bg-hq-surface border border-hq-border rounded-lg overflow-hidden flex-wrap">
                  <button @click="trading.activityLog.subTab = 'activity'"
                          :class="trading.activityLog.subTab === 'activity' ? 'bg-hq-accent/20 text-hq-accent font-bold' : 'text-hq-muted hover:text-hq-text'"
                          class="px-3 py-1.5 text-xs font-semibold transition">
                    üìã ÌôúÎèô <span class="font-mono ml-1" x-text="trading.activityLog.logs.filter(l => l.level !== 'tool' && l.level !== 'qa_pass' && l.level !== 'qa_fail' && l.type !== 'delegation' && l.type !== 'report').length"></span>
                  </button>
                  <button @click="trading.activityLog.subTab = 'comms'"
                          :class="trading.activityLog.subTab === 'comms' ? 'bg-hq-cyan/20 text-hq-cyan font-bold' : 'text-hq-muted hover:text-hq-text'"
                          class="px-3 py-1.5 text-xs font-semibold transition border-l border-hq-border">
                    üí¨ ÍµêÏã† <span class="font-mono ml-1" x-text="trading.activityLog.logs.filter(l => l.type === 'delegation' || l.type === 'report').length"></span>
                  </button>
                  <button @click="trading.activityLog.subTab = 'qa'"
                          :class="trading.activityLog.subTab === 'qa' ? 'bg-hq-green/20 text-hq-green font-bold' : 'text-hq-muted hover:text-hq-text'"
                          class="px-3 py-1.5 text-xs font-semibold transition border-l border-hq-border">
                    ‚úÖ Í≤ÄÏàò <span class="font-mono ml-1" x-text="trading.activityLog.logs.filter(l => l.level === 'qa_pass' || l.level === 'qa_fail').length"></span>
                  </button>
                  <button @click="trading.activityLog.subTab = 'tools'"
                          :class="trading.activityLog.subTab === 'tools' ? 'bg-hq-orange/20 text-hq-orange font-bold' : 'text-hq-muted hover:text-hq-text'"
                          class="px-3 py-1.5 text-xs font-semibold transition border-l border-hq-border">
                    üîß ÎèÑÍµ¨ <span class="font-mono ml-1" x-text="trading.activityLog.logs.filter(l => (l.tools || []).length > 0 || l.level === 'tool').length"></span>
                  </button>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <button @click="loadCioActivityLog()" class="bg-hq-surface border border-hq-border hover:border-hq-accent/30 rounded-lg px-3 py-1.5 text-xs text-hq-muted transition">ÏÉàÎ°úÍ≥†Ïπ®</button>
                <button @click="showConfirm({ title: 'Î°úÍ∑∏ ÏÇ≠Ï†ú', message: 'Ïù¥ ÌÉ≠Ïùò Î°úÍ∑∏Î•º ÏÇ≠Ï†úÌï†ÍπåÏöî?', confirmText: 'ÏÇ≠Ï†ú', onConfirm: () => clearCioLogsTab(trading.activityLog.subTab) })" title="ÌòÑÏû¨ ÌÉ≠ Ï†ÑÏ≤¥ÏÇ≠Ï†ú"
                        class="text-hq-muted hover:text-hq-red transition p-1 rounded">üóëÔ∏è</button>
              </div>
            </div>

            <!-- Î°úÎî© -->
            <div x-show="trading.activityLog.loading" class="flex items-center justify-center py-12">
              <div class="w-5 h-5 border-2 border-hq-accent border-t-transparent rounded-full animate-spin mr-2"></div>
              <span class="text-xs text-hq-muted">Î°úÍ∑∏ Ï°∞Ìöå Ï§ë...</span>
            </div>

            <!-- Îπà ÏÉÅÌÉú -->
            <template x-if="!trading.activityLog.loading && getFilteredCioLogs().length === 0">
              <div class="glass border border-hq-border rounded-xl p-8 text-center">
                <p class="text-hq-muted/50 text-xs">ÏïÑÏßÅ Í∏àÏúµÎ∂ÑÏÑùÌåÄ ÌôúÎèô Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</p>
                <p class="text-hq-muted/30 text-[10px] mt-1">"Ï¶âÏãú Î∂ÑÏÑù" Ïã§Ìñâ Ïãú Ïã§ÏãúÍ∞ÑÏúºÎ°ú Í∏∞Î°ùÎê©ÎãàÎã§</p>
              </div>
            </template>

            <!-- Î°úÍ∑∏ ÌÉÄÏûÑÎùºÏù∏ -->
            <div x-show="!trading.activityLog.loading && getFilteredCioLogs().length > 0" class="space-y-1">
              <template x-for="log in getFilteredCioLogs()" :key="log.id">
                <div class="glass border border-hq-border/50 rounded-lg px-3 py-2.5 hover:border-hq-accent/20 transition group">
                  <div class="flex items-start gap-2">
                    <!-- ÏïÑÏù¥ÏΩò -->
                    <span class="text-sm mt-0.5 shrink-0 w-5 text-center" x-text="getCioLogIcon(log)"></span>

                    <!-- Î≥∏Î¨∏ -->
                    <div class="flex-1 min-w-0">
                      <!-- Î∞úÏã†/ÏàòÏã† -->
                      <div class="flex items-center gap-1.5 mb-0.5">
                        <span class="text-xs font-bold shrink-0" :class="getCioLogColor(log)"
                              x-text="getCioShortName(log.sender)"></span>
                        <template x-if="log.receiver">
                          <span class="flex items-center gap-1">
                            <span class="text-[10px] text-hq-muted/40" x-text="log.type === 'report' ? '‚Üí' : '‚á¢'"></span>
                            <span class="text-[11px] text-hq-muted/60 shrink-0"
                                  x-text="getCioShortName(log.receiver)"></span>
                          </span>
                        </template>
                        <span class="text-[10px] text-hq-muted/40 ml-auto shrink-0" x-text="formatLogTime(log.time)"></span>
                      </div>

                      <!-- Î©îÏãúÏßÄ (2Ï§ÑÍπåÏßÄ) -->
                      <p class="text-xs text-hq-muted leading-relaxed line-clamp-2 group-hover:line-clamp-none transition-all"
                         x-text="stripMarkdownPreview(log.message)"></p>

                      <!-- ÎèÑÍµ¨ ÏÇ¨Ïö© ÌÉúÍ∑∏ -->
                      <template x-if="log.tools && log.tools.length > 0">
                        <div class="flex flex-wrap gap-1 mt-1.5">
                          <template x-for="tool in log.tools" :key="tool">
                            <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded bg-hq-accent/10 border border-hq-accent/20 text-[11px] text-hq-accent font-mono">
                              <span class="text-[10px]">üîß</span>
                              <span x-text="tool"></span>
                            </span>
                          </template>
                        </div>
                      </template>
                    </div>

                    <!-- ÌÉÄÏûÖ Î±ÉÏßÄ -->
                    <span class="text-[10px] px-1.5 py-0.5 rounded-full shrink-0 mt-0.5"
                          :class="{
                            'bg-hq-yellow/10 text-hq-yellow': log.type === 'delegation',
                            'bg-hq-green/10 text-hq-green': log.type === 'report',
                            'bg-hq-accent/10 text-hq-accent': log.type === 'activity',
                          }"
                          x-text="log.type === 'delegation' ? 'ÏúÑÏûÑ' : log.type === 'report' ? 'Î≥¥Í≥†' : 'ÌôúÎèô'"></span>
                  </div>
                </div>
              </template>
            </div>

            <!-- ÌÜµÍ≥Ñ ÏöîÏïΩ -->
            <div x-show="!trading.activityLog.loading && trading.activityLog.logs.length > 0" class="mt-4 glass border border-hq-border rounded-xl p-3">
              <div class="grid grid-cols-5 gap-2 text-center">
                <div>
                  <p class="text-lg font-bold text-hq-text" x-text="trading.activityLog.logs.length"></p>
                  <p class="text-[9px] text-hq-muted">Ï†ÑÏ≤¥</p>
                </div>
                <div>
                  <p class="text-lg font-bold text-hq-accent" x-text="trading.activityLog.logs.filter(l => l.type !== 'delegation' && l.type !== 'report' && l.level !== 'qa_pass' && l.level !== 'qa_fail' && l.level !== 'tool').length"></p>
                  <p class="text-[9px] text-hq-muted">ÌôúÎèô</p>
                </div>
                <div>
                  <p class="text-lg font-bold text-hq-yellow" x-text="trading.activityLog.logs.filter(l => l.type === 'delegation' || l.type === 'report').length"></p>
                  <p class="text-[9px] text-hq-muted">ÍµêÏã†</p>
                </div>
                <div>
                  <p class="text-lg font-bold text-hq-cyan" x-text="trading.activityLog.logs.filter(l => l.level === 'qa_pass' || l.level === 'qa_fail').length"></p>
                  <p class="text-[9px] text-hq-muted">Í≤ÄÏàò</p>
                </div>
                <div>
                  <p class="text-lg font-bold text-hq-orange" x-text="trading.activityLog.logs.filter(l => l.level === 'tool').length"></p>
                  <p class="text-[9px] text-hq-muted">ÎèÑÍµ¨</p>
                </div>
              </div>
            </div>
          </div>

          <!-- ‚ñ∏ ÏÑúÎ∏åÌÉ≠ 2: Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ (CÏïà ‚Äî ÌïúÍµ≠Ïû•+ÎØ∏Íµ≠Ïû• Î∂ÑÎ¶¨) -->
          <div x-show="trading.tab === 'portfolio' && !trading.loading"
               x-data="{
                 port: null, portLoading: false, portError: '',
                 snapHistory: [],
                 newInitialKrw: null, newInitialUsd: null, newTotalDeposit: null,
                 async loadPortfolio() {
                   this.portLoading = true; this.portError = '';
                   try {
                     const [p, h] = await Promise.all([
                       fetch('/api/trading/portfolio').then(r => r.json()),
                       fetch('/api/trading/portfolio/history').then(r => r.json()),
                     ]);
                     this.port = p;
                     this.snapHistory = (h.snapshots || []).slice(-30);
                   } catch(e) { this.portError = e.message; }
                   finally { this.portLoading = false; }
                 },
                 fmtKRW(v) { if (!v && v !== 0) return '-'; return '‚Ç©' + Number(v).toLocaleString('ko-KR'); },
                 fmtUSD(v) { if (!v && v !== 0) return '-'; return '$' + Number(v).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2}); },
                 fmtPct(v) { return (v >= 0 ? '+' : '') + Number(v).toFixed(2) + '%'; },
                 get pieSlices() {
                   if (!this.port || !this.port.available) return [];
                   const kr = this.port.kr || {}, us = this.port.us || {};
                   const fx = this.port.fx_rate || 1450;
                   const krCash = kr.cash || 0, krHoldings = kr.holdings || [];
                   const usCashKrw = (us.cash_usd || 0) * fx, usHoldings = us.holdings || [];
                   const total = this.port.total_eval || 1;
                   const colors = ['#3b82f6','#10b981','#f59e0b','#8b5cf6','#ef4444','#06b6d4','#f97316','#ec4899'];
                   let slices = [];
                   if (krCash > 0) slices.push({label:'ÌòÑÍ∏à(KR)', value: Math.round(krCash/total*1000)/10, color:'#3b82f6'});
                   if (usCashKrw > 0) slices.push({label:'ÌòÑÍ∏à(US)', value: Math.round(usCashKrw/total*1000)/10, color:'#60a5fa'});
                   krHoldings.forEach((h,i) => {
                     const pct = Math.round((h.qty * h.current_price)/total*1000)/10;
                     if (pct > 0) slices.push({label: (h.name||h.ticker)+' üá∞üá∑', value: pct, color: colors[(i+2) % colors.length]});
                   });
                   usHoldings.forEach((h,i) => {
                     const evalKrw = h.qty * (h.current_price||0) * fx;
                     const pct = Math.round(evalKrw/total*1000)/10;
                     if (pct > 0) slices.push({label: (h.name||h.symbol)+' üá∫üá∏', value: pct, color: colors[(i+4) % colors.length]});
                   });
                   return slices.length ? slices : [{label:'ÌòÑÍ∏à', value:100, color:'#3b82f6'}];
                 },
                 svgPie(slices) {
                   if (!slices.length) return '';
                   let paths = []; let cumPct = 0;
                   const cx=60, cy=60, r=55;
                   slices.forEach(s => {
                     const startAngle = (cumPct/100)*Math.PI*2 - Math.PI/2;
                     cumPct += s.value;
                     const endAngle = (cumPct/100)*Math.PI*2 - Math.PI/2;
                     const x1=cx+r*Math.cos(startAngle), y1=cy+r*Math.sin(startAngle);
                     const x2=cx+r*Math.cos(endAngle), y2=cy+r*Math.sin(endAngle);
                     const large = s.value > 50 ? 1 : 0;
                     if (s.value >= 99.9) { paths.push(`<circle cx='${cx}' cy='${cy}' r='${r}' fill='${s.color}'/>`); }
                     else { paths.push(`<path d='M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${large},1 ${x2},${y2} Z' fill='${s.color}' opacity='0.85'/>`); }
                   });
                   return paths.join('');
                 },
                 get linePoints() {
                   if (!this.snapHistory.length) return '';
                   const vals = this.snapHistory.map(s => s.eval || s.cash || 0);
                   const min = Math.min(...vals), max = Math.max(...vals);
                   const range = max - min || 1;
                   const w=280, h=80;
                   return this.snapHistory.map((s,i) => {
                     const x = (i/(this.snapHistory.length-1||1))*w;
                     const y = h - ((( (s.eval||s.cash||0) - min)/range)*h*0.85 + h*0.05);
                     return `${x},${y}`;
                   }).join(' ');
                 },
                 get svgCircles() {
                   if (!this.snapHistory.length) return '';
                   const vals = this.snapHistory.map(s => s.eval || s.cash || 0);
                   const min = Math.min(...vals), max = Math.max(...vals);
                   const range = max - min || 1;
                   const w=280, h=80, color = this.lineColor;
                   return this.snapHistory.map((s,i) => {
                     const cx = (i/(this.snapHistory.length-1||1))*w;
                     const cy = h - ((( (s.eval||s.cash||0) - min)/range)*h*0.85 + h*0.05);
                     return '&lt;circle cx=&quot;' + cx + '&quot; cy=&quot;' + cy + '&quot; r=&quot;2.5&quot; fill=&quot;' + color + '&quot;/&gt;';
                   }).join('');
                 },
                 get lineColor() { if (!this.port) return '#3b82f6'; return (this.port.pnl || 0) >= 0 ? '#10b981' : '#ef4444'; }
               }"
               x-init="loadPortfolio()">

            <div x-effect="if(trading.tab === 'portfolio') loadPortfolio()"></div>

            <!-- Î°úÎî© -->
            <div x-show="portLoading" class="text-center py-12 text-hq-muted text-sm">ÏûîÍ≥† Ï°∞Ìöå Ï§ë...</div>

            <!-- ÏóêÎü¨ ÎòêÎäî ÎØ∏Ïó∞Í≤∞ -->
            <template x-if="!portLoading && (!port || !port.available)">
              <div class="glass border border-hq-border rounded-xl p-8 text-center">
                <p class="text-hq-muted text-sm" x-text="port?.reason || 'Ïã§Í±∞Îûò API ÎØ∏Ïó∞Í≤∞'"></p>
              </div>
            </template>

            <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
            <template x-if="!portLoading && port && port.available">
              <div class="space-y-4">

                <!-- Ï¥ùÌï© ÏöîÏïΩ Ïπ¥Îìú -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                  <div class="glass border border-hq-accent/30 rounded-xl p-4">
                    <p class="text-[10px] text-hq-muted mb-1">Ï¥ù ÏûêÏÇ∞ (ÏõêÌôî ÌôòÏÇ∞)</p>
                    <p class="text-sm font-bold text-hq-text" x-text="fmtKRW(port.total_eval)"></p>
                    <p class="text-[9px] text-hq-muted/60 mt-0.5" x-text="'ÌôòÏú® ' + fmtKRW(port.fx_rate) + '/USD'"></p>
                  </div>
                  <div class="glass border border-hq-border rounded-xl p-4">
                    <p class="text-[10px] text-hq-muted mb-1">Ï¥ù Ìà¨ÏûêÍ∏à</p>
                    <p class="text-sm font-bold text-hq-text" x-text="fmtKRW(port.initial_capital)"></p>
                  </div>
                  <div class="glass border border-hq-border rounded-xl p-4">
                    <p class="text-[10px] text-hq-muted mb-1">Ï¥ù ÏÜêÏùµ</p>
                    <p class="text-sm font-bold" :class="(port.pnl||0)>=0?'text-hq-green':'text-hq-red'"
                       x-text="fmtKRW(port.pnl) + ' (' + fmtPct(port.pnl_pct) + ')'"></p>
                  </div>
                  <div class="glass border border-hq-border rounded-xl p-4">
                    <p class="text-[10px] text-hq-muted mb-1">Î≥¥Ïú† ÌòÑÍ∏à</p>
                    <p class="text-xs font-bold text-hq-accent" x-text="fmtKRW(port.kr?.cash||0)"></p>
                    <p class="text-[9px] text-hq-muted mt-0.5" x-show="port.us?.cash_usd > 0" x-text="'+ ' + fmtUSD(port.us?.cash_usd)"></p>
                  </div>
                </div>

                <!-- ÌïúÍµ≠Ïû• üá∞üá∑ / ÎØ∏Íµ≠Ïû• üá∫üá∏ Î∂ÑÎ¶¨ Ïπ¥Îìú -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
                  <!-- ÌïúÍµ≠Ïû• -->
                  <div class="glass border border-red-500/20 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-3">
                      <span class="text-[10px] font-bold px-1.5 py-0.5 rounded bg-red-500/20 text-red-400 border border-red-500/30">KR</span>
                      <h4 class="text-xs font-bold text-hq-text">ÌïúÍµ≠Ïû•</h4>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                      <div><span class="text-hq-muted">Ìà¨ÏûêÍ∏à</span><p class="font-bold" x-text="fmtKRW(port.kr?.initial_capital||0)"></p></div>
                      <div><span class="text-hq-muted">ÌèâÍ∞ÄÍ∏àÏï°</span><p class="font-bold" x-text="fmtKRW(port.kr?.total_eval||0)"></p></div>
                      <div><span class="text-hq-muted">ÏÜêÏùµ</span>
                        <p class="font-bold" :class="(port.kr?.pnl||0)>=0?'text-hq-green':'text-hq-red'"
                           x-text="fmtKRW(port.kr?.pnl||0) + ' (' + fmtPct(port.kr?.pnl_pct||0) + ')'"></p></div>
                      <div><span class="text-hq-muted">Ï¢ÖÎ™© Ïàò</span><p class="font-bold" x-text="(port.kr?.holdings||[]).length + 'Í∞ú'"></p></div>
                    </div>
                    <!-- Î≥¥Ïú† Ï¢ÖÎ™© -->
                    <template x-if="(port.kr?.holdings||[]).length > 0">
                      <div class="mt-3 space-y-1.5 border-t border-hq-border/30 pt-2">
                        <template x-for="h in port.kr.holdings" :key="h.ticker">
                          <div class="flex items-center justify-between text-[11px]">
                            <span class="text-hq-text" x-text="h.name||h.ticker"></span>
                            <span :class="(h.eval_profit||0)>=0?'text-hq-green':'text-hq-red'" x-text="fmtKRW(h.eval_profit||0)"></span>
                          </div>
                        </template>
                      </div>
                    </template>
                  </div>
                  <!-- ÎØ∏Íµ≠Ïû• -->
                  <div class="glass border border-blue-500/20 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-3">
                      <span class="text-[10px] font-bold px-1.5 py-0.5 rounded bg-blue-500/20 text-blue-400 border border-blue-500/30">US</span>
                      <h4 class="text-xs font-bold text-hq-text">ÎØ∏Íµ≠Ïû•</h4>
                      <span x-show="!port.us?.available" class="text-[9px] text-hq-muted/50">(ÎØ∏Ïó∞Í≤∞)</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                      <div><span class="text-hq-muted">Ìà¨ÏûêÍ∏à</span><p class="font-bold" x-text="fmtUSD(port.us?.initial_capital_usd||0)"></p></div>
                      <div><span class="text-hq-muted">ÌèâÍ∞ÄÍ∏àÏï°</span><p class="font-bold" x-text="fmtUSD(port.us?.total_eval_usd||0)"></p>
                        <p class="text-[9px] text-hq-muted" x-text="'‚âà ' + fmtKRW(port.us?.total_eval_krw||0)"></p></div>
                      <div><span class="text-hq-muted">ÏÜêÏùµ</span>
                        <p class="font-bold" :class="(port.us?.pnl_usd||0)>=0?'text-hq-green':'text-hq-red'"
                           x-text="fmtUSD(port.us?.pnl_usd||0) + ' (' + fmtPct(port.us?.pnl_pct||0) + ')'"></p></div>
                      <div><span class="text-hq-muted">Ï¢ÖÎ™© Ïàò</span><p class="font-bold" x-text="(port.us?.holdings||[]).length + 'Í∞ú'"></p></div>
                    </div>
                    <!-- Î≥¥Ïú† Ï¢ÖÎ™© -->
                    <template x-if="(port.us?.holdings||[]).length > 0">
                      <div class="mt-3 space-y-1.5 border-t border-hq-border/30 pt-2">
                        <template x-for="h in port.us.holdings" :key="h.symbol">
                          <div class="flex items-center justify-between text-[11px]">
                            <span class="text-hq-text" x-text="h.name||h.symbol"></span>
                            <span :class="(h.eval_profit||0)>=0?'text-hq-green':'text-hq-red'" x-text="fmtUSD(h.eval_profit||0)"></span>
                          </div>
                        </template>
                      </div>
                    </template>
                  </div>
                </div>

                <!-- ÌååÏù¥Ï∞®Ìä∏ + ÏûêÏÇ∞ Íµ¨ÏÑ± -->
                <div class="glass border border-hq-border rounded-xl p-5">
                  <h3 class="text-sm font-bold text-hq-text mb-4">ÏûêÏÇ∞ Íµ¨ÏÑ±</h3>
                  <div class="flex gap-6 items-center">
                    <div class="flex-shrink-0">
                      <svg width="120" height="120" viewBox="0 0 120 120" x-html="svgPie(pieSlices)"></svg>
                    </div>
                    <div class="flex-1 space-y-1.5">
                      <template x-for="slice in pieSlices" :key="slice.label">
                        <div class="flex items-center justify-between text-xs">
                          <div class="flex items-center gap-2">
                            <div class="w-2.5 h-2.5 rounded-full flex-shrink-0" :style="'background:'+slice.color"></div>
                            <span class="text-hq-text" x-text="slice.label"></span>
                          </div>
                          <span class="text-hq-muted" x-text="slice.value+'%'"></span>
                        </div>
                      </template>
                    </div>
                  </div>
                </div>

                <!-- ÏàòÏùµÎ•† ÎùºÏù∏ Ï∞®Ìä∏ -->
                <div class="glass border border-hq-border rounded-xl p-5">
                  <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-bold text-hq-text">ÏàòÏùµÎ•† Ï∂îÏù¥ (ÏµúÍ∑º 30Ïùº)</h3>
                    <span class="text-[10px] text-hq-muted">Îç∞Ïù¥ÌÑ∞ ÎàÑÏ†Å Ï§ë</span>
                  </div>
                  <template x-if="snapHistory.length >= 2">
                    <div>
                      <svg width="100%" height="90" viewBox="0 0 280 90" preserveAspectRatio="none" class="w-full">
                        <line x1="0" y1="45" x2="280" y2="45" stroke="#374151" stroke-width="0.5" stroke-dasharray="4,4"/>
                        <polyline :points="linePoints" fill="none" :stroke="lineColor" stroke-width="2" stroke-linejoin="round"/>
                        <g x-html="svgCircles"></g>
                      </svg>
                      <div class="flex justify-between text-[9px] text-hq-muted mt-1">
                        <span x-text="snapHistory[0]?.date||''"></span>
                        <span x-text="snapHistory[snapHistory.length-1]?.date||''"></span>
                      </div>
                    </div>
                  </template>
                  <template x-if="snapHistory.length < 2">
                    <div class="text-center py-6 text-hq-muted/70 text-xs">
                      Îç∞Ïù¥ÌÑ∞Í∞Ä ÏåìÏù¥Î©¥ Ï∞®Ìä∏Í∞Ä ÌëúÏãúÎê©ÎãàÎã§ (ÌòÑÏû¨ <span x-text="snapHistory.length"></span>Ïùº)
                    </div>
                  </template>
                </div>

                <!-- D-4: ÏûÖÏ∂úÍ∏à Í∏∞Î°ù (ÌÜ†Ïä§Ìòï) -->
                <div class="glass border border-hq-border rounded-xl p-4"
                     x-data="{
                       txns: [], txnLoading: false,
                       showAddTxn: false,
                       txnType: 'deposit', txnAmount: null, txnCurrency: 'KRW', txnMemo: '',
                       async loadTxns() {
                         this.txnLoading = true;
                         try {
                           const r = await fetch('/api/trading/portfolio/transactions');
                           const d = await r.json();
                           this.txns = (d.transactions || []).reverse();
                         } catch(e) {}
                         this.txnLoading = false;
                       },
                       async addTxn() {
                         if (!this.txnAmount || this.txnAmount <= 0) return;
                         await fetch('/api/trading/portfolio/transactions', {
                           method: 'POST', headers: {'Content-Type': 'application/json'},
                           body: JSON.stringify({type: this.txnType, amount: this.txnAmount, currency: this.txnCurrency, memo: this.txnMemo})
                         });
                         this.txnAmount = null; this.txnMemo = ''; this.showAddTxn = false;
                         await this.loadTxns();
                         await loadPortfolio();
                       },
                       async deleteTxn(id) {
                         await fetch('/api/trading/portfolio/transactions/' + id, {method: 'DELETE'});
                         await this.loadTxns();
                         await loadPortfolio();
                       },
                       txnLabel(t) { return t === 'deposit' ? 'ÏûÖÍ∏à' : t === 'withdraw' ? 'Ï∂úÍ∏à' : 'ÌôòÏ†Ñ'; },
                       txnColor(t) { return t === 'deposit' ? 'text-hq-green' : t === 'withdraw' ? 'text-hq-red' : 'text-hq-cyan'; },
                       txnSign(t) { return t === 'deposit' ? '+' : t === 'withdraw' ? '-' : ''; },
                     }" x-init="loadTxns()">
                  <div class="flex items-center justify-between mb-3">
                    <h4 class="text-xs font-bold text-hq-text">ÏûÖÏ∂úÍ∏à Í∏∞Î°ù</h4>
                    <button @click="showAddTxn = !showAddTxn"
                            class="text-[10px] px-2 py-1 rounded-lg transition"
                            :class="showAddTxn ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-accent'">
                      <span x-text="showAddTxn ? 'Îã´Í∏∞' : '+ Í∏∞Î°ù Ï∂îÍ∞Ä'"></span>
                    </button>
                  </div>
                  <!-- Ï∂îÍ∞Ä Ìèº -->
                  <div x-show="showAddTxn" x-transition class="bg-hq-bg/50 border border-hq-border/30 rounded-lg p-3 mb-3 space-y-2">
                    <div class="flex gap-2">
                      <template x-for="t in ['deposit','withdraw','exchange']" :key="t">
                        <button @click="txnType = t" class="text-[10px] px-3 py-1 rounded-lg transition"
                                :class="txnType === t ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'"
                                x-text="txnLabel(t)"></button>
                      </template>
                    </div>
                    <div class="flex gap-2">
                      <input type="number" x-model.number="txnAmount" placeholder="Í∏àÏï°"
                             class="flex-1 bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-xs text-hq-text font-mono"/>
                      <select x-model="txnCurrency" class="bg-hq-bg border border-hq-border rounded-lg px-2 py-2 text-xs text-hq-text">
                        <option value="KRW">KRW</option>
                        <option value="USD">USD</option>
                      </select>
                    </div>
                    <div class="flex gap-2">
                      <input x-model="txnMemo" placeholder="Î©îÎ™® (ÏÑ†ÌÉù)" class="flex-1 bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-xs text-hq-text"/>
                      <button @click="addTxn()" class="bg-hq-accent/20 text-hq-accent rounded-lg px-4 py-2 text-xs font-semibold hover:bg-hq-accent/30">Ï†ÄÏû•</button>
                    </div>
                  </div>
                  <!-- Í∏∞Î°ù Î¶¨Ïä§Ìä∏ -->
                  <div class="space-y-1.5 max-h-48 overflow-y-auto scrollbar-thin">
                    <template x-for="txn in txns" :key="txn.id">
                      <div class="flex items-center justify-between py-1.5 border-b border-hq-border/20 last:border-0">
                        <div class="flex items-center gap-2">
                          <span class="text-[10px] font-bold px-1.5 py-0.5 rounded"
                                :class="txn.type === 'deposit' ? 'bg-hq-green/10 text-hq-green' : txn.type === 'withdraw' ? 'bg-hq-red/10 text-hq-red' : 'bg-hq-cyan/10 text-hq-cyan'"
                                x-text="txnLabel(txn.type)"></span>
                          <span class="text-[10px] text-hq-muted" x-text="txn.date"></span>
                          <span x-show="txn.memo" class="text-[10px] text-hq-muted/60" x-text="txn.memo"></span>
                        </div>
                        <div class="flex items-center gap-2">
                          <span class="text-xs font-mono font-bold" :class="txnColor(txn.type)"
                                x-text="txnSign(txn.type) + Number(txn.amount).toLocaleString() + ' ' + txn.currency"></span>
                          <button @click="deleteTxn(txn.id)" class="text-hq-muted/30 hover:text-hq-red text-[10px] transition">√ó</button>
                        </div>
                      </div>
                    </template>
                    <div x-show="txns.length === 0" class="text-center text-hq-muted/60 py-4 text-xs">ÏûÖÏ∂úÍ∏à Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>
                  </div>
                  <!-- ÏöîÏïΩ -->
                  <div x-show="txns.length > 0" class="mt-3 pt-2 border-t border-hq-border/30 flex justify-between text-[10px]">
                    <span class="text-hq-muted">Ï¥ù ÏûÖÍ∏à</span>
                    <span class="text-hq-green font-mono" x-text="'+' + txns.filter(t => t.type === 'deposit').reduce((s,t) => s + t.amount, 0).toLocaleString() + ' KRW'"></span>
                  </div>
                </div>

              </div>
            </template>
          </div>

          <!-- ‚ñ∏ ÏÑúÎ∏åÌÉ≠ 3: Îß§Îß§ Ï†ÑÎûµ -->
          <!-- ‚ñ∏ ÏÑúÎ∏åÌÉ≠ 4: Í¥ÄÏã¨Ï¢ÖÎ™© -->
          <div x-show="trading.tab === 'watchlist' && !trading.loading">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-3">
                <h3 class="text-sm font-bold text-hq-text">Í¥ÄÏã¨Ï¢ÖÎ™©</h3>
                <button @click="loadWatchlistPrices()" :disabled="trading.watchPricesLoading"
                        class="text-[10px] px-2 py-0.5 rounded bg-hq-cyan/10 text-hq-cyan hover:bg-hq-cyan/20 transition disabled:opacity-50">
                  <span x-show="!trading.watchPricesLoading">üîÑ ÏãúÏÑ∏ ÏÉàÎ°úÍ≥†Ïπ®</span>
                  <span x-show="trading.watchPricesLoading">‚è≥ Ï°∞Ìöå Ï§ë...</span>
                </button>
                <span x-show="trading.watchPricesUpdatedAt" class="text-[9px] text-hq-muted"
                      x-text="'ÏµúÍ∑º Í∞±Ïã†: ' + trading.watchPricesUpdatedAt"></span>
              </div>
              <button @click="trading.showWatchModal = true" class="bg-hq-accent/20 text-hq-accent hover:bg-hq-accent/30 rounded-lg px-3 py-1.5 text-xs font-semibold transition">+ Ï¢ÖÎ™© Ï∂îÍ∞Ä</button>
            </div>
            <!-- ÏãúÏû• ÌïÑÌÑ∞ ÌÉ≠ -->
            <div class="flex items-center gap-1 mb-4">
              <template x-for="mf in [{id:'all',l:'Ï†ÑÏ≤¥'},{id:'KR',l:'üá∞üá∑ ÌïúÍµ≠'},{id:'US',l:'üá∫üá∏ ÎØ∏Íµ≠'}]" :key="mf.id">
                <button @click="trading.watchMarketFilter = mf.id"
                        :class="trading.watchMarketFilter === mf.id ? 'bg-hq-accent/25 text-hq-accent border-hq-accent/40' : 'bg-hq-surface/60 text-hq-muted border-hq-border hover:text-hq-text'"
                        class="px-3 py-1 rounded-lg text-xs font-semibold border transition"
                        x-text="mf.l + (mf.id === 'all' ? ' (' + trading.watchlist.length + ')' : ' (' + trading.watchlist.filter(w => w.market === mf.id || (mf.id === 'KR' && !w.market)).length + ')')"></button>
              </template>
              <span x-show="trading.watchDragHint" class="ml-auto text-[9px] text-hq-muted/60 italic">‚Üï ÎìúÎûòÍ∑∏Ìï¥ÏÑú ÏàúÏÑú Î≥ÄÍ≤Ω</span>
              <!-- Ï†ÑÏ≤¥ÏÑ†ÌÉù Î≤ÑÌäº -->
              <button @click="selectAllWatchlist(trading.watchMarketFilter)"
                      x-show="trading.watchlist.length > 0"
                      class="ml-2 px-2.5 py-1 rounded-lg text-[10px] font-semibold border transition"
                      :class="trading.watchlist.filter(w => trading.watchMarketFilter === 'all' || w.market === trading.watchMarketFilter || (trading.watchMarketFilter === 'KR' && !w.market)).every(w => trading.selectedWatchlist.includes(w.ticker)) && trading.watchlist.filter(w => trading.watchMarketFilter === 'all' || w.market === trading.watchMarketFilter || (trading.watchMarketFilter === 'KR' && !w.market)).length > 0 ? 'bg-hq-accent/20 text-hq-accent border-hq-accent/40' : 'bg-hq-surface/60 text-hq-muted border-hq-border hover:text-hq-text'"
                      x-text="trading.watchlist.filter(w => trading.watchMarketFilter === 'all' || w.market === trading.watchMarketFilter || (trading.watchMarketFilter === 'KR' && !w.market)).every(w => trading.selectedWatchlist.includes(w.ticker)) && trading.watchlist.filter(w => trading.watchMarketFilter === 'all' || w.market === trading.watchMarketFilter || (trading.watchMarketFilter === 'KR' && !w.market)).length > 0 ? '‚úì Ï†ÑÏ≤¥Ìï¥Ï†ú' : '‚òê Ï†ÑÏ≤¥ÏÑ†ÌÉù'">
              </button>
            </div>
            <!-- ÏÑ†ÌÉù Ï¢ÖÎ™© Î∂ÑÏÑù Î≤ÑÌäº -->
            <div x-show="trading.selectedWatchlist && trading.selectedWatchlist.length > 0" class="mb-3 flex items-center gap-2 p-2.5 rounded-xl bg-hq-accent/10 border border-hq-accent/30">
              <span class="text-xs text-hq-accent font-bold" x-text="trading.selectedWatchlist.length + 'Í∞ú Ï¢ÖÎ™© ÏÑ†ÌÉù'"></span>
              <button @click="analyzeSelectedWatchlist()"
                      :disabled="trading.analyzingSelected"
                      class="ml-auto bg-hq-accent text-white rounded-lg px-4 py-1.5 text-xs font-bold hover:bg-hq-accent/80 transition disabled:opacity-50">
                <span x-show="!trading.analyzingSelected">üîç ÏÑ†ÌÉù Ï¢ÖÎ™© Î∂ÑÏÑù Î∞è ÏûêÎèôÎß§Îß§</span>
                <span x-show="trading.analyzingSelected">‚è≥ Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• Î∂ÑÏÑù ÏßÑÌñâ Ï§ë...</span>
              </button>
              <button @click="trading.selectedWatchlist = []" class="text-hq-muted hover:text-hq-text text-xs transition">ÏÑ†ÌÉù Ìï¥Ï†ú</button>
            </div>
            <template x-if="trading.watchlist.length === 0">
              <div class="glass border border-hq-border rounded-xl p-8 text-center">
                <p class="text-hq-muted/70 text-xs mb-3">Í¥ÄÏã¨ Ï¢ÖÎ™©Ïù¥ ÏóÜÏäµÎãàÎã§</p>
                <button @click="trading.showWatchModal = true" class="bg-hq-accent/20 text-hq-accent rounded-lg px-4 py-2 text-xs font-semibold">Ï¢ÖÎ™© Ï∂îÍ∞ÄÌïòÍ∏∞</button>
              </div>
            </template>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
              <template x-for="w in trading.watchlist.filter(w => trading.watchMarketFilter === 'all' || w.market === trading.watchMarketFilter || (trading.watchMarketFilter === 'KR' && !w.market))" :key="w.ticker">
                <div class="glass border border-hq-border rounded-xl p-4 hover-glow transition-all duration-150 cursor-grab active:cursor-grabbing"
                     draggable="true"
                     @dragstart="trading.draggedTicker = w.ticker; trading.watchDragHint = false; $event.dataTransfer.effectAllowed = 'move'"
                     @dragend="trading.draggedTicker = null; trading.dragOverTicker = null"
                     @dragover.prevent="trading.dragOverTicker = w.ticker; $event.dataTransfer.dropEffect = 'move'"
                     @dragleave="if(trading.dragOverTicker === w.ticker) trading.dragOverTicker = null"
                     @drop.prevent="watchlistDropReorder(w.ticker)"
                     :class="trading.dragOverTicker === w.ticker && trading.draggedTicker !== w.ticker ? 'border-hq-accent/60 scale-[1.02] shadow-lg' : trading.draggedTicker === w.ticker ? 'opacity-40' : ''">
                  <!-- Ìó§Îçî: Ï≤¥ÌÅ¨Î∞ïÏä§ + Ï¢ÖÎ™©Î™Ö + ÏÇ≠Ï†ú -->
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                      <input type="checkbox" class="w-4 h-4 rounded border-hq-border accent-hq-accent cursor-pointer"
                             :checked="trading.selectedWatchlist && trading.selectedWatchlist.includes(w.ticker)"
                             @change="toggleWatchlistSelect(w.ticker)"
                             @click.stop>
                      <span class="text-[10px] font-bold px-1.5 py-0.5 rounded" :class="(w.market||'KR')==='US' ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' : 'bg-red-500/20 text-red-400 border border-red-500/30'" x-text="(w.market||'KR')==='US' ? 'US' : 'KR'"></span>
                      <div>
                        <div class="text-sm font-bold text-hq-text" x-text="w.name"></div>
                        <div class="text-[10px] text-hq-muted font-mono" x-text="w.ticker"></div>
                      </div>
                    </div>
                    <div class="flex items-center gap-1.5">
                      <button @click="openWatchlistChart(w)" class="text-hq-muted/70 hover:text-hq-cyan transition" title="Ï∞®Ìä∏ Î≥¥Í∏∞">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                      </button>
                      <button @click="openWatchlistEdit(w)" class="text-hq-muted/70 hover:text-hq-accent transition" title="ÏàòÏ†ï">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                      </button>
                      <button @click="removeWatchlistItem(w.ticker)" class="text-hq-muted/70 hover:text-hq-red transition" title="ÏÇ≠Ï†ú">&times;</button>
                    </div>
                  </div>

                  <!-- ÌòÑÏû¨Í∞Ä + Îì±ÎùΩÎ•† (Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞) -->
                  <template x-if="trading.watchPrices[w.ticker] && !trading.watchPrices[w.ticker].error">
                    <div class="mb-2">
                      <div class="flex items-baseline gap-2">
                        <span class="text-xl font-bold font-mono"
                              :class="trading.watchPrices[w.ticker].change >= 0 ? 'text-hq-red' : 'text-blue-400'"
                              x-text="(trading.watchPrices[w.ticker].currency === 'USD' ? '$' : '') + (trading.watchPrices[w.ticker].current_price||0).toLocaleString() + (trading.watchPrices[w.ticker].currency === 'KRW' ? 'Ïõê' : '')"></span>
                        <span class="text-sm font-bold px-2 py-0.5 rounded"
                              :class="trading.watchPrices[w.ticker].change >= 0 ? 'bg-hq-red/15 text-hq-red' : 'bg-blue-500/15 text-blue-400'"
                              x-text="(trading.watchPrices[w.ticker].change >= 0 ? '‚ñ≤' : '‚ñº') + ' ' + Math.abs(trading.watchPrices[w.ticker].change).toLocaleString() + ' (' + (trading.watchPrices[w.ticker].change_pct >= 0 ? '+' : '') + trading.watchPrices[w.ticker].change_pct + '%)'"></span>
                      </div>
                      <div class="flex gap-4 mt-1.5 text-xs text-hq-muted">
                        <span x-text="'Í≥†Í∞Ä ' + (trading.watchPrices[w.ticker].high||0).toLocaleString()"></span>
                        <span x-text="'Ï†ÄÍ∞Ä ' + (trading.watchPrices[w.ticker].low||0).toLocaleString()"></span>
                        <span x-text="'Í±∞ÎûòÎüâ ' + (trading.watchPrices[w.ticker].volume||0).toLocaleString()"></span>
                      </div>
                    </div>
                  </template>
                  <!-- Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞ ÏóÜÏùÑ Îïå -->
                  <template x-if="!trading.watchPrices[w.ticker]">
                    <div class="mb-2 text-[10px] text-hq-muted/60 italic">
                      üîÑ ÏãúÏÑ∏ ÏÉàÎ°úÍ≥†Ïπ®ÏùÑ ÎàåÎü¨ ÌòÑÏû¨Í∞ÄÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî
                    </div>
                  </template>
                  <!-- Í∞ÄÍ≤© Ï°∞Ìöå ÏóêÎü¨ (ÏÉÅÏÑ∏ ÏõêÏù∏ ÌëúÏãú) -->
                  <template x-if="trading.watchPrices[w.ticker] && trading.watchPrices[w.ticker].error">
                    <div class="mb-2 text-[10px] text-hq-yellow/70">
                      ‚ö†Ô∏è ÏãúÏÑ∏ Ï°∞Ìöå Ïã§Ìå®: <span x-text="trading.watchPrices[w.ticker].error" class="text-hq-muted"></span>
                    </div>
                  </template>

                  <!-- Î™©ÌëúÍ∞Ä vs ÌòÑÏû¨Í∞Ä ÎπÑÍµê -->
                  <template x-if="w.target_price && trading.watchPrices[w.ticker] && !trading.watchPrices[w.ticker].error">
                    <div class="mb-2">
                      <div class="flex items-center justify-between text-xs mb-1">
                        <span class="text-hq-muted">ÌòÑÏû¨Í∞Ä ‚Üí Î™©ÌëúÍ∞Ä</span>
                        <span class="font-mono font-semibold"
                              :class="trading.watchPrices[w.ticker].current_price >= w.target_price ? 'text-hq-green' : 'text-hq-cyan'"
                              x-text="(() => { const cur = trading.watchPrices[w.ticker].current_price; const tgt = w.target_price; const diff = ((tgt - cur) / cur * 100).toFixed(1); return (diff > 0 ? '+' : '') + diff + '%'; })()"></span>
                      </div>
                      <div class="w-full bg-hq-surface rounded-full h-2">
                        <div class="h-2 rounded-full transition-all"
                             :class="trading.watchPrices[w.ticker].current_price >= w.target_price ? 'bg-hq-green' : 'bg-hq-cyan'"
                             :style="'width:' + Math.min(100, Math.max(5, (trading.watchPrices[w.ticker].current_price / w.target_price * 100))) + '%'"></div>
                      </div>
                      <div class="flex justify-between text-xs text-hq-muted mt-1">
                        <span x-text="(trading.watchPrices[w.ticker].current_price||0).toLocaleString()"></span>
                        <span class="font-semibold" x-text="'Î™©Ìëú ' + (w.target_price||0).toLocaleString() + ((w.market||'KR')==='US' ? '$' : 'Ïõê')"></span>
                      </div>
                    </div>
                  </template>
                  <!-- Î™©ÌëúÍ∞ÄÎßå ÏûàÍ≥† ÌòÑÏû¨Í∞Ä ÏóÜÏùÑ Îïå -->
                  <template x-if="w.target_price && (!trading.watchPrices[w.ticker] || trading.watchPrices[w.ticker].error)">
                    <div class="text-[10px] text-hq-cyan mb-1">
                      <span x-text="(w.alert_type === 'above' ? '‚Üë ' : '‚Üì ') + 'Î™©Ìëú: ' + (w.target_price||0).toLocaleString() + ((w.market||'KR')==='US' ? '$' : 'Ïõê')"></span>
                    </div>
                  </template>

                  <div x-show="w.notes" class="text-[10px] text-hq-muted/80 truncate mb-1" x-text="w.notes"></div>
                  <div class="flex gap-2 mt-2">
                    <button @click="trading.orderForm = {action:'buy', ticker:w.ticker, name:w.name, qty:0, price:(trading.watchPrices[w.ticker]||{}).current_price||0, market:w.market||'KR'}; trading.showOrderModal = true;"
                            class="flex-1 bg-hq-green/10 text-hq-green hover:bg-hq-green/20 rounded-lg py-1 text-[10px] font-bold transition">Îß§Ïàò</button>
                    <button @click="trading.orderForm = {action:'sell', ticker:w.ticker, name:w.name, qty:0, price:(trading.watchPrices[w.ticker]||{}).current_price||0, market:w.market||'KR'}; trading.showOrderModal = true;"
                            class="flex-1 bg-hq-red/10 text-hq-red hover:bg-hq-red/20 rounded-lg py-1 text-[10px] font-bold transition">Îß§ÎèÑ</button>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- ‚ñ∏ ÏÑúÎ∏åÌÉ≠ 5: Í±∞ÎûòÎÇ¥Ïó≠ -->
          <div x-show="trading.tab === 'history' && !trading.loading">
            <h3 class="text-sm font-bold text-hq-text mb-4">Í±∞Îûò ÎÇ¥Ïó≠</h3>
            <template x-if="trading.history.length === 0">
              <div class="glass border border-hq-border rounded-xl p-8 text-center text-hq-muted/70 text-xs">Í±∞Îûò ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</div>
            </template>
            <template x-if="trading.history.length > 0">
              <div class="glass border border-hq-border rounded-xl overflow-hidden">
                <table class="w-full text-xs">
                  <thead>
                    <tr class="text-hq-muted text-[10px] uppercase tracking-wider border-b border-hq-border bg-hq-surface">
                      <th class="py-2 px-3 text-left">ÏãúÍ∞Ñ</th>
                      <th class="py-2 px-3 text-left">Íµ¨Î∂Ñ</th>
                      <th class="py-2 px-3 text-left">Ï¢ÖÎ™©</th>
                      <th class="py-2 px-3 text-right">ÏàòÎüâ</th>
                      <th class="py-2 px-3 text-right">Îã®Í∞Ä</th>
                      <th class="py-2 px-3 text-right">Í∏àÏï°</th>
                      <th class="py-2 px-3 text-right">ÏÜêÏùµ</th>
                      <th class="py-2 px-3 text-left">Ï†ÑÎûµ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <template x-for="t in trading.history.slice(0, 50)" :key="t.id">
                      <tr class="border-b border-hq-border/30 hover:bg-hq-surface/50">
                        <td class="py-2 px-3 text-hq-muted font-mono text-[10px]" x-text="(t.date||'').substring(5, 16)"></td>
                        <td class="py-2 px-3">
                          <span class="text-[10px] font-bold px-1.5 py-0.5 rounded" :class="t.action === 'buy' ? 'bg-hq-green/10 text-hq-green' : 'bg-hq-red/10 text-hq-red'"
                                x-text="t.action === 'buy' ? 'Îß§Ïàò' : 'Îß§ÎèÑ'"></span>
                        </td>
                        <td class="py-2 px-3 font-bold text-hq-text" x-text="t.name"></td>
                        <td class="py-2 px-3 text-right text-hq-text" x-text="t.qty"></td>
                        <td class="py-2 px-3 text-right text-hq-text" x-text="(t.price||0).toLocaleString()"></td>
                        <td class="py-2 px-3 text-right text-hq-text" x-text="(t.total||0).toLocaleString()"></td>
                        <td class="py-2 px-3 text-right" :class="tradingPnlColor(t.pnl||0)" x-text="t.pnl ? ((t.pnl > 0 ? '+' : '') + (t.pnl).toLocaleString()) : '-'"></td>
                        <td class="py-2 px-3 text-hq-muted" x-text="t.strategy || '-'"></td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </template>
          </div>

          <!-- ‚ñ∏ ÏÑúÎ∏åÌÉ≠ 6: ÏãúÍ∑∏ÎÑê (CIO Î∂ÑÏÑù) -->
          <div x-show="trading.tab === 'signals' && !trading.loading">
            <div x-effect="if(trading.tab === 'signals') {
              fetch('/api/trading/decisions').then(r=>r.ok?r.json():{decisions:[]}).then(d=>{ trading.decisions = d.decisions||[]; }).catch(()=>{});
            }"></div>
            <!-- ÏûëÏ†ÑÏùºÏßÄ (Î∂ÑÏÑùÎ≥Ñ Í∑∏Î£πÌïë) -->
            <div class="flex items-center justify-between mb-3">
              <div>
                <h3 class="text-sm font-bold text-hq-text">ÏûëÏ†ÑÏùºÏßÄ</h3>
                <p class="text-[10px] text-hq-muted mt-0.5">Ìà¨ÏûêÌåÄÏû•Ïùò Îß§Îß§ Í≤∞Ï†ï Í∏∞Î°ù (Î∂ÑÏÑùÎ≥Ñ Í∑∏Î£π)</p>
              </div>
              <button x-show="trading.decisions.length > 0"
                      @click="showConfirm({ title: 'ÏûëÏ†ÑÏùºÏßÄ ÏÇ≠Ï†ú', message: 'ÏûëÏ†ÑÏùºÏßÄÎ•º Ï†ÑÏ≤¥ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?', confirmText: 'Ï†ÑÏ≤¥ ÏÇ≠Ï†ú', onConfirm: () => { fetch('/api/trading/decisions',{method:'DELETE'}).then(r=>r.json()).then(d=>{if(d.success){trading.decisions=[];$dispatch('notify',{message:'ÏûëÏ†ÑÏùºÏßÄ Ï†ÑÏ≤¥ ÏÇ≠Ï†úÎê®',type:'success'})}}) } })"
                      class="text-[10px] text-hq-muted/50 hover:text-hq-red transition-colors px-2 py-1 rounded hover:bg-hq-red/10">
                Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
              </button>
            </div>

            <div x-data="{
              expandedGroup: null,
              get grouped() {
                const groups = {};
                (trading.decisions||[]).forEach(d => {
                  const key = (d.created_at||'').slice(0,16);
                  if (!groups[key]) groups[key] = { time: key, items: [] };
                  groups[key].items.push(d);
                });
                return Object.values(groups).sort((a,b) => b.time.localeCompare(a.time));
              },
              async deleteDecision(id) {
                const r = await fetch('/api/trading/decisions/'+id, {method:'DELETE'});
                const d = await r.json();
                if(d.success) {
                  trading.decisions = trading.decisions.filter(x => x.id !== id);
                  $dispatch('notify',{message:'ÏÇ≠Ï†úÎê®',type:'success'});
                }
              }
            }">
              <div x-show="trading.decisions.length === 0" class="text-xs text-hq-muted/60 text-center py-4">
                ÏïÑÏßÅ Îß§Îß§ Í≤∞Ï†ï Ïù¥Î†•Ïù¥ ÏóÜÏäµÎãàÎã§
              </div>
              <template x-for="(g, gi) in grouped" :key="g.time">
                <div class="glass border border-hq-border rounded-xl mb-2 overflow-hidden">
                  <!-- Í∑∏Î£π Ìó§Îçî (Î∂ÑÏÑù ÏÑ∏ÏÖò Îã®ÏúÑ) -->
                  <div @click="expandedGroup = expandedGroup === g.time ? null : g.time"
                       class="flex items-center gap-3 p-2.5 cursor-pointer hover:bg-hq-surface/50">
                    <svg :class="expandedGroup === g.time ? 'rotate-90' : ''" class="w-3 h-3 transition-transform text-hq-muted flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    <span class="text-[10px] text-hq-muted font-mono" x-text="g.time.replace('T',' ')"></span>
                    <span class="text-xs text-hq-text font-medium" x-text="'Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• Î∂ÑÏÑù (' + g.items.length + 'Ï¢ÖÎ™©)'"></span>
                    <div class="flex-1 flex items-center justify-end gap-1.5">
                      <template x-for="d in g.items.slice(0,5)" :key="d.id">
                        <span class="text-[10px] px-1.5 py-0.5 rounded-full border"
                              :class="d.action==='Îß§Ïàò'?'border-hq-green/30 bg-hq-green/10 text-hq-green':d.action==='Îß§ÎèÑ'?'border-hq-red/30 bg-hq-red/10 text-hq-red':'border-hq-muted/30 text-hq-muted'"
                              x-text="(d.ticker_name||d.ticker).slice(0,4)"></span>
                      </template>
                    </div>
                  </div>
                  <!-- Í∑∏Î£π ÎÇ¥Ïö© (ÌéºÏ≥§ÏùÑ Îïå) -->
                  <div x-show="expandedGroup === g.time" class="border-t border-hq-border">
                    <template x-for="d in g.items" :key="d.id">
                      <div class="border-b border-hq-border/50 last:border-b-0 p-2.5 group">
                        <div class="flex items-center gap-2 mb-1">
                          <span :class="d.action==='Îß§Ïàò'?'text-hq-green':d.action==='Îß§ÎèÑ'?'text-hq-red':'text-hq-muted'"
                                class="text-[10px] font-bold w-6" x-text="d.action"></span>
                          <span class="text-xs font-medium text-hq-text" x-text="d.ticker_name||d.ticker"></span>
                          <span class="text-[10px] font-mono text-hq-muted" x-text="'(' + d.ticker + ')'"></span>
                          <span class="ml-auto text-[10px] font-mono text-hq-accent" x-text="'Ïã†Î¢∞ÎèÑ ' + (d.confidence||0) + '%'"></span>
                          <button @click.stop="deleteDecision(d.id)"
                                  class="opacity-0 group-hover:opacity-100 text-hq-muted/40 hover:text-hq-red transition-all ml-1 p-0.5"
                                  title="ÏÇ≠Ï†ú">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                          </button>
                        </div>
                        <div x-show="d.reason" class="text-[11px] text-hq-muted/80 leading-relaxed line-clamp-2 pl-8" x-text="d.reason"></div>
                      </div>
                    </template>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- ‚ñ∏ ÏÑúÎ∏åÌÉ≠: ÏûëÏ†ÑÍ≥ÑÌöç -->
          <div x-show="trading.tab === 'plan' && !trading.loading"
               x-data="{
                 plan: null, triggers: [], planLoading: false, expandedTicker: null,
                 async load() {
                   this.planLoading = true;
                   try {
                     const [pr, tr] = await Promise.all([
                       fetch('/api/trading/plan').then(r=>r.json()),
                       fetch('/api/trading/triggers').then(r=>r.ok?r.json():{triggers:[]}).catch(()=>({triggers:[]}))
                     ]);
                     this.plan = pr;
                     this.triggers = (tr.triggers||[]).filter(t => t.type==='buy_limit' && t.active);
                   } finally { this.planLoading = false; }
                 },
                 fmtPrice(p, mkt) {
                   if (!p || p <= 0) return '‚Äî';
                   return mkt==='US' ? '$'+Number(p).toFixed(2) : '‚Ç©'+Number(p).toLocaleString();
                 },
                 actionLabel(a) { return a==='buy'?'Îß§Ïàò':a==='sell'?'Îß§ÎèÑ':a==='hold'?'Í¥ÄÎßù':a; },
                 cardBg(a) {
                   if(a==='buy') return 'from-hq-green/15 to-hq-green/3 border-hq-green/25';
                   if(a==='sell') return 'from-hq-red/15 to-hq-red/3 border-hq-red/25';
                   return 'from-hq-surface/80 to-hq-surface/40 border-hq-border';
                 },
                 actionBadge(a) {
                   if(a==='buy') return 'bg-hq-green/20 text-hq-green';
                   if(a==='sell') return 'bg-hq-red/20 text-hq-red';
                   return 'bg-hq-surface text-hq-muted';
                 },
                 confColor(c) { return c>=70?'text-hq-green':c>=55?'text-hq-accent':'text-hq-muted'; },
                 confBar(c) { return c>=70?'bg-hq-green':c>=55?'bg-hq-accent':'bg-hq-muted/50'; },
                 priceColor(a) { return a==='buy'?'text-hq-green':a==='sell'?'text-hq-red':'text-hq-accent'; },
                 hasTrigger(tk) { return this.triggers.some(t=>t.ticker===tk); }
               }">
            <div x-effect="if(trading.tab==='plan') load()"></div>

            <!-- Ìó§Îçî -->
            <div class="flex items-center justify-between mb-4">
              <div>
                <div class="flex items-center gap-2">
                  <h3 class="text-sm font-bold text-hq-text">Í∏àÏúµÌåÄÏû• ÏûëÏ†ÑÍ≥ÑÌöç</h3>
                  <span x-show="plan && plan.qa_passed" class="text-[9px] px-1.5 py-0.5 rounded-full bg-hq-green/15 border border-hq-green/25 text-hq-green font-bold">QA ‚úì</span>
                </div>
                <p class="text-[10px] text-hq-muted mt-0.5" x-show="plan && plan.date"
                   x-text="(plan?.analyzed_by||'Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû•') + ' ¬∑ ' + (plan?.date||'').slice(0,16).replace('T',' ')"></p>
              </div>
              <button @click="load()" class="flex items-center gap-1.5 text-[10px] text-hq-muted hover:text-hq-accent px-2.5 py-1.5 rounded-lg border border-hq-border hover:border-hq-accent/30 transition-all">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                ÏÉàÎ°úÍ≥†Ïπ®
              </button>
            </div>

            <!-- Î°úÎî© -->
            <div x-show="planLoading" class="flex flex-col items-center justify-center py-16 gap-3">
              <div class="w-7 h-7 border-2 border-hq-accent/30 border-t-hq-accent rounded-full animate-spin"></div>
              <p class="text-xs text-hq-muted">ÏûëÏ†Ñ Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
            </div>

            <!-- ÎπÑÏñ¥ÏûàÏùå -->
            <div x-show="!planLoading && (!plan || !plan.signals || plan.signals.length===0)"
                 class="glass border border-hq-border rounded-2xl p-10 text-center">
              <div class="text-4xl mb-3">üìã</div>
              <p class="text-sm font-bold text-hq-text mb-1">ÏïÑÏßÅ ÏûëÏ†ÑÍ≥ÑÌöçÏù¥ ÏóÜÏäµÎãàÎã§</p>
              <p class="text-xs text-hq-muted/70 leading-relaxed">Í¥ÄÏã¨Ï¢ÖÎ™© ÌÉ≠ÏóêÏÑú Ï¶âÏãúÎ∂ÑÏÑùÏùÑ Ïã§ÌñâÌïòÍ±∞ÎÇò<br>ÏûêÎèô Î∂ÑÏÑù(09:10 KST)ÏùÑ Í∏∞Îã§Î¶¨ÏÑ∏Ïöî.</p>
            </div>

            <div x-show="!planLoading && plan && plan.signals && plan.signals.length > 0">
              <!-- ÏöîÏïΩ Ïä§ÌÉØ -->
              <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-5">
                <div class="glass border border-hq-green/25 rounded-xl p-3 text-center">
                  <div class="text-2xl font-black text-hq-green" x-text="plan.signals.filter(s=>s.action==='buy').length"></div>
                  <div class="text-[10px] text-hq-muted mt-0.5">Îß§Ïàò</div>
                </div>
                <div class="glass border border-hq-red/25 rounded-xl p-3 text-center">
                  <div class="text-2xl font-black text-hq-red" x-text="plan.signals.filter(s=>s.action==='sell').length"></div>
                  <div class="text-[10px] text-hq-muted mt-0.5">Îß§ÎèÑ</div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-3 text-center">
                  <div class="text-2xl font-black text-hq-muted" x-text="plan.signals.filter(s=>s.action==='hold').length"></div>
                  <div class="text-[10px] text-hq-muted mt-0.5">Í¥ÄÎßù</div>
                </div>
                <div class="glass border border-hq-accent/25 rounded-xl p-3 text-center">
                  <div class="text-2xl font-black text-hq-accent" x-text="triggers.length"></div>
                  <div class="text-[10px] text-hq-muted mt-0.5">üéØ ÎåÄÍ∏∞</div>
                </div>
              </div>

              <!-- Ï¢ÖÎ™© Ïπ¥Îìú Í∑∏Î¶¨Îìú -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-5">
                <template x-for="sig in plan.signals" :key="sig.ticker">
                  <div class="rounded-2xl border bg-gradient-to-br p-4 transition-all duration-150 hover:scale-[1.015] hover:shadow-xl cursor-pointer select-none"
                       :class="cardBg(sig.action)"
                       @click="expandedTicker = expandedTicker===sig.ticker ? null : sig.ticker">

                    <!-- ÏÉÅÎã®: Ïï°ÏÖò + ÏãúÏû• + Ïã†Î¢∞ÎèÑ -->
                    <div class="flex items-center justify-between mb-3">
                      <div class="flex items-center gap-1.5">
                        <span class="text-xs font-black px-2.5 py-1 rounded-xl" :class="actionBadge(sig.action)"
                              x-text="actionLabel(sig.action)"></span>
                        <span class="text-[9px] font-bold px-1.5 py-0.5 rounded-lg"
                              :class="sig.market==='US' ? 'bg-blue-500/20 text-blue-400' : 'bg-rose-500/20 text-rose-400'"
                              x-text="sig.market==='US' ? 'üá∫üá∏' : 'üá∞üá∑'"></span>
                      </div>
                      <div class="text-right">
                        <div class="text-2xl font-black leading-none" :class="confColor(sig.confidence||0)"
                             x-text="(sig.confidence||0)+'%'"></div>
                        <div class="text-[9px] text-hq-muted">Ïã†Î¢∞ÎèÑ</div>
                      </div>
                    </div>

                    <!-- Ï¢ÖÎ™©Î™Ö -->
                    <div class="mb-2">
                      <div class="text-base font-bold text-hq-text" x-text="sig.name||sig.ticker"></div>
                      <div class="text-[10px] font-mono text-hq-muted" x-text="sig.ticker"></div>
                    </div>

                    <!-- Ïã†Î¢∞ÎèÑ Î∞î -->
                    <div class="w-full h-1 bg-white/10 rounded-full mb-3">
                      <div class="h-1 rounded-full transition-all duration-500" :class="confBar(sig.confidence||0)"
                           :style="'width:'+Math.min(100,sig.confidence||0)+'%'"></div>
                    </div>

                    <!-- Î™©ÌëúÍ∞Ä + ÎπÑÏ§ë + Ìä∏Î¶¨Í±∞ -->
                    <div class="flex items-end justify-between">
                      <div x-show="sig.target_price > 0">
                        <div class="text-[9px] text-hq-muted mb-0.5">Î™©Ìëú ÏßÑÏûÖÍ∞Ä</div>
                        <div class="text-lg font-black font-mono" :class="priceColor(sig.action)"
                             x-text="fmtPrice(sig.target_price, sig.market)"></div>
                      </div>
                      <div class="flex flex-col items-end gap-1">
                        <span x-show="sig.weight > 0" class="text-[10px] text-hq-muted">
                          ÎπÑÏ§ë <span class="font-bold text-hq-text" x-text="(sig.weight||0)+'%'"></span>
                        </span>
                        <span x-show="hasTrigger(sig.ticker)"
                              class="text-[9px] font-bold px-2 py-0.5 rounded-lg bg-hq-accent/15 border border-hq-accent/30 text-hq-accent">üéØ ÎåÄÍ∏∞ Ï§ë</span>
                      </div>
                    </div>

                    <!-- Ïù¥Ïú† (ÌÅ¥Î¶≠ Ïãú ÌéºÏπòÍ∏∞) -->
                    <div x-show="sig.reason" class="mt-3 pt-2.5 border-t border-white/10">
                      <div class="text-[11px] text-hq-muted/80 leading-relaxed"
                           :class="expandedTicker===sig.ticker ? '' : 'line-clamp-2'"
                           x-text="sig.reason"></div>
                      <div x-show="(sig.reason||'').length > 60"
                           class="text-[9px] text-hq-muted/40 mt-1.5"
                           x-text="expandedTicker===sig.ticker ? '‚ñ≤ Ï†ëÍ∏∞' : '‚ñº Îçî Î≥¥Í∏∞'"></div>
                    </div>
                  </div>
                </template>
              </div>

              <!-- Î™©ÌëúÎß§Ïàò ÎåÄÍ∏∞ ÏÑπÏÖò -->
              <div x-show="triggers.length > 0" class="glass border border-hq-accent/25 rounded-2xl p-4">
                <div class="flex items-center gap-2 mb-3">
                  <h4 class="text-xs font-bold text-hq-text">üéØ Î™©ÌëúÎß§Ïàò ÎåÄÍ∏∞ Ï§ë</h4>
                  <span class="text-[9px] px-1.5 py-0.5 rounded-full bg-hq-accent/15 text-hq-accent font-bold" x-text="triggers.length+'Í∞ú'"></span>
                  <span class="ml-auto text-[9px] text-hq-muted/50">Í∞ÄÍ≤© ÎèÑÎã¨ Ïãú ÏÑúÎ≤Ñ ÏûêÎèô Îß§Ïàò</span>
                </div>
                <div class="space-y-1.5">
                  <template x-for="t in triggers" :key="t.id">
                    <div class="flex items-center gap-3 p-2.5 rounded-xl bg-hq-accent/8 border border-hq-accent/15">
                      <div class="w-2 h-2 rounded-full bg-hq-accent animate-pulse flex-shrink-0"></div>
                      <span class="text-xs font-bold text-hq-text" x-text="t.name||t.ticker"></span>
                      <span class="text-[10px] font-mono text-hq-muted" x-text="t.ticker"></span>
                      <div class="ml-auto text-right">
                        <div class="text-sm font-black text-hq-accent font-mono"
                             x-text="t.market==='US' ? '$'+Number(t.trigger_price).toFixed(2) : '‚Ç©'+Number(t.trigger_price).toLocaleString()"></div>
                        <div class="text-[9px] text-hq-muted" x-text="(t.qty||1)+'Ï£º ÏòàÏ†ï'"></div>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </div>

          <!-- ‚ñ∏ ÏÑúÎ∏åÌÉ≠: CIO ÏÑ±Í≥º -->
          <div x-show="trading.tab === 'performance' && !trading.loading"
               x-data="{
                 perfData: null,
                 predictions: [],
                 loading: false,
                 async load() {
                   this.loading = true;
                   try {
                     const [p, s] = await Promise.all([
                       fetch('/api/cio/predictions?limit=20').then(r=>r.json()),
                       fetch('/api/cio/performance-summary').then(r=>r.json())
                     ]);
                     this.predictions = p.predictions || [];
                     this.perfData = s;
                   } catch(e) { console.error(e); }
                   this.loading = false;
                 }
               }"
               x-init="load()">

            <!-- ÏÑ±Í≥º ÏöîÏïΩ Ïπ¥Îìú (1Ìñâ: Ï¥ùÏòàÏ∏°/Í≤ÄÏ¶ù/Ï†ÑÏ≤¥ ÏäπÎ•† / 2Ìñâ: ÏµúÍ∑º20/Îß§Ïàò/Îß§ÎèÑ ÏäπÎ•†) -->
            <div class="grid grid-cols-3 gap-3 mb-4">
              <div class="glass border border-hq-border rounded-xl p-4 text-center">
                <p class="text-[10px] text-hq-muted mb-1">Ï†ÑÏ≤¥ ÏòàÏ∏°</p>
                <p class="text-2xl font-bold text-hq-text" x-text="perfData ? (perfData.total || 0) : '-'"></p>
              </div>
              <div class="glass border border-hq-border rounded-xl p-4 text-center">
                <p class="text-[10px] text-hq-muted mb-1">Í≤ÄÏ¶ù ÏôÑÎ£å</p>
                <p class="text-2xl font-bold text-hq-text" x-text="perfData ? (perfData.verified || 0) : '-'"></p>
              </div>
              <div class="glass border border-hq-green/30 rounded-xl p-4 text-center">
                <p class="text-[10px] text-hq-muted mb-1">Ï†ÑÏ≤¥ ÏäπÎ•†</p>
                <p class="text-2xl font-bold text-hq-green" x-text="perfData && perfData.overall_accuracy !== null ? perfData.overall_accuracy + '%' : '-'"></p>
              </div>
            </div>
            <div class="grid grid-cols-3 gap-3 mb-6">
              <div class="glass border border-hq-cyan/30 rounded-xl p-4 text-center">
                <p class="text-[10px] text-hq-muted mb-1">ÏµúÍ∑º 20Í±¥</p>
                <p class="text-2xl font-bold text-hq-cyan" x-text="perfData && perfData.recent_20_accuracy !== null ? perfData.recent_20_accuracy + '%' : '-'"></p>
                <p class="text-[9px] text-hq-muted mt-0.5" x-text="perfData ? (perfData.recent_correct || 0) + '/' + (perfData.recent_total || 0) : ''"></p>
              </div>
              <div class="glass border border-hq-red/30 rounded-xl p-4 text-center">
                <p class="text-[10px] text-hq-muted mb-1">Îß§Ïàò ÏäπÎ•†</p>
                <p class="text-2xl font-bold text-hq-red" x-text="perfData && perfData.buy_accuracy !== null ? perfData.buy_accuracy + '%' : '-'"></p>
              </div>
              <div class="glass border border-blue-500/30 rounded-xl p-4 text-center">
                <p class="text-[10px] text-hq-muted mb-1">Îß§ÎèÑ ÏäπÎ•†</p>
                <p class="text-2xl font-bold text-blue-400" x-text="perfData && perfData.sell_accuracy !== null ? perfData.sell_accuracy + '%' : '-'"></p>
              </div>
            </div>

            <!-- ÏòàÏ∏° ÌûàÏä§ÌÜ†Î¶¨ ÌÖåÏù¥Î∏î -->
            <div class="glass border border-hq-border rounded-xl overflow-hidden">
              <div class="px-4 py-3 border-b border-hq-border flex items-center justify-between">
                <h3 class="text-sm font-bold text-hq-text">ÏòàÏ∏° ÌûàÏä§ÌÜ†Î¶¨</h3>
                <button @click="load()" class="text-xs text-hq-accent hover:text-hq-text transition">ÏÉàÎ°úÍ≥†Ïπ®</button>
              </div>

              <div x-show="loading" class="text-center py-8 text-hq-muted text-sm">Î°úÎî© Ï§ë...</div>
              <div x-show="!loading && predictions.length === 0" class="text-center py-8 text-hq-muted text-sm">
                ÏïÑÏßÅ ÏòàÏ∏° Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå<br>
                <span class="text-xs">Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû•Ïù¥ Î∂ÑÏÑùÏùÑ Ïã§ÌñâÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Í∏∞Î°ùÎê©ÎãàÎã§</span>
              </div>

              <div x-show="!loading && predictions.length > 0" class="overflow-x-auto">
                <table class="w-full text-xs">
                  <thead>
                    <tr class="border-b border-hq-border">
                      <th class="text-left px-4 py-2 text-hq-muted font-medium">ÎÇ†Ïßú</th>
                      <th class="text-left px-4 py-2 text-hq-muted font-medium">Ï¢ÖÎ™©</th>
                      <th class="text-left px-4 py-2 text-hq-muted font-medium">ÏòàÏ∏°</th>
                      <th class="text-right px-4 py-2 text-hq-muted font-medium">ÏòàÏ∏°Í∞Ä</th>
                      <th class="text-center px-4 py-2 text-hq-muted font-medium">3Ïùº</th>
                      <th class="text-center px-4 py-2 text-hq-muted font-medium">7Ïùº</th>
                      <th class="text-left px-4 py-2 text-hq-muted font-medium">Ïã†Î¢∞ÎèÑ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <template x-for="pred in predictions" :key="pred.id">
                      <tr class="border-b border-hq-border/30 hover:bg-hq-surface/50">
                        <td class="px-4 py-2 text-hq-muted font-mono" x-text="pred.analyzed_at ? pred.analyzed_at.slice(0,10) : '-'"></td>
                        <td class="px-4 py-2 font-bold text-hq-text" x-text="(pred.ticker_name || pred.ticker || '-')"></td>
                        <td class="px-4 py-2">
                          <span class="px-2 py-0.5 rounded font-bold"
                                :class="['BUY','UP'].includes(pred.direction) ? 'bg-hq-green/20 text-hq-green' : 'bg-hq-red/20 text-hq-red'"
                                x-text="['BUY','UP'].includes(pred.direction) ? 'Îß§Ïàò' : 'Îß§ÎèÑ'"></span>
                        </td>
                        <td class="px-4 py-2 text-right font-mono text-hq-text" x-text="pred.predicted_price ? pred.predicted_price.toLocaleString() + 'Ïõê' : '-'"></td>
                        <td class="px-4 py-2 text-center">
                          <span x-show="pred.correct_3d !== null"
                                :class="pred.correct_3d ? 'text-hq-green' : 'text-hq-red'"
                                x-text="pred.correct_3d ? '‚úì' : '‚úó'"></span>
                          <span x-show="pred.correct_3d === null" class="text-hq-muted">ÎåÄÍ∏∞</span>
                        </td>
                        <td class="px-4 py-2 text-center">
                          <span x-show="pred.correct_7d !== null"
                                :class="pred.correct_7d ? 'text-hq-green' : 'text-hq-red'"
                                x-text="pred.correct_7d ? '‚úì' : '‚úó'"></span>
                          <span x-show="pred.correct_7d === null" class="text-hq-muted">ÎåÄÍ∏∞</span>
                        </td>
                        <td class="px-4 py-2">
                          <div class="flex items-center gap-2">
                            <div class="flex-1 h-1.5 bg-hq-surface rounded-full overflow-hidden">
                              <div class="h-full bg-hq-accent rounded-full" :style="`width: ${pred.confidence || 0}%`"></div>
                            </div>
                            <span class="text-hq-muted font-mono" x-text="(pred.confidence || 0) + '%'"></span>
                          </div>
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- ‚ïê‚ïê‚ïê SHADOW TRADING: Ïã§Í±∞Îûò/Î™®Ïùò ÎπÑÍµê ÌÉ≠ ‚ïê‚ïê‚ïê -->
          <div x-show="trading.tab === 'shadow' && !trading.loading" x-data="{
            shadowData: null, shadowLoading: false, shadowError: '',
            usReal: null, usMock: null,
            fxRate: 1450,
            async loadShadow() {
              this.shadowLoading = true; this.shadowError = '';
              try {
                const [sR, usRealR, usMockR] = await Promise.allSettled([
                  fetch('/api/trading/shadow/compare').then(r=>r.json()),
                  fetch('/api/trading/overseas/balance').then(r=>r.json()),
                  fetch('/api/trading/overseas/mock-balance').then(r=>r.json())
                ]);
                this.shadowData = sR.status==='fulfilled' ? sR.value : null;
                this.usReal = usRealR.status==='fulfilled' ? usRealR.value : null;
                this.usMock = usMockR.status==='fulfilled' ? usMockR.value : null;
              } catch(e) { this.shadowError = 'Ï°∞Ìöå Ïã§Ìå®: ' + e.message; }
              this.shadowLoading = false;
            },
            fmtKRW(v) { return '‚Ç©' + Math.round(v||0).toLocaleString(); },
            fmtUSD(v) { return '$' + (v||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}); }
          }">
            <div x-effect="if(trading.tab === 'shadow') loadShadow()"></div>

            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="text-sm font-bold text-hq-text">Ïã§Í±∞Îûò / Î™®ÏùòÌà¨Ïûê ÎπÑÍµê</h3>
                  <p class="text-xs text-hq-muted mt-0.5">ÌïúÍµ≠Ïû•+ÎØ∏Íµ≠Ïû• ÌÜµÌï© ÎπÑÍµê ¬∑ KRW/USD Ïù¥Ï§ëÌëúÍ∏∞</p>
                </div>
                <button @click="loadShadow()" class="bg-hq-surface border border-hq-border hover:border-hq-accent/30 rounded-lg px-3 py-1.5 text-xs text-hq-muted transition">ÏÉàÎ°úÍ≥†Ïπ®</button>
              </div>

              <div x-show="shadowLoading" class="flex items-center justify-center py-12">
                <div class="w-6 h-6 border-2 border-hq-accent border-t-transparent rounded-full animate-spin mr-3"></div>
                <span class="text-sm text-hq-muted">ÎπÑÍµê Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Ï§ë...</span>
              </div>

              <div x-show="!shadowLoading && shadowError" class="bg-hq-red/10 border border-hq-red/20 rounded-lg p-3 text-xs text-hq-red" x-text="shadowError"></div>

              <div x-show="!shadowLoading && !shadowError && shadowData && !(shadowData.mock||{}).available && !(shadowData.mock||{}).holdings" class="bg-hq-yellow/10 border border-hq-yellow/20 rounded-lg p-4">
                <p class="text-xs font-bold text-hq-yellow mb-1">Î™®ÏùòÌà¨Ïûê ÏÑ§Ï†ï ÌïÑÏöî</p>
                <p class="text-xs text-hq-muted">KIS Ìè¨ÌÑ∏ÏóêÏÑú Î™®ÏùòÌà¨Ïûê App KeyÎ•º Ïã†Ï≤≠ÌïòÍ≥† GitHub SecretsÏóê Îì±Î°ùÌïòÎ©¥ ÎπÑÍµêÍ∞Ä ÏãúÏûëÎê©ÎãàÎã§.</p>
              </div>

              <div x-show="!shadowLoading && !shadowError && shadowData" class="space-y-4">

                <!-- Ïã§Í±∞Îûò: ÌïúÍµ≠ | ÎØ∏Íµ≠ -->
                <div class="text-[10px] text-hq-muted font-bold uppercase tracking-wider mb-1">Ïã§Í±∞Îûò</div>
                <div class="grid grid-cols-2 gap-3">
                  <div class="bg-hq-panel border border-hq-green/30 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                      <div class="w-2 h-2 rounded-full bg-hq-green"></div>
                      <span class="text-xs font-bold text-hq-green">üá∞üá∑ ÌïúÍµ≠</span>
                    </div>
                    <div class="text-lg font-bold text-hq-text font-mono" x-text="(shadowData&&(shadowData.real||{}).success) ? fmtKRW(shadowData.real.total_eval||0) : '‚Äî'"></div>
                    <div class="text-[10px] text-hq-muted mt-1" x-text="(shadowData&&(shadowData.real||{}).success) ? 'ÌòÑÍ∏à '+fmtKRW(shadowData.real.cash||0)+' ¬∑ '+((shadowData.real.holdings||[]).length)+'Ï¢ÖÎ™©' : 'KIS ÎØ∏Ïó∞Í≤∞'"></div>
                  </div>
                  <div class="bg-hq-panel border border-hq-green/30 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                      <div class="w-2 h-2 rounded-full bg-hq-green"></div>
                      <span class="text-xs font-bold text-hq-green">üá∫üá∏ ÎØ∏Íµ≠</span>
                    </div>
                    <div class="text-lg font-bold text-hq-text font-mono" x-text="(usReal&&usReal.success) ? fmtUSD(usReal.total_eval_usd||0) : '‚Äî'"></div>
                    <div class="text-[10px] text-hq-muted mt-0.5 font-mono" x-text="(usReal&&usReal.success&&(usReal.total_eval_usd||0)>0) ? '‚âà '+fmtKRW((usReal.total_eval_usd||0)*fxRate) : ''"></div>
                    <div class="text-[10px] text-hq-muted mt-1" x-text="(usReal&&usReal.success) ? 'ÌòÑÍ∏à '+fmtUSD(usReal.cash_usd||0)+' ¬∑ '+((usReal.holdings||[]).length)+'Ï¢ÖÎ™©' : 'Ìï¥Ïô∏ ÎØ∏Ïó∞Í≤∞'"></div>
                  </div>
                </div>

                <!-- Î™®ÏùòÌà¨Ïûê: ÌïúÍµ≠ | ÎØ∏Íµ≠ -->
                <div class="text-[10px] text-hq-muted font-bold uppercase tracking-wider mt-4 mb-1">Î™®ÏùòÌà¨Ïûê</div>
                <div class="grid grid-cols-2 gap-3">
                  <div class="bg-hq-panel border border-hq-purple/30 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                      <div class="w-2 h-2 rounded-full bg-hq-purple"></div>
                      <span class="text-xs font-bold text-hq-purple">üá∞üá∑ ÌïúÍµ≠</span>
                    </div>
                    <div class="text-lg font-bold text-hq-text font-mono" x-text="(shadowData&&((shadowData.mock||{}).available||(shadowData.mock||{}).success)) ? fmtKRW(shadowData.mock.total_eval||0) : '‚Äî'"></div>
                    <div class="text-[10px] text-hq-muted mt-1" x-text="(shadowData&&((shadowData.mock||{}).available||(shadowData.mock||{}).success)) ? 'ÌòÑÍ∏à '+fmtKRW(shadowData.mock.cash||0)+' ¬∑ '+((shadowData.mock.holdings||[]).length)+'Ï¢ÖÎ™©' : 'Î™®Ïùò ÎØ∏Ïó∞Í≤∞'"></div>
                  </div>
                  <div class="bg-hq-panel border border-hq-purple/30 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                      <div class="w-2 h-2 rounded-full bg-hq-purple"></div>
                      <span class="text-xs font-bold text-hq-purple">üá∫üá∏ ÎØ∏Íµ≠</span>
                    </div>
                    <div class="text-lg font-bold text-hq-text font-mono" x-text="(usMock&&usMock.success) ? fmtUSD(usMock.total_eval_usd||0) : '‚Äî'"></div>
                    <div class="text-[10px] text-hq-muted mt-0.5 font-mono" x-text="(usMock&&usMock.success&&(usMock.total_eval_usd||0)>0) ? '‚âà '+fmtKRW((usMock.total_eval_usd||0)*fxRate) : ''"></div>
                    <div class="text-[10px] text-hq-muted mt-1" x-text="(usMock&&usMock.success) ? 'ÌòÑÍ∏à '+fmtUSD(usMock.cash_usd||0)+' ¬∑ '+((usMock.holdings||[]).length)+'Ï¢ÖÎ™©' : 'Ìï¥Ïô∏ Î™®Ïùò ÎØ∏Ïó∞Í≤∞'"></div>
                  </div>
                </div>

                <!-- Ïä¨Î¶¨ÌîºÏßÄ -->
                <div class="bg-hq-surface border border-hq-border rounded-xl p-4">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="text-xs font-bold text-hq-text">Ïä¨Î¶¨ÌîºÏßÄ (Ïã§Í±∞Îûò - Î™®Ïùò ÏàòÏùµÎ•† Ï∞®Ïù¥)</p>
                      <p class="text-[10px] text-hq-muted mt-0.5">ÏùåÏàò=Ïã§Í±∞Îûò ÏÜêÏã§ Îçî ÌÅº ¬∑ ÏñëÏàò=Ïã§Í±∞ÎûòÍ∞Ä Îçî Ï¢ãÏùå</p>
                    </div>
                    <div class="text-base font-bold" :class="(shadowData&&shadowData.slip_rate!=null) ? (shadowData.slip_rate>=0?'text-hq-green':'text-hq-red') : 'text-hq-muted'"
                         x-text="(shadowData&&shadowData.slip_rate!=null) ? (shadowData.slip_rate>=0?'+':'')+shadowData.slip_rate+'%' : 'Ï∏°Ï†ï Ï§ë'"></div>
                  </div>
                </div>

                <!-- Ï†ÑÎûµ Í≤ÄÏ¶ù -->
                <div class="bg-hq-panel border border-hq-accent/20 rounded-xl p-4">
                  <div class="flex items-start gap-3">
                    <div class="w-8 h-8 rounded-full bg-hq-accent/20 flex items-center justify-center flex-shrink-0 mt-0.5">üèÖ</div>
                    <div>
                      <p class="text-xs font-bold text-hq-text">Ï†ÑÎûµ Í≤ÄÏ¶ù ÌùêÎ¶Ñ</p>
                      <p class="text-xs text-hq-muted mt-1 leading-relaxed">
                        Î™®ÏùòÌà¨ÏûêÏóêÏÑú <span class="text-hq-yellow font-semibold">2Ï£º Ïó∞ÏÜç ÏàòÏùµ</span>Ïù¥ ÎÇòÎ©¥ ‚Üí ÌÖîÎ†àÍ∑∏Îû®ÏúºÎ°ú "Ïã§Í±∞Îûò Ï†ÑÌôò Ï∂îÏ≤ú" ÏïåÎ¶º Î∞úÏÜ°.
                      </p>
                      <div class="mt-2 flex gap-2 flex-wrap">
                        <span class="bg-hq-muted/10 text-hq-muted rounded px-2 py-0.5 text-[10px]">1Îã®Í≥Ñ: Î™®ÏùòÌà¨Ïûê</span>
                        <span class="text-hq-muted/40 text-[10px]">‚Üí</span>
                        <span class="bg-hq-yellow/10 text-hq-yellow rounded px-2 py-0.5 text-[10px]">2Îã®Í≥Ñ: 2Ï£º ÏàòÏùµ ÌôïÏù∏</span>
                        <span class="text-hq-muted/40 text-[10px]">‚Üí</span>
                        <span class="bg-hq-green/10 text-hq-green rounded px-2 py-0.5 text-[10px]">3Îã®Í≥Ñ: Ïã§Í±∞Îûò Ï†ÑÌôò</span>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div><!-- /shadow ÌÉ≠ ÎÅù -->

        </div>
      </div></template>

      <!-- E-1: ÌîºÎìúÎ∞± Î™®Îìú ‚Äî ÌîºÍ∑∏ÎßàÍ∏â ÌïÄ ÏãúÏä§ÌÖú -->
      <div class="fixed bottom-20 md:bottom-6 right-6 z-50 flex flex-col items-end gap-2">
        <!-- ÌîºÎìúÎ∞± Î™®Îìú ON Ìå®ÎÑê -->
        <div x-show="feedbackMode" x-transition class="bg-hq-bg/95 backdrop-blur border border-hq-yellow/40 rounded-xl shadow-xl p-3 w-56">
          <div class="text-xs font-bold text-hq-yellow mb-2 flex items-center gap-1.5">
            <span class="w-2 h-2 rounded-full bg-hq-yellow animate-pulse"></span>
            ÌîºÎìúÎ∞± Î™®Îìú ON
          </div>
          <p class="text-[10px] text-hq-muted mb-2">ÌôîÎ©¥ÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÌïÄÏù¥ ÏÉùÏÑ±Îê©ÎãàÎã§</p>
          <div class="text-[10px] text-hq-muted mb-1.5" x-text="'ÌïÄ ' + feedbackPins.length + 'Í∞ú'"></div>
          <!-- ÌïÄ Î™©Î°ù (ÏµúÍ∑º 5Í∞ú) -->
          <div class="max-h-24 overflow-y-auto scrollbar-thin space-y-1 mb-2">
            <template x-for="(pin, idx) in feedbackPins.slice(-5)" :key="idx">
              <div class="flex items-center gap-1 bg-hq-surface rounded px-2 py-1">
                <span class="text-hq-yellow font-bold text-[10px]" x-text="'#' + (idx + 1)"></span>
                <span class="text-[10px] text-hq-text truncate flex-1" x-text="pin.comment"></span>
                <button @click="removeFeedbackPin(idx)" class="text-hq-red/60 hover:text-hq-red text-[10px]">&times;</button>
              </div>
            </template>
          </div>
          <button x-show="feedbackPins.length > 0" @click="clearAllFeedbackPins()"
                  class="w-full text-[10px] py-1 rounded bg-hq-red/10 text-hq-red hover:bg-hq-red/20 transition mb-1">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button>
        </div>
        <button @click="feedbackMode = !feedbackMode; if(feedbackMode) loadFeedbackPins()"
                class="w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-lg transition-all"
                :class="feedbackMode ? 'bg-hq-yellow text-black scale-110 ring-4 ring-hq-yellow/30' : 'bg-hq-panel border border-hq-border text-hq-muted hover:text-hq-yellow hover:border-hq-yellow/30'"
                title="ÌîºÎìúÎ∞± Î™®Îìú">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"/>
          </svg>
        </button>
      </div>
      <!-- E-1: ÌîºÎìúÎ∞± ÌÅ¥Î¶≠ Ï∫°Ï≤ò Ïò§Î≤ÑÎ†àÏù¥ + ÌïÄ ÌëúÏãú -->
      <div x-show="feedbackMode"
           @click="feedbackPlacePin($event)"
           class="fixed inset-0 z-40 cursor-crosshair" style="background: rgba(234, 179, 8, 0.03);">
        <!-- Í∏∞Ï°¥ ÌïÄ ÌëúÏãú -->
        <template x-for="(pin, idx) in feedbackPins" :key="pin.id || idx">
          <div class="absolute z-41" :style="`left:${pin.x - 8}px;top:${pin.y - 8}px`">
            <div class="w-6 h-6 rounded-full bg-hq-yellow text-black text-[10px] font-bold flex items-center justify-center shadow-lg cursor-pointer hover:scale-110 transition"
                 :title="pin.comment" x-text="idx + 1"></div>
          </div>
        </template>
        <!-- ÏÉà ÌïÄ ÏûÖÎ†• Ìèº -->
        <div x-show="feedbackNewPin" x-transition @click.stop
             class="absolute z-42" :style="feedbackNewPin ? `left:${feedbackNewPin.x}px;top:${feedbackNewPin.y + 16}px` : ''">
          <div class="bg-hq-bg border border-hq-yellow/40 rounded-xl shadow-2xl p-3 w-64">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-5 h-5 rounded-full bg-hq-yellow text-black text-[10px] font-bold flex items-center justify-center" x-text="feedbackPins.length + 1"></div>
              <span class="text-xs font-bold text-hq-yellow">ÏÉà ÌîºÎìúÎ∞±</span>
            </div>
            <textarea id="feedbackPinInput" x-model="feedbackPinText"
                      @keydown.enter.meta="submitFeedbackPin()" @keydown.enter.ctrl="submitFeedbackPin()"
                      @keydown.escape="feedbackNewPin = null; feedbackPinText = ''"
                      placeholder="ÌîºÎìúÎ∞±ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Ctrl+Enter Ï†ÑÏÜ°)"
                      class="w-full bg-hq-surface border border-hq-border rounded-lg px-3 py-2 text-xs text-hq-text resize-none h-16 focus:border-hq-yellow/50 outline-none"></textarea>
            <div class="flex gap-2 mt-2">
              <button @click="submitFeedbackPin()" class="flex-1 py-1.5 text-xs font-semibold rounded-lg bg-hq-yellow/20 text-hq-yellow hover:bg-hq-yellow/30 transition">Ï†ÄÏû•</button>
              <button @click="feedbackNewPin = null; feedbackPinText = ''" class="py-1.5 px-3 text-xs rounded-lg bg-hq-muted/10 text-hq-muted hover:bg-hq-muted/20 transition">Ï∑®ÏÜå</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Mobile Bottom Navigation (Î™®Î∞îÏùº ÌïòÎã® ÎÑ§ÎπÑ) ‚ïê‚ïê‚ïê -->
      <nav class="mobile-bottom-nav safe-bottom" x-cloak>
        <!-- Ìôà -->
        <div class="mobile-bottom-nav-item" :class="viewMode === 'chat' && activeTab === 'home' ? 'active' : ''"
             @click="viewMode = 'chat'; switchTab('home'); mobileMoreOpen = false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0a1 1 0 01-1-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 01-1 1"/></svg>
          <span>ÏûëÏ†ÑÌòÑÌô©</span>
        </div>
        <!-- ÏÇ¨Î†πÍ¥ÄÏã§ -->
        <div class="mobile-bottom-nav-item" :class="viewMode === 'chat' && activeTab === 'command' ? 'active' : ''"
             @click="viewMode = 'chat'; switchTab('command'); mobileMoreOpen = false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
          <span>ÏÇ¨Î†πÍ¥ÄÏã§</span>
        </div>
        <!-- Ï†ÑÎûµÏã§ -->
        <div class="mobile-bottom-nav-item" :class="viewMode === 'chat' && activeTab === 'trading' ? 'active' : ''"
             @click="viewMode = 'chat'; switchTab('trading'); mobileMoreOpen = false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
          <span>Ï†ÑÎûµÏã§</span>
        </div>
        <!-- ÌÜµÏã†Î°úÍ∑∏ -->
        <div class="mobile-bottom-nav-item" :class="viewMode === 'chat' && activeTab === 'activityLog' ? 'active' : ''"
             @click="viewMode = 'chat'; switchTab('activityLog'); mobileMoreOpen = false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
          <span>ÌÜµÏã†Î°úÍ∑∏</span>
        </div>
        <!-- ÎçîÎ≥¥Í∏∞ -->
        <div class="mobile-bottom-nav-item" :class="mobileMoreOpen ? 'active' : ''"
             @click="mobileMoreOpen = !mobileMoreOpen">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="5" cy="12" r="1.5"/><circle cx="12" cy="12" r="1.5"/><circle cx="19" cy="12" r="1.5"/>
          </svg>
          <span>ÎçîÎ≥¥Í∏∞</span>
        </div>
      </nav>

      <!-- ‚ïê‚ïê‚ïê Mobile More Tabs Sheet (ÎçîÎ≥¥Í∏∞ Î∞îÌÖÄÏãúÌä∏) ‚ïê‚ïê‚ïê -->
      <div class="mobile-more-overlay" :class="mobileMoreOpen ? 'open' : ''" @click="mobileMoreOpen = false" x-cloak></div>
      <div class="mobile-more-sheet" :class="mobileMoreOpen ? 'open' : ''" x-cloak>
        <div class="mobile-more-sheet-handle"></div>
        <div class="mobile-more-sheet-grid">
          <!-- AGORA -->
          <div class="mobile-more-sheet-item" :class="viewMode === 'agora' ? 'active' : ''"
               @click="viewMode = 'agora'; mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"/></svg>
            <span>AGORA</span>
          </div>
          <!-- ÎåÄÏãúÎ≥¥Îìú -->
          <div class="mobile-more-sheet-item" :class="viewMode === 'dashboard' ? 'active' : ''"
               @click="viewMode = 'dashboard'; mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>
            <span>ÎåÄÏãúÎ≥¥Îìú</span>
          </div>
          <!-- ÏûëÏ†ÑÏùºÏßÄ -->
          <div class="mobile-more-sheet-item" :class="activeTab === 'history' ? 'active' : ''"
               @click="viewMode = 'chat'; switchTab('history'); mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            <span>ÏûëÏ†ÑÏùºÏßÄ</span>
          </div>
          <!-- Ï†ÑÎ†•Î∂ÑÏÑù -->
          <div class="mobile-more-sheet-item" :class="activeTab === 'performance' ? 'active' : ''"
               @click="viewMode = 'chat'; switchTab('performance'); mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            <span>Ï†ÑÎ†•Î∂ÑÏÑù</span>
          </div>
          <!-- Í∏∞Î∞ÄÎ¨∏ÏÑú -->
          <div class="mobile-more-sheet-item" :class="activeTab === 'archive' ? 'active' : ''"
               @click="viewMode = 'chat'; switchTab('archive'); mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/></svg>
            <span>Í∏∞Î∞ÄÎ¨∏ÏÑú</span>
          </div>
          <!-- ÏûêÎèôÌôî -->
          <div class="mobile-more-sheet-item" :class="activeTab === 'workflow' ? 'active' : ''"
               @click="viewMode = 'chat'; switchTab('workflow'); mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>
            <span>ÏûêÎèôÌôî</span>
          </div>
          <!-- ÌÅ¨Î°†Í∏∞ÏßÄ -->
          <div class="mobile-more-sheet-item" :class="activeTab === 'schedule' ? 'active' : ''"
               @click="viewMode = 'chat'; switchTab('schedule'); mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            <span>ÌÅ¨Î°†Í∏∞ÏßÄ</span>
          </div>
          <!-- Ï†ïÎ≥¥Íµ≠ -->
          <div class="mobile-more-sheet-item" :class="activeTab === 'knowledge' ? 'active' : ''"
               @click="viewMode = 'chat'; switchTab('knowledge'); mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
            <span>Ï†ïÎ≥¥Íµ≠</span>
          </div>
          <!-- ARGOS -->
          <div class="mobile-more-sheet-item" :class="activeTab === 'intelligence' ? 'active' : ''"
               @click="viewMode = 'chat'; switchTab('intelligence'); mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/></svg>
            <span>ARGOS</span>
          </div>
          <!-- ÌÜµÏã†Íµ≠ -->
          <div class="mobile-more-sheet-item" :class="activeTab === 'sns' ? 'active' : ''"
               @click="viewMode = 'chat'; switchTab('sns'); mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"/></svg>
            <span>ÌÜµÏã†Íµ≠</span>
          </div>
          <!-- ÏÇ¨Î¨¥Ïã§ Î∑∞ -->
          <div class="mobile-more-sheet-item"
               @click="viewMode = 'office'; mobileMoreOpen = false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
            <span>ÏÇ¨Î¨¥Ïã§</span>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- ‚ïê‚ïê‚ïê Trading Order Modal (Ï£ºÎ¨∏ Ïã§Ìñâ) ‚ïê‚ïê‚ïê -->
  <div x-show="trading.showOrderModal" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="trading.showOrderModal = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[420px] mx-4 p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-lg font-bold text-hq-text">Ï£ºÎ¨∏ Ïã§Ìñâ</h2>
        <div class="flex items-center gap-2">
          <span class="text-[10px] px-2 py-0.5 rounded-full font-bold"
                :class="(trading.summary.settings||{}).paper_trading !== false ? 'bg-hq-accent/20 text-hq-accent' : 'bg-hq-red/20 text-hq-red'"
                x-text="(trading.summary.settings||{}).paper_trading !== false ? 'Í∞ÄÏÉÅ Î™®Îìú' : 'Ïã§Í±∞Îûò Î™®Îìú'"></span>
          <button @click="trading.showOrderModal = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
        </div>
      </div>
      <!-- Ïã§Í±∞Îûò Í≤ΩÍ≥† -->
      <div x-show="(trading.summary.settings||{}).paper_trading === false" class="bg-hq-red/10 border border-hq-red/30 rounded-lg p-2.5 mb-3 text-xs text-hq-red">
        Ïã§Í±∞Îûò Î™®Îìú ‚Äî Ïã§Ï†ú Ï¶ùÍ∂å Í≥ÑÏ¢åÏóêÏÑú Ï£ºÎ¨∏Ïù¥ Ïã§ÌñâÎê©ÎãàÎã§
      </div>
      <div class="space-y-3">
        <div class="flex gap-2">
          <button @click="trading.orderForm.action = 'buy'" :class="trading.orderForm.action === 'buy' ? 'bg-hq-green text-white' : 'bg-hq-surface text-hq-muted'" class="flex-1 py-2 rounded-lg text-sm font-bold transition">Îß§Ïàò</button>
          <button @click="trading.orderForm.action = 'sell'" :class="trading.orderForm.action === 'sell' ? 'bg-hq-red text-white' : 'bg-hq-surface text-hq-muted'" class="flex-1 py-2 rounded-lg text-sm font-bold transition">Îß§ÎèÑ</button>
        </div>
        <!-- ÏãúÏû• ÏÑ†ÌÉù -->
        <div class="flex gap-2">
          <button @click="trading.orderForm.market = 'KR'" :class="(trading.orderForm.market||'KR') === 'KR' ? 'bg-hq-accent/20 text-hq-accent border-hq-accent/40' : 'bg-hq-surface text-hq-muted border-hq-border'" class="flex-1 py-1.5 rounded-lg text-xs font-bold border transition">ÌïúÍµ≠</button>
          <button @click="trading.orderForm.market = 'US'" :class="trading.orderForm.market === 'US' ? 'bg-hq-accent/20 text-hq-accent border-hq-accent/40' : 'bg-hq-surface text-hq-muted border-hq-border'" class="flex-1 py-1.5 rounded-lg text-xs font-bold border transition">ÎØ∏Íµ≠</button>
        </div>
        <div>
          <label class="text-[10px] text-hq-muted block mb-1">Ï¢ÖÎ™©ÏΩîÎìú</label>
          <input x-model="trading.orderForm.ticker" :placeholder="(trading.orderForm.market||'KR')==='KR' ? 'Ïòà: 005930' : 'Ïòà: AAPL'" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text font-mono">
        </div>
        <div>
          <label class="text-[10px] text-hq-muted block mb-1">Ï¢ÖÎ™©Î™Ö</label>
          <input x-model="trading.orderForm.name" :placeholder="(trading.orderForm.market||'KR')==='KR' ? 'Ïòà: ÏÇºÏÑ±Ï†ÑÏûê' : 'Ïòà: Apple'" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-[10px] text-hq-muted block mb-1">ÏàòÎüâ (Ï£º)</label>
            <input type="number" x-model.number="trading.orderForm.qty" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text text-right">
          </div>
          <div>
            <label class="text-[10px] text-hq-muted block mb-1" x-text="(trading.orderForm.market||'KR')==='KR' ? 'Í∞ÄÍ≤© (Ïõê)' : 'Í∞ÄÍ≤© ($)'">Í∞ÄÍ≤© (Ïõê)</label>
            <input type="number" x-model.number="trading.orderForm.price" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text text-right">
          </div>
        </div>
        <div class="bg-hq-surface rounded-lg p-3 text-xs">
          <div class="flex justify-between text-hq-muted">
            <span>Ï£ºÎ¨∏ Ï¥ùÏï°</span>
            <span class="font-bold text-hq-text" x-text="((trading.orderForm.qty || 0) * (trading.orderForm.price || 0)).toLocaleString() + ((trading.orderForm.market||'KR')==='KR' ? 'Ïõê' : '$')"></span>
          </div>
        </div>
        <button @click="tradingOrder()" class="w-full py-2.5 rounded-lg text-sm font-bold transition"
                :class="trading.orderForm.action === 'buy' ? 'bg-hq-green text-white hover:bg-hq-green/80' : 'bg-hq-red text-white hover:bg-hq-red/80'"
                x-text="trading.orderForm.action === 'buy' ? 'Îß§Ïàò Ïã§Ìñâ' : 'Îß§ÎèÑ Ïã§Ìñâ'"></button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Trading Watchlist Modal (Í¥ÄÏã¨Ï¢ÖÎ™© Ï∂îÍ∞Ä) ‚ïê‚ïê‚ïê -->
  <div x-show="trading.showWatchModal" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="trading.showWatchModal = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[420px] mx-4 p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-lg font-bold text-hq-text">Í¥ÄÏã¨Ï¢ÖÎ™© Ï∂îÍ∞Ä</h2>
        <button @click="trading.showWatchModal = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>
      <div class="space-y-3">
        <div>
          <label class="text-[10px] text-hq-muted block mb-1">ÏãúÏû•</label>
          <div class="flex gap-2">
            <button @click="trading.watchForm.market='KR'"
                    :class="trading.watchForm.market==='KR' ? 'bg-hq-accent/30 text-hq-accent border-hq-accent' : 'bg-hq-bg text-hq-muted border-hq-border'"
                    class="flex-1 border rounded-lg py-2 text-xs font-bold transition">üá∞üá∑ ÌïúÍµ≠</button>
            <button @click="trading.watchForm.market='US'"
                    :class="trading.watchForm.market==='US' ? 'bg-hq-cyan/30 text-hq-cyan border-hq-cyan' : 'bg-hq-bg text-hq-muted border-hq-border'"
                    class="flex-1 border rounded-lg py-2 text-xs font-bold transition">üá∫üá∏ ÎØ∏Íµ≠</button>
          </div>
        </div>
        <div>
          <label class="text-[10px] text-hq-muted block mb-1">Ï¢ÖÎ™©ÏΩîÎìú</label>
          <input x-model="trading.watchForm.ticker"
                 :placeholder="trading.watchForm.market==='KR' ? 'Ïòà: 005930' : 'Ïòà: AAPL, TSLA, NVDA'"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text font-mono">
        </div>
        <div>
          <label class="text-[10px] text-hq-muted block mb-1">Ï¢ÖÎ™©Î™Ö</label>
          <input x-model="trading.watchForm.name"
                 :placeholder="trading.watchForm.market==='KR' ? 'Ïòà: ÏÇºÏÑ±Ï†ÑÏûê' : 'Ïòà: Apple'"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
        </div>
        <div>
          <label class="text-[10px] text-hq-muted block mb-1" x-text="trading.watchForm.market==='KR' ? 'Î™©Ìëú Í∞ÄÍ≤© (Ïõê)' : 'Î™©Ìëú Í∞ÄÍ≤© ($)'"></label>
          <input type="number" x-model.number="trading.watchForm.target_price" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text text-right">
        </div>
        <div>
          <label class="text-[10px] text-hq-muted block mb-1">Î©îÎ™®</label>
          <input x-model="trading.watchForm.notes" placeholder="Î©îÎ™® (ÏÑ†ÌÉù)" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
        </div>
        <button @click="addWatchlistItem()" class="w-full bg-hq-accent/20 text-hq-accent hover:bg-hq-accent/30 rounded-lg py-2.5 text-sm font-bold transition">Í¥ÄÏã¨Ï¢ÖÎ™© Ï∂îÍ∞Ä</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Trading Watchlist Edit Modal (Í¥ÄÏã¨Ï¢ÖÎ™© ÏàòÏ†ï) ‚ïê‚ïê‚ïê -->
  <div x-show="trading.showWatchEditModal" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="trading.showWatchEditModal = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[420px] mx-4 p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <div>
          <h2 class="text-lg font-bold text-hq-text">Í¥ÄÏã¨Ï¢ÖÎ™© ÏàòÏ†ï</h2>
          <p class="text-[10px] text-hq-muted mt-0.5" x-text="trading.watchEditForm.name + ' (' + trading.watchEditForm.ticker + ')'"></p>
        </div>
        <button @click="trading.showWatchEditModal = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>
      <div class="space-y-3">
        <div>
          <label class="text-[10px] text-hq-muted block mb-1">Î™©ÌëúÍ∞Ä <span class="text-hq-muted/50" x-text="(trading.watchEditForm.market||'KR')==='US' ? '(USD)' : '(Ïõê)'"></span></label>
          <input x-model.number="trading.watchEditForm.target_price" type="number" placeholder="0" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text font-mono">
        </div>
        <div>
          <label class="text-[10px] text-hq-muted block mb-1">ÏïåÎ¶º Ï°∞Í±¥</label>
          <div class="flex gap-2">
            <button @click="trading.watchEditForm.alert_type='above'"
                    :class="trading.watchEditForm.alert_type==='above' ? 'bg-hq-green/20 text-hq-green border-hq-green/40' : 'bg-hq-bg text-hq-muted border-hq-border'"
                    class="flex-1 border rounded-lg py-2 text-xs font-bold transition">‚Üë Ïù¥ÏÉÅ Ïãú ÏïåÎ¶º</button>
            <button @click="trading.watchEditForm.alert_type='below'"
                    :class="trading.watchEditForm.alert_type==='below' ? 'bg-blue-500/20 text-blue-400 border-blue-500/40' : 'bg-hq-bg text-hq-muted border-hq-border'"
                    class="flex-1 border rounded-lg py-2 text-xs font-bold transition">‚Üì Ïù¥Ìïò Ïãú ÏïåÎ¶º</button>
          </div>
        </div>
        <div>
          <label class="text-[10px] text-hq-muted block mb-1">Î©îÎ™®</label>
          <input x-model="trading.watchEditForm.notes" placeholder="Î©îÎ™® (ÏÑ†ÌÉù)" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
        </div>
        <button @click="updateWatchlistItem()" class="w-full bg-hq-accent/20 text-hq-accent hover:bg-hq-accent/30 rounded-lg py-2.5 text-sm font-bold transition">ÏàòÏ†ï Ï†ÄÏû•</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Trading Chart Slide Panel (Ï¢ÖÎ™© Ï∞®Ìä∏ CÏïà) ‚ïê‚ïê‚ïê -->
  <div x-show="trading.showChartModal" x-transition.opacity
       class="fixed inset-0 z-50 bg-black/40" @click="trading.showChartModal = false" style="display: none;"></div>
  <div x-show="trading.showChartModal"
       x-transition:enter="transition ease-out duration-300" x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0"
       x-transition:leave="transition ease-in duration-200" x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full"
       class="fixed top-0 right-0 z-50 h-full w-full max-w-[420px] bg-hq-panel border-l border-hq-border shadow-2xl overflow-y-auto" style="display: none;">
    <!-- Ìó§Îçî -->
    <div class="sticky top-0 bg-hq-panel/95 backdrop-blur-sm border-b border-hq-border z-10 px-5 py-4">
      <div class="flex items-center justify-between">
        <div class="min-w-0">
          <h2 class="text-base font-bold text-hq-text truncate" x-text="trading.chartName"></h2>
          <p class="text-xs text-hq-muted font-mono mt-0.5" x-text="trading.chartTicker + ' ¬∑ ' + (trading.chartMarket || 'KR')"></p>
        </div>
        <button @click="trading.showChartModal = false" class="ml-3 flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-lg bg-hq-surface hover:bg-hq-border/50 text-hq-muted hover:text-hq-text transition">&times;</button>
      </div>
      <!-- ÌòÑÏû¨Í∞Ä ÏöîÏïΩ -->
      <div x-show="!trading.chartLoading && trading.chartData.length > 0" class="mt-3 flex items-end gap-3">
        <span class="text-2xl font-bold text-hq-text font-mono" x-text="trading.chartData.length > 0 ? trading.chartData[trading.chartData.length-1].close.toLocaleString() : '-'"></span>
        <span class="text-sm font-bold mb-0.5"
              :class="trading.chartData.length >= 2 && trading.chartData[trading.chartData.length-1].close >= trading.chartData[trading.chartData.length-2].close ? 'text-hq-red' : 'text-blue-400'"
              x-text="(() => { if(trading.chartData.length < 2) return ''; const cur = trading.chartData[trading.chartData.length-1].close; const prev = trading.chartData[trading.chartData.length-2].close; const pct = ((cur - prev) / prev * 100).toFixed(2); return (pct >= 0 ? '+' : '') + pct + '%'; })()"></span>
      </div>
    </div>

    <!-- Ï∞®Ìä∏ Î≥∏Î¨∏ -->
    <div class="px-5 py-4 space-y-4">
      <div x-show="trading.chartLoading" class="flex items-center justify-center py-16">
        <span class="text-hq-muted text-xs animate-pulse">Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Îäî Ï§ë...</span>
      </div>
      <div x-show="!trading.chartLoading && trading.chartData.length === 0" class="text-center py-16 text-hq-muted/70 text-xs">
        Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§
      </div>
      <div x-show="!trading.chartLoading && trading.chartData.length > 0">
        <!-- SVG ÏÑ† Í∑∏ÎûòÌîÑ -->
        <div class="bg-hq-bg rounded-xl p-3 border border-hq-border/50">
          <svg viewBox="0 0 560 200" class="w-full" style="height: 180px;">
            <line x1="40" y1="10" x2="550" y2="10" stroke="rgb(var(--hq-border))" stroke-width="0.5" opacity="0.3"/>
            <line x1="40" y1="60" x2="550" y2="60" stroke="rgb(var(--hq-border))" stroke-width="0.5" opacity="0.3"/>
            <line x1="40" y1="110" x2="550" y2="110" stroke="rgb(var(--hq-border))" stroke-width="0.5" opacity="0.3"/>
            <line x1="40" y1="160" x2="550" y2="160" stroke="rgb(var(--hq-border))" stroke-width="0.5" opacity="0.3"/>
            <defs>
              <linearGradient id="chartGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="rgb(var(--hq-cyan))" stop-opacity="0.3"/>
                <stop offset="100%" stop-color="rgb(var(--hq-cyan))" stop-opacity="0.02"/>
              </linearGradient>
            </defs>
            <polygon :points="getChartAreaPoints()" fill="url(#chartGrad)"/>
            <polyline :points="getChartLinePoints()" fill="none" stroke="rgb(var(--hq-cyan))" stroke-width="2" stroke-linejoin="round"/>
            <text x="36" y="14" fill="rgb(var(--hq-muted))" font-size="8" text-anchor="end" x-text="getChartYLabel(1)"></text>
            <text x="36" y="64" fill="rgb(var(--hq-muted))" font-size="8" text-anchor="end" x-text="getChartYLabel(0.67)"></text>
            <text x="36" y="114" fill="rgb(var(--hq-muted))" font-size="8" text-anchor="end" x-text="getChartYLabel(0.33)"></text>
            <text x="36" y="164" fill="rgb(var(--hq-muted))" font-size="8" text-anchor="end" x-text="getChartYLabel(0)"></text>
          </svg>
          <div class="flex justify-between px-10 text-[8px] text-hq-muted -mt-1">
            <span x-text="trading.chartData.length > 0 ? trading.chartData[0].date : ''"></span>
            <span x-text="trading.chartData.length > 10 ? trading.chartData[Math.floor(trading.chartData.length/2)].date : ''"></span>
            <span x-text="trading.chartData.length > 0 ? trading.chartData[trading.chartData.length-1].date : ''"></span>
          </div>
        </div>
        <!-- Í∞ÄÍ≤© ÏöîÏïΩ -->
        <div class="grid grid-cols-4 gap-2 mt-3">
          <div class="bg-hq-surface rounded-lg p-2.5 text-center">
            <div class="text-[9px] text-hq-muted">ÏãúÏûëÍ∞Ä</div>
            <div class="text-xs font-bold text-hq-text font-mono" x-text="trading.chartData.length > 0 ? trading.chartData[0].close.toLocaleString() : '-'"></div>
          </div>
          <div class="bg-hq-surface rounded-lg p-2.5 text-center">
            <div class="text-[9px] text-hq-muted">ÏµúÍ≥†Í∞Ä</div>
            <div class="text-xs font-bold text-hq-red font-mono" x-text="trading.chartData.length > 0 ? Math.max(...trading.chartData.map(d=>d.close)).toLocaleString() : '-'"></div>
          </div>
          <div class="bg-hq-surface rounded-lg p-2.5 text-center">
            <div class="text-[9px] text-hq-muted">ÏµúÏ†ÄÍ∞Ä</div>
            <div class="text-xs font-bold text-blue-400 font-mono" x-text="trading.chartData.length > 0 ? Math.min(...trading.chartData.map(d=>d.close)).toLocaleString() : '-'"></div>
          </div>
          <div class="bg-hq-surface rounded-lg p-2.5 text-center">
            <div class="text-[9px] text-hq-muted">ÌòÑÏû¨Í∞Ä</div>
            <div class="text-xs font-bold text-hq-cyan font-mono" x-text="trading.chartData.length > 0 ? trading.chartData[trading.chartData.length-1].close.toLocaleString() : '-'"></div>
          </div>
        </div>
        <!-- CIO ÏµúÍ∑º ÏãúÍ∑∏ÎÑê (ÏûàÏúºÎ©¥ ÌëúÏãú) -->
        <template x-if="trading.signals && trading.signals.filter(s => s.ticker === trading.chartTicker).length > 0">
          <div class="mt-4 bg-hq-surface rounded-xl p-3 border border-hq-border/50">
            <div class="text-[10px] text-hq-muted font-bold mb-2">Í∏àÏúµÎ∂ÑÏÑùÌåÄ ÏµúÍ∑º ÏãúÍ∑∏ÎÑê</div>
            <template x-for="sig in trading.signals.filter(s => s.ticker === trading.chartTicker).slice(0,2)" :key="sig.ticker + sig.action">
              <div class="flex items-center gap-2 mb-1.5 last:mb-0">
                <span class="text-[10px] px-1.5 py-0.5 rounded font-bold"
                      :class="sig.action === 'buy' ? 'bg-hq-red/20 text-hq-red' : sig.action === 'sell' ? 'bg-blue-500/20 text-blue-400' : 'bg-hq-surface text-hq-muted'"
                      x-text="sig.action === 'buy' ? 'Îß§Ïàò' : sig.action === 'sell' ? 'Îß§ÎèÑ' : 'Í¥ÄÎßù'"></span>
                <span class="text-[10px] text-hq-muted" x-text="'Ïã†Î¢∞ÎèÑ ' + (sig.confidence || 0) + '%'"></span>
                <span class="text-[10px] text-hq-text truncate flex-1" x-text="sig.reason || ''"></span>
              </div>
            </template>
          </div>
        </template>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Trading Settings Modal (ÏûêÎèôÎß§Îß§ ÏÑ§Ï†ï ‚Äî CEO ÏùΩÍ∏∞ Ï†ÑÏö© + ÏÑ±Ìñ• Ïä¨ÎùºÏù¥Îçî) ‚ïê‚ïê‚ïê -->
  <div x-show="trading.showSettingsModal" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="trading.showSettingsModal = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[520px] mx-4 p-6 max-h-[90vh] overflow-y-auto" @click.stop
         x-data="{
           riskProfile: 'aggressive',
           changeHistory: [],
           saving: false,
           async loadProfile() {
             try {
               const res = await fetch('/api/trading/risk-profile').then(r=>r.json());
               this.riskProfile = res.profile || 'aggressive';
               this.changeHistory = res.change_history || [];
             } catch {}
           },
           async setProfile(p) {
             this.saving = true;
             try {
               const res = await fetch('/api/trading/risk-profile', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({profile:p})}).then(r=>r.json());
               if (res.success) { this.riskProfile = p; $dispatch('trading-settings-updated'); }
             } catch {}
             this.saving = false;
             await this.loadProfile();
           }
         }" x-init="loadProfile()">

      <div class="flex items-center justify-between mb-5">
        <h2 class="text-lg font-bold text-hq-text">ÏûêÎèôÎß§Îß§ ÏÑ§Ï†ï</h2>
        <button @click="trading.showSettingsModal = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>

      <!-- Ìà¨Ïûê ÏÑ±Ìñ• Ïä¨ÎùºÏù¥Îçî (CEOÍ∞Ä Ïú†ÏùºÌïòÍ≤å Î≥ÄÍ≤Ω Í∞ÄÎä•Ìïú Í≤É) -->
      <div class="mb-5 p-4 bg-hq-surface rounded-xl border border-hq-border">
        <p class="text-xs font-bold text-hq-text mb-3">Ìà¨Ïûê ÏÑ±Ìñ•</p>
        <div class="flex gap-2">
          <button @click="setProfile('conservative')" :disabled="saving"
                  :class="riskProfile === 'conservative' ? 'bg-blue-500/20 text-blue-400 border-blue-500/40 ring-1 ring-blue-500/30' : 'bg-hq-bg text-hq-muted border-hq-border hover:border-blue-500/30'"
                  class="flex-1 border rounded-xl py-3 text-center transition">
            <div class="text-lg mb-0.5">üê¢</div>
            <div class="text-xs font-bold">Î≥¥ÏàòÏ†Å</div>
          </button>
          <button @click="setProfile('balanced')" :disabled="saving"
                  :class="riskProfile === 'balanced' ? 'bg-hq-yellow/20 text-hq-yellow border-hq-yellow/40 ring-1 ring-hq-yellow/30' : 'bg-hq-bg text-hq-muted border-hq-border hover:border-hq-yellow/30'"
                  class="flex-1 border rounded-xl py-3 text-center transition">
            <div class="text-lg mb-0.5">‚öñÔ∏è</div>
            <div class="text-xs font-bold">Í∑†Ìòï</div>
          </button>
          <button @click="setProfile('aggressive')" :disabled="saving"
                  :class="riskProfile === 'aggressive' ? 'bg-hq-red/20 text-hq-red border-hq-red/40 ring-1 ring-hq-red/30' : 'bg-hq-bg text-hq-muted border-hq-border hover:border-hq-red/30'"
                  class="flex-1 border rounded-xl py-3 text-center transition">
            <div class="text-lg mb-0.5">üî•</div>
            <div class="text-xs font-bold">Í≥µÍ≤©Ï†Å</div>
          </button>
        </div>
        <p class="text-[9px] text-hq-muted mt-2 text-center">Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû•Ïù¥ Ïù¥ ÏÑ±Ìñ•Ïóê ÎßûÏ∂∞ ÏïàÏ†Ñ Î≤îÏúÑ ÎÇ¥ÏóêÏÑú ÏûêÏú®Ï†ÅÏúºÎ°ú ÏÑ§Ï†ïÏùÑ Ï°∞Ï†ïÌï©ÎãàÎã§</p>
      </div>

      <!-- ÌòÑÏû¨ ÏÑ§Ï†ïÍ∞í (ÏùΩÍ∏∞ Ï†ÑÏö©) -->
      <div class="mb-4">
        <p class="text-[10px] font-bold text-hq-muted mb-2">ÌòÑÏû¨ ÏÑ§Ï†ï (Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• ÏûêÏú® Í¥ÄÎ¶¨)</p>
        <div class="grid grid-cols-3 gap-2">
          <div class="bg-hq-bg rounded-lg p-2.5 text-center border border-hq-border/50">
            <div class="text-[9px] text-hq-muted">Ï¢ÖÎ™©Îãπ ÏµúÎåÄ</div>
            <div class="text-sm font-bold text-hq-text font-mono" x-text="(trading.settings.max_position_pct || 20) + '%'"></div>
          </div>
          <div class="bg-hq-bg rounded-lg p-2.5 text-center border border-hq-border/50">
            <div class="text-[9px] text-hq-muted">ÏµúÏÜå Ïã†Î¢∞ÎèÑ</div>
            <div class="text-sm font-bold text-hq-text font-mono" x-text="(trading.settings.min_confidence || 65) + '%'"></div>
          </div>
          <div class="bg-hq-bg rounded-lg p-2.5 text-center border border-hq-border/50">
            <div class="text-[9px] text-hq-muted">Ï£ºÎ¨∏ Í∏àÏï°</div>
            <div class="text-sm font-bold text-hq-text font-mono" x-text="(trading.settings.order_size || 0) === 0 ? 'Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• ÏûêÏú®' : (trading.settings.order_size||0).toLocaleString()"></div>
          </div>
          <div class="bg-hq-bg rounded-lg p-2.5 text-center border border-hq-border/50">
            <div class="text-[9px] text-hq-muted">ÏÜêÏ†à</div>
            <div class="text-sm font-bold text-hq-red font-mono" x-text="(trading.settings.default_stop_loss_pct || -5) + '%'"></div>
          </div>
          <div class="bg-hq-bg rounded-lg p-2.5 text-center border border-hq-border/50">
            <div class="text-[9px] text-hq-muted">ÏùµÏ†à</div>
            <div class="text-sm font-bold text-hq-green font-mono" x-text="'+' + (trading.settings.default_take_profit_pct || 10) + '%'"></div>
          </div>
          <div class="bg-hq-bg rounded-lg p-2.5 text-center border border-hq-border/50">
            <div class="text-[9px] text-hq-muted">ÏùºÏùº ÏµúÎåÄ</div>
            <div class="text-sm font-bold text-hq-text font-mono" x-text="(trading.settings.max_daily_trades || 10) + 'Ìöå'"></div>
          </div>
        </div>
      </div>

      <!-- Îß§Îß§ Î™®Îìú ÏÑ†ÌÉù (3Îã® ÎùºÎîîÏò§) -->
      <div class="p-3 bg-hq-surface rounded-lg space-y-3 mb-4">
        <p class="text-[10px] font-bold text-hq-muted mb-1">Îß§Îß§ Î™®Îìú</p>
        <div class="space-y-2">
          <label class="flex items-center gap-3 p-2 rounded-lg cursor-pointer transition"
                 :class="trading.settings.enable_real && !trading.settings.paper_trading ? 'bg-green-500/10 border border-green-500/30' : 'hover:bg-hq-bg border border-transparent'">
            <input type="radio" name="trading_mode" value="real"
                   :checked="trading.settings.enable_real && !trading.settings.paper_trading"
                   @change="trading.settings.enable_real=true; trading.settings.enable_mock=false; trading.settings.paper_trading=false"
                   class="accent-green-500">
            <div>
              <span class="text-xs font-bold text-hq-green">Ïã§Í±∞Îûò</span>
              <p class="text-[9px] text-hq-muted">KIS Ïã§Í≥ÑÏ¢åÎ°ú Ïã§Ï†ú Ï£ºÎ¨∏ (Ïã§Ï†ú Îèà)</p>
            </div>
          </label>
          <label class="flex items-center gap-3 p-2 rounded-lg cursor-pointer transition"
                 :class="trading.settings.enable_mock && trading.settings.paper_trading ? 'bg-purple-500/10 border border-purple-500/30' : 'hover:bg-hq-bg border border-transparent'">
            <input type="radio" name="trading_mode" value="mock"
                   :checked="trading.settings.enable_mock && trading.settings.paper_trading"
                   @change="trading.settings.enable_real=false; trading.settings.enable_mock=true; trading.settings.paper_trading=true"
                   class="accent-purple-500">
            <div>
              <span class="text-xs font-bold text-hq-purple">Î™®ÏùòÌà¨Ïûê</span>
              <p class="text-[9px] text-hq-muted">KIS Î™®ÏùòÍ≥ÑÏ¢åÎ°ú Ï£ºÎ¨∏ (Ïó∞ÏäµÏö©)</p>
            </div>
          </label>
          <label class="flex items-center gap-3 p-2 rounded-lg cursor-pointer transition"
                 :class="!trading.settings.enable_real && !trading.settings.enable_mock ? 'bg-hq-accent/10 border border-hq-accent/30' : 'hover:bg-hq-bg border border-transparent'">
            <input type="radio" name="trading_mode" value="virtual"
                   :checked="!trading.settings.enable_real && !trading.settings.enable_mock"
                   @change="trading.settings.enable_real=false; trading.settings.enable_mock=false; trading.settings.paper_trading=true"
                   class="accent-blue-500">
            <div>
              <span class="text-xs font-bold text-hq-accent">Í∞ÄÏÉÅÌà¨Ïûê</span>
              <p class="text-[9px] text-hq-muted">ÎÇ¥Î∂Ä Ìè¨Ìä∏Ìè¥Î¶¨Ïò§Îßå (KIS ÎØ∏ÏÇ¨Ïö©)</p>
            </div>
          </label>
        </div>
        <!-- CIO ÏûêÎèôÏã§Ìñâ ÌÜ†Í∏Ä -->
        <div class="pt-2 border-t border-hq-border/50">
          <label class="flex items-center gap-2 text-xs text-hq-text cursor-pointer">
            <input type="checkbox" x-model="trading.settings.auto_execute" class="rounded">
            <span class="text-hq-yellow font-bold">Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû• ÏûêÎèôÏã§Ìñâ</span>
            <span class="text-[9px] text-hq-muted">(Ïã†Î¢∞ÎèÑ Ïù¥ÏÉÅ Ïãú ÏûêÎèô Îß§Ïàò/Îß§ÎèÑ)</span>
          </label>
        </div>
        <!-- ÏÜêÏ†à/ÏùµÏ†à -->
        <div class="flex gap-4 pt-1 border-t border-hq-border/50">
          <label class="flex items-center gap-2 text-xs text-hq-text cursor-pointer">
            <input type="checkbox" x-model="trading.settings.auto_stop_loss" class="rounded">
            <span>ÏûêÎèô ÏÜêÏ†à</span>
          </label>
          <label class="flex items-center gap-2 text-xs text-hq-text cursor-pointer">
            <input type="checkbox" x-model="trading.settings.auto_take_profit" class="rounded">
            <span>ÏûêÎèô ÏùµÏ†à</span>
          </label>
        </div>
      </div>
      <button @click="saveTradingSettings()" class="w-full bg-hq-accent/20 text-hq-accent hover:bg-hq-accent/30 rounded-lg py-2.5 text-sm font-bold transition mb-4">ÏÑ§Ï†ï Ï†ÄÏû•</button>

      <!-- CIO Î≥ÄÍ≤Ω Ïù¥Î†• -->
      <div x-show="changeHistory.length > 0" x-data="{ showHistory: false }">
        <button @click="showHistory = !showHistory" class="flex items-center gap-1 text-[10px] text-hq-muted font-semibold hover:text-hq-text transition w-full">
          <span x-text="showHistory ? '‚ñº' : '‚ñ∂'"></span>
          <span>ÏÑ§Ï†ï Î≥ÄÍ≤Ω Ïù¥Î†•</span>
          <span class="text-hq-accent ml-1" x-text="changeHistory.length + 'Í±¥'"></span>
        </button>
        <div x-show="showHistory" x-transition class="mt-2 space-y-1.5 max-h-40 overflow-y-auto">
          <template x-for="h in [...changeHistory].reverse().slice(0,10)" :key="h.changed_at">
            <div class="bg-hq-bg rounded-lg px-3 py-2 text-[9px] border border-hq-border/30">
              <div class="flex items-center justify-between">
                <span class="font-bold" :class="h.changed_by === 'Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû•' ? 'text-hq-cyan' : 'text-hq-yellow'" x-text="h.changed_by"></span>
                <span class="text-hq-muted font-mono" x-text="h.changed_at ? h.changed_at.slice(5,16).replace('T',' ') : ''"></span>
              </div>
              <div class="text-hq-text mt-0.5" x-text="h.detail || h.action"></div>
            </div>
          </template>
        </div>
      </div>

      <div x-show="(trading.summary.settings||{}).kis_connected" class="bg-hq-green/10 border border-hq-green/20 rounded-lg p-3 text-[10px] text-hq-green mt-3">
        ‚úÖ KIS(ÌïúÍµ≠Ìà¨ÏûêÏ¶ùÍ∂å) API Ïó∞Í≤∞Îê® ‚Äî Ïã§Í±∞Îûò Ï£ºÎ¨∏ Í∞ÄÎä•.
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Schedule Add Modal (ÏòàÏïΩ Ï∂îÍ∞Ä) ‚ïê‚ïê‚ïê -->
  <div x-show="schedules.showModal" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="schedules.showModal = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[500px] mx-4 p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-lg font-bold text-hq-text">ÏÉà ÏòàÏïΩ Ï∂îÍ∞Ä</h2>
        <button @click="schedules.showModal = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>

      <div class="space-y-4">
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">ÏòàÏïΩ Ïù¥Î¶Ñ</label>
          <input x-model="schedules.editName" placeholder="Ïòà: ÏùºÏùº Î≥¥Í≥†ÏÑú"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text focus:border-hq-accent outline-none">
        </div>
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">Ïã§ÌñâÌï† Î™ÖÎ†π</label>
          <textarea x-model="schedules.editCommand" placeholder="Ïòà: Ïò§Îäò ÌöåÏÇ¨ ÌòÑÌô©ÏùÑ Î≥¥Í≥†ÏÑúÎ°ú ÏûëÏÑ±Ìï¥Ï§ò" rows="2"
                    class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text focus:border-hq-accent outline-none resize-none"></textarea>
        </div>
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">Ïã§Ìñâ Ï£ºÍ∏∞</label>
          <div class="grid grid-cols-2 gap-2">
            <template x-for="preset in schedules.cronPresets" :key="preset">
              <button @click="schedules.editCronPreset = preset"
                      class="text-xs px-3 py-2 rounded-lg border transition text-left"
                      :class="schedules.editCronPreset === preset
                        ? 'border-hq-accent bg-hq-accent/15 text-hq-accent'
                        : 'border-hq-border text-hq-muted hover:border-hq-border-light'"
                      x-text="preset"></button>
            </template>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3 mt-6">
        <button @click="schedules.showModal = false"
                class="px-4 py-2 text-sm text-hq-muted hover:text-hq-text transition">Ï∑®ÏÜå</button>
        <button @click="addSchedule()"
                class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-5 py-2 text-sm font-semibold transition">Ï∂îÍ∞Ä</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Universal Delete Confirm Modal (Î≤îÏö© ÏÇ≠Ï†ú ÌôïÏù∏) ‚ïê‚ïê‚ïê -->
  <div x-show="confirmDelete.type" x-transition.opacity
       class="fixed inset-0 z-[60] flex items-center justify-center backdrop-blur-lg"
       :class="darkMode ? 'bg-black/60' : 'bg-black/30'"
       @click.self="confirmDelete = {type:null, id:null, name:null}" style="display: none;">
    <div class="relative overflow-hidden rounded-3xl w-full max-w-[400px] mx-4 text-center" @click.stop
         :style="darkMode
           ? 'background: rgba(18,10,36,0.92); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 60px rgba(239,68,68,0.12), 0 0 120px rgba(139,92,246,0.08), 0 8px 32px rgba(0,0,0,0.4);'
           : 'background: rgba(255,255,255,0.96); border: 1px solid rgba(220,120,160,0.2); box-shadow: 0 0 40px rgba(220,100,140,0.06), 0 8px 32px rgba(0,0,0,0.08);'"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 scale-90 translate-y-4"
         x-transition:enter-end="opacity-100 scale-100 translate-y-0">
      <!-- Ïò§Î°úÎùº Î∞∞Í≤Ω Í∑∏ÎùºÎç∞Ïù¥ÏÖò -->
      <div :style="darkMode
        ? 'position:absolute; inset:0; background: linear-gradient(135deg, rgba(239,68,68,0.06) 0%, rgba(139,92,246,0.08) 40%, rgba(236,72,153,0.06) 70%, rgba(239,68,68,0.04) 100%); pointer-events:none;'
        : 'position:absolute; inset:0; background: linear-gradient(135deg, rgba(236,72,153,0.03) 0%, rgba(168,85,247,0.03) 40%, rgba(244,114,182,0.02) 100%); pointer-events:none;'"></div>
      <!-- ÏÉÅÎã® Î∂ÑÌôç ÎùºÏù∏ -->
      <div :style="darkMode
        ? 'position:absolute; top:0; left:0; right:0; height:2px; background: linear-gradient(90deg, transparent, rgba(239,68,68,0.6), rgba(236,72,153,0.4), transparent);'
        : 'position:absolute; top:0; left:0; right:0; height:2px; background: linear-gradient(90deg, transparent, rgba(236,72,153,0.4), rgba(168,85,247,0.25), transparent);'"></div>
      <div class="relative px-8 pt-8 pb-7">
        <!-- ÌÅ∞ ÏïÑÏù¥ÏΩò + Î∂ÑÌôç Í∏ÄÎ°úÏö∞ -->
        <div class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6"
             :style="darkMode
               ? 'background: radial-gradient(circle, rgba(239,68,68,0.2) 0%, rgba(239,68,68,0.05) 70%); border: 1.5px solid rgba(239,68,68,0.3); box-shadow: 0 0 30px rgba(239,68,68,0.25), 0 0 60px rgba(239,68,68,0.1);'
               : 'background: radial-gradient(circle, rgba(236,72,153,0.1) 0%, rgba(244,114,182,0.03) 70%); border: 1.5px solid rgba(236,72,153,0.2); box-shadow: 0 0 20px rgba(236,72,153,0.08);'">
          <svg class="w-9 h-9" :style="darkMode
            ? 'color: rgb(252,129,129); filter: drop-shadow(0 0 8px rgba(239,68,68,0.4));'
            : 'color: rgb(219,39,119); filter: drop-shadow(0 0 6px rgba(236,72,153,0.2));'" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
        </div>
        <!-- Ï†úÎ™© (ÌÉÄÏûÖÏóê Îî∞Îùº Îã§Î•¥Í≤å) -->
        <h3 class="text-lg font-bold text-hq-text mb-3" x-text="confirmDelete.type === 'workflow' ? 'ÏõåÌÅ¨ÌîåÎ°úÏö∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?' : 'ÏòàÏïΩÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?'"></h3>
        <!-- Ïù¥Î¶Ñ ÌïòÏù¥ÎùºÏù¥Ìä∏ -->
        <div class="mb-6">
          <div class="inline-block rounded-lg px-4 py-2"
               :style="darkMode
                 ? 'background: rgba(239,68,68,0.08); border: 1px solid rgba(239,68,68,0.15);'
                 : 'background: rgba(236,72,153,0.06); border: 1px solid rgba(236,72,153,0.12);'">
            <span class="text-sm font-semibold"
                  :style="darkMode ? 'color: rgb(252,165,165);' : 'color: rgb(190,24,93);'"
                  x-text="confirmDelete.name || 'Ïù¥Î¶Ñ ÏóÜÏùå'"></span>
          </div>
          <p class="text-[13px] mt-3" :style="darkMode ? 'color: rgba(200,195,220,0.6);' : 'color: rgba(100,95,120,0.65);'">Ïù¥ Ìï≠Î™©ÏùÄ ÏòÅÍµ¨Ï†ÅÏúºÎ°ú ÏÇ≠Ï†úÎêòÎ©∞ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</p>
        </div>
        <!-- Î≤ÑÌäº (Ï†ÑÏ≤¥ ÎÑàÎπÑ, ÏÑ∏Î°ú Î∞∞Ïπò) -->
        <div class="space-y-2.5">
          <button @click="if(confirmDelete.type==='schedule') deleteSchedule(confirmDelete.id); else if(confirmDelete.type==='workflow') deleteWorkflow(confirmDelete.id); confirmDelete={type:null,id:null,name:null};"
                  class="w-full py-3 text-sm text-white rounded-2xl font-semibold transition-all duration-200"
                  :style="darkMode
                    ? 'background: linear-gradient(135deg, rgb(220,50,50), rgb(180,30,80)); box-shadow: 0 0 20px rgba(239,68,68,0.3), 0 4px 12px rgba(0,0,0,0.3);'
                    : 'background: linear-gradient(135deg, rgb(219,39,119), rgb(190,24,93)); box-shadow: 0 2px 12px rgba(219,39,119,0.25);'"
                  @mouseover="$el.style.transform='translateY(-1px)'; $el.style.boxShadow=darkMode ? '0 0 35px rgba(239,68,68,0.5), 0 4px 16px rgba(0,0,0,0.4)' : '0 4px 20px rgba(219,39,119,0.35)'"
                  @mouseout="$el.style.transform='translateY(0)'; $el.style.boxShadow=darkMode ? '0 0 20px rgba(239,68,68,0.3), 0 4px 12px rgba(0,0,0,0.3)' : '0 2px 12px rgba(219,39,119,0.25)'">ÏÇ≠Ï†úÌïòÍ∏∞</button>
          <button @click="confirmDelete = {type:null, id:null, name:null}"
                  class="w-full py-3 text-sm rounded-2xl transition-all duration-200 font-medium"
                  :style="darkMode
                    ? 'color: rgba(200,195,220,0.8); border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04);'
                    : 'color: rgba(85,80,108,0.7); border: 1px solid rgba(0,0,0,0.08); background: rgba(0,0,0,0.02);'"
                  @mouseover="$el.style.background=darkMode ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.05)'; $el.style.borderColor=darkMode ? 'rgba(255,255,255,0.15)' : 'rgba(0,0,0,0.12)'"
                  @mouseout="$el.style.background=darkMode ? 'rgba(255,255,255,0.04)' : 'rgba(0,0,0,0.02)'; $el.style.borderColor=darkMode ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.08)'">Ï∑®ÏÜå</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Agent Memory Modal (ÏóêÏù¥Ï†ÑÌä∏ Í∏∞Ïñµ) ‚ïê‚ïê‚ïê -->
  <div x-show="memoryModal.visible" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="memoryModal.visible = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[600px] mx-4 max-h-[80vh] overflow-y-auto p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-lg font-bold text-hq-text">
          <span x-text="memoryModal.agentName"></span> Í∏∞Ïñµ Í¥ÄÎ¶¨
        </h2>
        <button @click="memoryModal.visible = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>

      <!-- Í∏∞Ïñµ Ï∂îÍ∞Ä -->
      <div class="bg-hq-bg rounded-xl p-4 mb-4">
        <div class="text-xs text-hq-muted font-semibold mb-2">ÏÉà Í∏∞Ïñµ Ï∂îÍ∞Ä</div>
        <div class="flex gap-2 mb-2">
          <input x-model="memoryModal.newKey" placeholder="Ï†úÎ™© (Ïòà: ÏÑ†Ìò∏ÌïòÎäî Î≥¥Í≥†ÏÑú ÌòïÏãù)"
                 class="flex-1 bg-hq-panel border border-hq-border rounded-lg px-3 py-1.5 text-sm text-hq-text focus:border-hq-accent outline-none">
        </div>
        <div class="flex gap-2">
          <input x-model="memoryModal.newValue" placeholder="ÎÇ¥Ïö© (Ïòà: ÌëúÏôÄ Í∑∏ÎûòÌîÑÎ•º Ìè¨Ìï®Ìïú ÌòïÏãù ÏÑ†Ìò∏)"
                 class="flex-1 bg-hq-panel border border-hq-border rounded-lg px-3 py-1.5 text-sm text-hq-text focus:border-hq-accent outline-none"
                 @keydown.enter="addMemory()">
          <button @click="addMemory()"
                  class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-1.5 text-xs font-semibold transition">Ï∂îÍ∞Ä</button>
        </div>
      </div>

      <!-- Í∏∞Ïñµ Î™©Î°ù -->
      <div class="space-y-2">
        <template x-for="mem in memoryModal.items" :key="mem.memory_id">
          <div class="flex items-start gap-3 bg-hq-bg rounded-lg p-3 group">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-semibold text-hq-accent" x-text="mem.key"></span>
                <span class="text-[10px] px-1.5 py-0.5 rounded"
                      :class="mem.source === 'auto' ? 'bg-hq-purple/15 text-hq-purple' : 'bg-hq-green/15 text-hq-green'"
                      x-text="mem.source === 'auto' ? 'ÏûêÎèô' : 'ÏàòÎèô'"></span>
              </div>
              <div class="text-xs text-hq-muted" x-text="mem.value"></div>
            </div>
            <button @click="deleteMemory(mem.memory_id)"
                    class="text-hq-red/50 hover:text-hq-red text-sm opacity-0 group-hover:opacity-100 transition">&times;</button>
          </div>
        </template>
        <template x-if="!memoryModal.items || memoryModal.items.length === 0">
          <div class="text-center py-8 text-hq-muted/80 text-sm">ÏïÑÏßÅ Ï†ÄÏû•Îêú Í∏∞ÏñµÏù¥ ÏóÜÏäµÎãàÎã§.</div>
        </template>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Workflow Editor Modal (ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ìé∏ÏßëÍ∏∞) ‚ïê‚ïê‚ïê -->
  <div x-show="workflows.showEditor" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="workflows.showEditor = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[600px] mx-4 max-h-[80vh] overflow-y-auto p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-lg font-bold text-hq-text" x-text="workflows.editing ? 'ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏàòÏ†ï' : 'ÏÉà ÏõåÌÅ¨ÌîåÎ°úÏö∞'"></h2>
        <button @click="workflows.showEditor = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>

      <div class="space-y-4">
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">Ïù¥Î¶Ñ</label>
          <input x-model="workflows.editName" placeholder="ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ïù¥Î¶Ñ"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text focus:border-hq-accent outline-none">
        </div>
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">ÏÑ§Î™Ö</label>
          <input x-model="workflows.editDesc" placeholder="ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏÑ§Î™Ö (ÏÑ†ÌÉù)"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text focus:border-hq-accent outline-none">
        </div>

        <!-- Steps -->
        <div>
          <div class="flex items-center justify-between mb-2">
            <label class="text-xs text-hq-muted font-semibold">Îã®Í≥Ñ Î™©Î°ù</label>
            <button @click="workflows.editSteps.push({name:'', command:''})"
                    class="text-[10px] px-2 py-1 rounded border border-hq-accent/30 text-hq-accent hover:bg-hq-accent/10 transition">+ Îã®Í≥Ñ Ï∂îÍ∞Ä</button>
          </div>
          <div class="space-y-2">
            <template x-for="(step, idx) in workflows.editSteps" :key="idx">
              <div class="bg-hq-bg rounded-lg p-3">
                <div class="flex items-start gap-2">
                  <div class="text-xs text-hq-muted mt-1.5 font-mono w-6 shrink-0" x-text="(idx+1) + '.'"></div>
                  <div class="flex-1 space-y-1.5">
                    <input x-model="step.name" :placeholder="'Îã®Í≥Ñ ' + (idx+1) + ' Ïù¥Î¶Ñ'"
                           class="w-full bg-hq-panel border border-hq-border rounded px-2 py-1 text-xs text-hq-text focus:border-hq-accent outline-none">
                    <textarea x-model="step.command" :placeholder="idx === 0 ? 'Ïù¥ Îã®Í≥ÑÏóêÏÑú AIÏóêÍ≤å ÏãúÌÇ¨ ÏûëÏóÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî' : 'Ïù¥ Îã®Í≥ÑÏóêÏÑú AIÏóêÍ≤å ÏãúÌÇ¨ ÏûëÏóÖ (ÏïÑÎûò Î≤ÑÌäºÏúºÎ°ú Ïù¥Ï†Ñ Í≤∞Í≥ºÎ•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏûàÏñ¥Ïöî)'" rows="2"
                              :id="'wf-step-cmd-' + idx"
                              class="w-full bg-hq-panel border border-hq-border rounded px-2 py-1 text-xs text-hq-text focus:border-hq-accent outline-none resize-none"></textarea>
                    <!-- Ïù¥Ï†Ñ Í≤∞Í≥º ÏÇΩÏûÖ Î≤ÑÌäº (2Îã®Í≥ÑÎ∂ÄÌÑ∞Îßå ÌëúÏãú) -->
                    <button x-show="idx > 0"
                            @click="(() => { const ta = document.getElementById('wf-step-cmd-' + idx); const pos = ta.selectionStart || step.command.length; step.command = step.command.slice(0, pos) + '{prev_result}' + step.command.slice(pos); $nextTick(() => { ta.focus(); ta.setSelectionRange(pos + 13, pos + 13); }); })()"
                            class="inline-flex items-center gap-1 text-[10px] px-2 py-0.5 rounded border border-hq-cyan/30 text-hq-cyan hover:bg-hq-cyan/10 transition">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/></svg>
                      Ïù¥Ï†Ñ Í≤∞Í≥º ÏÇΩÏûÖ
                    </button>
                  </div>
                  <button @click="workflows.editSteps.splice(idx, 1)"
                          class="text-hq-red/50 hover:text-hq-red text-sm mt-1"
                          x-show="workflows.editSteps.length > 1">&times;</button>
                </div>
                <!-- Îã®Í≥Ñ Í∞Ñ ÌôîÏÇ¥Ìëú -->
                <div x-show="idx < workflows.editSteps.length - 1" class="flex justify-center mt-2 text-hq-muted/30">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3"/></svg>
                </div>
              </div>
            </template>
          </div>
          <div class="text-[10px] text-hq-muted/80 mt-2 bg-hq-panel/50 rounded-lg px-3 py-1.5">
            üí° 2Îã®Í≥ÑÎ∂ÄÌÑ∞ 'Ïù¥Ï†Ñ Í≤∞Í≥º ÏÇΩÏûÖ' Î≤ÑÌäºÏúºÎ°ú Ïïû Îã®Í≥ÑÏùò AI ÎãµÎ≥ÄÏùÑ Í∞ÄÏ†∏Ïò¨ Ïàò ÏûàÏñ¥Ïöî
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3 mt-6">
        <button @click="workflows.showEditor = false"
                class="px-4 py-2 text-sm text-hq-muted hover:text-hq-text transition">Ï∑®ÏÜå</button>
        <button @click="saveWorkflow()"
                class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-5 py-2 text-sm font-semibold transition">Ï†ÄÏû•</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ïã§ÌñâÏ∞Ω Î™®Îã¨ (ÎπÑÌôúÏÑ± ‚Äî Ïπ¥Îìú ÎÇ¥ ÏßÅÏ†ë Ïã§ÌñâÏúºÎ°ú ÎåÄÏ≤¥) ‚ïê‚ïê‚ïê -->
  <div x-show="false"
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       style="display: none !important;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[650px] mx-4 max-h-[85vh] overflow-y-auto p-6" @click.stop>
      <!-- Ìó§Îçî -->
      <div class="flex items-center justify-between mb-5">
        <div>
          <h2 class="text-lg font-bold text-hq-text font-title" x-text="workflowExec.workflowName"></h2>
          <p class="text-xs text-hq-muted mt-0.5">ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ïã§Ìñâ</p>
        </div>
        <button @click="closeWorkflowExec()" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>

      <!-- Î™®Îìú ÏÑ†ÌÉù -->
      <div class="flex items-center gap-3 mb-5 p-3 rounded-xl bg-hq-bg/50 border border-hq-border/30">
        <span class="text-xs text-hq-muted font-semibold">Î™®Îìú:</span>
        <button @click="workflowExec.mode = 'realtime'"
                class="px-3 py-1.5 rounded-lg text-xs font-semibold transition"
                :class="workflowExec.mode === 'realtime' ? 'bg-hq-accent text-white' : 'text-hq-muted hover:text-hq-text border border-hq-border'">
          Ïã§ÏãúÍ∞Ñ
        </button>
        <button @click="workflowExec.mode = 'batch'"
                class="px-3 py-1.5 rounded-lg text-xs font-semibold transition"
                :class="workflowExec.mode === 'batch' ? 'bg-hq-accent text-white' : 'text-hq-muted hover:text-hq-text border border-hq-border'">
          Î∞∞Ïπò
        </button>
        <span class="text-[10px] text-hq-muted/60 ml-1" x-text="workflowExec.mode === 'realtime' ? 'Îã®Í≥ÑÎ≥ÑÎ°ú Í≤∞Í≥ºÎ•º Î∞îÎ°ú Î≥¥Ïó¨Ï§çÎãàÎã§' : 'Ï†ÑÎ∂Ä ÎÅùÎÇòÎ©¥ Í≤∞Í≥ºÎ•º ÌïúÍ∫ºÎ≤àÏóê Î≥¥Ïó¨Ï§çÎãàÎã§'"></span>
      </div>

      <!-- Îã®Í≥ÑÎ≥Ñ ÏßÑÌñâ ÏÉÅÌÉú -->
      <div class="space-y-2 mb-5">
        <template x-for="(step, i) in workflowExec.steps" :key="i">
          <div class="flex items-start gap-3 p-3 rounded-xl transition-all"
               :class="step.status === 'running' ? 'bg-hq-yellow/5 border border-hq-yellow/20' : step.status === 'completed' ? 'bg-hq-green/5 border border-hq-green/20' : step.status === 'failed' ? 'bg-hq-red/5 border border-hq-red/20' : 'bg-hq-bg/30 border border-hq-border/10'">
            <!-- ÏÉÅÌÉú ÏïÑÏù¥ÏΩò -->
            <div class="w-6 h-6 rounded-full flex items-center justify-center shrink-0 text-xs font-bold mt-0.5"
                 :class="step.status === 'running' ? 'bg-hq-yellow/20 text-hq-yellow animate-pulse' : step.status === 'completed' ? 'bg-hq-green/20 text-hq-green' : step.status === 'failed' ? 'bg-hq-red/20 text-hq-red' : 'bg-hq-muted/10 text-hq-muted/50'">
              <span x-show="step.status === 'pending'" x-text="i + 1"></span>
              <span x-show="step.status === 'running'">
                <svg class="w-3.5 h-3.5 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
              </span>
              <span x-show="step.status === 'completed'">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
              </span>
              <span x-show="step.status === 'failed'">!</span>
            </div>
            <!-- Îã®Í≥Ñ Ï†ïÎ≥¥ -->
            <div class="flex-1 min-w-0">
              <div class="text-sm font-semibold" :class="step.status === 'running' ? 'text-hq-yellow' : step.status === 'completed' ? 'text-hq-green' : step.status === 'failed' ? 'text-hq-red' : 'text-hq-muted/60'" x-text="step.name"></div>
              <div x-show="step.command" class="text-[10px] text-hq-muted/50 truncate mt-0.5" x-text="step.command"></div>
              <div x-show="step.result && workflowExec.mode === 'realtime'" class="text-xs text-hq-text/80 mt-2 p-2 rounded-lg bg-hq-bg/50 whitespace-pre-wrap max-h-32 overflow-y-auto" x-html="renderMarkdown(step.result)"></div>
            </div>
          </div>
        </template>
      </div>

      <!-- ÏµúÏ¢Ö Í≤∞Í≥º (Î∞∞Ïπò Î™®Îìú) -->
      <div x-show="workflowExec.done && workflowExec.finalResult" class="mb-5 p-4 rounded-xl bg-hq-green/5 border border-hq-green/20">
        <div class="text-xs font-semibold text-hq-green mb-2">ÏµúÏ¢Ö Í≤∞Í≥º</div>
        <div class="text-sm text-hq-text/80 whitespace-pre-wrap markdown-body max-h-64 overflow-y-auto" x-html="renderMarkdown(workflowExec.finalResult)"></div>
      </div>

      <!-- ÏóêÎü¨ ÌëúÏãú -->
      <div x-show="workflowExec.error" class="mb-5 p-4 rounded-xl bg-hq-red/5 border border-hq-red/20">
        <div class="text-xs font-semibold text-hq-red mb-1">Ïò§Î•ò Î∞úÏÉù</div>
        <div class="text-sm text-hq-red/80" x-text="workflowExec.error"></div>
      </div>

      <!-- ÌïòÎã® Î≤ÑÌäº -->
      <div class="flex items-center justify-end gap-3 pt-3 border-t border-hq-border/20">
        <button @click="closeWorkflowExec()"
                class="px-4 py-2 text-sm text-hq-muted hover:text-hq-text transition">Îã´Í∏∞</button>
        <button @click="executeWorkflow()"
                :disabled="workflowExec.currentStep >= 0 && !workflowExec.done"
                class="bg-hq-green hover:bg-green-600 text-white rounded-lg px-5 py-2 text-sm font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed"
                x-text="workflowExec.currentStep >= 0 && !workflowExec.done ? 'Ïã§Ìñâ Ï§ë...' : workflowExec.done ? 'Îã§Ïãú Ïã§Ìñâ' : 'Ïã§Ìñâ'"></button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Login Overlay (Î°úÍ∑∏Ïù∏ Ïò§Î≤ÑÎ†àÏù¥) ‚ïê‚ïê‚ïê -->
  <div x-show="auth.showLogin" x-transition.opacity
       class="fixed inset-0 z-[60] flex items-center justify-center bg-hq-bg/95"
       style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[400px] mx-4 p-8">
      <div class="text-center mb-6">
        <div class="text-2xl font-bold gradient-text mb-2 font-mono tracking-normal">CYBER COMMAND</div>
        <p class="text-sm text-hq-muted">[ ACCESS RESTRICTED ] Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§</p>
      </div>

      <div class="space-y-4">
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
          <input x-model="auth.loginPass" type="password" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2.5 text-sm text-hq-text focus:border-hq-accent outline-none"
                 @keydown.enter="doLogin()">
          <p class="text-[10px] text-hq-muted/60 mt-1">Í∏∞Î≥∏ ÎπÑÎ∞ÄÎ≤àÌò∏: corthex2026</p>
        </div>
      </div>

      <div x-show="auth.loginError" class="mt-3 text-xs text-hq-red" x-text="auth.loginError"></div>

      <div class="flex flex-col gap-2 mt-6">
        <button @click="doLogin()"
                class="bg-hq-green/20 hover:bg-hq-green/30 text-hq-green border border-hq-green/40 rounded-lg px-5 py-2.5 text-sm font-semibold font-mono tracking-wide transition w-full">ACCESS</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Quality Gate Settings Modal ‚ïê‚ïê‚ïê -->
  <div x-show="showQualitySettings" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="showQualitySettings = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[720px] mx-4 max-h-[85vh] flex flex-col"
         @click.stop>

      <!-- Sticky Header -->
      <div class="flex items-center justify-between p-5 pb-4 border-b border-hq-border/50 shrink-0">
        <div class="flex items-center gap-3">
          <span class="inline-flex items-center justify-center w-9 h-9 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 text-white text-xs font-bold shadow-lg shadow-blue-500/20">QA</span>
          <div>
            <h2 class="text-base font-bold text-hq-text">ÌíàÏßà Í≤ÄÏàò ÏÑ§Ï†ï</h2>
            <p class="text-[11px] text-hq-muted/70">Îß§ÎãàÏ†ÄÍ∏â ÏóêÏù¥Ï†ÑÌä∏Í∞Ä Î≥¥Í≥†ÏÑúÎ•º Í≤ÄÏàòÌï† Îïå Ï†ÅÏö©ÎêòÎäî Í∏∞Ï§Ä</p>
          </div>
        </div>
        <button @click="showQualitySettings = false" class="text-hq-muted hover:text-hq-text w-8 h-8 flex items-center justify-center rounded-lg hover:bg-hq-surface transition">&times;</button>
      </div>

      <!-- Scrollable Content -->
      <div class="overflow-y-auto flex-1 p-5 space-y-5">

        <!-- Section 1: Review Model (ÏûêÍ∏∞ Î™®Îç∏ ÏÇ¨Ïö©) -->
        <div class="p-4 bg-hq-bg rounded-xl border border-hq-border/30">
          <div class="flex items-center gap-2 mb-3">
            <span class="text-sm">ü§ñ</span>
            <h3 class="text-sm font-semibold text-hq-text">Í≤ÄÏàò Î™®Îç∏</h3>
            <span class="text-[10px] px-1.5 py-0.5 rounded bg-hq-green/10 text-hq-green">ÏûêÎèô</span>
          </div>
          <p class="text-xs text-hq-muted/70 mb-2">Í∞Å Îß§ÎãàÏ†ÄÍ∞Ä ÏûêÍ∏∞ Î™®Îç∏Î°ú ÏßÅÏ†ë Í≤ÄÏàòÌï©ÎãàÎã§. Î≥ÑÎèÑ ÏÑ§Ï†ï Î∂àÌïÑÏöî.</p>
          <div class="text-xs text-hq-muted/50 space-y-1">
            <div>ÎπÑÏÑúÏã§Ïû•: Claude Sonnet 4.6 | ÏÇ¨ÏóÖÍ∏∞ÌöçÌåÄÏû•: Claude Sonnet 4.6</div>
            <div>Î≤ïÎ¨¥ÌåÄÏû•: Claude Sonnet 4.6 | ÎßàÏºÄÌåÖÌåÄÏû•: Claude Sonnet 4.6</div>
            <div>Í∏àÏúµÎ∂ÑÏÑùÌåÄÏû•: GPT-5.2 | ÏΩòÌÖêÏ∏†ÌåÄÏû•: Claude Sonnet 4.6</div>
          </div>
        </div>

        <!-- Section 2: Common Rubric -->
        <!-- Section 2: Common Checklist (Í≥µÌÜµ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏) -->
        <div class="p-4 bg-hq-bg rounded-xl border border-hq-border/30" x-show="qualityRules.common_checklist">
          <div class="flex items-center gap-2 mb-3">
            <span class="text-sm">&#10003;</span>
            <h3 class="text-sm font-semibold text-hq-text">Í≥µÌÜµ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</h3>
            <span class="text-[10px] px-1.5 py-0.5 rounded bg-hq-green/10 text-hq-green">Î™®Îì† Î∂ÄÏÑú</span>
          </div>
          <p class="text-xs text-hq-muted/70 mb-2">Î™®Îì† Í≤ÄÏàòÏóê ÏûêÎèô Ï†ÅÏö©ÎêòÎäî Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ÏûÖÎãàÎã§.</p>
          <div class="space-y-1">
            <template x-for="item in (qualityRules.common_checklist?.required || [])" :key="item.id">
              <div class="flex items-center gap-2 text-xs">
                <span class="font-mono text-hq-accent w-6" x-text="item.id"></span>
                <span class="text-[10px] px-1 rounded bg-hq-red/10 text-hq-red">ÌïÑÏàò</span>
                <span class="text-hq-text" x-text="item.label"></span>
              </div>
            </template>
            <template x-for="item in (qualityRules.common_checklist?.optional || [])" :key="item.id">
              <div class="flex items-center gap-2 text-xs">
                <span class="font-mono text-hq-accent w-6" x-text="item.id"></span>
                <span class="text-[10px] px-1 rounded bg-hq-muted/10 text-hq-muted">ÏÑ†ÌÉù</span>
                <span class="text-hq-text" x-text="item.label"></span>
              </div>
            </template>
          </div>
          <div class="mt-2 text-[10px] text-hq-muted/50" x-show="qualityRules.pass_criteria">
            Ìï©Í≤© Í∏∞Ï§Ä: ÌïÑÏàò Ìï≠Î™© Ï†ÑÎ∂Ä ÌÜµÍ≥º + Í∞ÄÏ§ë ÌèâÍ∑† <span x-text="qualityRules.pass_criteria?.min_average_score || 3.0"></span> Ïù¥ÏÉÅ
          </div>
        </div>

        <!-- Section 3: Default Rubric -->
        <div>
          <div class="flex items-center gap-2 mb-3">
            <span class="text-sm">üìã</span>
            <h3 class="text-sm font-semibold text-hq-text">Í∏∞Î≥∏ Ï†êÏàò Í∏∞Ï§Ä</h3>
            <span class="text-[10px] px-1.5 py-0.5 rounded bg-hq-muted/10 text-hq-muted">Í∏∞Î≥∏Í∞í</span>
          </div>
          <p class="text-xs text-hq-muted/70 mb-3">Î∂ÄÏÑúÎ≥Ñ Í∏∞Ï§ÄÏù¥ ÏóÜÎäî Î∂ÄÏÑúÏóê Í∏∞Î≥∏ Ï†ÅÏö©ÎêòÎäî Ï†êÏàò Í∏∞Ï§ÄÏûÖÎãàÎã§.</p>

          <div class="p-4 bg-hq-bg rounded-xl border border-hq-border/30 hover:border-hq-border/60 transition cursor-pointer"
               @click="editingRubric === 'default' ? (editingRubric = null) : startEditRubric('default')">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="text-sm font-medium text-hq-text">Í∏∞Î≥∏ (Ï†ÑÏ≤¥ Í≥µÌÜµ)</span>
                <span x-show="qualityRules.rubrics && qualityRules.rubrics['default']"
                      class="text-[10px] px-1.5 py-0.5 rounded-full bg-hq-green/10 text-hq-green font-medium">ÏÑ§Ï†ïÎê®</span>
              </div>
              <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="editingRubric === 'default' ? 'rotate-90' : ''">&#9654;</span>
            </div>
            <template x-if="qualityRules.rubrics && qualityRules.rubrics['default'] && editingRubric !== 'default'">
              <div class="mt-2 text-xs text-hq-muted/60 space-y-0.5">
                <template x-for="s in (qualityRules.rubrics['default'].scoring || []).slice(0, 3)" :key="s.id">
                  <span class="inline-block mr-2" x-text="s.label + ' (' + s.weight + '%)'"></span>
                </template>
              </div>
            </template>
          </div>
          <!-- Inline Editor (ÏùΩÍ∏∞ Ï†ÑÏö© ‚Äî YAMLÏóêÏÑú ÏßÅÏ†ë Ìé∏Ïßë) -->
          <div x-show="editingRubric === 'default'" x-collapse class="mt-2 p-4 bg-hq-bg rounded-xl border border-hq-accent/30">
            <p class="text-xs text-hq-muted/70 mb-3">ÌïòÏù¥Î∏åÎ¶¨Îìú Î£®Î∏åÎ¶≠ÏùÄ config/quality_rules.yamlÏóêÏÑú Ìé∏ÏßëÌï©ÎãàÎã§.</p>
            <template x-if="qualityRules.rubrics?.['default']?.scoring">
              <div class="space-y-3">
                <template x-for="s in qualityRules.rubrics['default'].scoring" :key="s.id">
                  <div class="bg-hq-surface/30 rounded-lg p-2.5">
                    <div class="flex items-center gap-2 text-xs mb-1.5">
                      <span class="font-mono text-hq-accent w-6" x-text="s.id"></span>
                      <span class="text-hq-text font-medium flex-1" x-text="s.label"></span>
                      <template x-if="s.critical"><span class="text-[9px] px-1 py-0.5 rounded bg-hq-red/20 text-hq-red">‚òÖÏπòÎ™ÖÏ†Å</span></template>
                      <span class="text-hq-muted text-[10px]" x-text="s.weight + '%'"></span>
                    </div>
                    <template x-if="s.criteria">
                      <div class="space-y-1 ml-8">
                        <div class="flex gap-2 text-[10px]"><span class="text-hq-red shrink-0 w-5">1Ï†ê</span><span class="text-hq-muted/70" x-text="s.criteria[1] || s.criteria['1'] || '-'"></span></div>
                        <div class="flex gap-2 text-[10px]"><span class="text-hq-yellow shrink-0 w-5">3Ï†ê</span><span class="text-hq-muted/70" x-text="s.criteria[3] || s.criteria['3'] || '-'"></span></div>
                        <div class="flex gap-2 text-[10px]"><span class="text-hq-green shrink-0 w-5">5Ï†ê</span><span class="text-hq-muted/70" x-text="s.criteria[5] || s.criteria['5'] || '-'"></span></div>
                      </div>
                    </template>
                  </div>
                </template>
              </div>
            </template>
            <div class="flex items-center gap-2 mt-3">
              <button @click.stop="editingRubric = null" class="bg-hq-surface hover:bg-hq-panel text-hq-text rounded-lg px-4 py-1.5 text-xs transition">Îã´Í∏∞</button>
            </div>
          </div>
        </div>

        <!-- Section 3: Department-Specific Rubrics -->
        <div>
          <div class="flex items-center gap-2 mb-3">
            <span class="text-sm">üè¢</span>
            <h3 class="text-sm font-semibold text-hq-text">Î∂ÄÏÑúÎ≥Ñ Í≤ÄÏàò Í∏∞Ï§Ä</h3>
            <span class="text-[10px] px-1.5 py-0.5 rounded bg-hq-accent/10 text-hq-accent"
                  x-text="(qualityRules.known_divisions || []).length + 'Í∞ú Î∂ÄÏÑú'"></span>
          </div>
          <p class="text-xs text-hq-muted/70 mb-3">Í∞Å Î∂ÄÏÑúÏùò Ïπ¥ÎìúÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ Ï†ÑÏö© Í≤ÄÏàò Í∏∞Ï§ÄÏùÑ ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>

          <div class="grid grid-cols-1 gap-2">
            <template x-for="div in (qualityRules.known_divisions || [])" :key="div">
              <div>
                <!-- Department Card -->
                <div class="p-3.5 bg-hq-bg rounded-xl border border-hq-border/30 hover:border-hq-border/60 transition cursor-pointer group"
                     :class="editingRubric === div ? 'border-hq-accent/40' : ''"
                     @click="editingRubric === div ? (editingRubric = null) : startEditRubric(div)">
                  <div class="flex items-center gap-3">
                    <span class="text-lg w-8 h-8 flex items-center justify-center rounded-lg shrink-0"
                          :class="'bg-gradient-to-br ' + getDivisionStyle(div).bg"
                          x-text="getDivisionStyle(div).icon"></span>
                    <div class="flex-1 min-w-0">
                      <div class="flex items-center gap-2">
                        <span class="text-sm text-hq-text font-medium" x-text="getDivisionLabel(div)"></span>
                        <span x-show="qualityRules.rubrics && qualityRules.rubrics[div]"
                              class="text-[10px] px-1.5 py-0.5 rounded-full bg-hq-green/10 text-hq-green font-medium shrink-0">ÏÑ§Ï†ïÎê®</span>
                        <span x-show="!qualityRules.rubrics || !qualityRules.rubrics[div]"
                              class="text-[10px] px-1.5 py-0.5 rounded-full bg-hq-muted/10 text-hq-muted shrink-0">Í≥µÌÜµ Ï†ÅÏö©</span>
                      </div>
                      <template x-if="qualityRules.rubrics && qualityRules.rubrics[div] && editingRubric !== div">
                        <div class="text-xs text-hq-muted/60 mt-0.5 flex flex-wrap gap-1">
                          <template x-for="s in (qualityRules.rubrics[div].scoring || []).slice(0, 3)" :key="s.id">
                            <span x-text="s.label + '(' + s.weight + '%)'"></span>
                          </template>
                        </div>
                      </template>
                      <template x-if="(!qualityRules.rubrics || !qualityRules.rubrics[div]) && editingRubric !== div">
                        <p class="text-xs text-hq-muted/40 mt-0.5">Í≥µÌÜµ Í∏∞Ï§Ä Ï†ÅÏö© Ï§ë</p>
                      </template>
                    </div>
                    <span class="text-[10px] text-hq-muted/50 group-hover:text-hq-muted transition-transform duration-200 shrink-0" :class="editingRubric === div ? 'rotate-90' : ''">&#9654;</span>
                  </div>
                </div>
                <!-- Inline Viewer (ÏùΩÍ∏∞ Ï†ÑÏö© ‚Äî YAMLÏóêÏÑú ÏßÅÏ†ë Ìé∏Ïßë) -->
                <div x-show="editingRubric === div" x-collapse class="mt-1 p-4 bg-hq-bg rounded-xl border border-hq-accent/30">
                  <p class="text-xs text-hq-muted/70 mb-3">config/quality_rules.yamlÏóêÏÑú Ìé∏ÏßëÌï©ÎãàÎã§.</p>
                  <!-- Î∂ÄÏÑú Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ -->
                  <template x-if="qualityRules.rubrics?.[div]?.department_checklist">
                    <div class="mb-3">
                      <div class="text-[10px] text-hq-muted font-semibold mb-1">Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</div>
                      <template x-for="item in [...(qualityRules.rubrics[div].department_checklist.required || []), ...(qualityRules.rubrics[div].department_checklist.optional || [])]" :key="item.id">
                        <div class="flex items-center gap-2 text-xs py-0.5">
                          <span class="font-mono text-hq-accent w-6" x-text="item.id"></span>
                          <span class="text-hq-text" x-text="item.label"></span>
                        </div>
                      </template>
                    </div>
                  </template>
                  <!-- Ï†êÏàò Ìï≠Î™© (1/3/5 ÏÉÅÏÑ∏ Í∏∞Ï§Ä Ìè¨Ìï®) -->
                  <template x-if="qualityRules.rubrics?.[div]?.scoring">
                    <div class="mb-3">
                      <div class="text-[10px] text-hq-muted font-semibold mb-2">Ï†êÏàò Ìï≠Î™© (1/3/5)</div>
                      <div class="space-y-2.5">
                        <template x-for="s in qualityRules.rubrics[div].scoring" :key="s.id">
                          <div class="bg-hq-surface/30 rounded-lg p-2.5">
                            <div class="flex items-center gap-2 text-xs mb-1.5">
                              <span class="font-mono text-hq-accent w-6" x-text="s.id"></span>
                              <span class="text-hq-text font-medium flex-1" x-text="s.label"></span>
                              <template x-if="s.critical"><span class="text-[9px] px-1 py-0.5 rounded bg-hq-red/20 text-hq-red">‚òÖÏπòÎ™ÖÏ†Å</span></template>
                              <span class="text-hq-muted text-[10px]" x-text="s.weight + '%'"></span>
                            </div>
                            <template x-if="s.criteria">
                              <div class="space-y-1 ml-8">
                                <div class="flex gap-2 text-[10px]"><span class="text-hq-red shrink-0 w-5">1Ï†ê</span><span class="text-hq-muted/70" x-text="s.criteria[1] || s.criteria['1'] || '-'"></span></div>
                                <div class="flex gap-2 text-[10px]"><span class="text-hq-yellow shrink-0 w-5">3Ï†ê</span><span class="text-hq-muted/70" x-text="s.criteria[3] || s.criteria['3'] || '-'"></span></div>
                                <div class="flex gap-2 text-[10px]"><span class="text-hq-green shrink-0 w-5">5Ï†ê</span><span class="text-hq-muted/70" x-text="s.criteria[5] || s.criteria['5'] || '-'"></span></div>
                              </div>
                            </template>
                          </div>
                        </template>
                      </div>
                    </div>
                  </template>
                  <div class="flex items-center gap-2">
                    <button @click.stop="editingRubric = null" class="bg-hq-surface hover:bg-hq-panel text-hq-text rounded-lg px-4 py-1.5 text-xs transition">Îã´Í∏∞</button>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>

      </div>

      <!-- Sticky Footer -->
      <div class="p-3 border-t border-hq-border/30 text-center shrink-0">
        <span x-show="qualitySaveStatus === 'saving'" class="text-xs text-hq-yellow animate-pulse">Ï†ÄÏû• Ï§ë...</span>
        <span x-show="qualitySaveStatus === 'saved'" class="text-xs text-hq-green">Ï†ÄÏû• ÏôÑÎ£å</span>
        <span x-show="qualitySaveStatus === 'error'" class="text-xs text-hq-red">Ï†ÄÏû• Ïã§Ìå®</span>
        <span x-show="!qualitySaveStatus" class="text-xs text-hq-muted/40">Î≥ÄÍ≤ΩÏÇ¨Ìï≠ÏùÄ ÏÑúÎ≤ÑÏóê ÏûêÎèô ÎèôÍ∏∞ÌôîÎê©ÎãàÎã§</span>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Agent Config Modal (ÏóêÏù¥Ï†ÑÌä∏ ÏÑ§Ï†ï) ‚ïê‚ïê‚ïê -->
  <div x-show="showAgentConfig" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="showAgentConfig = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[600px] mx-4 max-h-[85vh] overflow-y-auto p-6"
         @click.stop>

      <!-- Loading -->
      <div x-show="agentConfigLoading" class="flex items-center justify-center py-12">
        <svg class="animate-spin w-6 h-6 text-hq-accent" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
        </svg>
      </div>

      <!-- Content -->
      <div x-show="!agentConfigLoading && agentConfigData">
        <!-- Header -->
        <div class="flex items-center justify-between mb-5">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-sm font-bold"
                 :class="getAgentAvatarClass(agentConfigId)"
                 x-text="getAgentInitials(agentConfigId)"></div>
            <div>
              <h2 class="text-lg font-bold text-hq-text" x-text="agentConfigData?.name_ko || agentConfigData?.name || agentConfigId"></h2>
              <div class="text-xs text-hq-muted" x-text="(agentConfigData?.role || '') + ' ¬∑ ' + (agentConfigData?.division || '')"></div>
            </div>
          </div>
          <button @click="showAgentConfig = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
        </div>

        <!-- Tabs (Î™®Î∞îÏùº: Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§) -->
        <div class="flex gap-1 mb-5 bg-hq-bg rounded-xl p-1 overflow-x-auto scrollbar-thin">
          <button @click="agentConfigTab = 'info'"
                  :class="agentConfigTab === 'info' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-2 sm:px-3 py-2 text-[11px] sm:text-xs font-semibold rounded-lg transition-colors whitespace-nowrap shrink-0">Í∏∞Î≥∏ Ï†ïÎ≥¥</button>
          <button @click="agentConfigTab = 'model'"
                  :class="agentConfigTab === 'model' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-2 sm:px-3 py-2 text-[11px] sm:text-xs font-semibold rounded-lg transition-colors whitespace-nowrap shrink-0">Î™®Îç∏</button>
          <button @click="agentConfigTab = 'reasoning'"
                  :class="agentConfigTab === 'reasoning' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-2 sm:px-3 py-2 text-[11px] sm:text-xs font-semibold rounded-lg transition-colors whitespace-nowrap shrink-0">Ï∂îÎ°†</button>
          <button @click="agentConfigTab = 'soul'"
                  :class="agentConfigTab === 'soul' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-2 sm:px-3 py-2 text-[11px] sm:text-xs font-semibold rounded-lg transition-colors whitespace-nowrap shrink-0">ÏÜåÏö∏</button>
          <button @click="agentConfigTab = 'skills'"
                  :class="agentConfigTab === 'skills' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-2 sm:px-3 py-2 text-[11px] sm:text-xs font-semibold rounded-lg transition-colors whitespace-nowrap shrink-0">Ïä§ÌÇ¨</button>
        </div>

        <!-- Tab: Info -->
        <div x-show="agentConfigTab === 'info'">
          <div class="bg-hq-bg rounded-xl p-4 space-y-3">
            <div class="flex justify-between"><span class="text-sm text-hq-muted">ÏóêÏù¥Ï†ÑÌä∏ ID</span><span class="text-xs font-mono text-hq-text" x-text="agentConfigId"></span></div>
            <div class="flex justify-between"><span class="text-sm text-hq-muted">Ïù¥Î¶Ñ (ÌïúÍµ≠Ïñ¥)</span><span class="text-sm text-hq-text" x-text="agentConfigData?.name_ko || '-'"></span></div>
            <div class="flex justify-between"><span class="text-sm text-hq-muted">Ïó≠Ìï†</span><span class="text-sm text-hq-text" x-text="agentConfigData?.role || '-'"></span></div>
            <div class="flex justify-between"><span class="text-sm text-hq-muted">Î∂ÄÏÑú</span><span class="text-sm text-hq-text" x-text="agentConfigData?.division || '-'"></span></div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-hq-muted">ÌòÑÏû¨ Î™®Îç∏</span>
              <span class="text-xs font-mono text-hq-cyan font-semibold"
                    x-text="getModelDisplayName(agentConfigData?.model_name) + (agentConfigData?.reasoning_effort ? ' (' + agentConfigData.reasoning_effort + ')' : '')"></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-hq-muted">Ï∂îÎ°† Ï†ïÎèÑ</span>
              <span class="text-sm font-semibold"
                    :class="({'none':'text-hq-muted','minimal':'text-hq-cyan','low':'text-hq-green','medium':'text-hq-yellow','high':'text-hq-purple','xhigh':'text-hq-red'})[agentConfigData?.reasoning_effort] || 'text-hq-text'"
                    x-text="agentConfigData?.reasoning_effort ? (({'none':'‚õî none','minimal':'üí® minimal','low':'‚ö° low','medium':'üß† medium','high':'üî¨ high','xhigh':'üî• xhigh'})[agentConfigData.reasoning_effort] || agentConfigData.reasoning_effort) : 'default'"></span>
            </div>
            <div x-show="agentConfigData?.capabilities?.length > 0">
              <span class="text-sm text-hq-muted block mb-1">Îä•Î†•Ïπò</span>
              <div class="flex flex-wrap gap-1">
                <template x-for="cap in (agentConfigData?.capabilities || [])" :key="cap">
                  <span class="text-[10px] bg-hq-accent/10 text-hq-accent border border-hq-accent/20 rounded-md px-2 py-0.5" x-text="cap"></span>
                </template>
              </div>
            </div>
            <!-- ÏÉÅÍ¥Ä -->
            <div x-show="agentConfigData?.superior_id">
              <span class="text-sm text-hq-muted block mb-1">ÏÉÅÍ¥Ä</span>
              <div @click="openAgentConfig(agentConfigData?.superior_id)" class="inline-flex items-center gap-2 bg-hq-purple/10 border border-hq-purple/20 rounded-lg px-3 py-1.5 cursor-pointer hover:bg-hq-purple/20 transition">
                <div class="w-5 h-5 rounded-md flex items-center justify-center text-[8px] font-bold" :class="getAgentAvatarClass(agentConfigData?.superior_id)" x-text="getAgentInitials(agentConfigData?.superior_id)"></div>
                <span class="text-xs text-hq-text" x-text="getAgentName(agentConfigData?.superior_id)"></span>
              </div>
            </div>
            <!-- Î∂ÄÌïòÏßÅÏõê -->
            <div x-show="agentConfigData?.subordinate_ids?.length > 0">
              <span class="text-sm text-hq-muted block mb-1">Î∂ÄÌïòÏßÅÏõê</span>
              <div class="flex flex-wrap gap-1.5">
                <template x-for="subId in (agentConfigData?.subordinate_ids || [])" :key="subId">
                  <div @click="openAgentConfig(subId)" class="inline-flex items-center gap-2 bg-hq-cyan/10 border border-hq-cyan/20 rounded-lg px-3 py-1.5 cursor-pointer hover:bg-hq-cyan/20 transition">
                    <div class="w-5 h-5 rounded-md flex items-center justify-center text-[8px] font-bold" :class="getAgentAvatarClass(subId)" x-text="getAgentInitials(subId)"></div>
                    <span class="text-xs text-hq-text" x-text="getAgentName(subId)"></span>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Model -->
        <div x-show="agentConfigTab === 'model'">
          <div class="bg-hq-bg rounded-xl p-4">
            <label class="text-xs text-hq-muted block mb-2">AI Î™®Îç∏ ÏÑ†ÌÉù</label>
            <p class="text-[11px] text-hq-muted/70 mb-3">Ïù¥ ÏóêÏù¥Ï†ÑÌä∏Í∞Ä ÏÇ¨Ïö©Ìï† AI Î™®Îç∏ÏùÑ Î≥ÄÍ≤ΩÌï©ÎãàÎã§. Î≥ÄÍ≤Ω Ï¶âÏãú Ï†ÅÏö©Îê©ÎãàÎã§.</p>
            <select x-model="agentModelSelection"
                    class="w-full bg-hq-panel border border-hq-border rounded-lg px-3 py-2.5 text-sm text-hq-text mb-3">
              <template x-for="[provLabel, models] in Object.entries(getModelsByProvider())" :key="provLabel">
                <optgroup :label="provLabel">
                  <template x-for="m in models" :key="m.name">
                    <option :value="m.name" x-text="getModelDisplayName(m.name) + ' ($' + (m.cost_input ?? 0) + '/' + (m.cost_output ?? 0) + ')'"></option>
                  </template>
                </optgroup>
              </template>
            </select>
            <div class="flex items-center gap-2">
              <button @click="saveAgentModel()"
                      class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm transition-colors">Î™®Îç∏ Î≥ÄÍ≤Ω</button>
              <span class="text-xs text-hq-muted" x-show="agentModelSelection !== agentConfigData?.model_name">
                ÌòÑÏû¨: <span class="font-mono text-hq-cyan" x-text="agentConfigData?.model_name"></span>
              </span>
            </div>
          </div>
        </div>

        <!-- Tab: Reasoning -->
        <div x-show="agentConfigTab === 'reasoning'">
          <div class="bg-hq-bg rounded-xl p-4">
            <label class="text-xs text-hq-muted block mb-2">Ï∂îÎ°† Ï†ïÎèÑ (Reasoning Effort)</label>
            <p class="text-[11px] text-hq-muted/70 mb-4">ÏóêÏù¥Ï†ÑÌä∏Í∞Ä ÎãµÎ≥ÄÌï† Îïå ÏñºÎßàÎÇò ÍπäÏù¥ ÏÉùÍ∞ÅÌï†ÏßÄ Í≤∞Ï†ïÌï©ÎãàÎã§. ÎÜíÏùÑÏàòÎ°ù Ï†ïÌôïÌïòÏßÄÎßå ÎäêÎ¶¨Í≥† ÎπÑÏö©Ïù¥ Îçî Îì≠ÎãàÎã§.</p>

            <!-- Ï∂îÎ°† ÎØ∏ÏßÄÏõê Î™®Îç∏ -->
            <template x-if="agentReasoningOptions.length === 0">
              <div class="text-center py-6">
                <div class="text-3xl mb-2">üö´</div>
                <p class="text-sm text-hq-muted">Ïù¥ Î™®Îç∏ÏùÄ Ï∂îÎ°† Ï†ïÎèÑ ÏÑ§Ï†ïÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.</p>
                <p class="text-[11px] text-hq-muted/85 mt-1">Ï∂îÎ°†ÏùÑ ÏßÄÏõêÌïòÎäî Î™®Îç∏Î°ú Î≥ÄÍ≤ΩÌïòÎ©¥ ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
              </div>
            </template>

            <!-- Ï∂îÎ°† ÏßÄÏõê Î™®Îç∏: ÎèôÏ†Å Î≤ÑÌäº -->
            <template x-if="agentReasoningOptions.length > 0">
              <div>
                <div class="grid gap-3 mb-3" :class="agentReasoningOptions.length <= 3 ? 'grid-cols-3' : (agentReasoningOptions.length <= 4 ? 'grid-cols-2 sm:grid-cols-4' : 'grid-cols-2 sm:grid-cols-3')">
                  <template x-for="level in agentReasoningOptions" :key="level">
                    <button @click="agentReasoningSelection = level"
                            :class="agentReasoningSelection === level
                              ? (level === 'none' ? 'border-hq-muted bg-hq-muted/10 text-hq-muted'
                                : level === 'minimal' ? 'border-hq-cyan bg-hq-cyan/10 text-hq-cyan'
                                : level === 'low' ? 'border-hq-green bg-hq-green/10 text-hq-green'
                                : level === 'medium' ? 'border-hq-yellow bg-hq-yellow/10 text-hq-yellow'
                                : level === 'high' ? 'border-hq-purple bg-hq-purple/10 text-hq-purple'
                                : 'border-hq-red bg-hq-red/10 text-hq-red')
                              : 'border-hq-border text-hq-muted hover:text-hq-text'"
                            class="border-2 rounded-xl p-4 text-center transition-all">
                      <div class="text-2xl mb-1" x-text="({none:'‚õî',minimal:'üí®',low:'‚ö°',medium:'üß†',high:'üî¨',xhigh:'üî•'})[level] || '‚ùì'"></div>
                      <div class="text-sm font-bold font-mono" x-text="level"></div>
                      <div class="text-[10px] mt-1" x-text="({none:'Ï∂îÎ°† ÎπÑÌôúÏÑ±Ìôî',minimal:'ÏïÑÏ£º Îπ†Î¶Ñ',low:'Îπ†Î•¥Í≥† Ï†ÄÎ†¥',medium:'Í∑†ÌòïÏû°Ìûå ÏÑ±Îä•',high:'Ï†ïÌôïÌïòÏßÄÎßå ÎäêÎ¶º',xhigh:'ÏµúÎåÄ ÍπäÏù¥'})[level] || ''"></div>
                    </button>
                  </template>
                </div>
                <div class="flex items-center gap-2">
                  <button @click="saveAgentReasoning()"
                          class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm transition-colors">Ï∂îÎ°† Ï†ïÎèÑ Î≥ÄÍ≤Ω</button>
                  <button @click="agentReasoningSelection = ''; saveAgentReasoning()"
                          class="border border-hq-border hover:border-hq-muted text-hq-muted hover:text-hq-text rounded-lg px-4 py-2 text-sm transition-colors">Ï¥àÍ∏∞Ìôî (Í∏∞Î≥∏Í∞í)</button>
                </div>
              </div>
            </template>
          </div>
        </div>

        <!-- Tab: Soul (ÏùΩÍ∏∞ Ï†ÑÏö©) -->
        <div x-show="agentConfigTab === 'soul'">
          <div class="bg-hq-bg rounded-xl p-4">
            <div class="flex items-center justify-between mb-1">
              <div class="flex items-center gap-2">
                <span class="text-base">üß†</span>
                <label class="text-xs font-semibold text-hq-text">ÏãúÏä§ÌÖú ÌîÑÎ°¨ÌîÑÌä∏</label>
              </div>
              <span class="text-[9px] px-2.5 py-1 rounded-full font-medium"
                    style="background: linear-gradient(135deg, rgba(var(--hq-cyan),0.15), rgba(var(--hq-accent),0.10)); color: rgb(var(--hq-cyan)); border: 1px solid rgba(var(--hq-cyan),0.2);">
                üîí ÏΩîÎìú Í¥ÄÎ¶¨ Ï†ÑÏö©
              </span>
            </div>
            <p class="text-[11px] text-hq-muted/60 mb-3">ÏóêÏù¥Ï†ÑÌä∏Ïùò ÏÑ±Í≤©Í≥º ÌñâÎèô Î∞©ÏãùÏùÑ Í≤∞Ï†ïÌï©ÎãàÎã§. ÏÑ§Ï†ï ÌååÏùº(<code class="text-hq-cyan/70">agents.yaml</code>)ÏóêÏÑúÎßå ÏàòÏ†ï Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
            <div class="relative">
              <div class="w-full rounded-xl border border-hq-border/30 px-5 py-4 text-[13px] text-hq-text/85 overflow-y-auto whitespace-pre-wrap"
                   style="font-family: 'Pretendard Variable', 'Pretendard', sans-serif; line-height: 1.9; background: linear-gradient(135deg, rgba(var(--hq-panel),0.3), rgba(var(--hq-panel),0.5)); letter-spacing:0.01em; max-height: 420px; scrollbar-width: thin; scrollbar-color: rgba(var(--hq-cyan),0.2) transparent;"
                   x-text="agentSoulText || '(ÌîÑÎ°¨ÌîÑÌä∏ ÏóÜÏùå)'"></div>
            </div>
            <div class="flex items-center justify-between mt-3">
              <span class="text-[10px] text-hq-muted/60" x-text="agentSoulText.length + 'Ïûê'"></span>
              <span class="text-[10px] text-hq-muted/40 italic">config/agents.yaml ÏóêÏÑú ÏàòÏ†ïÌïòÏÑ∏Ïöî</span>
            </div>
          </div>
        </div>

        <!-- Tab: Skills -->
        <div x-show="agentConfigTab === 'skills'">
          <div class="bg-hq-bg rounded-xl p-4">
            <label class="text-xs text-hq-muted block mb-2">ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÎèÑÍµ¨ (Ïä§ÌÇ¨)</label>
            <p class="text-[11px] text-hq-muted/70 mb-4">Ïù¥ ÏóêÏù¥Ï†ÑÌä∏Í∞Ä ÏûëÏóÖÌï† Îïå Ïì∏ Ïàò ÏûàÎäî ÎèÑÍµ¨ Î™©Î°ùÏûÖÎãàÎã§.</p>
            <template x-if="(agentConfigData?.allowed_tools || []).length === 0">
              <div class="text-center py-8">
                <div class="text-3xl mb-2">üö´</div>
                <p class="text-sm text-hq-muted">Ïù¥ ÏóêÏù¥Ï†ÑÌä∏Îäî ÎèÑÍµ¨Î•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏäµÎãàÎã§.</p>
                <p class="text-[11px] text-hq-muted/85 mt-1">ÏàúÏàò Î∂ÑÏÑù¬∑ÏöîÏïΩ Ï†ÑÎ¨∏ ÏóêÏù¥Ï†ÑÌä∏ÏûÖÎãàÎã§.</p>
              </div>
            </template>
            <template x-if="(agentConfigData?.allowed_tools || []).length > 0">
              <div class="grid grid-cols-2 gap-2">
                <template x-for="tool in (agentConfigData?.allowed_tools || [])" :key="tool">
                  <div class="bg-hq-panel border border-hq-border/50 rounded-lg p-3 flex items-center gap-2.5">
                    <div class="w-7 h-7 rounded-md bg-hq-accent/10 flex items-center justify-center text-sm shrink-0">üîß</div>
                    <div class="min-w-0">
                      <div class="text-xs font-semibold text-hq-text truncate" x-text="getToolDisplayName(tool)"></div>
                      <div class="text-[10px] text-hq-muted truncate" x-text="getToolDescription(tool)"></div>
                    </div>
                  </div>
                </template>
              </div>
            </template>
          </div>
        </div>

        <!-- Save status -->
        <div class="mt-4 text-center h-5">
          <span x-show="agentConfigSaveStatus === 'saving'" class="text-xs text-hq-yellow">Ï†ÄÏû• Ï§ë...</span>
          <span x-show="agentConfigSaveStatus === 'saved'" class="text-xs text-hq-green">Ï†ÄÏû• ÏôÑÎ£å</span>
          <span x-show="agentConfigSaveStatus === 'error'" class="text-xs text-hq-red">Ï†ÄÏû• Ïã§Ìå®</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Task Detail Modal (ÏûëÏóÖ ÏÉÅÏÑ∏) ‚ïê‚ïê‚ïê -->
  <div x-show="showTaskDetail" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="showTaskDetail = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[800px] mx-4 max-h-[85vh] overflow-y-auto p-6" @click.stop>
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-bold text-hq-text">ÏûëÏóÖ ÏÉÅÏÑ∏</h2>
        <button @click="showTaskDetail = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>
      <template x-if="taskDetailData">
        <div>
          <!-- Task Info -->
          <div class="bg-hq-bg rounded-xl p-4 mb-4">
            <div class="grid grid-cols-2 gap-3 text-xs">
              <div><span class="text-hq-muted">Î™ÖÎ†π:</span> <span class="text-hq-text ml-1" x-text="taskDetailData.command"></span></div>
              <div><span class="text-hq-muted">ÏÉÅÌÉú:</span>
                <span class="ml-1 status-badge"
                      :class="taskDetailData.status === 'completed' ? 'bg-hq-green/10 text-hq-green' : taskDetailData.status === 'failed' ? 'bg-hq-red/10 text-hq-red' : 'bg-hq-yellow/10 text-hq-yellow'"
                      x-text="taskDetailData.status === 'completed' ? 'ÏôÑÎ£å' : taskDetailData.status === 'failed' ? 'Ïã§Ìå®' : 'ÏßÑÌñâÏ§ë'"></span>
              </div>
              <div><span class="text-hq-muted">ÏÜåÏöîÏãúÍ∞Ñ:</span> <span class="text-hq-text font-mono ml-1" x-text="(taskDetailData.time_seconds || 0) + 's'"></span></div>
              <div><span class="text-hq-muted">ÎπÑÏö©:</span> <span class="text-hq-green font-mono ml-1" x-text="'$' + (taskDetailData.cost || 0).toFixed(4)"></span></div>
              <div x-show="taskDetailData.tokens_used"><span class="text-hq-muted">ÌÜ†ÌÅ∞(ÏÇ¨Ïö©Îüâ):</span> <span class="text-hq-purple font-mono ml-1" x-text="(taskDetailData.tokens_used || 0).toLocaleString()"></span></div>
              <div><span class="text-hq-muted">ÏÉùÏÑ±Ïùº:</span> <span class="text-hq-text ml-1" x-text="taskDetailData.created_at ? new Date(taskDetailData.created_at).toLocaleString('ko-KR') : '-'"></span></div>
            </div>
          </div>
          <!-- Tabs -->
          <div class="flex gap-2 mb-4">
            <button @click="taskDetailTab = 'result'" :class="taskDetailTab === 'result' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1 text-xs font-semibold rounded-lg transition">Í≤∞Í≥º</button>
            <button @click="taskDetailTab = 'replay'; loadTaskReplay(taskDetailData.task_id)" :class="taskDetailTab === 'replay' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1 text-xs font-semibold rounded-lg transition">Î¶¨ÌîåÎ†àÏù¥ (Ïã§Ìñâ Í≥ºÏ†ï)</button>
          </div>
          <!-- Result Tab -->
          <div x-show="taskDetailTab === 'result'" class="bg-hq-bg rounded-xl p-4">
            <template x-if="taskDetailData.result_data">
              <div class="text-sm leading-relaxed markdown-body" x-html="renderMarkdown(taskDetailData.result_data)"></div>
            </template>
            <template x-if="!taskDetailData.result_data">
              <div class="text-sm text-hq-muted text-center py-4">Í≤∞Í≥º Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</div>
            </template>
          </div>
          <!-- Replay Tab -->
          <div x-show="taskDetailTab === 'replay'" class="bg-hq-bg rounded-xl p-4">
            <template x-if="taskReplay && taskReplay.root">
              <div class="space-y-2" x-html="renderTaskDetailReplay(taskReplay.root, 0)"></div>
            </template>
            <template x-if="!taskReplay">
              <div class="text-sm text-hq-muted text-center py-4">Î¶¨ÌîåÎ†àÏù¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
            </template>
            <template x-if="taskReplay && !taskReplay.root">
              <div class="text-sm text-hq-muted text-center py-4">Î¶¨ÌîåÎ†àÏù¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</div>
            </template>
          </div>
        </div>
      </template>
      <template x-if="!taskDetailData">
        <div class="text-center py-8 text-hq-muted">Î°úÎî© Ï§ë...</div>
      </template>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Task Comparison Modal (#9) ‚ïê‚ïê‚ïê -->
  <div x-show="taskHistory.compareMode" x-transition class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4" style="display:none;" @click.self="taskHistory.compareMode = false">
    <div class="glass border border-hq-border rounded-2xl w-full max-w-6xl max-h-[85vh] overflow-hidden flex flex-col">
      <div class="flex items-center justify-between px-6 py-4 border-b border-hq-border">
        <h3 class="text-lg font-bold text-hq-text">ÏûëÏóÖ ÎπÑÍµê</h3>
        <button @click="taskHistory.compareMode = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>
      <div class="flex-1 overflow-auto p-6">
        <div class="grid grid-cols-2 gap-6">
          <!-- Left -->
          <div class="space-y-3">
            <div class="bg-hq-surface border border-hq-border rounded-xl p-4">
              <div class="text-xs text-hq-muted mb-1">Î™ÖÎ†π</div>
              <div class="text-sm text-hq-text font-medium" x-text="taskHistory.compareA?.command || '-'"></div>
              <div class="flex items-center gap-3 mt-2 text-[10px] text-hq-muted">
                <span x-text="taskHistory.compareA?.created_at ? new Date(taskHistory.compareA.created_at).toLocaleString('ko-KR') : ''"></span>
                <span :class="taskHistory.compareA?.success ? 'text-hq-green' : 'text-hq-red'" x-text="taskHistory.compareA?.success ? 'ÏÑ±Í≥µ' : 'Ïã§Ìå®'"></span>
              </div>
            </div>
            <div class="bg-hq-bg rounded-xl p-4 text-sm markdown-body max-h-96 overflow-auto" x-html="renderMarkdown(taskHistory.compareA?.result_data || taskHistory.compareA?.result_summary || 'Í≤∞Í≥º ÏóÜÏùå')"></div>
          </div>
          <!-- Right -->
          <div class="space-y-3">
            <div class="bg-hq-surface border border-hq-border rounded-xl p-4">
              <div class="text-xs text-hq-muted mb-1">Î™ÖÎ†π</div>
              <div class="text-sm text-hq-text font-medium" x-text="taskHistory.compareB?.command || '-'"></div>
              <div class="flex items-center gap-3 mt-2 text-[10px] text-hq-muted">
                <span x-text="taskHistory.compareB?.created_at ? new Date(taskHistory.compareB.created_at).toLocaleString('ko-KR') : ''"></span>
                <span :class="taskHistory.compareB?.success ? 'text-hq-green' : 'text-hq-red'" x-text="taskHistory.compareB?.success ? 'ÏÑ±Í≥µ' : 'Ïã§Ìå®'"></span>
              </div>
            </div>
            <div class="bg-hq-bg rounded-xl p-4 text-sm markdown-body max-h-96 overflow-auto" x-html="renderMarkdown(taskHistory.compareB?.result_data || taskHistory.compareB?.result_summary || 'Í≤∞Í≥º ÏóÜÏùå')"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Budget Edit Modal (#8) ‚ïê‚ïê‚ïê -->
  <div x-show="showBudgetEdit" x-transition class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4" style="display:none;" @click.self="showBudgetEdit = false">
    <div class="glass border border-hq-border rounded-2xl w-full max-w-md p-6">
      <h3 class="text-lg font-bold text-hq-text mb-4">ÏòàÏÇ∞ ÌïúÎèÑ ÏàòÏ†ï</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-xs text-hq-muted mb-1">ÏùºÏùº ÌïúÎèÑ ($)</label>
          <input x-model.number="budgetEditDaily" type="number" step="0.1" min="0"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
        </div>
        <div>
          <label class="block text-xs text-hq-muted mb-1">ÏõîÍ∞Ñ ÌïúÎèÑ ($)</label>
          <input x-model.number="budgetEditMonthly" type="number" step="1" min="0"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
        </div>
        <div class="flex gap-3">
          <button @click="saveBudget()" class="flex-1 bg-hq-accent hover:bg-hq-accent/80 text-white rounded-lg py-2 text-sm font-semibold transition">Ï†ÄÏû•</button>
          <button @click="showBudgetEdit = false" class="px-4 text-hq-muted hover:text-hq-text border border-hq-border rounded-lg py-2 text-sm transition">Ï∑®ÏÜå</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê CEO Profile Modal ‚ïê‚ïê‚ïê -->
  <div x-show="showCeoProfile" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="showCeoProfile = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[500px] mx-4 p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-hq-accent to-hq-purple flex items-center justify-center text-white font-bold text-sm">CEO</div>
          <div>
            <h2 class="text-lg font-bold text-hq-text">CEO</h2>
            <div class="text-xs text-hq-muted">Ï¥ùÍ¥Ñ ÏÇ¨Î†πÍ¥Ä ¬∑ CORTHEX HQ</div>
          </div>
        </div>
        <button @click="showCeoProfile = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>
      <div class="bg-hq-bg rounded-xl p-4 space-y-3 mb-4">
        <div class="flex justify-between"><span class="text-xs text-hq-muted">ÏßÅÏ±Ö</span><span class="text-xs text-hq-text">Ï¥ùÍ¥Ñ ÏÇ¨Î†πÍ¥Ä (CEO)</span></div>
        <div class="flex justify-between"><span class="text-xs text-hq-muted">ÏßÅÏÜç Î≥¥Í≥†</span><span class="text-xs text-hq-cyan cursor-pointer hover:underline" @click="showCeoProfile = false; openAgentConfig('chief_of_staff')">ÎπÑÏÑúÏã§Ïû• ‚Üí CEO</span></div>
        <div class="flex justify-between"><span class="text-xs text-hq-muted">Í¥ÄÎ¶¨ Î∂ÄÏÑú</span><span class="text-xs text-hq-text">Ï†ÑÏ≤¥ (7Í∞ú Î∂ÄÏÑú)</span></div>
        <div class="flex justify-between"><span class="text-xs text-hq-muted">Ï¥ù ÏóêÏù¥Ï†ÑÌä∏</span><span class="text-xs text-hq-text" x-text="Object.keys(agentNames).length + 'Î™Ö'"></span></div>
      </div>
      <div class="bg-hq-bg rounded-xl p-4">
        <div class="text-xs text-hq-muted font-semibold mb-3">Ïò§Îäò ÌòÑÌô©</div>
        <div class="grid grid-cols-3 gap-3">
          <div class="text-center">
            <div class="text-lg font-bold text-hq-accent" x-text="dashboard.todayTasks || 0"></div>
            <div class="text-[10px] text-hq-muted">Î™ÖÎ†π</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-bold text-hq-green" x-text="dashboard.todayCompleted || 0"></div>
            <div class="text-[10px] text-hq-muted">ÏôÑÎ£å</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-bold text-hq-yellow">$<span x-text="(totalCost || 0).toFixed(2)"></span></div>
            <div class="text-[10px] text-hq-muted">ÎπÑÏö©</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Tool Detail Modal ‚ïê‚ïê‚ïê -->
  <div x-show="toolDetailVisible" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="toolDetailVisible = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[400px] mx-4 p-6" @click.stop>
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-hq-red/15 flex items-center justify-center text-hq-red text-lg">üîß</div>
          <div>
            <h2 class="text-base font-bold text-hq-text" x-text="toolDetailData?.name_ko || toolDetailData?.name || ''"></h2>
            <div class="text-[10px] text-hq-muted">Ïô∏Î∂Ä ÎèÑÍµ¨</div>
          </div>
        </div>
        <button @click="toolDetailVisible = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>
      <div class="bg-hq-bg rounded-xl p-4 space-y-3">
        <div class="flex justify-between"><span class="text-xs text-hq-muted">ÎèÑÍµ¨ ID</span><span class="text-xs font-mono text-hq-text" x-text="toolDetailData?.name || '-'"></span></div>
        <div x-show="toolDetailData?.description"><span class="text-xs text-hq-muted block mb-1">ÏÑ§Î™Ö</span><span class="text-xs text-hq-text" x-text="toolDetailData?.description || ''"></span></div>
        <div x-show="toolDetailData?.category"><div class="flex justify-between"><span class="text-xs text-hq-muted">Î∂ÑÎ•ò</span><span class="text-xs text-hq-text" x-text="toolDetailData?.category || '-'"></span></div></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Í∏∞Î∞ÄÎ¨∏ÏÑú Ï†ÑÏ≤¥ ÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨ ‚ïê‚ïê‚ïê -->
  <div x-show="showDeleteAllArchiveModal" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="showDeleteAllArchiveModal = false" style="display: none;">
    <div class="bg-hq-panel border border-red-500/30 rounded-2xl w-full max-w-[380px] mx-4 p-6" @click.stop>
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-xl bg-red-500/15 flex items-center justify-center text-red-400 text-lg">‚ö†Ô∏è</div>
        <h2 class="text-base font-bold text-red-400">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú ÌôïÏù∏</h2>
      </div>
      <p class="text-hq-300 text-sm mb-5 leading-relaxed">Ï†ïÎßê Î™®Îì† Í∏∞Î∞ÄÎ¨∏ÏÑúÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?<br>Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.</p>
      <div class="flex justify-end gap-2">
        <button @click="showDeleteAllArchiveModal = false"
                class="px-4 py-2 rounded-lg text-sm bg-hq-surface text-hq-muted hover:bg-hq-border transition">Ï∑®ÏÜå</button>
        <button @click="deleteAllArchives()"
                class="px-4 py-2 rounded-lg text-sm bg-red-600 text-white hover:bg-red-700 transition">ÏÇ≠Ï†ú</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê ÎØ∏ÎîîÏñ¥ Ï†ÑÏ≤¥ ÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨ ‚ïê‚ïê‚ïê -->
  <div x-show="sns.showDeleteAllMediaModal" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="sns.showDeleteAllMediaModal = false" style="display: none;">
    <div class="bg-hq-panel border border-red-500/30 rounded-2xl w-full max-w-[380px] mx-4 p-6" @click.stop>
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-xl bg-red-500/15 flex items-center justify-center text-red-400 text-lg">‚ö†Ô∏è</div>
        <h2 class="text-base font-bold text-red-400">ÎØ∏ÎîîÏñ¥ Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</h2>
      </div>
      <p class="text-hq-300 text-sm mb-5 leading-relaxed">Î™®Îì† Ïù¥ÎØ∏ÏßÄÏôÄ ÏòÅÏÉÅÏùÑ ÏÇ≠Ï†úÌï©ÎãàÎã§.<br>Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.</p>
      <div class="flex justify-end gap-2">
        <button @click="sns.showDeleteAllMediaModal = false"
                class="px-4 py-2 rounded-lg text-sm bg-hq-surface text-hq-muted hover:bg-hq-border transition">Ï∑®ÏÜå</button>
        <button @click="deleteAllMedia('images')"
                class="px-4 py-2 rounded-lg text-sm bg-orange-600 text-white hover:bg-orange-700 transition">Ïù¥ÎØ∏ÏßÄÎßå</button>
        <button @click="deleteAllMediaBoth()"
                class="px-4 py-2 rounded-lg text-sm bg-red-600 text-white hover:bg-red-700 transition">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê SNS ÌÅê Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî ÌôïÏù∏ Î™®Îã¨ ‚ïê‚ïê‚ïê -->
  <div x-show="sns.showClearQueueModal" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="sns.showClearQueueModal = false" style="display: none;">
    <div class="bg-hq-panel border border-red-500/30 rounded-2xl w-full max-w-[380px] mx-4 p-6" @click.stop>
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-xl bg-red-500/15 flex items-center justify-center text-red-400 text-lg">‚ö†Ô∏è</div>
        <h2 class="text-base font-bold text-red-400">ÏäπÏù∏ÌÅê Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</h2>
      </div>
      <p class="text-hq-300 text-sm mb-5 leading-relaxed">Î™®Îì† SNS Î∞úÌñâ ÏöîÏ≤≠ÏùÑ ÏÇ≠Ï†úÌï©ÎãàÎã§.<br>ÎåÄÍ∏∞/ÏäπÏù∏/Í±∞Ï†à/Î∞úÌñâ Î™®Îì† Ìï≠Î™©Ïù¥ ÏÇ¨ÎùºÏßëÎãàÎã§.</p>
      <div class="flex justify-end gap-2">
        <button @click="sns.showClearQueueModal = false"
                class="px-4 py-2 rounded-lg text-sm bg-hq-surface text-hq-muted hover:bg-hq-border transition">Ï∑®ÏÜå</button>
        <button @click="clearSNSQueue()"
                class="px-4 py-2 rounded-lg text-sm bg-red-600 text-white hover:bg-red-700 transition">Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Î≤îÏö© ÌôïÏù∏ Î™®Îã¨ ‚ïê‚ïê -->
  <div x-show="confirmModal.show" x-transition.opacity
       class="fixed inset-0 z-[100] flex items-center justify-center p-4"
       :style="darkMode ? 'background: rgba(2,0,12,0.8); backdrop-filter: blur(8px);' : 'background: rgba(100,80,120,0.25); backdrop-filter: blur(6px);'"
       @click.self="closeConfirm()" style="display: none;">
    <div class="w-full max-w-sm rounded-3xl overflow-hidden relative"
         :style="darkMode
           ? 'background: rgba(18,10,36,0.92); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 60px rgba(139,92,246,0.12), 0 8px 32px rgba(0,0,0,0.4);'
           : 'background: rgba(255,255,255,0.96); border: 1px solid rgba(160,120,200,0.2); box-shadow: 0 8px 32px rgba(0,0,0,0.08);'"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 scale-90 translate-y-4"
         x-transition:enter-end="opacity-100 scale-100 translate-y-0">
      <!-- ÏÉÅÎã® ÎùºÏù∏ -->
      <div :style="confirmModal.isDanger
        ? (darkMode ? 'position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(239,68,68,0.6),rgba(236,72,153,0.4),transparent);' : 'position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(236,72,153,0.4),transparent);')
        : (darkMode ? 'position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(139,92,246,0.6),rgba(99,102,241,0.4),transparent);' : 'position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(99,102,241,0.4),transparent);')
      "></div>
      <div class="relative px-8 pt-8 pb-7">
        <!-- ÏïÑÏù¥ÏΩò -->
        <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-5"
             :style="confirmModal.isDanger
               ? (darkMode ? 'background:radial-gradient(circle,rgba(239,68,68,0.15) 0%,transparent 70%);border:1.5px solid rgba(239,68,68,0.25);box-shadow:0 0 25px rgba(239,68,68,0.2);' : 'background:radial-gradient(circle,rgba(236,72,153,0.08) 0%,transparent 70%);border:1.5px solid rgba(236,72,153,0.15);')
               : (darkMode ? 'background:radial-gradient(circle,rgba(139,92,246,0.15) 0%,transparent 70%);border:1.5px solid rgba(139,92,246,0.25);box-shadow:0 0 25px rgba(139,92,246,0.2);' : 'background:radial-gradient(circle,rgba(99,102,241,0.08) 0%,transparent 70%);border:1.5px solid rgba(99,102,241,0.15);')">
          <template x-if="confirmModal.isDanger">
            <svg class="w-7 h-7" :style="darkMode ? 'color:rgb(252,129,129);' : 'color:rgb(219,39,119);'" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg>
          </template>
          <template x-if="!confirmModal.isDanger">
            <svg class="w-7 h-7" :style="darkMode ? 'color:rgb(167,139,250);' : 'color:rgb(99,102,241);'" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"/></svg>
          </template>
        </div>
        <!-- Ï†úÎ™© -->
        <h3 class="text-lg font-bold mb-2" :class="darkMode ? 'text-white' : 'text-gray-900'" x-text="confirmModal.title"></h3>
        <!-- Î©îÏãúÏßÄ -->
        <p class="text-sm mb-1" :style="darkMode ? 'color:rgba(200,195,220,0.8);' : 'color:rgba(75,70,100,0.8);'" x-text="confirmModal.message"></p>
        <!-- ÏÉÅÏÑ∏ (ÏûàÏùÑ ÎïåÎßå) -->
        <template x-if="confirmModal.detail">
          <div class="mt-3 mb-1 inline-block rounded-lg px-3 py-1.5"
               :style="confirmModal.isDanger
                 ? (darkMode ? 'background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.15);' : 'background:rgba(236,72,153,0.06);border:1px solid rgba(236,72,153,0.12);')
                 : (darkMode ? 'background:rgba(139,92,246,0.08);border:1px solid rgba(139,92,246,0.15);' : 'background:rgba(99,102,241,0.06);border:1px solid rgba(99,102,241,0.12);')">
            <span class="text-sm font-medium"
                  :style="confirmModal.isDanger ? (darkMode ? 'color:rgb(252,165,165);' : 'color:rgb(190,24,93);') : (darkMode ? 'color:rgb(196,181,253);' : 'color:rgb(79,70,229);')"
                  x-text="confirmModal.detail"></span>
          </div>
        </template>
        <p class="text-[13px] mt-3 mb-5" :style="darkMode ? 'color:rgba(200,195,220,0.5);' : 'color:rgba(100,95,120,0.55);'" x-show="confirmModal.isDanger">Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.</p>
        <!-- Î≤ÑÌäº -->
        <div class="space-y-2.5">
          <button @click="executeConfirm()"
                  class="w-full py-3 text-sm text-white rounded-2xl font-semibold transition-all duration-200"
                  :style="confirmModal.isDanger
                    ? (darkMode ? 'background:linear-gradient(135deg,rgb(220,50,50),rgb(180,30,80));box-shadow:0 0 20px rgba(239,68,68,0.3),0 4px 12px rgba(0,0,0,0.3);' : 'background:linear-gradient(135deg,rgb(219,39,119),rgb(190,24,93));box-shadow:0 2px 12px rgba(219,39,119,0.25);')
                    : (darkMode ? 'background:linear-gradient(135deg,rgb(124,58,237),rgb(99,102,241));box-shadow:0 0 20px rgba(139,92,246,0.3),0 4px 12px rgba(0,0,0,0.3);' : 'background:linear-gradient(135deg,rgb(99,102,241),rgb(79,70,229));box-shadow:0 2px 12px rgba(99,102,241,0.25);')"
                  x-text="confirmModal.confirmText"></button>
          <button @click="closeConfirm()"
                  class="w-full py-3 text-sm rounded-2xl transition-all duration-200 font-medium"
                  :style="darkMode ? 'color:rgba(200,195,220,0.8);border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.04);' : 'color:rgba(85,80,108,0.7);border:1px solid rgba(0,0,0,0.08);background:rgba(0,0,0,0.02);'">Ï∑®ÏÜå</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NEXUS ÌíÄÏä§ÌÅ¨Î¶∞ Ïò§Î≤ÑÎ†àÏù¥ ‚ïê‚ïê -->
  <template x-if="nexusOpen">
    <div class="fixed inset-0 z-50 flex flex-col bg-[#060a14]"
         @keydown.ctrl.s.prevent.window="nexusOpen && flowchart.mode==='canvas' && saveNexusCanvas()">

      <!-- ÏÉÅÎã® Ìó§Îçî -->
      <div class="shrink-0 flex items-center gap-3 px-5 py-3 border-b border-white/10 bg-[#0a0f1a]/90 backdrop-blur-md">
        <!-- NEXUS Î°úÍ≥† -->
        <span class="text-base font-black tracking-[0.3em] text-[#e879f9]">NEXUS</span>
        <span class="text-xs text-white/20">|</span>
        <!-- Î™®Îìú Ï†ÑÌôò -->
        <div class="flex items-center bg-white/5 border border-white/10 rounded-lg p-0.5 gap-0.5">
          <button @click="onNexusModeChange('3d')"
                  :class="flowchart.mode==='3d' ? 'bg-emerald-500/20 text-emerald-400' : 'text-white/40 hover:text-white/70'"
                  class="flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-semibold transition">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
            3D ÏãúÏä§ÌÖú Îßµ
          </button>
          <button @click="onNexusModeChange('canvas')"
                  :class="flowchart.mode==='canvas' ? 'bg-yellow-500/20 text-yellow-400' : 'text-white/40 hover:text-white/70'"
                  class="flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-semibold transition">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
            ÎπÑÏ£ºÏñº Ï∫îÎ≤ÑÏä§
          </button>
        </div>

        <!-- Ï∫îÎ≤ÑÏä§ Î™®Îìú ÎèÑÍµ¨ -->
        <template x-if="flowchart.mode === 'canvas'">
          <div class="flex items-center gap-2 ml-2">
            <input x-model="flowchart.canvasName" type="text" placeholder="ÌååÏùºÎ™Ö..."
                   class="bg-white/5 border border-white/10 rounded-lg px-2.5 py-1.5 text-xs text-white/80 font-mono outline-none focus:border-yellow-500/50 w-36"/>
            <button @click="saveNexusCanvas()"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30 transition"
                    :class="flowchart.canvasDirty ? 'ring-1 ring-yellow-500/40' : ''">
              <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17,21 17,13 7,13 7,21"/><polyline points="7,3 7,8 15,8"/></svg>
              <span x-text="flowchart.canvasDirty ? 'Ï†ÄÏû• *' : 'Ï†ÄÏû•'"></span>
            </button>
            <button @click="clearNexusCanvas()" class="px-2.5 py-1.5 rounded-lg text-xs bg-white/5 border border-white/10 text-white/40 hover:text-red-400 hover:border-red-400/40 transition">Ï¥àÍ∏∞Ìôî</button>
          </div>
        </template>

        <!-- Ïö∞Ï∏° Îã´Í∏∞ -->
        <div class="ml-auto flex items-center gap-3">
          <span class="text-xs text-white/20 font-mono hidden sm:block">ESC</span>
          <button @click="nexusOpen = false"
                  class="w-8 h-8 rounded-lg bg-white/5 border border-white/10 text-white/40 hover:text-white hover:bg-white/10 flex items-center justify-center transition"
                  title="Îã´Í∏∞ (ESC)">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
          </button>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ 3D ÏãúÏä§ÌÖú Îßµ ‚îÄ‚îÄ -->
      <div x-show="flowchart.mode === '3d'" class="flex-1 flex flex-col overflow-hidden" x-cloak>
        <template x-if="!flowchart.graph3dLoaded">
          <div class="flex-1 flex items-center justify-center">
            <div class="flex flex-col items-center gap-4 text-center px-8">
              <div class="w-14 h-14 border-2 border-emerald-500/30 border-t-emerald-400 rounded-full animate-spin"></div>
              <p class="text-sm text-white/50">3D ÏãúÏä§ÌÖú Îßµ Íµ¨Ï∂ï Ï§ë...</p>
              <p class="text-xs text-white/25">ÏóêÏù¥Ï†ÑÌä∏ + ÌÉ≠ + ÏÑúÎπÑÏä§ + ÌîÑÎ°úÏÑ∏Ïä§ Ï†ÑÏ≤¥ Î°úÎî©</p>
            </div>
          </div>
        </template>
        <div id="nexus-3d" class="flex-1 w-full" style="min-height:400px"></div>
        <!-- 3D Î≤îÎ°Ä + ÏïàÎÇ¥ -->
        <div class="shrink-0 flex items-center justify-between px-5 py-2.5 bg-[#0a0f1a]/90 border-t border-white/10">
          <div class="flex items-center gap-3 flex-wrap">
            <template x-for="cat in [
              {c:'#e879f9',l:'CORTHEX'},{c:'#60a5fa',l:'UI ÌÉ≠'},{c:'#a78bfa',l:'Î∂ÄÏÑú'},
              {c:'#34d399',l:'ÏóêÏù¥Ï†ÑÌä∏'},{c:'#fbbf24',l:'Ï†ÄÏû•ÏÜå'},{c:'#fb923c',l:'Ïô∏Î∂ÄÏÑúÎπÑÏä§'},{c:'#f87171',l:'ÌîÑÎ°úÏÑ∏Ïä§'}
            ]" :key="cat.l">
              <div class="flex items-center gap-1.5">
                <span class="w-2.5 h-2.5 rounded-sm" :style="`background:${cat.c}`"></span>
                <span class="text-xs text-white/50" x-text="cat.l"></span>
              </div>
            </template>
          </div>
          <div class="flex items-center gap-4 text-xs text-white/30">
            <span>‚Üí ÌôîÏÇ¥Ìëú: Îç∞Ïù¥ÌÑ∞ ÌùêÎ¶Ñ</span><span>‚óè ÏûÖÏûê: Ïã§ÏãúÍ∞Ñ ÌÜµÏã†</span><span class="text-white/15">|</span><span>ÎìúÎûòÍ∑∏: ÌöåÏ†Ñ</span><span>Ìú†: Ï§å</span><span>ÏóêÏù¥Ï†ÑÌä∏ ÌÅ¥Î¶≠ ‚Üí ÏÇ¨Î†πÍ¥ÄÏã§</span>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ ÎπÑÏ£ºÏñº Ï∫îÎ≤ÑÏä§ ‚îÄ‚îÄ -->
      <div x-show="flowchart.mode === 'canvas'" class="flex-1 flex overflow-hidden" x-cloak>
        <!-- Ï¢åÏ∏°: ÌåîÎ†àÌä∏ + Î™©Î°ù -->
        <div class="w-44 shrink-0 border-r border-white/10 bg-[#0a0f1a] flex flex-col overflow-hidden">
          <div class="px-3 py-2 border-b border-white/10">
            <span class="text-xs font-semibold text-white/40 uppercase tracking-wider">ÎÖ∏Îìú ÌåîÎ†àÌä∏</span>
          </div>
          <div class="p-2 flex flex-col gap-1.5 border-b border-white/10">
            <template x-if="flowchart.canvasLoaded">
              <div class="flex flex-col gap-1.5">
                <template x-for="n in [{t:'agent',l:'ÏóêÏù¥Ï†ÑÌä∏',c:'#8b5cf6'},{t:'system',l:'ÏãúÏä§ÌÖú',c:'#3b82f6'},{t:'api',l:'Ïô∏Î∂Ä API',c:'#059669'},{t:'decide',l:'Í≤∞Ï†ï Î∂ÑÍ∏∞',c:'#f59e0b'},{t:'start',l:'ÏãúÏûë',c:'#22c55e'},{t:'end',l:'Ï¢ÖÎ£å',c:'#ef4444'},{t:'note',l:'Î©îÎ™®',c:'#6b7280'}]" :key="n.t">
                  <button @click="addCanvasNode(n.t)"
                          class="w-full text-left py-1.5 px-2 rounded-lg text-xs font-semibold transition hover:opacity-80 flex items-center gap-2"
                          :style="`background:${n.c}22; border:1px solid ${n.c}44; color:${n.c}`">
                    <span class="w-2 h-2 rounded-full shrink-0" :style="`background:${n.c}`"></span>
                    <span x-text="n.l"></span>
                  </button>
                </template>
              </div>
            </template>
            <template x-if="!flowchart.canvasLoaded">
              <div class="text-xs text-white/30 py-2 animate-pulse">Î°úÎî© Ï§ë...</div>
            </template>
          </div>
          <div class="px-3 py-2 border-b border-white/10">
            <span class="text-xs font-semibold text-white/40 uppercase tracking-wider">Ï†ÄÏû•Îêú Ï∫îÎ≤ÑÏä§</span>
          </div>
          <div class="flex-1 overflow-y-auto scrollbar-thin py-1">
            <template x-if="flowchart.canvasItems.length === 0">
              <div class="px-3 py-2 text-xs text-white/20 italic">ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§</div>
            </template>
            <template x-for="item in flowchart.canvasItems" :key="item.name">
              <button @click="loadNexusCanvas(item)"
                      class="w-full text-left py-1.5 px-3 text-xs text-white/40 hover:text-white/80 hover:bg-white/5 transition rounded-r-lg font-mono truncate"
                      x-text="item.name.replace('.json','')">
              </button>
            </template>
          </div>
        </div>
        <!-- Drawflow Ï∫îÎ≤ÑÏä§ -->
        <div class="flex-1 overflow-hidden relative">
          <template x-if="!flowchart.canvasLoaded">
            <div class="absolute inset-0 flex items-center justify-center z-10">
              <div class="flex flex-col items-center gap-3">
                <div class="w-8 h-8 border-2 border-yellow-500/30 border-t-yellow-400 rounded-full animate-spin"></div>
                <span class="text-xs text-white/40">ÎπÑÏ£ºÏñº Ï∫îÎ≤ÑÏä§ Î°úÎî© Ï§ë...</span>
              </div>
            </div>
          </template>
          <template x-if="flowchart.canvasLoaded">
            <div class="absolute top-4 left-1/2 -translate-x-1/2 z-10 pointer-events-none">
              <div class="bg-black/60 border border-white/10 rounded-lg px-3 py-1.5 text-xs text-white/30 backdrop-blur-sm">
                ÌåîÎ†àÌä∏ÏóêÏÑú ÎÖ∏Îìú Ï∂îÍ∞Ä / Ìè¨Ìä∏ ÎìúÎûòÍ∑∏Î°ú Ïó∞Í≤∞ / ÎçîÎ∏îÌÅ¥Î¶≠ÏúºÎ°ú ÎÖ∏Îìú Ïù¥Î¶Ñ ÏàòÏ†ï
              </div>
            </div>
          </template>
          <div id="nexus-canvas" class="w-full h-full"></div>
        </div>
      </div>

    </div>
  </template>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AGORA (ÎèÖÎ¶Ω viewMode) ‚ïê‚ïê -->
  <template x-if="viewMode === 'agora'">
    <div class="flex-1 flex flex-col overflow-hidden">

      <!-- ÏÉÅÎã® Ìà¥Î∞î -->
      <div class="shrink-0 flex items-center gap-2 px-4 py-2.5 border-b border-hq-border bg-hq-panel/80 backdrop-blur-sm">
        <!-- AGORA Î°úÍ≥† -->
        <div class="flex items-center gap-2 mr-2">
          <span class="text-sm font-bold tracking-widest text-hq-accent">AGORA</span>
          <template x-if="agora.status">
            <span class="text-[10px] px-1.5 py-0.5 rounded-full font-semibold"
                  :class="{'bg-green-500/20 text-green-400': agora.status==='active', 'bg-yellow-500/20 text-yellow-400': agora.status==='paused', 'bg-hq-muted/20 text-hq-muted': agora.status==='completed'}"
                  x-text="({active:'ÏßÑÌñâÏ§ë',paused:'ÏùºÏãúÏ†ïÏßÄ',completed:'ÏôÑÎ£å'})[agora.status]"></span>
          </template>
        </div>

        <!-- Ïª®Ìä∏Î°§ Î≤ÑÌäºÎì§ -->
        <template x-if="!agora.sessionId">
          <button @click="startAgora()"
                  class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-hq-accent/20 text-hq-accent hover:bg-hq-accent/30 transition">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            ÏÉà ÌÜ†Î°† ÏãúÏûë
          </button>
        </template>
        <template x-if="agora.status === 'active'">
          <button @click="pauseAgora()"
                  class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30 transition">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
            ÏùºÏãúÏ†ïÏßÄ
          </button>
        </template>
        <template x-if="agora.status === 'paused'">
          <button @click="resumeAgora()"
                  class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-green-500/20 text-green-400 hover:bg-green-500/30 transition">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            Ïû¨Í∞ú
          </button>
        </template>

        <div class="flex-1"></div>

        <!-- ÎùºÏö¥Îìú + ÎπÑÏö© ÌëúÏãú -->
        <template x-if="agora.sessionId">
          <div class="flex items-center gap-3">
            <span class="text-xs text-hq-muted/60 font-mono">
              R<span class="text-hq-text" x-text="agora.totalRounds"></span>
            </span>
            <span class="text-xs font-mono px-2 py-0.5 rounded bg-hq-surface border border-hq-border">
              <span class="text-hq-muted/60">$</span><span class="text-hq-accent" x-text="(agora.totalCost || 0).toFixed(2)"></span>
            </span>
          </div>
        </template>
      </div>

      <!-- 3Ìå®ÎÑê Î≥∏Î¨∏ -->
      <div class="flex-1 flex overflow-hidden">

        <!-- ‚ñåÏ¢åÏ∏°: ÏüÅÏ†ê Ìä∏Î¶¨ ‚ñå -->
        <div class="w-60 shrink-0 border-r border-hq-border overflow-y-auto bg-hq-bg/50">
          <div class="p-3">
            <h3 class="text-[10px] font-semibold text-hq-muted/50 uppercase tracking-widest mb-3">ÏüÅÏ†ê Ìä∏Î¶¨</h3>
            <div class="space-y-0.5">
              <template x-for="issue in agora.issues" :key="issue.id">
                <button @click="selectAgoraIssue(issue.id)"
                        :class="agora.selectedIssueId === issue.id ? 'bg-hq-accent/10 border-hq-accent/30 text-hq-text' : 'border-transparent text-hq-text/70 hover:bg-hq-surface hover:text-hq-text'"
                        :style="`padding-left: ${(issue._depth || 0) * 14 + 8}px`"
                        class="w-full text-left py-1.5 pr-2 rounded-lg text-xs border transition-all flex items-center gap-1.5">
                  <span x-text="agoraIssueIcon(issue.status)" class="text-[11px] shrink-0"></span>
                  <span x-text="issue.title" class="truncate"></span>
                </button>
              </template>
            </div>
            <template x-if="agora.issues.length === 0">
              <div class="flex flex-col items-center justify-center py-12 text-hq-muted/40">
                <svg class="w-8 h-8 mb-2 opacity-30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"/></svg>
                <p class="text-[10px]">ÌÜ†Î°†ÏùÑ ÏãúÏûëÌïòÎ©¥</p>
                <p class="text-[10px]">ÏüÅÏ†êÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
              </div>
            </template>
          </div>
        </div>

        <!-- ‚ñåÏ§ëÏïô: ÌÜ†Î°† ÎùºÏù¥Î∏å ‚ñå -->
        <div class="flex-1 flex flex-col overflow-hidden min-w-0">
          <div class="shrink-0 px-4 py-2 border-b border-hq-border flex items-center gap-2">
            <h3 class="text-[10px] font-semibold text-hq-muted/50 uppercase tracking-widest">ÌÜ†Î°† ÎùºÏù¥Î∏å</h3>
            <template x-if="agora.selectedIssueId">
              <span class="text-[10px] text-hq-muted/40" x-text="'‚Äî ' + (agora.issues.find(i => i.id === agora.selectedIssueId)?.title || '')"></span>
            </template>
          </div>
          <div class="flex-1 overflow-y-auto p-4 space-y-4" x-ref="agoraLive">
            <template x-for="round in agora.rounds" :key="`${round.issue_id}-${round.round_num}-${round.speaker}`">
              <div class="flex gap-3 group">
                <!-- ÏïÑÎ∞îÌÉÄ -->
                <div class="shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold mt-0.5"
                     :class="{'bg-blue-500/20 text-blue-400': round.speaker==='kodh', 'bg-red-500/20 text-red-400': round.speaker==='psb', 'bg-purple-500/20 text-purple-400': round.speaker==='kdw'}">
                  <span x-text="agoraSpeakerName(round.speaker)[0]"></span>
                </div>
                <!-- Î∞úÏñ∏ ÎÇ¥Ïö© -->
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="text-xs font-bold" :class="agoraSpeakerColor(round.speaker)" x-text="agoraSpeakerName(round.speaker)"></span>
                    <span class="text-[10px] text-hq-muted/30 font-mono">R<span x-text="round.round_num"></span></span>
                    <template x-if="round.speaker === 'kdw'">
                      <span class="text-[10px] px-1.5 py-0.5 rounded-full bg-purple-500/10 text-purple-400/60">ÏÇ¨ÌöåÏûê</span>
                    </template>
                  </div>
                  <div class="text-sm text-hq-text/80 whitespace-pre-wrap leading-relaxed" x-text="round.content"></div>
                  <!-- Ïù∏Ïö© ÌëúÏãú -->
                  <template x-if="round.citations && JSON.parse(round.citations || '[]').length > 0">
                    <div class="mt-2 space-y-1">
                      <template x-for="cite in JSON.parse(round.citations || '[]')" :key="cite.title">
                        <div class="text-[10px] px-2 py-1 rounded bg-hq-surface/50 border border-hq-border/50 text-hq-muted/60 flex items-center gap-1.5">
                          <span :class="cite.verified ? 'text-green-400' : 'text-yellow-400'" x-text="cite.verified ? '‚úì' : '?'"></span>
                          <span x-text="`${cite.author}, „Äå${cite.title}„Äç (${cite.year})`"></span>
                        </div>
                      </template>
                    </div>
                  </template>
                </div>
              </div>
            </template>
            <!-- Îπà ÏÉÅÌÉú -->
            <template x-if="agora.rounds.length === 0">
              <div class="flex flex-col items-center justify-center h-full text-hq-muted/40">
                <svg class="w-10 h-10 mb-3 opacity-20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                <p class="text-xs">ÏüÅÏ†êÏùÑ ÏÑ†ÌÉùÌïòÎ©¥</p>
                <p class="text-xs">ÌÜ†Î°† ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
              </div>
            </template>
          </div>
        </div>

        <!-- ‚ñåÏö∞Ï∏°: ÎÖºÎ¨∏ DIFF / ÎåÄÌôîÎ°ù ‚ñå -->
        <div class="w-80 shrink-0 border-l border-hq-border flex flex-col overflow-hidden">
          <!-- ÌÉ≠ Î∞î -->
          <div class="shrink-0 flex border-b border-hq-border">
            <button @click="agora.rightTab = 'diff'"
                    :class="agora.rightTab === 'diff' ? 'border-b-2 border-hq-accent text-hq-accent' : 'text-hq-muted/50 hover:text-hq-text'"
                    class="flex-1 px-3 py-2 text-xs font-semibold transition">
              <span class="flex items-center justify-center gap-1.5">
                <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v18M3 12h18"/></svg>
                ÎÖºÎ¨∏ DIFF
              </span>
            </button>
            <button @click="agora.rightTab = 'book'"
                    :class="agora.rightTab === 'book' ? 'border-b-2 border-hq-accent text-hq-accent' : 'text-hq-muted/50 hover:text-hq-text'"
                    class="flex-1 px-3 py-2 text-xs font-semibold transition">
              <span class="flex items-center justify-center gap-1.5">
                <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
                ÎåÄÌôîÎ°ù
              </span>
            </button>
          </div>

          <!-- DIFF ÎÇ¥Ïö© -->
          <div x-show="agora.rightTab === 'diff'" class="flex-1 overflow-y-auto">
            <template x-if="agora.diffHtml">
              <div class="p-4 text-xs font-mono leading-relaxed agora-diff" x-html="agora.diffHtml"></div>
            </template>
            <template x-if="!agora.diffHtml">
              <div class="flex flex-col items-center justify-center h-full text-hq-muted/40">
                <svg class="w-8 h-8 mb-2 opacity-20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3"/></svg>
                <p class="text-[10px]">ÎÖºÎ¨∏ ÏàòÏ†ïÏù¥ Î∞úÏÉùÌïòÎ©¥</p>
                <p class="text-[10px]">diffÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
              </div>
            </template>
          </div>

          <!-- ÎåÄÌôîÎ°ù ÎÇ¥Ïö© -->
          <div x-show="agora.rightTab === 'book'" class="flex-1 overflow-y-auto">
            <template x-if="agora.bookChapters.length > 0">
              <div class="p-4 space-y-6">
                <!-- ÎåÄÌôîÎ°ù Ìó§Îçî -->
                <div class="text-center pb-4 border-b border-hq-border/30">
                  <p class="text-[10px] text-hq-muted/40 uppercase tracking-widest mb-1">ÌîåÎùºÌÜ§ ÎåÄÌôîÎ°ù</p>
                  <p class="text-[10px] text-hq-muted/30">Ï†ÄÏûê: Í≥†ÎèôÌù¨ ¬∑ Î∞ïÏÑ±Î≤î | ÏóÆÏùÄÏù¥: Í∂åÎåÄÏò•</p>
                </div>
                <template x-for="ch in agora.bookChapters" :key="ch.chapter_num">
                  <div class="space-y-2">
                    <h4 class="text-sm font-bold text-hq-accent/80 flex items-center gap-2">
                      <span class="text-[10px] text-hq-muted/30 font-mono" x-text="`CH.${ch.chapter_num}`"></span>
                      <span x-text="ch.title"></span>
                    </h4>
                    <div class="text-xs text-hq-text/70 whitespace-pre-wrap leading-relaxed pl-2 border-l-2 border-hq-border/30" x-text="ch.content"></div>
                  </div>
                </template>
              </div>
            </template>
            <template x-if="agora.bookChapters.length === 0">
              <div class="flex flex-col items-center justify-center h-full text-hq-muted/40">
                <svg class="w-8 h-8 mb-2 opacity-20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
                <p class="text-[10px]">Ìï©ÏùòÍ∞Ä ÎèÑÎã¨ÎêòÎ©¥</p>
                <p class="text-[10px]">ÌîåÎùºÌÜ§ ÎåÄÌôîÎ°ùÏù¥ Ïó¨Í∏∞Ïóê Ìé∏Ï∞¨Îê©ÎãàÎã§</p>
              </div>
            </template>
          </div>
        </div>

      </div>
    </div>
  </template>

  <!-- AGORA: ÎÖºÎ¨∏ ÏûÖÎ†• Î™®Îã¨ -->
  <template x-if="viewMode === 'agora' && agora.showPaperInput">
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm"
         @click.self="agora.showPaperInput = false">
      <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-2xl mx-4 p-6 shadow-2xl" @click.stop>
        <h3 class="text-base font-bold text-hq-text mb-1 flex items-center gap-2">
          <svg class="w-5 h-5 text-hq-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"/></svg>
          ÏÉà ÌÜ†Î°† ÏãúÏûë
        </h3>
        <p class="text-xs text-hq-muted/60 mb-4">ÎÖºÎ¨∏ ÌÖçÏä§Ìä∏Î•º ÏûÖÎ†•ÌïòÎ©¥ AI ÏóêÏù¥Ï†ÑÌä∏ 3Î™ÖÏù¥ ÏûêÎèôÏúºÎ°ú ÌÜ†Î°†ÏùÑ ÏãúÏûëÌï©ÎãàÎã§</p>

        <label class="text-xs font-semibold text-hq-muted/70 mb-1 block">ÎÖºÎ¨∏ Ï†úÎ™©</label>
        <input x-model="agora.inputTitle" type="text" placeholder="Ïòà: Î∂ÄÏßÑÏ†ïÎ∂ÄÏûëÏúÑÎ≤îÏùò Ïù∏Í≥ºÍ¥ÄÍ≥Ñ Î∞è Í∞ùÍ¥ÄÏ†Å Í∑ÄÏÜç ÌèâÍ∞ÄÏùò Í∞ÄÎä•ÏÑ±Í≥º Î∞©Ìñ•ÏÑ± Ïû¨Í≤ÄÌÜ†"
               class="w-full bg-hq-surface border border-hq-border rounded-xl px-3 py-2.5 text-sm text-hq-text placeholder:text-hq-muted/30 outline-none focus:border-hq-accent/50 mb-3 font-mono">

        <label class="text-xs font-semibold text-hq-muted/70 mb-1 block">ÎÖºÎ¨∏ Ï†ÑÎ¨∏</label>
        <textarea x-model="agora.inputPaper" placeholder="ÎÖºÎ¨∏ Ï†ÑÎ¨∏ÏùÑ Ïó¨Í∏∞Ïóê Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî..."
                  class="w-full h-64 bg-hq-surface border border-hq-border rounded-xl px-3 py-2.5 text-sm text-hq-text placeholder:text-hq-muted/30 outline-none focus:border-hq-accent/50 resize-none mb-1 font-mono"></textarea>
        <p class="text-[10px] text-hq-muted/40 mb-4">üí° Í≥†ÎèôÌù¨(Opus) vs Î∞ïÏÑ±Î≤î(GPT-5.2) ‚Äî ÏÇ¨ÌöåÏûê: Í∂åÎåÄÏò•(GPT-5.2/Sonnet)</p>

        <div class="flex justify-end gap-2">
          <button @click="agora.showPaperInput = false"
                  class="px-4 py-2 rounded-lg text-sm bg-hq-surface text-hq-muted hover:bg-hq-border transition">Ï∑®ÏÜå</button>
          <button @click="submitAgora()" :disabled="!agora.inputTitle.trim() || !agora.inputPaper.trim()"
                  class="px-4 py-2 rounded-lg text-sm bg-hq-accent text-white hover:bg-hq-accent/80 transition disabled:opacity-40 flex items-center gap-1.5">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            ÌÜ†Î°† ÏãúÏûë
          </button>
        </div>
      </div>
    </div>
  </template>

  <!-- ÏÑ§Í≥ÑÏã§: ÏÉà Îã§Ïù¥Ïñ¥Í∑∏Îû® Î™®Îã¨ -->
  <template x-if="activeTab === 'flowchart' && flowchart.showNewModal">
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm"
         @click.self="flowchart.showNewModal = false">
      <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-sm mx-4 p-6 shadow-2xl" @click.stop>
        <h3 class="text-base font-bold text-hq-text mb-4 flex items-center gap-2">
          <svg class="w-4 h-4 text-hq-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          ÏÉà Îã§Ïù¥Ïñ¥Í∑∏Îû®
        </h3>
        <input x-model="flowchart.newName" @keydown.enter="createFlowchart()"
               type="text" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†• (Ïòà: Îß§Îß§Î¥á-ÌùêÎ¶Ñ)"
               class="w-full bg-hq-surface border border-hq-border rounded-xl px-3 py-2.5 text-sm text-hq-text placeholder:text-hq-muted/40 outline-none focus:border-hq-accent/50 mb-4 font-mono"
               x-ref="newFcInput"
               x-init="$nextTick(()=>$el.focus())">
        <div class="flex justify-end gap-2">
          <button @click="flowchart.showNewModal = false"
                  class="px-4 py-2 rounded-lg text-sm bg-hq-surface text-hq-muted hover:bg-hq-border transition">Ï∑®ÏÜå</button>
          <button @click="createFlowchart()" :disabled="!flowchart.newName.trim()"
                  class="px-4 py-2 rounded-lg text-sm bg-hq-accent text-white hover:bg-hq-accent/80 transition disabled:opacity-40">ÏÉùÏÑ±</button>
        </div>
      </div>
    </div>
  </template>


  <!-- PWA Service Worker Îì±Î°ù -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }
  </script>
</body>
</html>
