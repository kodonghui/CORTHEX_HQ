<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CORTHEX HQ - CEO Command Center</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'hq-bg': '#0f1729',
            'hq-surface': '#1a2744',
            'hq-panel': '#243352',
            'hq-border': '#475569',
            'hq-border-light': '#64748b',
            'hq-accent': '#60a5fa',
            'hq-cyan': '#22d3ee',
            'hq-purple': '#a78bfa',
            'hq-green': '#34d399',
            'hq-yellow': '#fbbf24',
            'hq-red': '#f87171',
            'hq-text': '#f1f5f9',
            'hq-muted': '#cbd5e1',
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap');

    * { box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }

    /* Scrollbar */
    .scrollbar-thin::-webkit-scrollbar { width: 5px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #64748b; }

    /* Animations */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-16px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes pulseDot {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(0.85); }
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes typing {
      from { width: 0; }
      to { width: 100%; }
    }
    @keyframes blink {
      50% { border-color: transparent; }
    }
    @keyframes ripple {
      0% { transform: scale(1); opacity: 0.4; }
      100% { transform: scale(2.5); opacity: 0; }
    }
    @keyframes gridPulse {
      0%, 100% { opacity: 0.03; }
      50% { opacity: 0.06; }
    }
    .fade-in-up { animation: fadeInUp 0.4s ease-out; }
    .fade-in { animation: fadeIn 0.3s ease-out; }
    .slide-in-left { animation: slideInLeft 0.3s ease-out; }
    .pulse-dot { animation: pulseDot 1.5s ease-in-out infinite; }
    .progress-bar { transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }

    /* Gradient text */
    .gradient-text {
      background: linear-gradient(135deg, #06b6d4, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Gradient border */
    .gradient-border {
      position: relative;
      background: #1a2744;
      border: 1px solid transparent;
      background-clip: padding-box;
    }
    .gradient-border::before {
      content: '';
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      background: linear-gradient(135deg, #06b6d430, #3b82f630, #8b5cf630);
      z-index: -1;
    }

    /* Glow effects */
    .glow-cyan { box-shadow: 0 0 20px rgba(6, 182, 212, 0.15), 0 0 40px rgba(6, 182, 212, 0.05); }
    .glow-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.15), 0 0 40px rgba(59, 130, 246, 0.05); }
    .glow-purple { box-shadow: 0 0 20px rgba(139, 92, 246, 0.15), 0 0 40px rgba(139, 92, 246, 0.05); }
    .glow-accent { box-shadow: 0 0 24px rgba(59, 130, 246, 0.2); }

    /* Glass effect */
    .glass {
      background: rgba(26, 39, 68, 0.92);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    /* Background grid pattern */
    .bg-grid {
      background-image:
        linear-gradient(rgba(59, 130, 246, 0.10) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59, 130, 246, 0.10) 1px, transparent 1px);
      background-size: 40px 40px;
      animation: gridPulse 8s ease-in-out infinite;
    }

    /* Hover transitions */
    .hover-lift {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    /* Card hover glow */
    .hover-glow {
      transition: box-shadow 0.3s ease, border-color 0.3s ease;
    }
    .hover-glow:hover {
      box-shadow: 0 0 24px rgba(59, 130, 246, 0.12);
      border-color: #2a3a5c;
    }

    /* Agent avatar */
    .agent-avatar {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      flex-shrink: 0;
      transition: transform 0.15s ease;
    }
    .agent-avatar:hover { transform: scale(1.1); }

    /* Status badge */
    .status-badge {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 4px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    /* Markdown body */
    .markdown-body { line-height: 1.7; }
    .markdown-body h1 { font-size: 1.25rem; font-weight: 700; margin: 1rem 0 0.5rem; color: #e2e8f0; }
    .markdown-body h2 { font-size: 1.1rem; font-weight: 600; margin: 0.8rem 0 0.4rem; color: #cbd5e1; }
    .markdown-body h3 { font-size: 1rem; font-weight: 600; margin: 0.6rem 0 0.3rem; color: #94a3b8; }
    .markdown-body p { margin: 0.4rem 0; color: #cbd5e1; }
    .markdown-body ul, .markdown-body ol { margin: 0.3rem 0; padding-left: 1.5rem; }
    .markdown-body li { margin: 0.2rem 0; color: #cbd5e1; }
    .markdown-body code { background: #0f172a; padding: 0.15rem 0.5rem; border-radius: 6px; font-size: 0.85rem; font-family: 'JetBrains Mono', monospace; color: #7dd3fc; border: 1px solid #1e2d4a; }
    .markdown-body pre { background: #0a0e1a; padding: 1rem; border-radius: 10px; overflow-x: auto; margin: 0.5rem 0; border: 1px solid #1e2d4a; }
    .markdown-body pre code { background: transparent; padding: 0; border: none; color: #e2e8f0; }
    .markdown-body table { border-collapse: collapse; width: 100%; margin: 0.5rem 0; }
    .markdown-body th, .markdown-body td { border: 1px solid #1e2d4a; padding: 0.5rem 0.8rem; text-align: left; }
    .markdown-body th { background: #111827; color: #94a3b8; font-weight: 600; }
    .markdown-body blockquote { border-left: 3px solid #3b82f6; padding-left: 1rem; margin: 0.5rem 0; color: #94a3b8; }
    .markdown-body a { color: #60a5fa; text-decoration: underline; text-underline-offset: 2px; }
    .markdown-body hr { border-color: #1e2d4a; margin: 1rem 0; }

    /* Typing effect for welcome */
    .typing-text {
      overflow: hidden;
      white-space: nowrap;
      border-right: 2px solid #3b82f6;
      animation: typing 2s steps(30) 0.5s forwards, blink 0.8s step-end infinite;
      width: 0;
    }

    /* Input focus ring */
    .input-glow:focus {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15), 0 0 20px rgba(59, 130, 246, 0.1);
    }

    /* Activity log item */
    .log-item {
      transition: background 0.15s ease;
      border-radius: 6px;
      padding: 4px 8px;
    }
    .log-item:hover {
      background: rgba(59, 130, 246, 0.05);
    }

    /* ‚ïê‚ïê‚ïê Light mode overrides ‚ïê‚ïê‚ïê */
    html:not(.dark) body { background-color: #f8fafc; color: #1e293b; }
    html:not(.dark) .bg-hq-bg { background-color: #f8fafc !important; }
    html:not(.dark) .bg-hq-surface { background-color: #ffffff !important; }
    html:not(.dark) .bg-hq-panel { background-color: #f1f5f9 !important; }
    html:not(.dark) .text-hq-text { color: #1e293b !important; }
    html:not(.dark) .text-hq-muted { color: #475569 !important; }
    html:not(.dark) .border-hq-border { border-color: #e2e8f0 !important; }
    html:not(.dark) .border-hq-border-light { border-color: #cbd5e1 !important; }
    html:not(.dark) .text-hq-text\/90 { color: rgba(30,41,59,0.9) !important; }
    html:not(.dark) .text-hq-text\/80 { color: rgba(30,41,59,0.8) !important; }
    html:not(.dark) .text-hq-text\/70 { color: rgba(30,41,59,0.7) !important; }
    html:not(.dark) .text-hq-muted\/70 { color: rgba(71,85,105,0.7) !important; }
    html:not(.dark) .text-hq-muted\/60 { color: rgba(71,85,105,0.6) !important; }
    html:not(.dark) .text-hq-muted\/50 { color: rgba(71,85,105,0.5) !important; }
    html:not(.dark) .glass { background: rgba(255,255,255,0.92) !important; border-color: #e2e8f0 !important; }
    html:not(.dark) .bg-grid {
      background-image: linear-gradient(rgba(59,130,246,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(59,130,246,0.05) 1px, transparent 1px);
    }
    html:not(.dark) .gradient-border { background: #f1f5f9; }
    html:not(.dark) .markdown-body h1 { color: #1e293b; }
    html:not(.dark) .markdown-body h2 { color: #334155; }
    html:not(.dark) .markdown-body h3 { color: #475569; }
    html:not(.dark) .markdown-body p, html:not(.dark) .markdown-body li { color: #334155; }
    html:not(.dark) .markdown-body code { background: #f1f5f9; color: #0369a1; border-color: #e2e8f0; }
    html:not(.dark) .markdown-body pre { background: #f8fafc; border-color: #e2e8f0; }
    html:not(.dark) .markdown-body pre code { color: #1e293b; }
    html:not(.dark) .markdown-body th { background: #f1f5f9; color: #475569; }
    html:not(.dark) .markdown-body th, html:not(.dark) .markdown-body td { border-color: #e2e8f0; }
    html:not(.dark) .markdown-body blockquote { color: #475569; }
    html:not(.dark) .scrollbar-thin::-webkit-scrollbar-thumb { background: #cbd5e1; }
    html:not(.dark) .hover-lift:hover { box-shadow: 0 8px 24px rgba(0,0,0,0.08); }

    /* ‚ïê‚ïê‚ïê Toast animations ‚ïê‚ïê‚ïê */
    @keyframes toastIn {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes toastOut {
      from { opacity: 1; transform: translateX(0); }
      to { opacity: 0; transform: translateX(100%); }
    }
    .toast-in { animation: toastIn 0.3s ease-out forwards; }
    .toast-out { animation: toastOut 0.3s ease-in forwards; }

    /* ‚ïê‚ïê‚ïê Agent working glow ‚ïê‚ïê‚ïê */
    @keyframes agentGlow {
      0%, 100% { box-shadow: 0 0 4px rgba(250,204,21,0.3); }
      50% { box-shadow: 0 0 14px rgba(250,204,21,0.6), 0 0 28px rgba(250,204,21,0.15); }
    }
    .agent-working-glow { animation: agentGlow 2s ease-in-out infinite; border-radius: 50%; }

    /* ‚ïê‚ïê‚ïê Office floor plan ‚ïê‚ïê‚ïê */
    .office-room { border-radius: 16px; padding: 20px; transition: all 0.3s ease; }
    .desk-card {
      border-radius: 12px; padding: 12px; cursor: pointer;
      transition: all 0.2s ease; position: relative; min-width: 100px;
      border: 1px solid rgba(71, 85, 105, 0.5);
    }
    .desk-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.25); border-color: rgba(96, 165, 250, 0.4); }
    .status-light { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .status-light-working { background: #10b981; box-shadow: 0 0 10px rgba(16,185,129,0.6); animation: pulseDot 1.5s ease-in-out infinite; }
    .status-light-idle { background: #f59e0b; box-shadow: 0 0 6px rgba(245,158,11,0.4); }
    .status-light-done { background: #10b981; }
    .status-light-off { background: #475569; }
    html:not(.dark) .desk-card:hover { box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
    html:not(.dark) .office-room { border-color: #e2e8f0; }

    /* Light mode: input/select elements */
    html:not(.dark) input, html:not(.dark) textarea, html:not(.dark) select {
      background-color: #ffffff;
      border-color: #e2e8f0;
      color: #1e293b;
    }
    html:not(.dark) .hover-glow:hover { border-color: #cbd5e1; box-shadow: 0 0 24px rgba(59,130,246,0.06); }

    /* ‚ïê‚ïê‚ïê #11: Mobile responsive ‚ïê‚ïê‚ïê */
    @media (max-width: 768px) {
      /* ÏÇ¨Ïù¥ÎìúÎ∞î Ïà®ÍπÄ (Î™®Î∞îÏùº) */
      .mobile-sidebar-hidden { display: none !important; }
      /* ÌÉ≠ Î∞î Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ */
      .mobile-tabs-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
      .mobile-tabs-scroll::-webkit-scrollbar { display: none; }
      /* Ïπ¥Îìú 1Ïó¥ */
      .mobile-grid-1 { grid-template-columns: 1fr !important; }
      /* ÎåÄÏãúÎ≥¥Îìú Ïπ¥Îìú 2Ïó¥ ‚Üí 1Ïó¥ */
      .grid-cols-2 { grid-template-columns: 1fr !important; }
      .lg\:grid-cols-4 { grid-template-columns: repeat(2, 1fr) !important; }
      /* ÎπÑÍµê Î™®Îã¨ 1Ïó¥ */
      .grid-cols-2.gap-6 { grid-template-columns: 1fr !important; }
    }
    @media (max-width: 480px) {
      .lg\:grid-cols-4, .grid-cols-4 { grid-template-columns: 1fr !important; }
    }
  </style>
</head>

<body class="bg-hq-bg text-hq-text h-screen flex flex-col overflow-hidden"
      x-data="corthexApp()" x-init="init()">

  <!-- ‚ïê‚ïê‚ïê Top Bar ‚ïê‚ïê‚ïê -->
  <header class="h-14 glass border-b border-hq-border flex items-center justify-between px-5 shrink-0 z-20">
    <div class="flex items-center gap-4">
      <!-- Logo -->
      <div class="flex items-center gap-2.5">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="logoGrad" x1="0" y1="0" x2="32" y2="32">
              <stop offset="0%" stop-color="#06b6d4"/>
              <stop offset="50%" stop-color="#3b82f6"/>
              <stop offset="100%" stop-color="#8b5cf6"/>
            </linearGradient>
          </defs>
          <path d="M16 2L28 9V23L16 30L4 23V9L16 2Z" stroke="url(#logoGrad)" stroke-width="1.5" fill="none"/>
          <path d="M16 6L24 10.5V21.5L16 26L8 21.5V10.5L16 6Z" stroke="url(#logoGrad)" stroke-width="1" fill="none" opacity="0.5"/>
          <circle cx="16" cy="16" r="4" fill="url(#logoGrad)" opacity="0.8"/>
          <circle cx="16" cy="16" r="2" fill="#0a0e1a"/>
          <line x1="16" y1="12" x2="16" y2="6" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="19.5" y1="14" x2="24" y2="10.5" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="19.5" y1="18" x2="24" y2="21.5" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="16" y1="20" x2="16" y2="26" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="12.5" y1="18" x2="8" y2="21.5" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
          <line x1="12.5" y1="14" x2="8" y2="10.5" stroke="url(#logoGrad)" stroke-width="1" opacity="0.6"/>
        </svg>
        <div>
          <div class="text-base font-bold tracking-wide gradient-text">CORTHEX</div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <span class="text-[10px] font-mono text-hq-muted bg-hq-surface border border-hq-border rounded-md px-2 py-0.5">v0.4.0</span>
        <span class="text-[10px] font-mono text-hq-cyan/60 bg-hq-cyan/5 border border-hq-cyan/20 rounded-md px-2 py-0.5">CEO Í¥ÄÏ†ú</span>
      </div>
    </div>

    <div class="flex items-center gap-5">
      <!-- System Status (click ‚Üí health popover) -->
      <div class="flex items-center gap-2 relative">
        <template x-if="systemStatus === 'idle'">
          <div @click="showHealthPopover = !showHealthPopover; if(showHealthPopover) loadHealth()"
               class="flex items-center gap-2 bg-hq-green/10 border border-hq-green/20 rounded-lg px-3 py-1 cursor-pointer hover:bg-hq-green/20 transition">
            <span class="w-2 h-2 rounded-full bg-hq-green"></span>
            <span class="text-xs font-medium text-hq-green">ÎåÄÍ∏∞</span>
          </div>
        </template>
        <template x-if="systemStatus === 'working'">
          <div @click="showHealthPopover = !showHealthPopover; if(showHealthPopover) loadHealth()"
               class="flex items-center gap-2 bg-hq-yellow/10 border border-hq-yellow/20 rounded-lg px-3 py-1 cursor-pointer hover:bg-hq-yellow/20 transition">
            <span class="w-2 h-2 rounded-full bg-hq-yellow pulse-dot"></span>
            <span class="text-xs font-medium text-hq-yellow">Ï≤òÎ¶¨Ï§ë</span>
          </div>
        </template>
        <template x-if="systemStatus === 'error'">
          <div @click="showHealthPopover = !showHealthPopover; if(showHealthPopover) loadHealth()"
               class="flex items-center gap-2 bg-hq-red/10 border border-hq-red/20 rounded-lg px-3 py-1 cursor-pointer hover:bg-hq-red/20 transition">
            <span class="w-2 h-2 rounded-full bg-hq-red"></span>
            <span class="text-xs font-medium text-hq-red">Ïò§Î•ò</span>
          </div>
        </template>
        <!-- Health Popover -->
        <div x-show="showHealthPopover" @click.outside="showHealthPopover = false" x-transition
             class="absolute top-full mt-2 right-0 w-72 glass border border-hq-border rounded-xl p-4 shadow-xl z-30"
             style="display: none;">
          <h4 class="text-xs font-bold text-hq-text uppercase tracking-wider mb-3">ÏãúÏä§ÌÖú ÏÉÅÌÉú ÏÉÅÏÑ∏</h4>
          <template x-if="healthData">
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-xs text-hq-muted">Ï†ÑÏ≤¥</span>
                <span class="text-xs font-bold" :class="healthData.overall === 'ok' ? 'text-hq-green' : healthData.overall === 'warning' ? 'text-hq-yellow' : 'text-hq-red'"
                      x-text="healthData.overall === 'ok' ? 'Ï†ïÏÉÅ' : healthData.overall === 'warning' ? 'Í≤ΩÍ≥†' : 'Ïò§Î•ò'"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-hq-muted">Ïò§ÏºÄÏä§Ìä∏Î†àÏù¥ÌÑ∞ (ÏßÄÌúòÏûê)</span>
                <span class="text-xs" x-text="healthData.orchestrator !== undefined ? (healthData.orchestrator ? '‚úÖ' : '‚ùå') : (healthData.message || '-')"></span>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.model_router !== undefined">
                <span class="text-xs text-hq-muted">Î™®Îç∏ ÎùºÏö∞ÌÑ∞ (Í≤ΩÎ°ú Î∞∞Ï†ï)</span>
                <span class="text-xs" x-text="healthData.model_router ? '‚úÖ' : '‚ùå'"></span>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.registry !== undefined">
                <span class="text-xs text-hq-muted">ÏóêÏù¥Ï†ÑÌä∏ Î†àÏßÄÏä§Ìä∏Î¶¨ (Îì±Î°ùÏÜå)</span>
                <span class="text-xs" x-text="healthData.registry ? '‚úÖ' : '‚ùå'"></span>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.knowledge_mgr !== undefined">
                <span class="text-xs text-hq-muted">ÏßÄÏãù Í¥ÄÎ¶¨Ïûê</span>
                <span class="text-xs" x-text="healthData.knowledge_mgr ? '‚úÖ' : '‚ùå'"></span>
              </div>
              <div class="flex items-center justify-between" x-show="healthData.agent_count !== undefined">
                <span class="text-xs text-hq-muted">Îì±Î°ùÎêú ÏóêÏù¥Ï†ÑÌä∏</span>
                <span class="text-xs font-mono text-hq-accent" x-text="healthData.agent_count + 'Î™Ö'"></span>
              </div>
              <template x-if="healthData.checks && healthData.checks.length > 0">
                <div class="border-t border-hq-border/50 pt-2 mt-2 space-y-1">
                  <template x-for="check in healthData.checks" :key="check.name || check">
                    <div class="flex items-center justify-between">
                      <span class="text-[11px] text-hq-muted" x-text="check.name || check"></span>
                      <span class="text-[11px]" :class="check.ok ? 'text-hq-green' : 'text-hq-red'" x-text="check.ok ? '‚úÖ' : '‚ùå'"></span>
                    </div>
                  </template>
                </div>
              </template>
            </div>
          </template>
          <template x-if="!healthData">
            <div class="text-xs text-hq-muted text-center py-2">Î°úÎî© Ï§ë...</div>
          </template>
        </div>
      </div>

      <!-- Metrics -->
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-1.5">
          <svg class="w-3.5 h-3.5 text-hq-green/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          <span class="text-xs font-mono text-hq-green" x-text="'$' + totalCost.toFixed(4)"></span>
        </div>
        <div class="flex items-center gap-1.5">
          <svg class="w-3.5 h-3.5 text-hq-purple/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/></svg>
          <span class="text-xs font-mono text-hq-text/70" x-text="totalTokens.toLocaleString()"></span>
        </div>
      </div>

      <!-- Connection -->
      <div class="flex items-center gap-1.5" :class="wsConnected ? 'text-hq-green' : 'text-hq-red'">
        <span class="w-1.5 h-1.5 rounded-full" :class="wsConnected ? 'bg-hq-green' : 'bg-hq-red'"></span>
        <span class="text-[11px] font-mono" x-text="wsConnected ? 'Ïó∞Í≤∞Îê®' : 'ÎÅäÍπÄ'"></span>
      </div>

      <!-- View Toggle: Ï±ÑÌåÖ/ÏÇ¨Î¨¥Ïã§/ÎåÄÏãúÎ≥¥Îìú -->
      <div class="flex items-center bg-hq-surface border border-hq-border rounded-lg">
        <button @click="if(dashboardRefreshTimer){clearInterval(dashboardRefreshTimer);dashboardRefreshTimer=null;} viewMode = 'chat'"
                :class="viewMode === 'chat' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                class="px-3 py-1 text-xs font-semibold rounded-l-lg transition-colors">Ï±ÑÌåÖ</button>
        <button @click="if(dashboardRefreshTimer){clearInterval(dashboardRefreshTimer);dashboardRefreshTimer=null;} viewMode = 'office'"
                :class="viewMode === 'office' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                class="px-3 py-1 text-xs font-semibold border-x border-hq-border transition-colors">ÏÇ¨Î¨¥Ïã§</button>
        <button @click="viewMode = 'dashboard'; loadDashboard(); if(dashboardRefreshTimer){clearInterval(dashboardRefreshTimer);} dashboardRefreshTimer = setInterval(() => loadDashboard(), 30000)"
                :class="viewMode === 'dashboard' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                class="px-3 py-1 text-xs font-semibold rounded-r-lg transition-colors">ÎåÄÏãúÎ≥¥Îìú</button>
      </div>

      <!-- Dark/Light Toggle -->
      <button @click="toggleTheme()" class="text-hq-muted hover:text-hq-text transition" title="Îã§ÌÅ¨/ÎùºÏù¥Ìä∏ Î™®Îìú Ï†ÑÌôò">
        <svg x-show="darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
        <svg x-show="!darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
        </svg>
      </button>

      <!-- Quality Settings Button -->
      <button @click="showQualitySettings = true; loadQualityRules()"
              class="text-hq-muted hover:text-hq-text transition" title="ÌíàÏßà Í≤ÄÏàò ÏÑ§Ï†ï">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
      </button>
    </div>
  </header>
  <div class="h-[2px] bg-gradient-to-r from-hq-cyan via-hq-accent to-hq-purple shrink-0"></div>

  <!-- ‚ïê‚ïê‚ïê Toast Notifications ‚ïê‚ïê‚ïê -->
  <div class="fixed top-16 right-4 z-50 space-y-2 max-w-sm" style="pointer-events:none;">
    <template x-for="toast in toasts" :key="toast.id">
      <div :class="[
        toast.visible ? 'toast-in' : 'toast-out',
        toast.type === 'success' ? 'border-hq-green/40 bg-hq-green/10' :
        toast.type === 'error' ? 'border-hq-red/40 bg-hq-red/10' :
        toast.type === 'warning' ? 'border-hq-yellow/40 bg-hq-yellow/10' :
        'border-hq-accent/40 bg-hq-accent/10'
      ]" class="glass border rounded-xl px-4 py-3 text-sm shadow-lg" style="pointer-events:auto;">
        <div class="flex items-center gap-2">
          <span class="w-2 h-2 rounded-full shrink-0"
                :class="toast.type==='success'?'bg-hq-green':toast.type==='error'?'bg-hq-red':toast.type==='warning'?'bg-hq-yellow':'bg-hq-accent'"></span>
          <span class="flex-1 text-hq-text text-sm" x-text="toast.message"></span>
          <button @click="removeToast(toast.id)" class="text-hq-muted hover:text-hq-text text-lg leading-none ml-2">&times;</button>
        </div>
      </div>
    </template>
  </div>

  <!-- ‚ïê‚ïê‚ïê Connection Lost Banner ‚ïê‚ïê‚ïê -->
  <div x-show="connectionLost" x-transition
       class="bg-hq-red/15 border-b border-hq-red/30 text-center py-2 text-sm text-hq-red shrink-0 flex items-center justify-center gap-2">
    <span class="w-2 h-2 bg-hq-red rounded-full pulse-dot"></span>
    ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ï°åÏäµÎãàÎã§. Ïû¨Ïó∞Í≤∞ ÏãúÎèÑÏ§ë... (<span x-text="reconnectAttempt"></span>Ìöå)
  </div>

  <!-- ‚ïê‚ïê‚ïê Main Layout ‚ïê‚ïê‚ïê -->
  <div class="flex flex-1 overflow-hidden">

    <!-- ‚ïê‚ïê‚ïê Left Panel: Organization ‚ïê‚ïê‚ïê -->
    <aside class="w-[280px] bg-hq-surface border-r border-hq-border flex flex-col shrink-0 mobile-sidebar-hidden">

      <!-- Org Tree -->
      <div class="flex-1 overflow-y-auto scrollbar-thin p-3 space-y-1">
        <div class="flex items-center justify-between px-2 mb-2">
          <div class="text-[10px] font-bold text-hq-muted uppercase tracking-[0.15em]">Ï°∞ÏßÅÎèÑ</div>
          <div class="text-[10px] font-mono text-hq-muted">25Î™Ö</div>
        </div>
        <!-- ÏóêÏù¥Ï†ÑÌä∏ ÏÉÅÌÉú ÏöîÏïΩ -->
        <div class="flex items-center gap-3 px-2 py-1.5 mb-2 rounded-lg bg-hq-bg/50 text-[10px]">
          <span class="flex items-center gap-1 text-hq-green"><span class="w-1.5 h-1.5 rounded-full bg-hq-green animate-pulse"></span> <span x-text="Object.values(activeAgents).filter(a => a.status === 'working').length"></span> ÌôúÎèô</span>
          <span class="flex items-center gap-1 text-hq-yellow"><span class="w-1.5 h-1.5 rounded-full bg-hq-yellow"></span> <span x-text="Object.values(activeAgents).filter(a => a.status === 'idle').length"></span> ÎåÄÍ∏∞</span>
          <span class="flex items-center gap-1 text-hq-muted"><span class="w-1.5 h-1.5 rounded-full bg-hq-muted/50"></span> <span x-text="25 - Object.values(activeAgents).filter(a => a.status === 'working' || a.status === 'idle').length"></span> ÎπÑÌôúÏÑ±</span>
        </div>

        <!-- CEO -->
        <div class="mb-2">
          <div class="flex items-center gap-2.5 px-2 py-2 rounded-lg bg-gradient-to-r from-hq-accent/10 to-hq-purple/10 border border-hq-accent/20">
            <div class="agent-avatar bg-gradient-to-br from-hq-accent to-hq-purple text-white">
              CEO
            </div>
            <div>
              <div class="text-sm font-semibold text-hq-text">CEO</div>
              <div class="text-[10px] text-hq-muted">Ï¥ùÍ¥Ñ ÏÇ¨Î†πÍ¥Ä</div>
            </div>
          </div>
        </div>

        <!-- ÎπÑÏÑúÏã§ -->
        <div class="mb-1">
          <button @click="toggleSection('secretary')"
                  class="flex items-center gap-2.5 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors group">
            <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.secretary ? 'rotate-90' : ''" >&#9654;</span>
            <div class="agent-avatar bg-hq-yellow/20 text-hq-yellow text-[10px]">BS</div>
            <div class="flex-1">
              <span class="text-sm text-hq-text/90">ÎπÑÏÑúÏã§</span>
            </div>
            <span class="status-badge" :class="getSectionBadgeClass('secretary')"
                  x-text="getSectionStatusText('secretary')"></span>
          </button>
          <div x-show="expanded.secretary" x-collapse class="ml-10 space-y-0.5 mt-1">
            <template x-for="id in ['chief_of_staff', 'report_worker', 'schedule_worker', 'relay_worker']" :key="id">
              <div :id="'agent-' + id" @click="openAgentConfig(id)" class="flex items-center gap-2 px-2 py-1.5 rounded-md hover:bg-hq-accent/10 transition-all duration-300 cursor-pointer" title="ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏¬∑Ï∂îÎ°†¬∑ÏÜåÏö∏ ÏÑ§Ï†ï Í∞ÄÎä•">
                <span class="w-1.5 h-1.5 rounded-full transition-colors shrink-0 mt-0.5" :class="[getAgentDotClass(id), activeAgents[id]?.status==='working' ? 'agent-working-glow' : '']"></span>
                <div class="flex-1 min-w-0">
                  <div class="text-xs text-hq-text" x-text="getAgentName(id)"></div>
                  <div class="text-[9px] text-hq-muted truncate" x-show="agentRoles[id]" x-text="agentRoles[id] || ''"></div>
                </div>
                <span x-show="activeAgents[id]?.status === 'working'"
                      class="ml-auto text-[9px] font-mono text-hq-yellow shrink-0"
                      x-text="Math.round((activeAgents[id]?.progress || 0) * 100) + '%'"></span>
              </div>
            </template>
          </div>
        </div>

        <!-- LEET Master Î≥∏Î∂Ä -->
        <div class="mb-1">
          <button @click="toggleSection('leet_master')"
                  class="flex items-center gap-2.5 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors group">
            <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.leet_master ? 'rotate-90' : ''">&#9654;</span>
            <div class="agent-avatar bg-hq-cyan/20 text-hq-cyan text-[10px]">LM</div>
            <div class="flex-1">
              <span class="text-sm font-semibold text-hq-cyan">LEET Master</span>
            </div>
            <span class="status-badge" :class="getSectionBadgeClass('leet_master')"
                  x-text="getSectionStatusText('leet_master')"></span>
          </button>
          <div x-show="expanded.leet_master" x-collapse class="space-y-0.5 mt-1">

            <!-- Í∏∞Ïà†Í∞úÎ∞úÏ≤ò CTO -->
            <div class="ml-5 mb-1">
              <button @click="toggleSection('tech')"
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors">
                <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.tech ? 'rotate-90' : ''">&#9654;</span>
                <div class="agent-avatar bg-hq-cyan/15 text-hq-cyan text-[9px]" :class="getAgentDotClass('cto_manager').includes('pulse') ? 'ring-1 ring-hq-green ring-offset-1 ring-offset-hq-surface' : ''">
                  CTO
                </div>
                <span class="text-xs text-hq-text/80">Í∏∞Ïà†Í∞úÎ∞úÏ≤ò</span>
                <span class="ml-auto status-badge" :class="getSectionBadgeClass('tech')"
                      x-text="getSectionStatusText('tech')"></span>
              </button>
              <div x-show="expanded.tech" x-collapse class="ml-10 space-y-0.5 mt-1">
                <template x-for="id in ['frontend_specialist','backend_specialist','infra_specialist','ai_model_specialist']" :key="id">
                  <div :id="'agent-' + id" @click="openAgentConfig(id)" class="flex items-center gap-2 px-2 py-1 rounded-md hover:bg-hq-accent/10 transition-all duration-300 cursor-pointer" title="ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏¬∑Ï∂îÎ°†¬∑ÏÜåÏö∏ ÏÑ§Ï†ï Í∞ÄÎä•">
                    <span class="w-1.5 h-1.5 rounded-full transition-colors" :class="[getAgentDotClass(id), activeAgents[id]?.status==='working' ? 'agent-working-glow' : '']"></span>
                    <span class="text-xs text-hq-muted" x-text="getAgentName(id)"></span>
                    <span x-show="activeAgents[id]?.status === 'working'"
                          class="ml-auto text-[9px] font-mono text-hq-yellow"
                          x-text="Math.round((activeAgents[id]?.progress || 0) * 100) + '%'"></span>
                  </div>
                </template>
              </div>
            </div>

            <!-- ÏÇ¨ÏóÖÍ∏∞ÌöçÏ≤ò CSO -->
            <div class="ml-5 mb-1">
              <button @click="toggleSection('strategy')"
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors">
                <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.strategy ? 'rotate-90' : ''">&#9654;</span>
                <div class="agent-avatar bg-hq-cyan/15 text-hq-cyan text-[9px]">CSO</div>
                <span class="text-xs text-hq-text/80">ÏÇ¨ÏóÖÍ∏∞ÌöçÏ≤ò</span>
                <span class="ml-auto status-badge" :class="getSectionBadgeClass('strategy')"
                      x-text="getSectionStatusText('strategy')"></span>
              </button>
              <div x-show="expanded.strategy" x-collapse class="ml-10 space-y-0.5 mt-1">
                <template x-for="id in ['market_research_specialist','business_plan_specialist','financial_model_specialist']" :key="id">
                  <div :id="'agent-' + id" @click="openAgentConfig(id)" class="flex items-center gap-2 px-2 py-1 rounded-md hover:bg-hq-accent/10 transition-all duration-300 cursor-pointer" title="ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏¬∑Ï∂îÎ°†¬∑ÏÜåÏö∏ ÏÑ§Ï†ï Í∞ÄÎä•">
                    <span class="w-1.5 h-1.5 rounded-full transition-colors" :class="[getAgentDotClass(id), activeAgents[id]?.status==='working' ? 'agent-working-glow' : '']"></span>
                    <span class="text-xs text-hq-muted" x-text="getAgentName(id)"></span>
                    <span x-show="activeAgents[id]?.status === 'working'"
                          class="ml-auto text-[9px] font-mono text-hq-yellow"
                          x-text="Math.round((activeAgents[id]?.progress || 0) * 100) + '%'"></span>
                  </div>
                </template>
              </div>
            </div>

            <!-- Î≤ïÎ¨¥ IPÏ≤ò CLO -->
            <div class="ml-5 mb-1">
              <button @click="toggleSection('legal')"
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors">
                <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.legal ? 'rotate-90' : ''">&#9654;</span>
                <div class="agent-avatar bg-hq-cyan/15 text-hq-cyan text-[9px]">CLO</div>
                <span class="text-xs text-hq-text/80">Î≤ïÎ¨¥ IPÏ≤ò</span>
                <span class="ml-auto status-badge" :class="getSectionBadgeClass('legal')"
                      x-text="getSectionStatusText('legal')"></span>
              </button>
              <div x-show="expanded.legal" x-collapse class="ml-10 space-y-0.5 mt-1">
                <template x-for="id in ['copyright_specialist','patent_specialist']" :key="id">
                  <div :id="'agent-' + id" @click="openAgentConfig(id)" class="flex items-center gap-2 px-2 py-1 rounded-md hover:bg-hq-accent/10 transition-all duration-300 cursor-pointer" title="ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏¬∑Ï∂îÎ°†¬∑ÏÜåÏö∏ ÏÑ§Ï†ï Í∞ÄÎä•">
                    <span class="w-1.5 h-1.5 rounded-full transition-colors" :class="[getAgentDotClass(id), activeAgents[id]?.status==='working' ? 'agent-working-glow' : '']"></span>
                    <span class="text-xs text-hq-muted" x-text="getAgentName(id)"></span>
                    <span x-show="activeAgents[id]?.status === 'working'"
                          class="ml-auto text-[9px] font-mono text-hq-yellow"
                          x-text="Math.round((activeAgents[id]?.progress || 0) * 100) + '%'"></span>
                  </div>
                </template>
              </div>
            </div>

            <!-- ÎßàÏºÄÌåÖ Í≥†Í∞ùÏ≤ò CMO -->
            <div class="ml-5 mb-1">
              <button @click="toggleSection('marketing')"
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors">
                <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.marketing ? 'rotate-90' : ''">&#9654;</span>
                <div class="agent-avatar bg-hq-cyan/15 text-hq-cyan text-[9px]">CMO</div>
                <span class="text-xs text-hq-text/80">ÎßàÏºÄÌåÖ Í≥†Í∞ùÏ≤ò</span>
                <span class="ml-auto status-badge" :class="getSectionBadgeClass('marketing')"
                      x-text="getSectionStatusText('marketing')"></span>
              </button>
              <div x-show="expanded.marketing" x-collapse class="ml-10 space-y-0.5 mt-1">
                <template x-for="id in ['survey_specialist','content_specialist','community_specialist']" :key="id">
                  <div :id="'agent-' + id" @click="openAgentConfig(id)" class="flex items-center gap-2 px-2 py-1 rounded-md hover:bg-hq-accent/10 transition-all duration-300 cursor-pointer" title="ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏¬∑Ï∂îÎ°†¬∑ÏÜåÏö∏ ÏÑ§Ï†ï Í∞ÄÎä•">
                    <span class="w-1.5 h-1.5 rounded-full transition-colors" :class="[getAgentDotClass(id), activeAgents[id]?.status==='working' ? 'agent-working-glow' : '']"></span>
                    <span class="text-xs text-hq-muted" x-text="getAgentName(id)"></span>
                    <span x-show="activeAgents[id]?.status === 'working'"
                          class="ml-auto text-[9px] font-mono text-hq-yellow"
                          x-text="Math.round((activeAgents[id]?.progress || 0) * 100) + '%'"></span>
                  </div>
                </template>
              </div>
            </div>

          </div>
        </div>

        <!-- Ìà¨ÏûêÎ∂ÑÏÑù Î≥∏Î∂Ä -->
        <div class="mb-1">
          <button @click="toggleSection('investment')"
                  class="flex items-center gap-2.5 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors group">
            <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.investment ? 'rotate-90' : ''">&#9654;</span>
            <div class="agent-avatar bg-hq-purple/20 text-hq-purple text-[10px]">FN</div>
            <div class="flex-1">
              <span class="text-sm font-semibold text-hq-purple">Ìà¨ÏûêÎ∂ÑÏÑù</span>
            </div>
            <span class="status-badge" :class="getSectionBadgeClass('investment')"
                  x-text="getSectionStatusText('investment')"></span>
          </button>
          <div x-show="expanded.investment" x-collapse class="space-y-0.5 mt-1">

            <!-- Ìà¨ÏûêÎ∂ÑÏÑùÏ≤ò CIO -->
            <div class="ml-5 mb-1">
              <button @click="toggleSection('finance')"
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors">
                <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.finance ? 'rotate-90' : ''">&#9654;</span>
                <div class="agent-avatar bg-hq-purple/15 text-hq-purple text-[9px]">CIO</div>
                <span class="text-xs text-hq-text/80">Ìà¨ÏûêÎ∂ÑÏÑùÏ≤ò</span>
                <span class="ml-auto status-badge" :class="getSectionBadgeClass('finance')"
                      x-text="getSectionStatusText('finance')"></span>
              </button>
              <div x-show="expanded.finance" x-collapse class="ml-10 space-y-0.5 mt-1">
                <template x-for="id in ['market_condition_specialist','stock_analysis_specialist','technical_analysis_specialist','risk_management_specialist']" :key="id">
                  <div :id="'agent-' + id" @click="openAgentConfig(id)" class="flex items-center gap-2 px-2 py-1 rounded-md hover:bg-hq-accent/10 transition-all duration-300 cursor-pointer" title="ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏¬∑Ï∂îÎ°†¬∑ÏÜåÏö∏ ÏÑ§Ï†ï Í∞ÄÎä•">
                    <span class="w-1.5 h-1.5 rounded-full transition-colors" :class="[getAgentDotClass(id), activeAgents[id]?.status==='working' ? 'agent-working-glow' : '']"></span>
                    <span class="text-xs text-hq-muted" x-text="getAgentName(id)"></span>
                    <template x-if="id !== 'risk_management_specialist'">
                      <span class="text-[9px] font-mono text-hq-cyan/40 ml-auto flex items-center gap-0.5" title="Îã§Î•∏ ÏóêÏù¥Ï†ÑÌä∏ÏôÄ ÎèôÏãúÏóê ÏûëÏóÖÌï©ÎãàÎã§">‚ö° ÎèôÏãú</span>
                    </template>
                    <template x-if="id === 'risk_management_specialist'">
                      <span class="text-[9px] font-mono text-hq-purple/40 ml-auto flex items-center gap-0.5" title="Ïïû ÏóêÏù¥Ï†ÑÌä∏Í∞Ä ÎÅùÎÇòÎ©¥ ÏãúÏûëÌï©ÎãàÎã§">üìã ÏàúÏÑúÎåÄÎ°ú</span>
                    </template>
                  </div>
                </template>
              </div>
            </div>

          </div>
        </div>

        <!-- Ï∂úÌåê¬∑Í∏∞Î°ù Î≥∏Î∂Ä -->
        <div class="mb-1">
          <button @click="toggleSection('publishing')"
                  class="flex items-center gap-2.5 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors group">
            <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.publishing ? 'rotate-90' : ''">&#9654;</span>
            <div class="agent-avatar bg-hq-green/20 text-hq-green text-[10px]">PB</div>
            <div class="flex-1">
              <span class="text-sm font-semibold text-hq-green">Ï∂úÌåê¬∑Í∏∞Î°ù</span>
            </div>
            <span class="status-badge" :class="getSectionBadgeClass('publishing')"
                  x-text="getSectionStatusText('publishing')"></span>
          </button>
          <div x-show="expanded.publishing" x-collapse class="ml-10 space-y-0.5 mt-1">
            <template x-for="id in ['cpo_manager', 'chronicle_specialist', 'editor_specialist', 'archive_specialist']" :key="id">
              <div :id="'agent-' + id" @click="openAgentConfig(id)" class="flex items-center gap-2 px-2 py-1.5 rounded-md hover:bg-white/[0.10] transition-all duration-300 cursor-pointer" title="ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏¬∑Ï∂îÎ°†¬∑ÏÜåÏö∏ ÏÑ§Ï†ï Í∞ÄÎä•">
                <span class="w-1.5 h-1.5 rounded-full transition-colors shrink-0 mt-0.5" :class="[getAgentDotClass(id), activeAgents[id]?.status==='working' ? 'agent-working-glow' : '']"></span>
                <div class="flex-1 min-w-0">
                  <div class="text-xs text-hq-text" x-text="getAgentName(id)"></div>
                </div>
              </div>
            </template>
          </div>
        </div>

        <!-- Tool Pool -->
        <div class="mb-1">
          <button @click="toggleSection('tools')"
                  class="flex items-center gap-2.5 px-2 py-1.5 rounded-lg hover:bg-white/[0.12] w-full text-left transition-colors group">
            <span class="text-[10px] text-hq-muted transition-transform duration-200" :class="expanded.tools ? 'rotate-90' : ''">&#9654;</span>
            <div class="agent-avatar bg-hq-red/15 text-hq-red text-[10px]">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            </div>
            <span class="text-sm text-hq-text/70">ÎèÑÍµ¨Ìï®</span>
            <span class="text-[10px] font-mono text-hq-muted ml-auto" x-text="(toolsList || []).length + 'Í∞ú'"></span>
          </button>
          <div x-show="expanded.tools" x-collapse class="ml-10 space-y-0.5 mt-1 max-h-48 overflow-y-auto scrollbar-thin">
            <template x-for="t in (toolsList || [])" :key="t.name">
              <div class="flex items-center gap-2 px-2 py-1 rounded-md hover:bg-white/[0.10] transition-colors">
                <span class="w-1.5 h-1.5 rounded-full bg-hq-muted/50"></span>
                <span class="text-xs text-hq-muted" x-text="t.name_ko || t.name"></span>
                <span class="text-[9px] text-hq-muted/50 ml-auto">ÎèÑÍµ¨</span>
              </div>
            </template>
          </div>
        </div>
      </div>

      <!-- Activity Log -->
      <div class="border-t border-hq-border shrink-0">
        <button @click="logExpanded = !logExpanded"
                class="w-full flex items-center justify-between px-4 py-2 hover:bg-white/[0.10] transition-colors">
          <div class="flex items-center gap-2">
            <svg class="w-3.5 h-3.5 text-hq-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
            <span class="text-[10px] font-bold text-hq-muted uppercase tracking-[0.15em]">ÌôúÎèô Î°úÍ∑∏</span>
          </div>
          <div class="flex items-center gap-2">
            <span x-show="activityLogs.length > 0"
                  class="text-[9px] font-mono bg-hq-accent/10 text-hq-accent px-1.5 py-0.5 rounded"
                  x-text="activityLogs.length"></span>
            <span class="text-[10px] text-hq-muted transition-transform duration-200"
                  :class="logExpanded ? 'rotate-180' : ''">&#9660;</span>
          </div>
        </button>
        <div x-show="logExpanded" x-collapse>
          <div class="overflow-y-auto scrollbar-thin max-h-52 px-3 pb-3 space-y-0.5">
            <template x-for="(log, i) in activityLogs.slice(-30).reverse()" :key="i">
              <div class="log-item text-[11px] text-hq-muted fade-in">
                <span class="font-mono text-hq-muted/50" x-text="log.time"></span>
                <span class="text-hq-cyan/70 font-medium" x-text="log.agent_id"></span>
                <span x-text="log.action"></span>
              </div>
            </template>
            <template x-if="activityLogs.length === 0">
              <div class="text-[11px] text-hq-muted/40 italic px-2 py-2">ÏïÑÏßÅ ÌôúÎèôÏù¥ ÏóÜÏäµÎãàÎã§</div>
            </template>
          </div>
        </div>
      </div>
    </aside>

    <!-- ‚ïê‚ïê‚ïê Right Panel: Tabs + Content ‚ïê‚ïê‚ïê -->
    <main class="flex-1 flex flex-col overflow-hidden bg-hq-bg">

      <!-- ‚ïê‚ïê‚ïê Error Alert Banner ‚ïê‚ïê‚ïê -->
      <div x-show="errorAlert.visible" x-transition
           class="bg-hq-red/15 border-b border-hq-red/30 px-5 py-2 flex items-center justify-between shrink-0" style="display:none;">
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-hq-red" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
          <span class="text-sm text-hq-red font-medium" x-text="errorAlert.message"></span>
        </div>
        <button @click="errorAlert.visible = false" class="text-hq-red/50 hover:text-hq-red text-lg">&times;</button>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab Navigation (Ï±ÑÌåÖ Î™®ÎìúÏùº ÎïåÎßå ÌëúÏãú) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat'" class="flex items-center gap-0.5 px-3 pt-1.5 pb-0 border-b border-hq-border bg-hq-surface/50 shrink-0 mobile-tabs-scroll">
        <!-- Í∏∞Î≥∏ ÌÉ≠ 5Í∞ú (#12) -->
        <template x-for="tab in getPrimaryTabs()" :key="tab.id">
          <button @click="switchTab(tab.id); showMoreTabs = false"
                  :class="activeTab === tab.id
                    ? 'text-white border-hq-accent bg-hq-accent/10'
                    : 'text-hq-muted border-transparent hover:text-hq-text hover:bg-white/[0.10]'"
                  class="flex items-center gap-1.5 px-3 py-2 text-[11px] font-semibold border-b-2 transition-all rounded-t-lg whitespace-nowrap">
            <span x-html="tab.icon" class="w-3.5 h-3.5"></span>
            <span x-text="tab.label"></span>
          </button>
        </template>
        <!-- ÎçîÎ≥¥Í∏∞ ÎìúÎ°≠Îã§Ïö¥ -->
        <div class="relative">
          <button @click="showMoreTabs = !showMoreTabs"
                  :class="getSecondaryTabs().some(t => t.id === activeTab)
                    ? 'text-white border-hq-accent bg-hq-accent/10'
                    : 'text-hq-muted border-transparent hover:text-hq-text hover:bg-white/[0.10]'"
                  class="flex items-center gap-1 px-3 py-2 text-[11px] font-semibold border-b-2 transition-all rounded-t-lg whitespace-nowrap">
            <span x-text="getSecondaryTabs().find(t => t.id === activeTab)?.label || 'ÎçîÎ≥¥Í∏∞'"></span>
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
          </button>
          <div x-show="showMoreTabs" @click.outside="showMoreTabs = false" x-transition
               class="absolute top-full left-0 mt-1 glass border border-hq-border rounded-xl py-1 shadow-xl z-30 min-w-[140px]" style="display:none;">
            <template x-for="tab in getSecondaryTabs()" :key="tab.id">
              <button @click="switchTab(tab.id); showMoreTabs = false"
                      :class="activeTab === tab.id ? 'bg-hq-accent/10 text-hq-accent' : 'text-hq-muted hover:text-hq-text hover:bg-white/[0.10]'"
                      class="flex items-center gap-2 w-full px-3 py-2 text-xs transition">
                <span x-html="tab.icon" class="w-3.5 h-3.5"></span>
                <span x-text="tab.label"></span>
              </button>
            </template>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab: Ìôà (Home Dashboard) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'home'" x-cloak class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
        <div class="max-w-5xl mx-auto fade-in-up">
          <div class="mb-6">
            <h1 class="text-2xl font-bold gradient-text mb-1">CORTHEX HQ ÎåÄÏãúÎ≥¥Îìú</h1>
            <p class="text-sm text-hq-muted">AI ÏóêÏù¥Ï†ÑÌä∏ Í∏∞ÏóÖ ÌòÑÌô©ÏùÑ ÌïúÎààÏóê ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
          </div>

          <!-- Summary Cards -->
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg bg-hq-accent/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                </div>
                <div>
                  <div class="text-xl font-bold text-hq-text" x-text="dashboard.todayTasks || 0"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">Ïò§Îäò ÏûëÏóÖ</div>
                </div>
              </div>
              <div class="flex items-center gap-2 text-[11px]">
                <span class="text-hq-green" x-text="'ÏôÑÎ£å ' + (dashboard.todayCompleted || 0)"></span>
                <span class="text-hq-muted">¬∑</span>
                <span class="text-hq-yellow" x-text="'ÏßÑÌñâ ' + (dashboard.runningCount || 0)"></span>
              </div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg bg-hq-green/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div>
                  <div class="text-xl font-bold text-hq-text" x-text="'$' + (dashboard.totalCost || 0).toFixed(4)"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">ÎàÑÏ†Å ÎπÑÏö©</div>
                </div>
              </div>
              <div class="text-[11px] text-hq-muted" x-text="(dashboard.totalTokens || 0).toLocaleString() + ' ÌÜ†ÌÅ∞'"></div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg bg-hq-purple/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                </div>
                <div>
                  <div class="text-xl font-bold text-hq-text" x-text="dashboard.agentCount || 0"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">ÏóêÏù¥Ï†ÑÌä∏</div>
                </div>
              </div>
              <div class="text-[11px] text-hq-muted">4Í∞ú Î≥∏Î∂Ä Ïö¥ÏòÅ Ï§ë</div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg flex items-center justify-center"
                     :class="dashboard.systemHealth === 'ok' ? 'bg-hq-green/15' : 'bg-hq-red/15'">
                  <svg class="w-4.5 h-4.5" :class="dashboard.systemHealth === 'ok' ? 'text-hq-green' : 'text-hq-red'" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div>
                  <div class="text-xl font-bold text-hq-text" x-text="dashboard.systemHealth === 'ok' ? 'Ï†ïÏÉÅ' : 'Ï†êÍ≤Ä'"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">ÏãúÏä§ÌÖú</div>
                </div>
              </div>
              <div class="flex items-center gap-1.5 text-[11px]">
                <span class="w-1.5 h-1.5 rounded-full" :class="wsConnected ? 'bg-hq-green' : 'bg-hq-red'"></span>
                <span class="text-hq-muted" x-text="wsConnected ? 'Ïó∞Í≤∞Îê®' : 'ÎÅäÍπÄ'"></span>
              </div>
            </div>
          </div>

          <!-- Feedback + Budget Row -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-8">
            <!-- CEO ÎßåÏ°±ÎèÑ Ïπ¥Îìú (#7) -->
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg bg-hq-yellow/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div class="flex-1">
                  <div class="text-xl font-bold text-hq-text" x-text="(feedbackStats.satisfaction_rate || 0) + '%'"></div>
                  <div class="text-[10px] text-hq-muted uppercase tracking-wider">CEO ÎßåÏ°±ÎèÑ</div>
                </div>
              </div>
              <div class="flex items-center gap-3 text-[11px]">
                <span class="text-hq-green" x-text="'Ï¢ãÏïÑÏöî ' + (feedbackStats.good || 0)"></span>
                <span class="text-hq-muted">¬∑</span>
                <span class="text-hq-red" x-text="'ÏïÑÏâ¨ÏõåÏöî ' + (feedbackStats.bad || 0)"></span>
                <span class="text-hq-muted">¬∑</span>
                <span class="text-hq-muted" x-text="'Ï¥ù ' + (feedbackStats.total || 0) + 'Í±¥'"></span>
              </div>
            </div>
            <!-- ÏòàÏÇ∞ ÌòÑÌô© + ÏàòÏ†ï Ïπ¥Îìú (#8) -->
            <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-9 h-9 rounded-lg bg-hq-cyan/15 flex items-center justify-center">
                  <svg class="w-4.5 h-4.5 text-hq-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                </div>
                <div class="flex-1">
                  <div class="text-sm font-bold text-hq-text">ÏòàÏÇ∞</div>
                  <div class="text-[10px] text-hq-muted">ÏùºÏùº $<span x-text="(budget.daily_limit || 0).toFixed(2)"></span> / Ïõî $<span x-text="(budget.monthly_limit || 0).toFixed(2)"></span></div>
                </div>
                <button @click="showBudgetEdit = true; budgetEditDaily = budget.daily_limit || 0; budgetEditMonthly = budget.monthly_limit || 0"
                        class="text-xs text-hq-accent hover:text-hq-accent/80 px-2 py-1 border border-hq-accent/20 rounded-lg">ÏàòÏ†ï</button>
              </div>
              <div class="w-full bg-hq-bg rounded-full h-2 mt-1">
                <div class="bg-gradient-to-r from-hq-green to-hq-yellow h-2 rounded-full transition-all"
                     :style="'width:' + Math.min(100, ((budget.today_spent || 0) / Math.max(budget.daily_limit || 1, 0.01)) * 100) + '%'"></div>
              </div>
              <div class="text-[10px] text-hq-muted mt-1">Ïò§Îäò ÏÇ¨Ïö©: $<span x-text="(budget.today_spent || 0).toFixed(4)"></span></div>
            </div>
          </div>

          <!-- Recent Completed Tasks -->
          <div class="glass border border-hq-border rounded-xl p-5 mb-6">
            <h2 class="text-sm font-bold text-hq-text mb-4 flex items-center gap-2">
              <svg class="w-4 h-4 text-hq-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              ÏµúÍ∑º ÏôÑÎ£å ÏûëÏóÖ
            </h2>
            <template x-if="dashboard.recentCompleted && dashboard.recentCompleted.length > 0">
              <div class="space-y-2">
                <template x-for="task in dashboard.recentCompleted" :key="task.task_id">
                  <div class="flex items-center justify-between p-3 bg-hq-bg/50 rounded-lg hover:bg-hq-bg transition cursor-pointer"
                       @click="switchTab('history')">
                    <div class="flex-1 min-w-0">
                      <div class="text-sm text-hq-text truncate" x-text="task.command"></div>
                      <div class="text-[11px] text-hq-muted mt-0.5" x-text="new Date(task.created_at).toLocaleString('ko-KR', {timeZone:'Asia/Seoul'})"></div>
                    </div>
                    <div class="flex items-center gap-3 shrink-0 ml-4">
                      <span class="text-[11px] font-mono text-hq-green" x-text="task.time_seconds + 'Ï¥à'"></span>
                      <span class="text-[11px] font-mono text-hq-muted" x-text="'$' + (task.cost || 0).toFixed(4)"></span>
                    </div>
                  </div>
                </template>
              </div>
            </template>
            <template x-if="!dashboard.recentCompleted || dashboard.recentCompleted.length === 0">
              <div class="text-center py-8 text-hq-muted/50 text-sm">ÏïÑÏßÅ ÏôÑÎ£åÎêú ÏûëÏóÖÏù¥ ÏóÜÏäµÎãàÎã§</div>
            </template>
          </div>

          <!-- Quick Commands -->
          <div class="glass border border-hq-border rounded-xl p-5">
            <h2 class="text-sm font-bold text-hq-text mb-4 flex items-center gap-2">
              <svg class="w-4 h-4 text-hq-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              Îπ†Î•∏ Î™ÖÎ†π
            </h2>
            <div class="grid grid-cols-2 lg:grid-cols-3 gap-3">
              <template x-for="p in presets.items" :key="p.name">
                <button @click="switchTab('command'); $nextTick(() => sendPreset(p.command))"
                        class="text-left p-3 bg-hq-bg/50 rounded-lg hover:bg-hq-bg border border-transparent hover:border-hq-accent/20 transition group">
                  <div class="text-sm font-medium text-hq-text group-hover:text-hq-text" x-text="p.name"></div>
                  <div class="text-[11px] text-hq-muted mt-1 truncate" x-text="p.command"></div>
                </button>
              </template>
              <button @click="switchTab('command')"
                      class="text-left p-3 bg-hq-bg/50 rounded-lg hover:bg-hq-bg border border-dashed border-hq-border hover:border-hq-accent/30 transition group flex items-center justify-center min-h-[60px]">
                <span class="text-sm text-hq-muted group-hover:text-hq-accent">+ ÏßÅÏ†ë Î™ÖÎ†π</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab: Î™ÖÎ†π (Command) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'command'" x-cloak class="flex-1 flex flex-col overflow-hidden">

        <!-- Chat Messages -->
        <div class="flex-1 overflow-y-auto scrollbar-thin p-6 space-y-4 bg-grid" id="chatArea" x-ref="chatArea">

          <!-- ‚ïê‚ïê‚ïê Welcome Screen ‚ïê‚ïê‚ïê -->
          <template x-if="messages.length === 0 && viewMode === 'chat'">
            <div class="flex flex-col items-center justify-center h-full text-center fade-in-up">
              <div class="mb-6 relative">
                <svg width="72" height="72" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="drop-shadow-lg">
                  <defs><linearGradient id="heroGrad" x1="0" y1="0" x2="32" y2="32"><stop offset="0%" stop-color="#06b6d4"/><stop offset="50%" stop-color="#3b82f6"/><stop offset="100%" stop-color="#8b5cf6"/></linearGradient></defs>
                  <path d="M16 2L28 9V23L16 30L4 23V9L16 2Z" stroke="url(#heroGrad)" stroke-width="1.5" fill="none"/>
                  <path d="M16 6L24 10.5V21.5L16 26L8 21.5V10.5L16 6Z" stroke="url(#heroGrad)" stroke-width="1" fill="none" opacity="0.4"/>
                  <circle cx="16" cy="16" r="4" fill="url(#heroGrad)" opacity="0.8"/><circle cx="16" cy="16" r="2" fill="#0a0e1a"/>
                  <line x1="16" y1="12" x2="16" y2="6" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="19.5" y1="14" x2="24" y2="10.5" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="19.5" y1="18" x2="24" y2="21.5" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="16" y1="20" x2="16" y2="26" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="12.5" y1="18" x2="8" y2="21.5" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                  <line x1="12.5" y1="14" x2="8" y2="10.5" stroke="url(#heroGrad)" stroke-width="1" opacity="0.5"/>
                </svg>
                <div class="absolute inset-0 bg-hq-accent/10 rounded-full blur-3xl scale-150"></div>
              </div>

              <h1 class="text-4xl font-extrabold gradient-text mb-2 tracking-tight">CORTHEX HQ</h1>
              <p class="text-lg text-hq-text/80 mb-1" x-text="greeting"></p>
              <p class="text-hq-muted text-sm mb-8 max-w-sm leading-relaxed">
                4Í∞ú Î≥∏Î∂Ä, 25Î™ÖÏùò ÏóêÏù¥Ï†ÑÌä∏Í∞Ä Î™ÖÎ†πÏùÑ ÎåÄÍ∏∞ÌïòÍ≥† ÏûàÏäµÎãàÎã§
              </p>

              <div class="flex gap-3 mb-6">
                <div class="glass border border-hq-border rounded-xl px-4 py-3 hover-glow cursor-default">
                  <div class="text-lg font-bold text-hq-cyan">4</div><div class="text-[10px] text-hq-muted uppercase tracking-wider">Î≥∏Î∂Ä</div>
                </div>
                <div class="glass border border-hq-border rounded-xl px-4 py-3 hover-glow cursor-default">
                  <div class="text-lg font-bold text-hq-accent">25</div><div class="text-[10px] text-hq-muted uppercase tracking-wider">ÏóêÏù¥Ï†ÑÌä∏</div>
                </div>
                <div class="glass border border-hq-border rounded-xl px-4 py-3 hover-glow cursor-default">
                  <div class="text-lg font-bold text-hq-purple">5</div><div class="text-[10px] text-hq-muted uppercase tracking-wider">ÎèÑÍµ¨</div>
                </div>
                <div class="glass border border-hq-border rounded-xl px-4 py-3 hover-glow cursor-default">
                  <div class="text-lg font-bold text-hq-green">2</div><div class="text-[10px] text-hq-muted uppercase tracking-wider">AI Î™®Îç∏</div>
                </div>
              </div>

              <!-- Preset Category Tabs -->
              <div class="flex gap-2 mb-4">
                <template x-for="tab in presetTabs" :key="tab">
                  <button @click="presetTab = tab"
                    :class="presetTab === tab ? 'bg-hq-accent/20 border-hq-accent/40 text-hq-accent' : 'bg-hq-surface border-hq-border text-hq-muted hover:text-hq-text'"
                    class="border rounded-lg px-3 py-1.5 text-xs font-semibold transition-all" x-text="tab"></button>
                </template>
              </div>

              <!-- Preset Commands Grid -->
              <div class="grid grid-cols-2 gap-3 max-w-lg w-full max-h-[300px] overflow-y-auto scrollbar-thin">
                <template x-for="preset in getFilteredPresets()" :key="preset.name">
                  <div class="glass border border-hq-border rounded-xl px-4 py-3.5 text-left hover-lift hover-glow group relative">
                    <div @click="sendPreset(preset.command)" class="cursor-pointer">
                      <div class="flex items-center gap-2 mb-1.5">
                        <div class="w-7 h-7 rounded-lg flex items-center justify-center" :class="'bg-' + preset.color + '/15'">
                          <span class="w-3 h-3 rounded-full" :class="'bg-' + preset.color"></span>
                        </div>
                        <span class="text-sm font-semibold text-hq-text group-hover:text-hq-text transition-colors" x-text="preset.name"></span>
                      </div>
                      <p class="text-[11px] text-hq-muted leading-relaxed" x-text="preset.desc"></p>
                    </div>
                    <button x-show="preset.isServer" @click.stop="deletePreset(preset.name)"
                      class="absolute top-2 right-2 text-hq-muted/30 hover:text-hq-red text-xs transition opacity-0 group-hover:opacity-100" title="ÏÇ≠Ï†ú">&times;</button>
                  </div>
                </template>
              </div>
              <!-- Add Preset Button & Form -->
              <div class="mt-3 max-w-lg w-full">
                <button x-show="!showAddPreset" @click="showAddPreset = true"
                  class="text-xs text-hq-accent hover:text-hq-accent/80 transition">+ ÏÉà ÌîÑÎ¶¨ÏÖã Ï∂îÍ∞Ä</button>
                <div x-show="showAddPreset" x-transition class="glass border border-hq-border rounded-xl p-3 space-y-2">
                  <input x-model="newPresetName" placeholder="ÌîÑÎ¶¨ÏÖã Ïù¥Î¶Ñ" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-1.5 text-sm text-hq-text placeholder-hq-muted/40">
                  <input x-model="newPresetCommand" placeholder="Î™ÖÎ†πÏñ¥" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-1.5 text-sm text-hq-text placeholder-hq-muted/40">
                  <div class="flex gap-2">
                    <button @click="addPreset()" class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-3 py-1 text-xs">Ï∂îÍ∞Ä</button>
                    <button @click="showAddPreset = false; newPresetName = ''; newPresetCommand = ''" class="bg-hq-surface hover:bg-hq-panel text-hq-text rounded-lg px-3 py-1 text-xs">Ï∑®ÏÜå</button>
                  </div>
                </div>
              </div>
              <p class="text-[11px] text-hq-muted/40 mt-4">ÏûêÏú†Î°≠Í≤å Î™ÖÎ†πÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Shift+Enter: Ï§ÑÎ∞îÍøà)</p>
            </div>
          </template>

          <!-- ‚ïê‚ïê‚ïê Messages ‚ïê‚ïê‚ïê -->
          <template x-for="(msg, i) in messages" :key="i">
            <div class="fade-in-up">

              <!-- User message -->
              <template x-if="msg.type === 'user'">
                <div class="flex justify-end mb-4">
                  <div class="max-w-2xl">
                    <div class="bg-gradient-to-br from-hq-accent/20 to-hq-purple/10 border border-hq-accent/20 rounded-2xl rounded-tr-md px-5 py-3.5 glow-blue">
                      <div class="flex items-center gap-2 mb-1.5">
                        <div class="w-5 h-5 rounded-md bg-gradient-to-br from-hq-accent to-hq-purple flex items-center justify-center">
                          <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                        </div>
                        <span class="text-[11px] font-bold text-hq-accent uppercase tracking-wider">CEO Î™ÖÎ†π</span>
                      </div>
                      <div class="text-hq-text text-sm leading-relaxed whitespace-pre-wrap" x-text="msg.text"></div>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Processing indicator -->
              <template x-if="msg.type === 'processing'">
                <div class="mb-4">
                  <div class="max-w-3xl">
                    <div class="glass border border-hq-yellow/20 rounded-2xl rounded-tl-md px-5 py-4">
                      <div class="flex items-center gap-2 mb-3">
                        <span class="w-2 h-2 rounded-full bg-hq-yellow pulse-dot"></span>
                        <span class="text-xs font-bold text-hq-yellow uppercase tracking-wider">ÏóêÏù¥Ï†ÑÌä∏ ÏûëÏóÖÏ§ë</span>
                        <div class="ml-auto flex gap-1">
                          <span class="w-1 h-1 rounded-full bg-hq-yellow/60 pulse-dot" style="animation-delay:0s"></span>
                          <span class="w-1 h-1 rounded-full bg-hq-yellow/60 pulse-dot" style="animation-delay:0.3s"></span>
                          <span class="w-1 h-1 rounded-full bg-hq-yellow/60 pulse-dot" style="animation-delay:0.6s"></span>
                        </div>
                      </div>
                      <div class="space-y-2.5">
                        <template x-for="(status, agentId) in activeAgents" :key="agentId">
                          <div x-show="status.status === 'working'" class="fade-in cursor-pointer" @click="scrollToAgent(agentId)">
                            <div class="flex items-center justify-between mb-1">
                              <div class="flex items-center gap-2">
                                <div class="w-5 h-5 rounded-md flex items-center justify-center text-[8px] font-bold"
                                     :class="getAgentAvatarClass(agentId)" x-text="getAgentInitials(agentId)"></div>
                                <span class="text-xs text-hq-text/80 font-medium" x-text="getAgentName(agentId)"></span>
                              </div>
                              <span class="text-[10px] font-mono text-hq-yellow" x-text="Math.round(status.progress * 100) + '%'"></span>
                            </div>
                            <div x-show="status.detail" class="text-[10px] text-hq-muted mb-1 pl-7 truncate" x-text="status.detail"></div>
                            <div class="h-1 bg-hq-bg rounded-full overflow-hidden">
                              <div class="h-full rounded-full progress-bar bg-gradient-to-r from-hq-yellow to-hq-accent"
                                   :style="'width:' + (status.progress * 100) + '%'"></div>
                            </div>
                          </div>
                        </template>
                      </div>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Agent result -->
              <template x-if="msg.type === 'result'">
                <div class="mb-4">
                  <div class="max-w-4xl">
                    <div class="glass border border-hq-green/20 rounded-2xl rounded-tl-md overflow-hidden">
                      <div class="flex items-center justify-between px-5 py-3 border-b border-hq-border/50 bg-hq-green/[0.03]">
                        <div class="flex items-center gap-2.5">
                          <div class="w-2 h-2 rounded-full bg-hq-green"></div>
                          <span class="text-xs font-bold text-hq-green uppercase tracking-wider" x-text="getAgentName(msg.sender_id) || 'Í≤∞Í≥º'"></span>
                          <template x-if="msg.quality_score">
                            <span class="status-badge border" :class="getQualityBadge(msg.quality_score).cls" x-text="getQualityBadge(msg.quality_score).label"></span>
                          </template>
                        </div>
                        <div class="flex items-center gap-3">
                          <div class="flex items-center gap-4 text-[11px] font-mono text-hq-muted">
                            <div class="flex items-center gap-1">
                              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                              <span x-text="msg.time_seconds + 's'"></span>
                            </div>
                            <div class="flex items-center gap-1">
                              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                              <span x-text="'$' + (msg.cost || 0).toFixed(4)"></span>
                            </div>
                          </div>
                          <button @click="copyToClipboard(msg.content)" class="text-hq-muted hover:text-hq-green transition p-1" title="Î≥µÏÇ¨">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                          </button>
                          <!-- Feedback Buttons -->
                          <div class="flex items-center gap-0.5 border-l border-hq-border/40 pl-2 ml-1">
                            <button @click="sendFeedback(msg, 'good')" :disabled="msg.feedbackSent"
                              :class="msg.feedbackRating === 'good' ? 'text-hq-green' : 'text-hq-muted hover:text-hq-green'"
                              class="transition p-1 disabled:opacity-50" title="Ï¢ãÏïÑÏöî">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/></svg>
                            </button>
                            <button @click="sendFeedback(msg, 'bad')" :disabled="msg.feedbackSent"
                              :class="msg.feedbackRating === 'bad' ? 'text-hq-red' : 'text-hq-muted hover:text-hq-red'"
                              class="transition p-1 disabled:opacity-50" title="ÏïÑÏâ¨ÏõåÏöî">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018c.163 0 .326.02.485.06L17 4m-7 10v2a3.5 3.5 0 003.5 3.5h.5a2 2 0 002-2v-.5c0-.966-.393-1.84-1.027-2.472L17 13V4m-7 10h2M17 4h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"/></svg>
                            </button>
                          </div>
                          <button x-show="isLongContent(msg.content)" @click="msg.collapsed = !msg.collapsed"
                            class="text-hq-muted hover:text-hq-text transition p-1" title="Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞">
                            <svg class="w-4 h-4 transition-transform" :class="msg.collapsed ? '' : 'rotate-180'" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
                          </button>
                        </div>
                      </div>
                      <div class="px-5 py-4" x-show="!msg.collapsed" x-collapse>
                        <div class="text-sm leading-relaxed markdown-body" x-html="renderMarkdown(msg.content)"></div>
                      </div>
                      <div x-show="msg.collapsed" class="px-5 py-3">
                        <div class="text-sm text-hq-muted italic">Í≤∞Í≥ºÍ∞Ä Ï†ëÌòÄÏûàÏäµÎãàÎã§. ÏúÑ Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÌéºÏπ©ÎãàÎã§. <span class="text-[11px] font-mono ml-2" x-text="'(' + (msg.content?.length || 0) + 'Ïûê)'"></span></div>
                      </div>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Error -->
              <template x-if="msg.type === 'error'">
                <div class="mb-4">
                  <div class="max-w-2xl">
                    <div class="bg-hq-red/5 border border-hq-red/20 rounded-2xl rounded-tl-md px-5 py-4">
                      <div class="flex items-center gap-2 mb-2">
                        <svg class="w-4 h-4 text-hq-red" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
                        <span class="text-xs font-bold text-hq-red uppercase tracking-wider">Ïò§Î•ò</span>
                      </div>
                      <div class="text-sm text-hq-text/80" x-text="msg.text"></div>
                    </div>
                  </div>
                </div>
              </template>

            </div>
          </template>
        </div>

        <!-- ‚ïê‚ïê‚ïê Input Bar ‚ïê‚ïê‚ïê -->
        <div class="border-t border-hq-border bg-hq-surface/80 backdrop-blur-sm p-4 shrink-0">
          <div class="max-w-4xl mx-auto relative">
            <!-- Export + Shortcut hint -->
            <div x-show="messages.length > 0" class="flex items-center justify-end gap-2 mb-2">
              <button @click="exportConversation()"
                      class="text-[10px] text-hq-muted/60 hover:text-hq-accent flex items-center gap-1 transition">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                ÎåÄÌôî ÎÇ¥Î≥¥ÎÇ¥Í∏∞
              </button>
              <!-- Batch/Ïã§ÏãúÍ∞Ñ ÌÜ†Í∏Ä -->
              <button @click="useBatch = !useBatch"
                      :class="useBatch ? 'bg-hq-purple/20 text-hq-purple border-hq-purple/30' : 'text-hq-muted/60 border-hq-border/30'"
                      class="text-[10px] flex items-center gap-1 px-2 py-0.5 border rounded-md transition">
                <span x-text="useBatch ? 'Batch (Ï†ÄÎ†¥)' : 'Ïã§ÏãúÍ∞Ñ'"></span>
              </button>
              <span class="text-[9px] text-hq-muted/30 font-mono">Ctrl+K</span>
            </div>
            <!-- @mention dropdown -->
            <div x-show="showMentionDropdown" x-transition
                 class="absolute bottom-full mb-2 left-0 w-64 glass border border-hq-border rounded-xl overflow-hidden shadow-xl z-10">
              <template x-for="agent in mentionResults" :key="agent.id">
                <button @click="insertMention(agent)"
                  class="w-full px-3 py-2 text-left text-sm hover:bg-hq-accent/10 flex items-center gap-2 transition-colors">
                  <span class="w-6 h-6 rounded-md flex items-center justify-center text-[9px] font-bold"
                    :class="getAgentAvatarClass(agent.id)" x-text="getAgentInitials(agent.id)"></span>
                  <span class="text-hq-text" x-text="agent.name"></span>
                  <span class="text-hq-muted text-xs ml-auto" x-text="'@' + agent.id"></span>
                </button>
              </template>
            </div>
            <div class="flex items-end gap-3">
              <div class="flex-1 relative">
                <textarea x-model="inputText" x-ref="inputArea"
                  @keydown="handleInputKeydown($event)" @input="handleInputChange($event)"
                  :disabled="systemStatus === 'working'"
                  placeholder="Î™ÖÎ†πÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Shift+Enter: Ï§ÑÎ∞îÍøà)"
                  rows="1"
                  class="w-full bg-hq-bg border border-hq-border rounded-xl px-4 py-3 pr-10 text-sm text-hq-text
                         placeholder-hq-muted/50 focus:outline-none focus:border-hq-accent/50 input-glow
                         disabled:opacity-40 disabled:cursor-not-allowed transition-all resize-none overflow-hidden"
                  style="min-height:44px; max-height:200px;" autofocus></textarea>
                <div class="absolute right-3 bottom-3 text-[10px] font-mono text-hq-muted/30"
                     x-show="!inputText.trim() && systemStatus !== 'working'">Enter &#9166;</div>
              </div>
              <button x-show="systemStatus !== 'working'" @click="sendMessage()"
                :disabled="!inputText.trim()"
                class="bg-gradient-to-r from-hq-accent to-hq-purple hover:from-blue-500 hover:to-violet-500
                       disabled:from-gray-700 disabled:to-gray-700 disabled:text-hq-muted
                       text-white rounded-xl px-6 py-3 text-sm font-semibold transition-all shrink-0
                       hover:shadow-lg hover:shadow-hq-accent/20 disabled:shadow-none">Î≥¥ÎÇ¥Í∏∞</button>
              <button x-show="systemStatus === 'working'" @click="cancelTask()"
                class="bg-hq-red/20 border border-hq-red/30 hover:bg-hq-red/30
                       text-hq-red rounded-xl px-6 py-3 text-sm font-semibold transition-all shrink-0 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                Ï∑®ÏÜå
              </button>
            </div>
          </div>
        <!-- Preset Chips -->
        <div x-show="presets.items.length > 0" class="flex items-center gap-2 flex-wrap mt-2 max-w-4xl mx-auto">
          <template x-for="p in presets.items" :key="p.name">
            <button @click="sendPreset(p.command)"
                    :disabled="systemStatus === 'working'"
                    class="text-[11px] bg-hq-panel border border-hq-border rounded-lg px-2.5 py-1 hover:border-hq-accent/40 hover:text-hq-accent transition disabled:opacity-30 text-hq-muted">
              <span x-text="p.name"></span>
            </button>
          </template>
          <button @click="presets.showModal = true" class="text-[11px] text-hq-muted/50 hover:text-hq-accent transition px-1">
            <svg class="w-3.5 h-3.5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
          </button>
        </div>
      </div>
      </div><!-- /command tab -->

      <!-- ‚ïê‚ïê‚ïê Tab: ÏÑ±Îä• (Performance) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'performance'" x-cloak class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
        <div class="max-w-5xl mx-auto fade-in-up">
          <h1 class="text-xl font-bold text-hq-text mb-1">ÏóêÏù¥Ï†ÑÌä∏ ÏÑ±Îä•</h1>
          <p class="text-sm text-hq-muted mb-6">ÏóêÏù¥Ï†ÑÌä∏Î≥Ñ ÏûëÏóÖ ÌÜµÍ≥ÑÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>

          <!-- Performance Summary Cards -->
          <div class="grid grid-cols-4 gap-4 mb-6">
            <div class="glass border border-hq-border rounded-xl p-4">
              <div class="text-xl font-bold text-hq-text" x-text="performance.totalCalls || 0"></div>
              <div class="text-[10px] text-hq-muted uppercase">Ï¥ù LLM Ìò∏Ï∂ú</div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4">
              <div class="text-xl font-bold text-hq-green" x-text="'$' + (performance.totalCost || 0).toFixed(4)"></div>
              <div class="text-[10px] text-hq-muted uppercase">Ï¥ù ÎπÑÏö©</div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4">
              <div class="text-xl font-bold text-hq-text" x-text="performance.totalTasks || 0"></div>
              <div class="text-[10px] text-hq-muted uppercase">Ï¥ù ÏûëÏóÖ</div>
            </div>
            <div class="glass border border-hq-border rounded-xl p-4">
              <div class="text-xl font-bold text-hq-cyan" x-text="(performance.avgSuccessRate || 0).toFixed(0) + '%'"></div>
              <div class="text-[10px] text-hq-muted uppercase">ÌèâÍ∑† ÏÑ±Í≥µÎ•†</div>
            </div>
          </div>

          <!-- Agent Performance Table -->
          <div class="glass border border-hq-border rounded-xl overflow-hidden">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b border-hq-border text-[11px] text-hq-muted uppercase">
                  <th class="text-left px-4 py-3">ÏóêÏù¥Ï†ÑÌä∏</th>
                  <th class="text-right px-4 py-3">Ìò∏Ï∂ú</th>
                  <th class="text-right px-4 py-3">ÎπÑÏö©</th>
                  <th class="text-right px-4 py-3">ÏûëÏóÖ</th>
                  <th class="text-right px-4 py-3">ÏÑ±Í≥µÎ•†</th>
                  <th class="text-right px-4 py-3">ÌèâÍ∑† ÏãúÍ∞Ñ</th>
                  <th class="px-4 py-3 w-32">ÎπÑÏö© ÎπÑÏú®</th>
                  <th class="px-4 py-3">Í∏∞Ïñµ</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="a in performance.agents" :key="a.agent_id">
                  <tr class="border-b border-hq-border/50 hover:bg-white/[0.10]">
                    <td class="px-4 py-2.5">
                      <div class="text-hq-text font-medium" x-text="a.name_ko"></div>
                      <div class="text-[10px] text-hq-muted" x-text="a.role"></div>
                    </td>
                    <td class="text-right px-4 py-2.5 font-mono text-hq-text" x-text="a.llm_calls"></td>
                    <td class="text-right px-4 py-2.5 font-mono text-hq-green" x-text="'$' + (a.cost_usd || 0).toFixed(4)"></td>
                    <td class="text-right px-4 py-2.5 font-mono text-hq-text" x-text="a.tasks_completed"></td>
                    <td class="text-right px-4 py-2.5">
                      <span class="font-mono" :class="(a.success_rate||0) >= 80 ? 'text-hq-green' : (a.success_rate||0) >= 50 ? 'text-hq-yellow' : 'text-hq-red'"
                            x-text="(a.success_rate || 0).toFixed(0) + '%'"></span>
                    </td>
                    <td class="text-right px-4 py-2.5 font-mono text-hq-muted" x-text="(a.avg_execution_seconds || 0).toFixed(1) + 'Ï¥à'"></td>
                    <td class="px-4 py-2.5">
                      <div class="h-2 bg-hq-bg rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-hq-accent to-hq-cyan rounded-full transition-all"
                             :style="'width:' + (performance.maxCost > 0 ? ((a.cost_usd || 0) / performance.maxCost * 100) : 0) + '%'"></div>
                      </div>
                    </td>
                    <td class="px-4 py-2.5 text-center">
                      <button @click="openMemoryModal(a.agent_id, a.name_ko)"
                              class="text-[10px] px-2 py-1 rounded border border-hq-purple/30 text-hq-purple hover:bg-hq-purple/10 transition">Í∏∞Ïñµ</button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
            <template x-if="!performance.agents || performance.agents.length === 0">
              <div class="text-center py-12 text-hq-muted/50 text-sm">ÏÑ±Îä• Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÏûëÏóÖÏùÑ Ïã§ÌñâÌïòÎ©¥ ÌÜµÍ≥ÑÍ∞Ä ÏåìÏûÖÎãàÎã§.</div>
            </template>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Office View (Í∞ÄÏÉÅ ÏÇ¨Î¨¥Ïã§) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'office'" x-transition.opacity.duration.200ms class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
        <div class="max-w-5xl mx-auto space-y-5 fade-in-up">

          <!-- CEO ÏÇ¨Î¨¥Ïã§ -->
          <div class="office-room glass border border-hq-accent/20 bg-gradient-to-br from-hq-accent/5 to-hq-purple/5">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üëî</span>
              <span class="text-sm font-bold text-hq-accent uppercase tracking-wider">CEO ÏÇ¨Î¨¥Ïã§</span>
            </div>
            <div class="flex gap-3">
              <div class="desk-card glass border border-hq-accent/30 w-[160px] cursor-default">
                <div class="flex items-center justify-between mb-2">
                  <div class="agent-avatar bg-gradient-to-br from-hq-accent to-hq-purple text-white text-[10px]">CEO</div>
                  <div class="status-light status-light-working"></div>
                </div>
                <div class="text-sm font-semibold text-hq-text">CEO</div>
                <div class="text-[10px] text-hq-muted">Ï¥ùÍ¥Ñ ÏÇ¨Î†πÍ¥Ä (You)</div>
              </div>
            </div>
          </div>

          <!-- ÎπÑÏÑúÏã§ -->
          <div class="office-room glass border border-hq-yellow/20 bg-hq-yellow/[0.06]">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üìã</span>
              <span class="text-sm font-bold text-hq-yellow uppercase tracking-wider">ÎπÑÏÑúÏã§</span>
              <span class="text-[10px] text-hq-muted ml-auto">4Î™Ö</span>
            </div>
            <div class="grid grid-cols-4 gap-3">
              <template x-for="id in ['chief_of_staff', 'report_worker', 'schedule_worker', 'relay_worker']" :key="id">
                <div class="desk-card glass border border-hq-border hover:border-hq-yellow/30" @click="openAgentConfig(id)">
                  <div class="flex items-center justify-between mb-2">
                    <div class="agent-avatar bg-hq-yellow/20 text-hq-yellow text-[9px]" x-text="getAgentInitials(id)"></div>
                    <div class="status-light" :class="getAgentStatusLight(id)"></div>
                  </div>
                  <div class="text-xs font-semibold text-hq-text truncate" x-text="getAgentName(id)"></div>
                  <div class="text-[10px] text-hq-muted truncate" x-text="agentRoles[id] || id"></div>
                  <div x-show="agentModels[id]" class="text-[9px] text-hq-muted/60 font-mono truncate" x-text="agentModels[id]"></div>
                </div>
              </template>
            </div>
          </div>

          <!-- LEET Master Î≥∏Î∂Ä -->
          <div class="office-room glass border border-hq-cyan/20 bg-hq-cyan/[0.06]">
            <div class="flex items-center gap-2 mb-4">
              <span class="text-lg">üè¢</span>
              <span class="text-sm font-bold text-hq-cyan uppercase tracking-wider">LEET Master Î≥∏Î∂Ä</span>
              <span class="text-[10px] text-hq-muted ml-auto">16Î™Ö (4Í∞ú Ï≤ò)</span>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <!-- Í∏∞Ïà†Í∞úÎ∞úÏ≤ò CTO -->
              <div class="bg-hq-bg/50 border border-hq-border rounded-xl p-3">
                <div class="flex items-center gap-2 mb-3">
                  <span class="text-sm">üîß</span>
                  <span class="text-xs font-bold text-hq-cyan">Í∏∞Ïà†Í∞úÎ∞úÏ≤ò (CTO)</span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                  <template x-for="id in ['cto_manager','frontend_specialist','backend_specialist','infra_specialist','ai_model_specialist']" :key="id">
                    <div class="desk-card bg-hq-surface border border-hq-border hover:border-hq-cyan/30" @click="openAgentConfig(id)">
                      <div class="flex items-center justify-between mb-1.5">
                        <div class="agent-avatar bg-hq-cyan/20 text-hq-cyan text-[8px]" x-text="getAgentInitials(id)"></div>
                        <div class="status-light" :class="getAgentStatusLight(id)"></div>
                      </div>
                      <div class="text-[11px] font-medium text-hq-text truncate" x-text="getAgentName(id)"></div>
                      <div class="text-[9px] text-hq-muted truncate" x-show="agentRoles[id]" x-text="agentRoles[id]"></div>
                    </div>
                  </template>
                </div>
              </div>
              <!-- ÏÇ¨ÏóÖÍ∏∞ÌöçÏ≤ò CSO -->
              <div class="bg-hq-bg/50 border border-hq-border rounded-xl p-3">
                <div class="flex items-center gap-2 mb-3">
                  <span class="text-sm">üìä</span>
                  <span class="text-xs font-bold text-hq-cyan">ÏÇ¨ÏóÖÍ∏∞ÌöçÏ≤ò (CSO)</span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                  <template x-for="id in ['cso_manager','market_research_specialist','business_plan_specialist','financial_model_specialist']" :key="id">
                    <div class="desk-card bg-hq-surface border border-hq-border hover:border-hq-cyan/30" @click="openAgentConfig(id)">
                      <div class="flex items-center justify-between mb-1.5">
                        <div class="agent-avatar bg-hq-cyan/20 text-hq-cyan text-[8px]" x-text="getAgentInitials(id)"></div>
                        <div class="status-light" :class="getAgentStatusLight(id)"></div>
                      </div>
                      <div class="text-[11px] font-medium text-hq-text truncate" x-text="getAgentName(id)"></div>
                      <div class="text-[9px] text-hq-muted truncate" x-show="agentRoles[id]" x-text="agentRoles[id]"></div>
                    </div>
                  </template>
                </div>
              </div>
              <!-- Î≤ïÎ¨¥ IPÏ≤ò CLO -->
              <div class="bg-hq-bg/50 border border-hq-border rounded-xl p-3">
                <div class="flex items-center gap-2 mb-3">
                  <span class="text-sm">‚öñÔ∏è</span>
                  <span class="text-xs font-bold text-hq-cyan">Î≤ïÎ¨¥ IPÏ≤ò (CLO)</span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                  <template x-for="id in ['clo_manager','copyright_specialist','patent_specialist']" :key="id">
                    <div class="desk-card bg-hq-surface border border-hq-border hover:border-hq-cyan/30" @click="openAgentConfig(id)">
                      <div class="flex items-center justify-between mb-1.5">
                        <div class="agent-avatar bg-hq-cyan/20 text-hq-cyan text-[8px]" x-text="getAgentInitials(id)"></div>
                        <div class="status-light" :class="getAgentStatusLight(id)"></div>
                      </div>
                      <div class="text-[11px] font-medium text-hq-text truncate" x-text="getAgentName(id)"></div>
                      <div class="text-[9px] text-hq-muted truncate" x-show="agentRoles[id]" x-text="agentRoles[id]"></div>
                    </div>
                  </template>
                </div>
              </div>
              <!-- ÎßàÏºÄÌåÖ Í≥†Í∞ùÏ≤ò CMO -->
              <div class="bg-hq-bg/50 border border-hq-border rounded-xl p-3">
                <div class="flex items-center gap-2 mb-3">
                  <span class="text-sm">üì£</span>
                  <span class="text-xs font-bold text-hq-cyan">ÎßàÏºÄÌåÖ Í≥†Í∞ùÏ≤ò (CMO)</span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                  <template x-for="id in ['cmo_manager','survey_specialist','content_specialist','community_specialist']" :key="id">
                    <div class="desk-card bg-hq-surface border border-hq-border hover:border-hq-cyan/30" @click="openAgentConfig(id)">
                      <div class="flex items-center justify-between mb-1.5">
                        <div class="agent-avatar bg-hq-cyan/20 text-hq-cyan text-[8px]" x-text="getAgentInitials(id)"></div>
                        <div class="status-light" :class="getAgentStatusLight(id)"></div>
                      </div>
                      <div class="text-[11px] font-medium text-hq-text truncate" x-text="getAgentName(id)"></div>
                      <div class="text-[9px] text-hq-muted truncate" x-show="agentRoles[id]" x-text="agentRoles[id]"></div>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </div>

          <!-- Ìà¨ÏûêÎ∂ÑÏÑù Î≥∏Î∂Ä -->
          <div class="office-room glass border border-hq-purple/20 bg-hq-purple/[0.06]">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üìà</span>
              <span class="text-sm font-bold text-hq-purple uppercase tracking-wider">Ìà¨ÏûêÎ∂ÑÏÑù Î≥∏Î∂Ä</span>
              <span class="text-[10px] text-hq-muted ml-auto">5Î™Ö</span>
            </div>
            <div class="grid grid-cols-5 gap-3">
              <template x-for="id in ['cio_manager','market_condition_specialist','stock_analysis_specialist','technical_analysis_specialist','risk_management_specialist']" :key="id">
                <div class="desk-card glass border border-hq-border hover:border-hq-purple/30" @click="openAgentConfig(id)">
                  <div class="flex items-center justify-between mb-2">
                    <div class="agent-avatar bg-hq-purple/20 text-hq-purple text-[8px]" x-text="getAgentInitials(id)"></div>
                    <div class="status-light" :class="getAgentStatusLight(id)"></div>
                  </div>
                  <div class="text-[11px] font-medium text-hq-text truncate" x-text="getAgentName(id)"></div>
                  <div class="text-[9px] text-hq-muted truncate" x-show="agentRoles[id]" x-text="agentRoles[id]"></div>
                </div>
              </template>
            </div>
          </div>

          <!-- ÎèÑÍµ¨ ÌíÄ -->
          <div class="office-room glass border border-hq-border bg-hq-red/[0.06]">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üõ†Ô∏è</span>
              <span class="text-sm font-bold text-hq-red/70 uppercase tracking-wider">ÎèÑÍµ¨ ÌíÄ</span>
              <span class="text-[10px] text-hq-muted ml-auto">5Í∞ú</span>
            </div>
            <div class="grid grid-cols-5 gap-3">
              <template x-for="tool in [{n:'Î≥ÄÎ¶¨ÏÇ¨',c:'amber'},{n:'ÏÑ∏Î¨¥ÏÇ¨',c:'emerald'},{n:'ÎîîÏûêÏù¥ÎÑà',c:'pink'},{n:'Î≤àÏó≠Í∞Ä',c:'sky'},{n:'ÏõπÍ≤ÄÏÉâ',c:'orange'}]" :key="tool.n">
                <div class="desk-card bg-hq-surface border border-hq-border cursor-default">
                  <div class="flex items-center justify-between mb-2">
                    <div class="agent-avatar bg-hq-muted/10 text-hq-muted text-[9px]">T</div>
                    <div class="status-light status-light-off"></div>
                  </div>
                  <div class="text-[11px] font-medium text-hq-muted" x-text="tool.n"></div>
                  <div class="text-[9px] text-hq-muted/50">Ïô∏Î∂Ä ÎèÑÍµ¨</div>
                </div>
              </template>
            </div>
          </div>

          <p class="text-center text-[11px] text-hq-muted/40 mt-4">ÏóêÏù¥Ï†ÑÌä∏Î•º ÌÅ¥Î¶≠ÌïòÎ©¥ Î™®Îç∏, Ï∂îÎ°† Ï†ïÎèÑ, ÏÜåÏö∏(ÏÑ±Í≤©)ÏùÑ ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§</p>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Dashboard View ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'dashboard'" x-transition.opacity.duration.200ms class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
        <div class="max-w-5xl mx-auto fade-in-up">

          <!-- Header -->
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-bold text-hq-text mb-1">ÎåÄÏãúÎ≥¥Îìú</h1>
              <p class="text-sm text-hq-muted">Ïã§ÏãúÍ∞Ñ Ïö¥ÏòÅ ÌòÑÌô©</p>
            </div>
            <button @click="loadDashboard()" class="bg-hq-surface border border-hq-border rounded-lg px-3 py-1.5 text-xs text-hq-muted hover:text-hq-text transition flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              ÏÉàÎ°úÍ≥†Ïπ®
            </button>
          </div>

          <!-- Loading -->
          <template x-if="!dashboard.loaded">
            <div class="flex items-center justify-center py-20">
              <div class="text-hq-muted flex items-center gap-2">
                <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
                ÎåÄÏãúÎ≥¥Îìú Î°úÎî© Ï§ë...
              </div>
            </div>
          </template>

          <!-- Content -->
          <template x-if="dashboard.loaded">
            <div class="space-y-6">

              <!-- Summary Cards -->
              <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">Ïò§Îäò ÏûëÏóÖ</div>
                  <div class="text-2xl font-bold text-hq-text" x-text="dashboard.todayTasks"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">ÏôÑÎ£å</div>
                  <div class="text-2xl font-bold text-hq-green" x-text="dashboard.todayCompleted"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">Ïã§Ìå®</div>
                  <div class="text-2xl font-bold text-hq-red" x-text="dashboard.todayFailed"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">ÏßÑÌñâÏ§ë</div>
                  <div class="text-2xl font-bold text-hq-yellow" x-text="dashboard.runningCount"></div>
                </div>
              </div>

              <!-- Cost & Agent Info -->
              <div class="grid grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">Ï¥ù ÎπÑÏö©</div>
                  <div class="text-lg font-bold text-hq-accent">$<span x-text="(dashboard.totalCost || 0).toFixed(2)"></span></div>
                  <div class="text-[10px] text-hq-muted mt-1" x-text="(dashboard.totalTokens || 0).toLocaleString() + ' ÌÜ†ÌÅ∞'"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">ÏóêÏù¥Ï†ÑÌä∏</div>
                  <div class="text-lg font-bold text-hq-cyan" x-text="(dashboard.agentCount || 0) + 'Î™Ö'"></div>
                </div>
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="text-xs text-hq-muted mb-1">ÏãúÏä§ÌÖú ÏÉÅÌÉú</div>
                  <div class="flex items-center gap-2">
                    <span class="w-2.5 h-2.5 rounded-full" :class="dashboard.systemHealth === 'ok' ? 'bg-hq-green' : 'bg-hq-red'"></span>
                    <span class="text-lg font-bold" :class="dashboard.systemHealth === 'ok' ? 'text-hq-green' : 'text-hq-red'" x-text="dashboard.systemHealth === 'ok' ? 'Ï†ïÏÉÅ' : 'Ïù¥ÏÉÅ'"></span>
                  </div>
                </div>
              </div>

              <!-- Budget Section -->
              <div class="glass border border-hq-border rounded-xl p-5" x-show="budget && (budget.daily_limit || budget.monthly_limit)">
                <h3 class="text-sm font-bold text-hq-text mb-4 flex items-center gap-2">
                  <span class="text-hq-yellow">$</span> ÏòàÏÇ∞ ÌòÑÌô©
                </h3>
                <div class="space-y-4">
                  <!-- Daily Budget -->
                  <div x-show="budget.daily_limit">
                    <div class="flex justify-between text-xs mb-1.5">
                      <span class="text-hq-muted">ÏùºÏùº ÏòàÏÇ∞</span>
                      <span class="text-hq-text font-mono">$<span x-text="(budget.daily_used || 0).toFixed(2)"></span> / $<span x-text="(budget.daily_limit || 0).toFixed(2)"></span></span>
                    </div>
                    <div class="w-full bg-hq-bg rounded-full h-2.5">
                      <div class="h-2.5 rounded-full transition-all duration-500"
                           :class="(budget.daily_used / budget.daily_limit * 100) > 80 ? 'bg-hq-red' : 'bg-hq-green'"
                           :style="'width: ' + Math.min(100, (budget.daily_used || 0) / (budget.daily_limit || 1) * 100) + '%'"></div>
                    </div>
                  </div>
                  <!-- Monthly Budget -->
                  <div x-show="budget.monthly_limit">
                    <div class="flex justify-between text-xs mb-1.5">
                      <span class="text-hq-muted">ÏõîÍ∞Ñ ÏòàÏÇ∞</span>
                      <span class="text-hq-text font-mono">$<span x-text="(budget.monthly_used || 0).toFixed(2)"></span> / $<span x-text="(budget.monthly_limit || 0).toFixed(2)"></span></span>
                    </div>
                    <div class="w-full bg-hq-bg rounded-full h-2.5">
                      <div class="h-2.5 rounded-full transition-all duration-500"
                           :class="(budget.monthly_used / budget.monthly_limit * 100) > 80 ? 'bg-hq-red' : 'bg-hq-accent'"
                           :style="'width: ' + Math.min(100, (budget.monthly_used || 0) / (budget.monthly_limit || 1) * 100) + '%'"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Quality Section -->
              <div class="glass border border-hq-border rounded-xl p-5" x-show="quality && quality.total_reviews">
                <h3 class="text-sm font-bold text-hq-text mb-4 flex items-center gap-2">
                  <span class="text-hq-green">&#10003;</span> ÌíàÏßà Í≤ÄÏàò
                </h3>
                <div class="grid grid-cols-3 gap-4">
                  <div class="text-center">
                    <div class="text-2xl font-bold" :class="(quality.pass_rate || 0) >= 80 ? 'text-hq-green' : 'text-hq-yellow'" x-text="(quality.pass_rate || 0).toFixed(0) + '%'"></div>
                    <div class="text-[10px] text-hq-muted">Ìï©Í≤©Î•†</div>
                  </div>
                  <div class="text-center">
                    <div class="text-2xl font-bold text-hq-text" x-text="quality.total_reviews || 0"></div>
                    <div class="text-[10px] text-hq-muted">Ï¥ù Í≤ÄÏàò</div>
                  </div>
                  <div class="text-center">
                    <div class="text-2xl font-bold text-hq-red" x-text="quality.failed || 0"></div>
                    <div class="text-[10px] text-hq-muted">Î∂àÌï©Í≤©</div>
                  </div>
                </div>
              </div>

              <!-- Recent Completed -->
              <div class="glass border border-hq-border rounded-xl p-5" x-show="dashboard.recentCompleted && dashboard.recentCompleted.length > 0">
                <h3 class="text-sm font-bold text-hq-text mb-4">ÏµúÍ∑º ÏôÑÎ£å ÏûëÏóÖ</h3>
                <div class="space-y-2">
                  <template x-for="task in dashboard.recentCompleted.slice(0, 8)" :key="task.task_id">
                    <div class="flex items-center gap-3 p-2.5 bg-hq-bg/50 rounded-lg">
                      <span class="w-2 h-2 rounded-full bg-hq-green shrink-0"></span>
                      <div class="flex-1 min-w-0">
                        <div class="text-sm text-hq-text truncate" x-text="task.command || task.task_id"></div>
                      </div>
                      <span class="text-[10px] text-hq-muted font-mono shrink-0" x-text="task.time_seconds ? task.time_seconds.toFixed(1) + 'Ï¥à' : ''"></span>
                    </div>
                  </template>
                </div>
              </div>

            </div>
          </template>

        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab: ÏûëÏóÖÎÇ¥Ïó≠ (History) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'history'" x-cloak class="flex-1 flex flex-col overflow-hidden">
        <div class="px-6 pt-4 pb-3 shrink-0 border-b border-hq-border bg-hq-surface/30">
          <div class="flex items-center gap-3 max-w-5xl mx-auto">
            <!-- Search -->
            <div class="flex-1 relative">
              <svg class="w-4 h-4 text-hq-muted absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
              <input type="text" x-model="taskHistory.search" @input.debounce.300ms="loadTaskHistory()"
                     placeholder="ÏûëÏóÖ Í≤ÄÏÉâ..."
                     class="w-full bg-hq-bg border border-hq-border rounded-lg pl-9 pr-4 py-2 text-sm text-hq-text placeholder-hq-muted/50 focus:outline-none focus:border-hq-accent/50">
            </div>
            <!-- Status Filter -->
            <select x-model="taskHistory.filterStatus" @change="loadTaskHistory()"
                    class="bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text focus:outline-none min-w-[100px]">
              <option value="all">Ï†ÑÏ≤¥</option>
              <option value="completed">ÏôÑÎ£å</option>
              <option value="failed">Ïã§Ìå®</option>
              <option value="running">ÏßÑÌñâÏ§ë</option>
            </select>
            <!-- Bookmark Filter -->
            <button @click="taskHistory.bookmarkOnly = !taskHistory.bookmarkOnly; loadTaskHistory()"
                    :class="taskHistory.bookmarkOnly ? 'text-hq-yellow border-hq-yellow/30' : 'text-hq-muted border-hq-border'"
                    class="border rounded-lg px-3 py-2 text-sm transition hover:text-hq-yellow">
              &#9733;
            </button>
            <!-- Compare Button -->
            <button x-show="taskHistory.selectedIds.length === 2"
                    @click="openComparison()"
                    class="bg-hq-accent/20 text-hq-accent border border-hq-accent/30 rounded-lg px-3 py-2 text-xs font-semibold hover:bg-hq-accent/30 transition">
              ÎπÑÍµêÌïòÍ∏∞
            </button>
          </div>
        </div>

        <div class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
          <div class="max-w-5xl mx-auto space-y-2">
            <template x-for="task in getPagedTaskHistory()" :key="task.task_id">
              <div class="glass border rounded-xl p-4 hover-glow transition"
                   :class="taskHistory.selectedIds.includes(task.task_id) ? 'border-hq-accent/40' : 'border-hq-border'">
                <div class="flex items-start gap-3">
                  <!-- Checkbox -->
                  <input type="checkbox" :value="task.task_id"
                         @change="toggleTaskSelect(task.task_id)"
                         :checked="taskHistory.selectedIds.includes(task.task_id)"
                         class="mt-1 rounded border-hq-border bg-hq-bg text-hq-accent focus:ring-hq-accent/50">
                  <!-- Bookmark -->
                  <button @click="toggleBookmark(task.task_id)"
                          class="mt-0.5 text-lg transition"
                          :class="task.bookmarked ? 'text-hq-yellow' : 'text-hq-muted/30 hover:text-hq-yellow/50'">
                    &#9733;
                  </button>
                  <!-- Content -->
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                      <span class="status-badge"
                            :class="task.status === 'completed' ? 'bg-hq-green/15 text-hq-green border border-hq-green/20' :
                                    task.status === 'failed' ? 'bg-hq-red/15 text-hq-red border border-hq-red/20' :
                                    task.status === 'running' ? 'bg-hq-yellow/15 text-hq-yellow border border-hq-yellow/20' :
                                    'bg-hq-muted/15 text-hq-muted border border-hq-border'"
                            x-text="task.status === 'completed' ? 'ÏôÑÎ£å' : task.status === 'failed' ? 'Ïã§Ìå®' : task.status === 'running' ? 'ÏßÑÌñâÏ§ë' : 'ÎåÄÍ∏∞'"></span>
                      <span class="text-[11px] text-hq-muted" x-text="new Date(task.created_at).toLocaleString('ko-KR', {timeZone:'Asia/Seoul'})"></span>
                    </div>
                    <div class="text-sm text-hq-text mb-1" x-text="task.command"></div>
                    <div x-show="task.summary" class="text-[12px] text-hq-muted truncate" x-text="task.summary"></div>
                    <!-- Expandable Detail -->
                    <div x-show="taskHistory.expandedId === task.task_id" class="mt-3 pt-3 border-t border-hq-border/50">
                      <div class="text-sm markdown-body max-h-96 overflow-y-auto" x-html="renderMarkdown(task._fullResult || '')"></div>
                      <!-- Replay Button -->
                      <button x-show="task.correlation_id"
                              @click="loadReplay(task.correlation_id, task.task_id)"
                              class="mt-3 text-xs text-hq-accent hover:text-hq-accent/80 flex items-center gap-1">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                        ÎÇ¥Î∂Ä ÎåÄÌôî Î≥¥Í∏∞
                      </button>
                      <!-- Replay Tree -->
                      <div x-show="taskHistory.replayData[task.task_id]" class="mt-3 pl-4 border-l-2 border-hq-accent/20">
                        <div class="text-xs text-hq-muted mb-2 font-semibold">ÏóêÏù¥Ï†ÑÌä∏ Í∞Ñ ÎåÄÌôî ÌùêÎ¶Ñ</div>
                        <div x-html="renderReplayTree(taskHistory.replayData[task.task_id])"></div>
                      </div>
                    </div>
                  </div>
                  <!-- Meta -->
                  <div class="flex items-center gap-3 shrink-0">
                    <span class="text-[11px] font-mono text-hq-muted" x-text="task.time_seconds ? task.time_seconds + 'Ï¥à' : ''"></span>
                    <span class="text-[11px] font-mono text-hq-green" x-text="task.cost ? '$' + task.cost.toFixed(4) : ''"></span>
                    <button x-show="task.correlation_id"
                            @click="taskHistory.expandedId = task.task_id; loadTaskDetail(task.task_id); loadReplay(task.correlation_id, task.task_id)"
                            class="text-hq-cyan hover:text-hq-cyan/80 transition text-xs" title="ÏóêÏù¥Ï†ÑÌä∏ Í∞Ñ ÎåÄÌôî Î≥¥Í∏∞">
                      üí¨
                    </button>
                    <button @click="taskHistory.expandedId = taskHistory.expandedId === task.task_id ? null : task.task_id; if(taskHistory.expandedId === task.task_id) loadTaskDetail(task.task_id)"
                            class="text-hq-muted hover:text-hq-text transition text-xs">
                      <span x-text="taskHistory.expandedId === task.task_id ? 'Ï†ëÍ∏∞' : 'ÌéºÏπòÍ∏∞'"></span>
                    </button>
                  </div>
                </div>
              </div>
            </template>
            <!-- Îçî Î≥¥Í∏∞ Î≤ÑÌäº (#14) -->
            <div x-show="hasMoreTasks()" class="text-center py-4">
              <button @click="loadMoreTasks()"
                      class="text-xs text-hq-accent hover:text-hq-accent/80 bg-hq-accent/10 border border-hq-accent/20 rounded-lg px-6 py-2 transition">
                Îçî Î≥¥Í∏∞ (<span x-text="taskHistory.items.length - taskHistoryPage * taskHistoryPageSize"></span>Í±¥ ÎÇ®Ïùå)
              </button>
            </div>
            <template x-if="!taskHistory.items || taskHistory.items.length === 0">
              <div class="text-center py-16 text-hq-muted/50 text-sm">ÏûëÏóÖ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</div>
            </template>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab: ÏòàÏïΩ (Schedule) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'schedule'" x-cloak class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
        <div class="max-w-4xl mx-auto fade-in-up">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-bold text-hq-text mb-1">ÏûëÏóÖ ÏòàÏïΩ</h1>
              <p class="text-sm text-hq-muted">Î∞òÎ≥µ ÏûëÏóÖÏùÑ ÏûêÎèôÏúºÎ°ú Ïã§ÌñâÌï©ÎãàÎã§</p>
            </div>
            <button @click="schedules.showModal = true"
                    class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm font-semibold transition">
              + ÏÉà ÏòàÏïΩ
            </button>
          </div>

          <div class="space-y-3">
            <template x-for="s in schedules.items" :key="s.id">
              <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <div class="flex items-center gap-2 mb-1">
                      <span class="text-sm font-semibold text-hq-text" x-text="s.name"></span>
                      <span class="status-badge" :class="s.enabled ? 'bg-hq-green/15 text-hq-green border border-hq-green/20' : 'bg-hq-muted/15 text-hq-muted border border-hq-border'"
                            x-text="s.enabled ? 'ÌôúÏÑ±' : 'ÎπÑÌôúÏÑ±'"></span>
                    </div>
                    <div class="text-[12px] text-hq-muted mb-1" x-text="s.command"></div>
                    <div class="flex items-center gap-3 text-[11px] text-hq-muted/70">
                      <span x-text="'Ï£ºÍ∏∞: ' + (s.cron_label || s.cron)"></span>
                      <span x-show="s.last_run" x-text="'ÎßàÏßÄÎßâ: ' + s.last_run"></span>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <button @click="toggleSchedule(s.id)"
                            class="text-xs px-3 py-1.5 rounded-lg border transition"
                            :class="s.enabled ? 'border-hq-yellow/30 text-hq-yellow hover:bg-hq-yellow/10' : 'border-hq-green/30 text-hq-green hover:bg-hq-green/10'"
                            x-text="s.enabled ? 'Ï§ëÏßÄ' : 'ÏãúÏûë'"></button>
                    <button @click="deleteSchedule(s.id)"
                            class="text-xs px-3 py-1.5 rounded-lg border border-hq-red/30 text-hq-red hover:bg-hq-red/10 transition">ÏÇ≠Ï†ú</button>
                  </div>
                </div>
              </div>
            </template>
            <template x-if="!schedules.items || schedules.items.length === 0">
              <div class="text-center py-16 text-hq-muted/50 text-sm">ÏòàÏïΩÎêú ÏûëÏóÖÏù¥ ÏóÜÏäµÎãàÎã§. ÏÉà ÏòàÏïΩÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî.</div>
            </template>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Tab: ÏõåÌÅ¨ÌîåÎ°úÏö∞ (Workflow) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'workflow'" x-cloak class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
        <div class="max-w-4xl mx-auto fade-in-up">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-xl font-bold text-hq-text mb-1">ÏõåÌÅ¨ÌîåÎ°úÏö∞</h1>
              <p class="text-sm text-hq-muted">Ïó¨Îü¨ Îã®Í≥ÑÎ•º Ïó∞Í≤∞Ìï¥ÏÑú ÏûêÎèôÌôî ÌùêÎ¶ÑÏùÑ ÎßåÎìúÏÑ∏Ïöî</p>
            </div>
            <button @click="workflows.showEditor = true; workflows.editing = null; workflows.editSteps = [{name:'', command:''}]"
                    class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm font-semibold transition">
              + ÏÉà ÏõåÌÅ¨ÌîåÎ°úÏö∞
            </button>
          </div>

          <div class="space-y-3">
            <template x-for="wf in workflows.items" :key="wf.id">
              <div class="glass border border-hq-border rounded-xl p-4 hover-glow">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <div class="text-sm font-semibold text-hq-text mb-1" x-text="wf.name"></div>
                    <div class="text-[12px] text-hq-muted" x-text="wf.description || wf.steps.length + 'Îã®Í≥Ñ'"></div>
                    <div class="flex items-center gap-2 mt-2">
                      <template x-for="(step, i) in wf.steps" :key="i">
                        <div class="flex items-center gap-1">
                          <span class="text-[10px] bg-hq-accent/10 text-hq-accent rounded px-1.5 py-0.5" x-text="step.name || ('Îã®Í≥Ñ ' + (i+1))"></span>
                          <span x-show="i < wf.steps.length - 1" class="text-hq-muted/30 text-[10px]">‚Üí</span>
                        </div>
                      </template>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <button @click="runWorkflow(wf.id)"
                            :disabled="workflows.runningId === wf.id"
                            class="bg-hq-green/20 text-hq-green border border-hq-green/30 rounded-lg px-3 py-1.5 text-xs font-semibold hover:bg-hq-green/30 transition disabled:opacity-50">
                      <span x-show="workflows.runningId !== wf.id">Ïã§Ìñâ</span>
                      <span x-show="workflows.runningId === wf.id">ÏßÑÌñâÏ§ë...</span>
                    </button>
                    <button @click="editWorkflow(wf)"
                            class="text-xs px-3 py-1.5 rounded-lg border border-hq-border text-hq-muted hover:text-hq-text transition">ÏàòÏ†ï</button>
                    <button @click="deleteWorkflow(wf.id)"
                            class="text-xs px-3 py-1.5 rounded-lg border border-hq-red/30 text-hq-red hover:bg-hq-red/10 transition">ÏÇ≠Ï†ú</button>
                  </div>
                </div>
              </div>
            </template>
            <template x-if="!workflows.items || workflows.items.length === 0">
              <div class="text-center py-16 text-hq-muted/50 text-sm">ÏõåÌÅ¨ÌîåÎ°úÏö∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÏÉà ÏõåÌÅ¨ÌîåÎ°úÏö∞Î•º ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî.</div>
            </template>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Activity Log View (ÌôúÎèô Î°úÍ∑∏) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'activityLog'" class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
        <div class="max-w-4xl mx-auto fade-in-up">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-bold text-hq-text">ÌôúÎèô Î°úÍ∑∏</h2>
            <div class="flex items-center gap-3">
              <select x-model="activityLogFilter"
                      class="bg-hq-surface border border-hq-border rounded-lg px-3 py-1.5 text-xs text-hq-text min-w-[120px]">
                <option value="all">Ï†ÑÏ≤¥ ÏóêÏù¥Ï†ÑÌä∏</option>
                <template x-for="(name, id) in agentNames" :key="id">
                  <option :value="id" x-text="name"></option>
                </template>
              </select>
              <span class="text-xs text-hq-muted font-mono" x-text="activityLogs.length + 'Í±¥'"></span>
            </div>
          </div>
          <div class="text-[11px] text-hq-muted/50 mb-4 bg-hq-surface/50 border border-hq-border/50 rounded-lg px-3 py-2">
            Ïã§ÏãúÍ∞Ñ WebSocket Î°úÍ∑∏ÏûÖÎãàÎã§. ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ® Ïãú Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§.
          </div>
          <div class="space-y-1">
            <template x-for="(log, i) in activityLogs.filter(l => activityLogFilter === 'all' || l.agent_id === activityLogFilter).slice().reverse()" :key="i">
              <div class="flex items-center gap-3 bg-hq-surface/60 border border-hq-border/30 rounded-lg px-4 py-2.5 hover:bg-hq-surface transition">
                <span class="text-[11px] font-mono text-hq-muted/60 shrink-0 w-16" x-text="log.time"></span>
                <span class="w-7 h-7 rounded-md flex items-center justify-center text-[9px] font-bold shrink-0"
                      :class="getAgentAvatarClass(log.agent_id)" x-text="getAgentInitials(log.agent_id)"></span>
                <span class="text-xs font-medium text-hq-cyan/80 shrink-0 w-24 truncate" x-text="getAgentName(log.agent_id)"></span>
                <span class="text-xs text-hq-text/70 flex-1" x-text="log.action"></span>
              </div>
            </template>
            <template x-if="activityLogs.length === 0">
              <div class="text-center text-hq-muted/50 py-12">ÏïÑÏßÅ ÌôúÎèô Î°úÍ∑∏Í∞Ä ÏóÜÏäµÎãàÎã§. ÏóêÏù¥Ï†ÑÌä∏Ïóê ÏûëÏóÖÏùÑ ÏßÄÏãúÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</div>
            </template>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Knowledge View (ÏßÄÏãù Í¥ÄÎ¶¨) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'knowledge'" class="flex-1 overflow-hidden flex bg-grid">
        <!-- Left: File Tree -->
        <div class="w-64 border-r border-hq-border overflow-y-auto scrollbar-thin p-4 bg-hq-surface/30 shrink-0">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-xs font-bold text-hq-text uppercase tracking-wider">ÌååÏùº Î™©Î°ù</h3>
            <button @click="knowledge.showCreateForm = !knowledge.showCreateForm" class="text-hq-accent text-xs hover:text-hq-accent/80">+ ÏÉà ÌååÏùº</button>
          </div>
          <div x-show="knowledge.showCreateForm" x-transition class="mb-3 space-y-1">
            <input x-model="knowledge.newFolder" placeholder="Ìè¥ÎçîÎ™Ö" class="w-full bg-hq-bg border border-hq-border rounded-lg px-2 py-1 text-xs text-hq-text">
            <input x-model="knowledge.newFileName" placeholder="ÌååÏùºÎ™Ö" class="w-full bg-hq-bg border border-hq-border rounded-lg px-2 py-1 text-xs text-hq-text">
            <button @click="createKnowledgeFile()" class="bg-hq-accent text-white rounded-lg px-2 py-1 text-xs w-full">ÏÉùÏÑ±</button>
          </div>
          <template x-if="knowledge.loading">
            <div class="text-xs text-hq-muted text-center py-4">Î°úÎî© Ï§ë...</div>
          </template>
          <div class="space-y-0.5">
            <template x-for="file in knowledge.files" :key="file.folder + '/' + file.filename">
              <button @click="selectKnowledgeFile(file)"
                :class="knowledge.selectedFile && knowledge.selectedFile.folder === file.folder && knowledge.selectedFile.filename === file.filename ? 'bg-hq-accent/15 text-hq-accent' : 'text-hq-text/70 hover:bg-hq-surface'"
                class="w-full text-left px-2 py-1.5 rounded-lg text-xs transition truncate">
                <span class="text-hq-muted/50" x-text="file.folder + '/'"></span><span x-text="file.filename"></span>
              </button>
            </template>
          </div>
          <template x-if="!knowledge.loading && knowledge.files.length === 0">
            <div class="text-xs text-hq-muted/40 text-center py-4">ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§</div>
          </template>
        </div>
        <!-- Right: Editor/Viewer -->
        <div class="flex-1 overflow-y-auto scrollbar-thin p-6">
          <template x-if="knowledge.selectedFile">
            <div class="fade-in-up">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-bold text-hq-text" x-text="knowledge.selectedFile.folder + '/' + knowledge.selectedFile.filename"></h3>
                <div class="flex items-center gap-2">
                  <button @click="knowledge.editMode = !knowledge.editMode"
                    :class="knowledge.editMode ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'"
                    class="text-xs px-3 py-1 rounded-lg transition" x-text="knowledge.editMode ? 'ÎØ∏Î¶¨Î≥¥Í∏∞' : 'Ìé∏Ïßë'"></button>
                  <button x-show="knowledge.editMode" @click="saveKnowledge()" :disabled="knowledge.saving"
                    class="bg-hq-accent hover:bg-blue-600 disabled:opacity-50 text-white rounded-lg px-3 py-1 text-xs">Ï†ÄÏû•</button>
                  <button @click="deleteKnowledge()" class="text-hq-red/60 hover:text-hq-red text-xs px-2 py-1">ÏÇ≠Ï†ú</button>
                </div>
              </div>
              <div x-show="knowledge.editMode">
                <textarea x-model="knowledge.content" rows="25"
                  class="w-full bg-hq-bg border border-hq-border rounded-xl px-4 py-3 text-sm text-hq-text font-mono resize-y"></textarea>
              </div>
              <div x-show="!knowledge.editMode" class="bg-hq-surface/50 border border-hq-border rounded-xl px-5 py-4">
                <div class="text-sm leading-relaxed markdown-body" x-html="renderMarkdown(knowledge.content)"></div>
              </div>
            </div>
          </template>
          <template x-if="!knowledge.selectedFile">
            <div class="flex items-center justify-center h-full text-hq-muted/40 text-sm">ÏôºÏ™ΩÏóêÏÑú ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
          </template>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Archive View (ÏïÑÏπ¥Ïù¥Î∏å) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'archive'" class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
        <div class="max-w-5xl mx-auto fade-in-up">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-bold text-hq-text">ÏïÑÏπ¥Ïù¥Î∏å (Î≥¥Í≥†ÏÑú Ï†ÄÏû•ÏÜå)</h2>
            <div class="flex items-center gap-2">
              <input x-model="archive.searchCorrelation" placeholder="ÏûëÏóÖ IDÎ°ú Í≤ÄÏÉâ"
                class="bg-hq-surface border border-hq-border rounded-lg px-3 py-1.5 text-xs text-hq-text w-48" @keydown.enter="searchArchiveByCorrelation()">
              <button @click="searchArchiveByCorrelation()" class="bg-hq-accent text-white rounded-lg px-3 py-1.5 text-xs">Í≤ÄÏÉâ</button>
            </div>
          </div>
          <!-- Division Filter -->
          <div class="flex gap-2 mb-4">
            <button @click="archive.filterDivision = 'all'; loadArchive()"
              :class="archive.filterDivision === 'all' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'"
              class="px-3 py-1 text-xs font-semibold rounded-lg transition">Ï†ÑÏ≤¥</button>
            <template x-for="div in ['secretary','leet_master.tech','leet_master.strategy','leet_master.legal','leet_master.marketing','finance.investment']" :key="div">
              <button @click="archive.filterDivision = div; loadArchive()"
                :class="archive.filterDivision === div ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'"
                class="px-3 py-1 text-xs font-semibold rounded-lg transition" x-text="getDivisionLabel(div)"></button>
            </template>
          </div>
          <template x-if="archive.loading">
            <div class="text-center py-8 text-hq-muted">Î°úÎî© Ï§ë...</div>
          </template>
          <!-- Report List -->
          <div class="space-y-2 mb-6" x-show="!archive.loading">
            <template x-for="file in archive.files.filter(f => archive.filterDivision === 'all' || f.division === archive.filterDivision)" :key="file.division + '/' + file.filename">
              <div @click="readArchiveReport(file)"
                :class="archive.selectedReport && archive.selectedReport.filename === file.filename ? 'border-hq-accent/40 bg-hq-accent/5' : 'border-hq-border'"
                class="glass border rounded-xl px-4 py-3 cursor-pointer hover:bg-hq-surface transition">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <span class="status-badge bg-hq-cyan/10 text-hq-cyan text-[9px]" x-text="getDivisionLabel(file.division)"></span>
                    <span class="text-sm text-hq-text/80" x-text="file.filename"></span>
                  </div>
                  <div class="flex items-center gap-3 text-[10px] text-hq-muted font-mono">
                    <span x-text="file.size ? (file.size / 1024).toFixed(1) + 'KB' : ''"></span>
                    <span x-text="file.modified ? new Date(file.modified).toLocaleDateString('ko-KR') : ''"></span>
                  </div>
                </div>
              </div>
            </template>
            <template x-if="archive.files.length === 0">
              <div class="text-center text-hq-muted/50 py-8">ÏïÑÏπ¥Ïù¥Î∏åÏóê Î≥¥Í≥†ÏÑúÍ∞Ä ÏóÜÏäµÎãàÎã§</div>
            </template>
          </div>
          <!-- Report Content -->
          <div x-show="archive.content" class="glass border border-hq-border rounded-xl p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-sm font-bold text-hq-text" x-text="archive.selectedReport?.filename || ''"></h3>
              <button @click="copyToClipboard(archive.content)" class="text-xs text-hq-muted hover:text-hq-green">Î≥µÏÇ¨</button>
            </div>
            <div class="text-sm leading-relaxed markdown-body" x-html="renderMarkdown(archive.content)"></div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê SNS Management View (SNS Í¥ÄÎ¶¨) ‚ïê‚ïê‚ïê -->
      <div x-show="viewMode === 'chat' && activeTab === 'sns'" class="flex-1 overflow-y-auto scrollbar-thin p-6 bg-grid">
        <div class="max-w-5xl mx-auto fade-in-up">
          <h2 class="text-lg font-bold text-hq-text mb-4">SNS Í¥ÄÎ¶¨</h2>
          <!-- Sub Tabs -->
          <div class="flex gap-2 mb-6">
            <button @click="sns.tab = 'status'; loadSNS()" :class="sns.tab === 'status' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1.5 text-xs font-semibold rounded-lg transition">Ïó∞Í≤∞ ÏÉÅÌÉú</button>
            <button @click="sns.tab = 'publish'" :class="sns.tab === 'publish' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1.5 text-xs font-semibold rounded-lg transition">Í≤åÏãúÌïòÍ∏∞</button>
            <button @click="sns.tab = 'queue'; loadSNSQueue()" :class="sns.tab === 'queue' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1.5 text-xs font-semibold rounded-lg transition">ÏäπÏù∏ ÎåÄÍ∏∞Ïó¥</button>
            <button @click="sns.tab = 'events'; loadSNSEvents()" :class="sns.tab === 'events' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1.5 text-xs font-semibold rounded-lg transition">Ïù¥Î≤§Ìä∏</button>
          </div>
          <template x-if="sns.loading">
            <div class="text-center py-8 text-hq-muted">Î°úÎî© Ï§ë...</div>
          </template>

          <!-- SNS Tab 1: Connection Status -->
          <div x-show="sns.tab === 'status' && !sns.loading">
            <div class="grid grid-cols-2 gap-4">
              <template x-for="platform in ['instagram','youtube','linkedin','tistory','naver_blog','naver_cafe','daum_cafe']" :key="platform">
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-bold text-hq-text" x-text="getSNSPlatformName(platform)"></span>
                    <span class="status-badge text-[9px]"
                      :class="(sns.oauthStatus?.platforms || {})[platform]?.connected ? 'bg-hq-green/10 text-hq-green' : 'bg-hq-muted/10 text-hq-muted'"
                      x-text="(sns.oauthStatus?.platforms || {})[platform]?.connected ? 'Ïó∞Í≤∞Îê®' : 'ÎØ∏Ïó∞Í≤∞'"></span>
                  </div>
                  <button @click="connectPlatform(platform)"
                    class="w-full bg-hq-accent/10 border border-hq-accent/20 hover:bg-hq-accent/20 text-hq-accent rounded-lg px-3 py-2 text-xs transition"
                    x-text="(sns.oauthStatus?.platforms || {})[platform]?.connected ? 'Ïû¨Ïó∞Í≤∞' : 'Ïó∞Í≤∞ÌïòÍ∏∞'"></button>
                </div>
              </template>
            </div>
          </div>

          <!-- SNS Tab 2: Publish -->
          <div x-show="sns.tab === 'publish' && !sns.loading" class="space-y-6">
            <!-- Instagram Photo -->
            <div class="glass border border-hq-border rounded-xl p-5">
              <h3 class="text-sm font-bold text-hq-text mb-3">Instagram ÏÇ¨ÏßÑ Í≤åÏãú</h3>
              <div class="space-y-2">
                <input x-model="sns.igImageUrl" placeholder="Ïù¥ÎØ∏ÏßÄ URL" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                <textarea x-model="sns.igCaption" placeholder="Ï∫°ÏÖò" rows="2" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text resize-y"></textarea>
                <button @click="postInstagramPhoto()" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-lg px-4 py-2 text-sm font-semibold">Í≤åÏãú</button>
              </div>
            </div>
            <!-- Instagram Reel -->
            <div class="glass border border-hq-border rounded-xl p-5">
              <h3 class="text-sm font-bold text-hq-text mb-3">Instagram Î¶¥Ïä§ Í≤åÏãú</h3>
              <div class="space-y-2">
                <input x-model="sns.igVideoUrl" placeholder="ÎπÑÎîîÏò§ URL" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                <textarea x-model="sns.igReelCaption" placeholder="Ï∫°ÏÖò" rows="2" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text resize-y"></textarea>
                <button @click="postInstagramReel()" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-lg px-4 py-2 text-sm font-semibold">Í≤åÏãú</button>
              </div>
            </div>
            <!-- YouTube Upload -->
            <div class="glass border border-hq-border rounded-xl p-5">
              <h3 class="text-sm font-bold text-hq-text mb-3">YouTube ÏóÖÎ°úÎìú</h3>
              <div class="space-y-2">
                <input x-model="sns.ytFilePath" placeholder="ÌååÏùº Í≤ΩÎ°ú (ÏÑúÎ≤Ñ ÎÇ¥)" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                <input x-model="sns.ytTitle" placeholder="Ï†úÎ™©" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                <textarea x-model="sns.ytDesc" placeholder="ÏÑ§Î™Ö" rows="2" class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text resize-y"></textarea>
                <div class="flex gap-2">
                  <input x-model="sns.ytTags" placeholder="ÌÉúÍ∑∏ (ÏâºÌëú Íµ¨Î∂Ñ)" class="flex-1 bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                  <select x-model="sns.ytPrivacy" class="bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
                    <option value="private">ÎπÑÍ≥µÍ∞ú</option>
                    <option value="unlisted">ÏùºÎ∂ÄÍ≥µÍ∞ú</option>
                    <option value="public">Í≥µÍ∞ú</option>
                  </select>
                </div>
                <button @click="postYouTubeVideo()" class="bg-red-600 hover:bg-red-700 text-white rounded-lg px-4 py-2 text-sm font-semibold">ÏóÖÎ°úÎìú</button>
              </div>
            </div>
          </div>

          <!-- SNS Tab 3: Approval Queue -->
          <div x-show="sns.tab === 'queue' && !sns.loading">
            <div class="flex gap-2 mb-4">
              <template x-for="f in ['all','pending','approved','published','rejected']" :key="f">
                <button @click="sns.queueFilter = f"
                  :class="sns.queueFilter === f ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'"
                  class="px-3 py-1 text-xs rounded-lg transition"
                  x-text="f === 'all' ? 'Ï†ÑÏ≤¥' : f === 'pending' ? 'ÎåÄÍ∏∞' : f === 'approved' ? 'ÏäπÏù∏' : f === 'published' ? 'Î∞úÌñâ' : 'Í±∞Ï†à'"></button>
              </template>
            </div>
            <div class="space-y-2">
              <template x-for="item in (Array.isArray(sns.queue) ? sns.queue : sns.queue?.pending_requests || []).filter(q => sns.queueFilter === 'all' || q.status === sns.queueFilter)" :key="item.id || item.request_id">
                <div class="glass border border-hq-border rounded-xl p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                      <span class="text-xs font-bold text-hq-text capitalize" x-text="item.platform || '-'"></span>
                      <span class="status-badge text-[9px]"
                        :class="item.status === 'pending' ? 'bg-hq-yellow/10 text-hq-yellow' : item.status === 'approved' ? 'bg-hq-green/10 text-hq-green' : item.status === 'published' ? 'bg-hq-cyan/10 text-hq-cyan' : 'bg-hq-red/10 text-hq-red'"
                        x-text="item.status === 'pending' ? 'ÎåÄÍ∏∞' : item.status === 'approved' ? 'ÏäπÏù∏' : item.status === 'published' ? 'Î∞úÌñâ' : 'Í±∞Ï†à'"></span>
                    </div>
                    <div class="flex items-center gap-2" x-show="item.status === 'pending'">
                      <button @click="approveSNS(item.id || item.request_id)" class="bg-hq-green/20 text-hq-green rounded-lg px-3 py-1 text-xs hover:bg-hq-green/30">ÏäπÏù∏</button>
                      <button @click="sns.rejectingId = item.id || item.request_id" class="bg-hq-red/20 text-hq-red rounded-lg px-3 py-1 text-xs hover:bg-hq-red/30">Í±∞Ï†à</button>
                    </div>
                  </div>
                  <div class="text-xs text-hq-muted" x-text="item.caption || item.title || item.content || '-'"></div>
                  <!-- Reject form -->
                  <div x-show="sns.rejectingId === (item.id || item.request_id)" class="mt-2 flex gap-2">
                    <input x-model="sns.rejectReason" placeholder="Í±∞Ï†à ÏÇ¨Ïú†" class="flex-1 bg-hq-bg border border-hq-border rounded-lg px-2 py-1 text-xs text-hq-text">
                    <button @click="rejectSNS(item.id || item.request_id)" class="bg-hq-red text-white rounded-lg px-3 py-1 text-xs">ÌôïÏù∏</button>
                  </div>
                </div>
              </template>
              <template x-if="(Array.isArray(sns.queue) ? sns.queue : sns.queue?.pending_requests || []).length === 0">
                <div class="text-center text-hq-muted/50 py-8">ÎåÄÍ∏∞Ïó¥Ïù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§</div>
              </template>
            </div>
          </div>

          <!-- SNS Tab 4: Events -->
          <div x-show="sns.tab === 'events' && !sns.loading">
            <div class="space-y-2">
              <template x-for="(event, i) in sns.events" :key="i">
                <div class="glass border border-hq-border rounded-xl px-4 py-3">
                  <div class="flex items-center gap-3">
                    <span class="text-[10px] font-mono text-hq-muted/60 shrink-0" x-text="event.time || event.timestamp || '-'"></span>
                    <span class="text-xs font-bold text-hq-cyan capitalize" x-text="event.platform || '-'"></span>
                    <span class="text-xs text-hq-text/70" x-text="event.type || event.event || '-'"></span>
                  </div>
                  <div x-show="event.data" class="text-[11px] text-hq-muted mt-1 truncate" x-text="typeof event.data === 'string' ? event.data : JSON.stringify(event.data || '').substring(0, 150)"></div>
                </div>
              </template>
              <template x-if="sns.events.length === 0">
                <div class="text-center text-hq-muted/50 py-8">Ïù¥Î≤§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§</div>
              </template>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- ‚ïê‚ïê‚ïê Schedule Add Modal (ÏòàÏïΩ Ï∂îÍ∞Ä) ‚ïê‚ïê‚ïê -->
  <div x-show="schedules.showModal" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="schedules.showModal = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[500px] mx-4 p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-lg font-bold text-hq-text">ÏÉà ÏòàÏïΩ Ï∂îÍ∞Ä</h2>
        <button @click="schedules.showModal = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>

      <div class="space-y-4">
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">ÏòàÏïΩ Ïù¥Î¶Ñ</label>
          <input x-model="schedules.editName" placeholder="Ïòà: ÏùºÏùº Î≥¥Í≥†ÏÑú"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text focus:border-hq-accent outline-none">
        </div>
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">Ïã§ÌñâÌï† Î™ÖÎ†π</label>
          <textarea x-model="schedules.editCommand" placeholder="Ïòà: Ïò§Îäò ÌöåÏÇ¨ ÌòÑÌô©ÏùÑ Î≥¥Í≥†ÏÑúÎ°ú ÏûëÏÑ±Ìï¥Ï§ò" rows="2"
                    class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text focus:border-hq-accent outline-none resize-none"></textarea>
        </div>
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">Ïã§Ìñâ Ï£ºÍ∏∞</label>
          <div class="grid grid-cols-2 gap-2">
            <template x-for="preset in schedules.cronPresets" :key="preset">
              <button @click="schedules.editCronPreset = preset"
                      class="text-xs px-3 py-2 rounded-lg border transition text-left"
                      :class="schedules.editCronPreset === preset
                        ? 'border-hq-accent bg-hq-accent/15 text-hq-accent'
                        : 'border-hq-border text-hq-muted hover:border-hq-border-light'"
                      x-text="preset"></button>
            </template>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3 mt-6">
        <button @click="schedules.showModal = false"
                class="px-4 py-2 text-sm text-hq-muted hover:text-hq-text transition">Ï∑®ÏÜå</button>
        <button @click="addSchedule()"
                class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-5 py-2 text-sm font-semibold transition">Ï∂îÍ∞Ä</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Agent Memory Modal (ÏóêÏù¥Ï†ÑÌä∏ Í∏∞Ïñµ) ‚ïê‚ïê‚ïê -->
  <div x-show="memoryModal.visible" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="memoryModal.visible = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[600px] mx-4 max-h-[80vh] overflow-y-auto p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-lg font-bold text-hq-text">
          <span x-text="memoryModal.agentName"></span> Í∏∞Ïñµ Í¥ÄÎ¶¨
        </h2>
        <button @click="memoryModal.visible = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>

      <!-- Í∏∞Ïñµ Ï∂îÍ∞Ä -->
      <div class="bg-hq-bg rounded-xl p-4 mb-4">
        <div class="text-xs text-hq-muted font-semibold mb-2">ÏÉà Í∏∞Ïñµ Ï∂îÍ∞Ä</div>
        <div class="flex gap-2 mb-2">
          <input x-model="memoryModal.newKey" placeholder="Ï†úÎ™© (Ïòà: ÏÑ†Ìò∏ÌïòÎäî Î≥¥Í≥†ÏÑú ÌòïÏãù)"
                 class="flex-1 bg-hq-panel border border-hq-border rounded-lg px-3 py-1.5 text-sm text-hq-text focus:border-hq-accent outline-none">
        </div>
        <div class="flex gap-2">
          <input x-model="memoryModal.newValue" placeholder="ÎÇ¥Ïö© (Ïòà: ÌëúÏôÄ Í∑∏ÎûòÌîÑÎ•º Ìè¨Ìï®Ìïú ÌòïÏãù ÏÑ†Ìò∏)"
                 class="flex-1 bg-hq-panel border border-hq-border rounded-lg px-3 py-1.5 text-sm text-hq-text focus:border-hq-accent outline-none"
                 @keydown.enter="addMemory()">
          <button @click="addMemory()"
                  class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-1.5 text-xs font-semibold transition">Ï∂îÍ∞Ä</button>
        </div>
      </div>

      <!-- Í∏∞Ïñµ Î™©Î°ù -->
      <div class="space-y-2">
        <template x-for="mem in memoryModal.items" :key="mem.memory_id">
          <div class="flex items-start gap-3 bg-hq-bg rounded-lg p-3 group">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-semibold text-hq-accent" x-text="mem.key"></span>
                <span class="text-[10px] px-1.5 py-0.5 rounded"
                      :class="mem.source === 'auto' ? 'bg-hq-purple/15 text-hq-purple' : 'bg-hq-green/15 text-hq-green'"
                      x-text="mem.source === 'auto' ? 'ÏûêÎèô' : 'ÏàòÎèô'"></span>
              </div>
              <div class="text-xs text-hq-muted" x-text="mem.value"></div>
            </div>
            <button @click="deleteMemory(mem.memory_id)"
                    class="text-hq-red/50 hover:text-hq-red text-sm opacity-0 group-hover:opacity-100 transition">&times;</button>
          </div>
        </template>
        <template x-if="!memoryModal.items || memoryModal.items.length === 0">
          <div class="text-center py-8 text-hq-muted/50 text-sm">ÏïÑÏßÅ Ï†ÄÏû•Îêú Í∏∞ÏñµÏù¥ ÏóÜÏäµÎãàÎã§.</div>
        </template>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Workflow Editor Modal (ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ìé∏ÏßëÍ∏∞) ‚ïê‚ïê‚ïê -->
  <div x-show="workflows.showEditor" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="workflows.showEditor = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[600px] mx-4 max-h-[80vh] overflow-y-auto p-6" @click.stop>
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-lg font-bold text-hq-text" x-text="workflows.editing ? 'ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏàòÏ†ï' : 'ÏÉà ÏõåÌÅ¨ÌîåÎ°úÏö∞'"></h2>
        <button @click="workflows.showEditor = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>

      <div class="space-y-4">
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">Ïù¥Î¶Ñ</label>
          <input x-model="workflows.editName" placeholder="ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ïù¥Î¶Ñ"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text focus:border-hq-accent outline-none">
        </div>
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">ÏÑ§Î™Ö</label>
          <input x-model="workflows.editDesc" placeholder="ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏÑ§Î™Ö (ÏÑ†ÌÉù)"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text focus:border-hq-accent outline-none">
        </div>

        <!-- Steps -->
        <div>
          <div class="flex items-center justify-between mb-2">
            <label class="text-xs text-hq-muted font-semibold">Îã®Í≥Ñ Î™©Î°ù</label>
            <button @click="workflows.editSteps.push({name:'', command:''})"
                    class="text-[10px] px-2 py-1 rounded border border-hq-accent/30 text-hq-accent hover:bg-hq-accent/10 transition">+ Îã®Í≥Ñ Ï∂îÍ∞Ä</button>
          </div>
          <div class="space-y-2">
            <template x-for="(step, idx) in workflows.editSteps" :key="idx">
              <div class="flex items-start gap-2 bg-hq-bg rounded-lg p-3">
                <div class="text-xs text-hq-muted mt-1.5 font-mono w-6 shrink-0" x-text="(idx+1) + '.'"></div>
                <div class="flex-1 space-y-1.5">
                  <input x-model="step.name" :placeholder="'Îã®Í≥Ñ ' + (idx+1) + ' Ïù¥Î¶Ñ'"
                         class="w-full bg-hq-panel border border-hq-border rounded px-2 py-1 text-xs text-hq-text focus:border-hq-accent outline-none">
                  <textarea x-model="step.command" placeholder="Ïã§ÌñâÌï† Î™ÖÎ†π ({prev_result}Î°ú Ïù¥Ï†Ñ Í≤∞Í≥º Ï∞∏Ï°∞)" rows="2"
                            class="w-full bg-hq-panel border border-hq-border rounded px-2 py-1 text-xs text-hq-text focus:border-hq-accent outline-none resize-none"></textarea>
                </div>
                <button @click="workflows.editSteps.splice(idx, 1)"
                        class="text-hq-red/50 hover:text-hq-red text-sm mt-1"
                        x-show="workflows.editSteps.length > 1">&times;</button>
              </div>
            </template>
          </div>
          <div class="text-[10px] text-hq-muted/50 mt-2">
            TIP: Î™ÖÎ†πÏóê <code class="text-hq-accent">{prev_result}</code>Î•º ÎÑ£ÏúºÎ©¥ Ïù¥Ï†Ñ Îã®Í≥Ñ Í≤∞Í≥ºÍ∞Ä ÏûêÎèôÏúºÎ°ú Îì§Ïñ¥Í∞ëÎãàÎã§.
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3 mt-6">
        <button @click="workflows.showEditor = false"
                class="px-4 py-2 text-sm text-hq-muted hover:text-hq-text transition">Ï∑®ÏÜå</button>
        <button @click="saveWorkflow()"
                class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-5 py-2 text-sm font-semibold transition">Ï†ÄÏû•</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Login Overlay (Î°úÍ∑∏Ïù∏ Ïò§Î≤ÑÎ†àÏù¥) ‚ïê‚ïê‚ïê -->
  <div x-show="auth.showLogin" x-transition.opacity
       class="fixed inset-0 z-[60] flex items-center justify-center bg-hq-bg/95"
       style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[400px] mx-4 p-8">
      <div class="text-center mb-6">
        <div class="text-2xl font-bold gradient-text mb-2">CORTHEX HQ</div>
        <p class="text-sm text-hq-muted">CEO Í¥ÄÏ†úÏã§Ïóê Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî</p>
      </div>

      <div class="space-y-4">
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">ÏÇ¨Ïö©ÏûêÎ™Ö</label>
          <input x-model="auth.loginUser" placeholder="ÏÇ¨Ïö©ÏûêÎ™Ö"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2.5 text-sm text-hq-text focus:border-hq-accent outline-none"
                 @keydown.enter="$refs.loginPass.focus()">
        </div>
        <div>
          <label class="text-xs text-hq-muted font-semibold mb-1 block">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
          <input x-ref="loginPass" x-model="auth.loginPass" type="password" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2.5 text-sm text-hq-text focus:border-hq-accent outline-none"
                 @keydown.enter="doLogin()">
        </div>
      </div>

      <div x-show="auth.loginError" class="mt-3 text-xs text-hq-red" x-text="auth.loginError"></div>

      <div class="flex flex-col gap-2 mt-6">
        <button @click="doLogin()"
                class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-5 py-2.5 text-sm font-semibold transition w-full">Î°úÍ∑∏Ïù∏</button>
        <button @click="doRegister()"
                class="border border-hq-border text-hq-muted hover:text-hq-text rounded-lg px-5 py-2.5 text-sm transition w-full">ÌöåÏõêÍ∞ÄÏûÖ</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Quality Gate Settings Modal ‚ïê‚ïê‚ïê -->
  <div x-show="showQualitySettings" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="showQualitySettings = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[700px] mx-4 max-h-[80vh] overflow-y-auto p-6"
         @click.stop>

      <div class="flex items-center justify-between mb-6">
        <h2 class="text-lg font-bold text-hq-text">ÌíàÏßà Í≤ÄÏàò ÏÑ§Ï†ï</h2>
        <button @click="showQualitySettings = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>

      <!-- Section 1: Review Model Selection -->
      <div class="mb-6 p-4 bg-hq-bg rounded-xl">
        <h3 class="text-sm font-semibold text-hq-text mb-2">Í≤ÄÏàò Î™®Îç∏</h3>
        <p class="text-xs text-hq-muted/70 mb-3">Î™®Îì† ÌíàÏßà Í≤ÄÏàòÏóê ÏÇ¨Ïö©Ìï† AI Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</p>
        <div class="flex items-center gap-3">
          <select x-model="selectedReviewModel"
                  class="flex-1 bg-hq-panel border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
            <template x-for="m in availableModels" :key="m.name">
              <option :value="m.name"
                      x-text="getModelDisplayName(m.name) + ' ($' + (m.cost_input ?? 0) + '/' + (m.cost_output ?? 0) + ')'">
              </option>
            </template>
          </select>
          <button @click="saveReviewModel()"
                  class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm whitespace-nowrap">
            Ï†ÄÏû•
          </button>
        </div>
      </div>

      <!-- Section 2: Common Rubric -->
      <div class="mb-4">
        <h3 class="text-sm font-semibold text-hq-text mb-2">Í≥µÌÜµ Í≤ÄÏàò Í∏∞Ï§Ä</h3>
        <p class="text-xs text-hq-muted/70 mb-3">Î∂ÄÏÑúÎ≥Ñ Í∏∞Ï§ÄÏù¥ ÏóÜÎäî Î∂ÄÏÑúÏóê Í∏∞Î≥∏ Ï†ÅÏö©ÎêòÎäî Í≤ÄÏàò Í∏∞Ï§ÄÏûÖÎãàÎã§.</p>

        <div class="p-3 bg-hq-bg rounded-lg">
          <div class="flex items-center justify-between">
            <div>
              <span class="text-sm text-hq-text font-medium">Í∏∞Î≥∏ (Ï†ÑÏ≤¥ Í≥µÌÜµ)</span>
              <span x-show="qualityRules.rubrics && qualityRules.rubrics['default']"
                    class="ml-2 text-xs text-hq-green">ÏÑ§Ï†ïÎê®</span>
            </div>
            <button @click="startEditRubric('default')"
                    class="text-xs text-hq-accent hover:text-hq-accent/80">Ìé∏Ïßë</button>
          </div>
          <template x-if="qualityRules.rubrics && qualityRules.rubrics['default']">
            <p class="text-xs text-hq-muted/70 mt-1 truncate"
               x-text="qualityRules.rubrics['default'].prompt.substring(0, 80) + '...'"></p>
          </template>
        </div>
      </div>

      <!-- Section 3: Department-Specific Rubrics -->
      <div class="mb-4">
        <h3 class="text-sm font-semibold text-hq-text mb-2">Î∂ÄÏÑúÎ≥Ñ Í≤ÄÏàò Í∏∞Ï§Ä (Î£®Î∏åÎ¶≠)</h3>
        <p class="text-xs text-hq-muted/70 mb-3">Í∞Å Î∂ÄÏÑúÎ≥Ñ Í≤ÄÏàò Í∏∞Ï§ÄÏùÑ ÏÑ§Ï†ïÌïòÏÑ∏Ïöî. ÎØ∏ÏÑ§Ï†ï Î∂ÄÏÑúÎäî ÏúÑ Í≥µÌÜµ Í∏∞Ï§ÄÏù¥ Ï†ÅÏö©Îê©ÎãàÎã§.</p>

        <div class="space-y-2">
          <template x-for="div in (qualityRules.known_divisions || [])" :key="div">
            <div class="p-3 bg-hq-bg rounded-lg">
              <div class="flex items-center justify-between">
                <div>
                  <span class="text-sm text-hq-text font-medium" x-text="getDivisionLabel(div)"></span>
                  <span x-show="qualityRules.rubrics && qualityRules.rubrics[div]"
                        class="ml-2 text-xs text-hq-green">ÏÑ§Ï†ïÎê®</span>
                  <span x-show="!qualityRules.rubrics || !qualityRules.rubrics[div]"
                        class="ml-2 text-xs text-hq-muted/70">Í≥µÌÜµ Ï†ÅÏö©</span>
                </div>
                <button @click="startEditRubric(div)"
                        class="text-xs text-hq-accent hover:text-hq-accent/80">Ìé∏Ïßë</button>
              </div>
              <template x-if="qualityRules.rubrics && qualityRules.rubrics[div]">
                <p class="text-xs text-hq-muted/70 mt-1 truncate"
                   x-text="qualityRules.rubrics[div].prompt.substring(0, 80) + '...'"></p>
              </template>
            </div>
          </template>
        </div>
      </div>

      <!-- Rubric Editor -->
      <div x-show="editingRubric !== null" class="mt-4 p-4 bg-hq-bg rounded-xl border border-hq-accent/30">
        <h4 class="text-sm font-semibold text-hq-accent mb-3"
            x-text="getDivisionLabel(editingRubric) + ' Í≤ÄÏàò Í∏∞Ï§Ä Ìé∏Ïßë'"></h4>
        <div class="mb-3">
          <label class="text-xs text-hq-muted mb-1 block">Í∏∞Ï§Ä Ïù¥Î¶Ñ</label>
          <input x-model="rubricEditName"
                 class="w-full bg-hq-panel border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text"
                 placeholder="Ïòà: Í∏∞Ïà†Í∞úÎ∞úÏ≤ò Í≤ÄÏàò Í∏∞Ï§Ä">
        </div>
        <div class="grid grid-cols-2 gap-3 mb-3">
          <div>
            <label class="text-xs text-hq-muted mb-1 block">Í≤ÄÏàò Î™®Îç∏ (Ïù¥ Î∂ÄÏÑú Ï†ÑÏö©)</label>
            <select x-model="rubricEditModel" class="w-full bg-hq-panel border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
              <option value="">Í≥µÌÜµ Î™®Îç∏ ÏÇ¨Ïö©</option>
              <template x-for="m in availableModels" :key="m.name">
                <option :value="m.name" x-text="getModelDisplayName(m.name)"></option>
              </template>
            </select>
          </div>
          <div>
            <label class="text-xs text-hq-muted mb-1 block">Ï∂îÎ°† Ï†ïÎèÑ</label>
            <select x-model="rubricEditReasoning" class="w-full bg-hq-panel border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
              <option value="">Í∏∞Î≥∏Í∞í</option>
              <option value="low">low (Îπ†Î¶Ñ)</option>
              <option value="medium">medium (Í∑†Ìòï)</option>
              <option value="high">high (Ï†ïÎ∞Ä)</option>
              <option value="xhigh">xhigh (ÏµúÍ≥† Ï†ïÎ∞Ä)</option>
            </select>
          </div>
        </div>
        <div class="mb-3">
          <label class="text-xs text-hq-muted mb-1 block">Í≤ÄÏàò Í∏∞Ï§Ä (ÌîÑÎ°¨ÌîÑÌä∏)</label>
          <textarea x-model="rubricEditPrompt" rows="8"
                    class="w-full bg-hq-panel border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text resize-y font-mono"
                    placeholder="Îã§Ïùå Í∏∞Ï§ÄÏúºÎ°ú Í≤ÄÏàòÌïòÏÑ∏Ïöî:&#10;1. ...&#10;2. ...&#10;3. ..."></textarea>
        </div>
        <div class="flex items-center gap-2">
          <button @click="saveRubric()"
                  class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm">Ï†ÄÏû•</button>
          <button @click="editingRubric = null"
                  class="bg-hq-surface hover:bg-hq-panel text-hq-text rounded-lg px-4 py-2 text-sm">Ï∑®ÏÜå</button>
        </div>
      </div>

      <!-- Save status -->
      <div class="mt-4 text-center h-5">
        <span x-show="qualitySaveStatus === 'saving'" class="text-xs text-hq-yellow">Ï†ÄÏû• Ï§ë...</span>
        <span x-show="qualitySaveStatus === 'saved'" class="text-xs text-hq-green">Ï†ÄÏû• ÏôÑÎ£å (Git ÎèôÍ∏∞ÌôîÎê®)</span>
        <span x-show="qualitySaveStatus === 'error'" class="text-xs text-hq-red">Ï†ÄÏû• Ïã§Ìå®</span>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Agent Config Modal (ÏóêÏù¥Ï†ÑÌä∏ ÏÑ§Ï†ï) ‚ïê‚ïê‚ïê -->
  <div x-show="showAgentConfig" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="showAgentConfig = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[600px] mx-4 max-h-[85vh] overflow-y-auto p-6"
         @click.stop>

      <!-- Loading -->
      <div x-show="agentConfigLoading" class="flex items-center justify-center py-12">
        <svg class="animate-spin w-6 h-6 text-hq-accent" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
        </svg>
      </div>

      <!-- Content -->
      <div x-show="!agentConfigLoading && agentConfigData">
        <!-- Header -->
        <div class="flex items-center justify-between mb-5">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-sm font-bold"
                 :class="getAgentAvatarClass(agentConfigId)"
                 x-text="getAgentInitials(agentConfigId)"></div>
            <div>
              <h2 class="text-lg font-bold text-hq-text" x-text="agentConfigData?.name_ko || agentConfigData?.name || agentConfigId"></h2>
              <div class="text-xs text-hq-muted" x-text="(agentConfigData?.role || '') + ' ¬∑ ' + (agentConfigData?.division || '')"></div>
            </div>
          </div>
          <button @click="showAgentConfig = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
        </div>

        <!-- Tabs -->
        <div class="flex gap-1 mb-5 bg-hq-bg rounded-xl p-1">
          <button @click="agentConfigTab = 'info'"
                  :class="agentConfigTab === 'info' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-3 py-2 text-xs font-semibold rounded-lg transition-colors">Í∏∞Î≥∏ Ï†ïÎ≥¥</button>
          <button @click="agentConfigTab = 'model'"
                  :class="agentConfigTab === 'model' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-3 py-2 text-xs font-semibold rounded-lg transition-colors">Î™®Îç∏ ÏÑ§Ï†ï</button>
          <button @click="agentConfigTab = 'reasoning'"
                  :class="agentConfigTab === 'reasoning' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-3 py-2 text-xs font-semibold rounded-lg transition-colors">Ï∂îÎ°† Ï†ïÎèÑ</button>
          <button @click="agentConfigTab = 'soul'"
                  :class="agentConfigTab === 'soul' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-3 py-2 text-xs font-semibold rounded-lg transition-colors">ÏÜåÏö∏</button>
          <button @click="agentConfigTab = 'skills'"
                  :class="agentConfigTab === 'skills' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted hover:text-hq-text'"
                  class="flex-1 px-3 py-2 text-xs font-semibold rounded-lg transition-colors">Ïä§ÌÇ¨</button>
        </div>

        <!-- Tab: Info -->
        <div x-show="agentConfigTab === 'info'">
          <div class="bg-hq-bg rounded-xl p-4 space-y-3">
            <div class="flex justify-between"><span class="text-xs text-hq-muted">ÏóêÏù¥Ï†ÑÌä∏ ID</span><span class="text-xs font-mono text-hq-text" x-text="agentConfigId"></span></div>
            <div class="flex justify-between"><span class="text-xs text-hq-muted">Ïù¥Î¶Ñ (ÌïúÍµ≠Ïñ¥)</span><span class="text-xs text-hq-text" x-text="agentConfigData?.name_ko || '-'"></span></div>
            <div class="flex justify-between"><span class="text-xs text-hq-muted">Ïó≠Ìï†</span><span class="text-xs text-hq-text" x-text="agentConfigData?.role || '-'"></span></div>
            <div class="flex justify-between"><span class="text-xs text-hq-muted">Î∂ÄÏÑú</span><span class="text-xs text-hq-text" x-text="agentConfigData?.division || '-'"></span></div>
            <div class="flex justify-between"><span class="text-xs text-hq-muted">ÌòÑÏû¨ Î™®Îç∏</span><span class="text-xs font-mono text-hq-cyan" x-text="agentConfigData?.model_name || '-'"></span></div>
            <div class="flex justify-between"><span class="text-xs text-hq-muted">Ï∂îÎ°† Ï†ïÎèÑ</span><span class="text-xs text-hq-text" x-text="agentConfigData?.reasoning_effort || 'default'"></span></div>
            <div x-show="agentConfigData?.capabilities?.length > 0">
              <span class="text-xs text-hq-muted block mb-1">Îä•Î†•Ïπò</span>
              <div class="flex flex-wrap gap-1">
                <template x-for="cap in (agentConfigData?.capabilities || [])" :key="cap">
                  <span class="text-[10px] bg-hq-accent/10 text-hq-accent border border-hq-accent/20 rounded-md px-2 py-0.5" x-text="cap"></span>
                </template>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Model -->
        <div x-show="agentConfigTab === 'model'">
          <div class="bg-hq-bg rounded-xl p-4">
            <label class="text-xs text-hq-muted block mb-2">AI Î™®Îç∏ ÏÑ†ÌÉù</label>
            <p class="text-[11px] text-hq-muted/70 mb-3">Ïù¥ ÏóêÏù¥Ï†ÑÌä∏Í∞Ä ÏÇ¨Ïö©Ìï† AI Î™®Îç∏ÏùÑ Î≥ÄÍ≤ΩÌï©ÎãàÎã§. Î≥ÄÍ≤Ω Ï¶âÏãú Ï†ÅÏö©Îê©ÎãàÎã§.</p>
            <select x-model="agentModelSelection"
                    class="w-full bg-hq-panel border border-hq-border rounded-lg px-3 py-2.5 text-sm text-hq-text mb-3">
              <template x-for="m in availableModels" :key="m.name">
                <option :value="m.name" x-text="getModelDisplayName(m.name) + ' ($' + (m.cost_input ?? 0) + '/' + (m.cost_output ?? 0) + ')'"></option>
              </template>
            </select>
            <div class="flex items-center gap-2">
              <button @click="saveAgentModel()"
                      class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm transition-colors">Î™®Îç∏ Î≥ÄÍ≤Ω</button>
              <span class="text-xs text-hq-muted" x-show="agentModelSelection !== agentConfigData?.model_name">
                ÌòÑÏû¨: <span class="font-mono text-hq-cyan" x-text="agentConfigData?.model_name"></span>
              </span>
            </div>
          </div>
        </div>

        <!-- Tab: Reasoning -->
        <div x-show="agentConfigTab === 'reasoning'">
          <div class="bg-hq-bg rounded-xl p-4">
            <label class="text-xs text-hq-muted block mb-2">Ï∂îÎ°† Ï†ïÎèÑ (Reasoning Effort)</label>
            <p class="text-[11px] text-hq-muted/70 mb-4">ÏóêÏù¥Ï†ÑÌä∏Í∞Ä ÎãµÎ≥ÄÌï† Îïå ÏñºÎßàÎÇò ÍπäÏù¥ ÏÉùÍ∞ÅÌï†ÏßÄ Í≤∞Ï†ïÌï©ÎãàÎã§. ÎÜíÏùÑÏàòÎ°ù Ï†ïÌôïÌïòÏßÄÎßå ÎäêÎ¶¨Í≥† ÎπÑÏö©Ïù¥ Îçî Îì≠ÎãàÎã§.</p>

            <!-- Ï∂îÎ°† ÎØ∏ÏßÄÏõê Î™®Îç∏ -->
            <template x-if="agentReasoningOptions.length === 0">
              <div class="text-center py-6">
                <div class="text-3xl mb-2">üö´</div>
                <p class="text-sm text-hq-muted">Ïù¥ Î™®Îç∏ÏùÄ Ï∂îÎ°† Ï†ïÎèÑ ÏÑ§Ï†ïÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.</p>
                <p class="text-[11px] text-hq-muted/60 mt-1">Ï∂îÎ°†ÏùÑ ÏßÄÏõêÌïòÎäî Î™®Îç∏Î°ú Î≥ÄÍ≤ΩÌïòÎ©¥ ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
              </div>
            </template>

            <!-- Ï∂îÎ°† ÏßÄÏõê Î™®Îç∏: ÎèôÏ†Å Î≤ÑÌäº -->
            <template x-if="agentReasoningOptions.length > 0">
              <div>
                <div class="grid gap-3 mb-3" :class="agentReasoningOptions.length <= 3 ? 'grid-cols-3' : (agentReasoningOptions.length <= 4 ? 'grid-cols-2 sm:grid-cols-4' : 'grid-cols-2 sm:grid-cols-3')">
                  <template x-for="level in agentReasoningOptions" :key="level">
                    <button @click="agentReasoningSelection = level"
                            :class="agentReasoningSelection === level
                              ? (level === 'none' ? 'border-hq-muted bg-hq-muted/10 text-hq-muted'
                                : level === 'minimal' ? 'border-hq-cyan bg-hq-cyan/10 text-hq-cyan'
                                : level === 'low' ? 'border-hq-green bg-hq-green/10 text-hq-green'
                                : level === 'medium' ? 'border-hq-yellow bg-hq-yellow/10 text-hq-yellow'
                                : level === 'high' ? 'border-hq-purple bg-hq-purple/10 text-hq-purple'
                                : 'border-hq-red bg-hq-red/10 text-hq-red')
                              : 'border-hq-border text-hq-muted hover:text-hq-text'"
                            class="border-2 rounded-xl p-4 text-center transition-all">
                      <div class="text-2xl mb-1" x-text="({none:'‚õî',minimal:'üí®',low:'‚ö°',medium:'üß†',high:'üî¨',xhigh:'üî•'})[level] || '‚ùì'"></div>
                      <div class="text-sm font-bold font-mono" x-text="level"></div>
                      <div class="text-[10px] mt-1" x-text="({none:'Ï∂îÎ°† ÎπÑÌôúÏÑ±Ìôî',minimal:'ÏïÑÏ£º Îπ†Î¶Ñ',low:'Îπ†Î•¥Í≥† Ï†ÄÎ†¥',medium:'Í∑†ÌòïÏû°Ìûå ÏÑ±Îä•',high:'Ï†ïÌôïÌïòÏßÄÎßå ÎäêÎ¶º',xhigh:'ÏµúÎåÄ ÍπäÏù¥'})[level] || ''"></div>
                    </button>
                  </template>
                </div>
                <div class="flex items-center gap-2">
                  <button @click="saveAgentReasoning()"
                          class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm transition-colors">Ï∂îÎ°† Ï†ïÎèÑ Î≥ÄÍ≤Ω</button>
                  <button @click="agentReasoningSelection = ''; saveAgentReasoning()"
                          class="border border-hq-border hover:border-hq-muted text-hq-muted hover:text-hq-text rounded-lg px-4 py-2 text-sm transition-colors">Ï¥àÍ∏∞Ìôî (Í∏∞Î≥∏Í∞í)</button>
                </div>
              </div>
            </template>
          </div>
        </div>

        <!-- Tab: Soul -->
        <div x-show="agentConfigTab === 'soul'">
          <div class="bg-hq-bg rounded-xl p-4">
            <label class="text-xs text-hq-muted block mb-2">ÏãúÏä§ÌÖú ÌîÑÎ°¨ÌîÑÌä∏ (ÏÜåÏö∏)</label>
            <p class="text-[11px] text-hq-muted/70 mb-3">ÏóêÏù¥Ï†ÑÌä∏Ïùò ÏÑ±Í≤©Í≥º ÌñâÎèô Î∞©ÏãùÏùÑ Í≤∞Ï†ïÌïòÎäî ÌïµÏã¨ ÏßÄÏãúÎ¨∏ÏûÖÎãàÎã§. Î≥ÄÍ≤ΩÌïòÎ©¥ Ï¶âÏãú Î∞òÏòÅÎê©ÎãàÎã§.</p>
            <textarea x-model="agentSoulText" rows="12"
                      class="w-full bg-hq-panel border border-hq-border rounded-lg px-4 py-3 text-sm text-hq-text font-mono resize-y focus:outline-none focus:border-hq-accent/50 input-glow"
                      placeholder="Ïù¥ ÏóêÏù¥Ï†ÑÌä∏Ïùò ÏãúÏä§ÌÖú ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
            <div class="flex items-center justify-between mt-3">
              <span class="text-[10px] text-hq-muted font-mono" x-text="agentSoulText.length + 'Ïûê'"></span>
              <button @click="saveAgentSoul()"
                      class="bg-hq-accent hover:bg-blue-600 text-white rounded-lg px-5 py-2 text-sm transition-colors">
                ÏÜåÏö∏ Ï†ÄÏû• (Ï¶âÏãú Î∞òÏòÅ)
              </button>
            </div>
          </div>
        </div>

        <!-- Tab: Skills -->
        <div x-show="agentConfigTab === 'skills'">
          <div class="bg-hq-bg rounded-xl p-4">
            <label class="text-xs text-hq-muted block mb-2">ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÎèÑÍµ¨ (Ïä§ÌÇ¨)</label>
            <p class="text-[11px] text-hq-muted/70 mb-4">Ïù¥ ÏóêÏù¥Ï†ÑÌä∏Í∞Ä ÏûëÏóÖÌï† Îïå Ïì∏ Ïàò ÏûàÎäî ÎèÑÍµ¨ Î™©Î°ùÏûÖÎãàÎã§.</p>
            <template x-if="(agentConfigData?.allowed_tools || []).length === 0">
              <div class="text-center py-8">
                <div class="text-3xl mb-2">üîì</div>
                <p class="text-sm text-hq-muted">Ïù¥ ÏóêÏù¥Ï†ÑÌä∏Îäî Î™®Îì† ÎèÑÍµ¨Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.</p>
                <p class="text-[11px] text-hq-muted/60 mt-1">ÌäπÏ†ï ÎèÑÍµ¨Îßå ÌóàÏö©ÌïòÎ†§Î©¥ ÏÑ§Ï†ï ÌååÏùºÏóêÏÑú allowed_toolsÎ•º ÏßÄÏ†ïÌïòÏÑ∏Ïöî.</p>
              </div>
            </template>
            <template x-if="(agentConfigData?.allowed_tools || []).length > 0">
              <div class="grid grid-cols-2 gap-2">
                <template x-for="tool in (agentConfigData?.allowed_tools || [])" :key="tool">
                  <div class="bg-hq-panel border border-hq-border/50 rounded-lg p-3 flex items-center gap-2.5">
                    <div class="w-7 h-7 rounded-md bg-hq-accent/10 flex items-center justify-center text-sm shrink-0">üîß</div>
                    <div class="min-w-0">
                      <div class="text-xs font-semibold text-hq-text truncate" x-text="getToolDisplayName(tool)"></div>
                      <div class="text-[10px] text-hq-muted truncate" x-text="getToolDescription(tool)"></div>
                    </div>
                  </div>
                </template>
              </div>
            </template>
          </div>
        </div>

        <!-- Save status -->
        <div class="mt-4 text-center h-5">
          <span x-show="agentConfigSaveStatus === 'saving'" class="text-xs text-hq-yellow">Ï†ÄÏû• Ï§ë...</span>
          <span x-show="agentConfigSaveStatus === 'saved'" class="text-xs text-hq-green">Ï†ÄÏû• ÏôÑÎ£å</span>
          <span x-show="agentConfigSaveStatus === 'error'" class="text-xs text-hq-red">Ï†ÄÏû• Ïã§Ìå®</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Task Detail Modal (ÏûëÏóÖ ÏÉÅÏÑ∏) ‚ïê‚ïê‚ïê -->
  <div x-show="showTaskDetail" x-transition.opacity
       class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
       @click.self="showTaskDetail = false" style="display: none;">
    <div class="bg-hq-panel border border-hq-border rounded-2xl w-full max-w-[800px] mx-4 max-h-[85vh] overflow-y-auto p-6" @click.stop>
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-bold text-hq-text">ÏûëÏóÖ ÏÉÅÏÑ∏</h2>
        <button @click="showTaskDetail = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>
      <template x-if="taskDetailData">
        <div>
          <!-- Task Info -->
          <div class="bg-hq-bg rounded-xl p-4 mb-4">
            <div class="grid grid-cols-2 gap-3 text-xs">
              <div><span class="text-hq-muted">Î™ÖÎ†π:</span> <span class="text-hq-text ml-1" x-text="taskDetailData.command"></span></div>
              <div><span class="text-hq-muted">ÏÉÅÌÉú:</span>
                <span class="ml-1 status-badge"
                      :class="taskDetailData.status === 'completed' ? 'bg-hq-green/10 text-hq-green' : taskDetailData.status === 'failed' ? 'bg-hq-red/10 text-hq-red' : 'bg-hq-yellow/10 text-hq-yellow'"
                      x-text="taskDetailData.status === 'completed' ? 'ÏôÑÎ£å' : taskDetailData.status === 'failed' ? 'Ïã§Ìå®' : 'ÏßÑÌñâÏ§ë'"></span>
              </div>
              <div><span class="text-hq-muted">ÏÜåÏöîÏãúÍ∞Ñ:</span> <span class="text-hq-text font-mono ml-1" x-text="(taskDetailData.time_seconds || 0) + 's'"></span></div>
              <div><span class="text-hq-muted">ÎπÑÏö©:</span> <span class="text-hq-green font-mono ml-1" x-text="'$' + (taskDetailData.cost || 0).toFixed(4)"></span></div>
              <div x-show="taskDetailData.tokens_used"><span class="text-hq-muted">ÌÜ†ÌÅ∞(ÏÇ¨Ïö©Îüâ):</span> <span class="text-hq-purple font-mono ml-1" x-text="(taskDetailData.tokens_used || 0).toLocaleString()"></span></div>
              <div><span class="text-hq-muted">ÏÉùÏÑ±Ïùº:</span> <span class="text-hq-text font-mono ml-1" x-text="taskDetailData.created_at ? new Date(taskDetailData.created_at).toLocaleString('ko-KR') : '-'"></span></div>
            </div>
          </div>
          <!-- Tabs -->
          <div class="flex gap-2 mb-4">
            <button @click="taskDetailTab = 'result'" :class="taskDetailTab === 'result' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1 text-xs font-semibold rounded-lg transition">Í≤∞Í≥º</button>
            <button @click="taskDetailTab = 'replay'; loadTaskReplay(taskDetailData.task_id)" :class="taskDetailTab === 'replay' ? 'bg-hq-accent/20 text-hq-accent' : 'text-hq-muted'" class="px-3 py-1 text-xs font-semibold rounded-lg transition">Î¶¨ÌîåÎ†àÏù¥ (Ïã§Ìñâ Í≥ºÏ†ï)</button>
          </div>
          <!-- Result Tab -->
          <div x-show="taskDetailTab === 'result'" class="bg-hq-bg rounded-xl p-4">
            <template x-if="taskDetailData.result_data">
              <div class="text-sm leading-relaxed markdown-body" x-html="renderMarkdown(taskDetailData.result_data)"></div>
            </template>
            <template x-if="!taskDetailData.result_data">
              <div class="text-sm text-hq-muted text-center py-4">Í≤∞Í≥º Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</div>
            </template>
          </div>
          <!-- Replay Tab -->
          <div x-show="taskDetailTab === 'replay'" class="bg-hq-bg rounded-xl p-4">
            <template x-if="taskReplay && taskReplay.root">
              <div class="space-y-2" x-html="renderTaskDetailReplay(taskReplay.root, 0)"></div>
            </template>
            <template x-if="!taskReplay">
              <div class="text-sm text-hq-muted text-center py-4">Î¶¨ÌîåÎ†àÏù¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
            </template>
            <template x-if="taskReplay && !taskReplay.root">
              <div class="text-sm text-hq-muted text-center py-4">Î¶¨ÌîåÎ†àÏù¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</div>
            </template>
          </div>
        </div>
      </template>
      <template x-if="!taskDetailData">
        <div class="text-center py-8 text-hq-muted">Î°úÎî© Ï§ë...</div>
      </template>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Task Comparison Modal (#9) ‚ïê‚ïê‚ïê -->
  <div x-show="taskHistory.compareMode" x-transition class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4" style="display:none;" @click.self="taskHistory.compareMode = false">
    <div class="glass border border-hq-border rounded-2xl w-full max-w-6xl max-h-[85vh] overflow-hidden flex flex-col">
      <div class="flex items-center justify-between px-6 py-4 border-b border-hq-border">
        <h3 class="text-lg font-bold text-hq-text">ÏûëÏóÖ ÎπÑÍµê</h3>
        <button @click="taskHistory.compareMode = false" class="text-hq-muted hover:text-hq-text text-xl">&times;</button>
      </div>
      <div class="flex-1 overflow-auto p-6">
        <div class="grid grid-cols-2 gap-6">
          <!-- Left -->
          <div class="space-y-3">
            <div class="bg-hq-surface border border-hq-border rounded-xl p-4">
              <div class="text-xs text-hq-muted mb-1">Î™ÖÎ†π</div>
              <div class="text-sm text-hq-text font-medium" x-text="taskHistory.compareA?.command || '-'"></div>
              <div class="flex items-center gap-3 mt-2 text-[10px] text-hq-muted">
                <span x-text="taskHistory.compareA?.created_at ? new Date(taskHistory.compareA.created_at).toLocaleString('ko-KR') : ''"></span>
                <span :class="taskHistory.compareA?.success ? 'text-hq-green' : 'text-hq-red'" x-text="taskHistory.compareA?.success ? 'ÏÑ±Í≥µ' : 'Ïã§Ìå®'"></span>
              </div>
            </div>
            <div class="bg-hq-bg rounded-xl p-4 text-sm markdown-body max-h-96 overflow-auto" x-html="renderMarkdown(taskHistory.compareA?.result_data || taskHistory.compareA?.result_summary || 'Í≤∞Í≥º ÏóÜÏùå')"></div>
          </div>
          <!-- Right -->
          <div class="space-y-3">
            <div class="bg-hq-surface border border-hq-border rounded-xl p-4">
              <div class="text-xs text-hq-muted mb-1">Î™ÖÎ†π</div>
              <div class="text-sm text-hq-text font-medium" x-text="taskHistory.compareB?.command || '-'"></div>
              <div class="flex items-center gap-3 mt-2 text-[10px] text-hq-muted">
                <span x-text="taskHistory.compareB?.created_at ? new Date(taskHistory.compareB.created_at).toLocaleString('ko-KR') : ''"></span>
                <span :class="taskHistory.compareB?.success ? 'text-hq-green' : 'text-hq-red'" x-text="taskHistory.compareB?.success ? 'ÏÑ±Í≥µ' : 'Ïã§Ìå®'"></span>
              </div>
            </div>
            <div class="bg-hq-bg rounded-xl p-4 text-sm markdown-body max-h-96 overflow-auto" x-html="renderMarkdown(taskHistory.compareB?.result_data || taskHistory.compareB?.result_summary || 'Í≤∞Í≥º ÏóÜÏùå')"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Budget Edit Modal (#8) ‚ïê‚ïê‚ïê -->
  <div x-show="showBudgetEdit" x-transition class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4" style="display:none;" @click.self="showBudgetEdit = false">
    <div class="glass border border-hq-border rounded-2xl w-full max-w-md p-6">
      <h3 class="text-lg font-bold text-hq-text mb-4">ÏòàÏÇ∞ ÌïúÎèÑ ÏàòÏ†ï</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-xs text-hq-muted mb-1">ÏùºÏùº ÌïúÎèÑ ($)</label>
          <input x-model.number="budgetEditDaily" type="number" step="0.1" min="0"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
        </div>
        <div>
          <label class="block text-xs text-hq-muted mb-1">ÏõîÍ∞Ñ ÌïúÎèÑ ($)</label>
          <input x-model.number="budgetEditMonthly" type="number" step="1" min="0"
                 class="w-full bg-hq-bg border border-hq-border rounded-lg px-3 py-2 text-sm text-hq-text">
        </div>
        <div class="flex gap-3">
          <button @click="saveBudget()" class="flex-1 bg-hq-accent hover:bg-hq-accent/80 text-white rounded-lg py-2 text-sm font-semibold transition">Ï†ÄÏû•</button>
          <button @click="showBudgetEdit = false" class="px-4 text-hq-muted hover:text-hq-text border border-hq-border rounded-lg py-2 text-sm transition">Ï∑®ÏÜå</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function corthexApp() {
      return {
        // State
        inputText: '',
        messages: [],
        systemStatus: 'idle',
        wsConnected: false,
        totalCost: 0,
        totalTokens: 0,
        activityLogs: [],
        activeAgents: {},
        ws: null,
        logExpanded: true,

        // ‚îÄ‚îÄ Tab System ‚îÄ‚îÄ
        activeTab: 'home',
        tabs: [
          { id: 'home', label: 'Ìôà', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0a1 1 0 01-1-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 01-1 1"/></svg>' },
          { id: 'command', label: 'Î™ÖÎ†π', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>' },
          { id: 'performance', label: 'ÏÑ±Îä•', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>' },
          { id: 'history', label: 'ÏûëÏóÖÎÇ¥Ïó≠', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>' },
          { id: 'schedule', label: 'ÏòàÏïΩ', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>' },
          { id: 'workflow', label: 'ÏõåÌÅ¨ÌîåÎ°úÏö∞', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>' },
          { id: 'activityLog', label: 'Î°úÍ∑∏', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>' },
          { id: 'knowledge', label: 'ÏßÄÏãù', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>' },
          { id: 'archive', label: 'ÏïÑÏπ¥Ïù¥Î∏å', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/></svg>' },
          { id: 'sns', label: 'SNS', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"/></svg>' },
        ],

        // ‚îÄ‚îÄ Dashboard (Ìôà) ‚îÄ‚îÄ
        dashboard: { todayTasks: 0, todayCompleted: 0, todayFailed: 0, runningCount: 0, totalCost: 0, totalTokens: 0, agentCount: 0, recentCompleted: [], systemHealth: 'ok', loaded: false },

        // ‚îÄ‚îÄ Presets (Î™ÖÎ†π ÌÖúÌîåÎ¶ø) ‚îÄ‚îÄ
        presets: { items: [], showModal: false, editName: '', editCommand: '' },

        // ‚îÄ‚îÄ Task History (ÏûëÏóÖÎÇ¥Ïó≠) ‚îÄ‚îÄ
        taskHistory: { items: [], search: '', filterStatus: 'all', filterDateFrom: '', filterDateTo: '', bookmarkOnly: false, selectedIds: [], expandedId: null, replayData: {}, compareMode: false, compareA: null, compareB: null, loaded: false },

        // ‚îÄ‚îÄ Performance (ÏÑ±Îä•) ‚îÄ‚îÄ
        performance: { agents: [], totalCalls: 0, totalCost: 0, totalTasks: 0, avgSuccessRate: 0, maxCost: 0, loaded: false },

        // ‚îÄ‚îÄ Error Alert ‚îÄ‚îÄ
        errorAlert: { visible: false, message: '', severity: 'error' },

        // ‚îÄ‚îÄ Schedules (ÏòàÏïΩ) ‚îÄ‚îÄ
        schedules: {
          items: [], showModal: false, editName: '', editCommand: '',
          editCronPreset: 'Îß§Ïùº Ïò§Ï†Ñ 9Ïãú',
          cronPresets: ['Îß§Ïùº Ïò§Ï†Ñ 9Ïãú', 'Îß§Ïùº Ïò§ÌõÑ 6Ïãú', 'Îß§Ï£º ÏõîÏöîÏùº Ïò§Ï†Ñ 10Ïãú', 'Îß§Ï£º Í∏àÏöîÏùº Ïò§ÌõÑ 5Ïãú', 'Îß§ÏãúÍ∞Ñ', '30Î∂ÑÎßàÎã§'],
        },

        // ‚îÄ‚îÄ Workflows (ÏõåÌÅ¨ÌîåÎ°úÏö∞) ‚îÄ‚îÄ
        workflows: { items: [], showEditor: false, editing: null, editName: '', editDesc: '', editSteps: [{ name: '', command: '' }], runningId: null },

        // ‚îÄ‚îÄ Auth (Ïù∏Ï¶ù) ‚îÄ‚îÄ
        auth: { user: null, token: null, showLogin: false, loginUser: '', loginPass: '', loginError: '', role: 'ceo', bootstrapMode: true },

        // ‚îÄ‚îÄ Memory Modal (ÏóêÏù¥Ï†ÑÌä∏ Í∏∞Ïñµ) ‚îÄ‚îÄ
        memoryModal: { visible: false, agentId: '', agentName: '', items: [], newKey: '', newValue: '' },

        // Dark/Light mode
        darkMode: true,

        // Toast/Notification
        toasts: [],
        toastCounter: 0,
        notificationsEnabled: false,
        connectionLost: false,
        reconnectAttempt: 0,

        // Input experience
        commandHistory: [],
        historyIndex: -1,
        showMentionDropdown: false,
        mentionQuery: '',
        mentionResults: [],
        currentTaskId: null,

        // Welcome screen
        greeting: '',
        presetTab: 'Ï†ÑÏ≤¥',
        presetTabs: ['Ï†ÑÏ≤¥', 'Ï†ÑÎûµ', 'Î∂ÑÏÑù', 'Î≤ïÎ¨¥', 'ÎßàÏºÄÌåÖ'],
        backendPresets: [],
        // presetsLoaded Ï†úÍ±∞Îê® (loadPresetsÏóê ÌÜµÌï©)

        // View mode (chat panel)
        viewMode: 'chat',

        // Quality gate settings
        showQualitySettings: false,
        qualityRules: { rules: {}, rubrics: {}, known_divisions: [] },
        availableModels: [],
        selectedReviewModel: '',
        editingRubric: null,
        rubricEditName: '',
        rubricEditPrompt: '',
        rubricEditModel: '',
        rubricEditReasoning: '',
        qualitySaveStatus: '',

        // Agent config modal
        showAgentConfig: false,
        agentConfigData: null,
        agentConfigId: '',
        agentConfigTab: 'info',
        agentConfigLoading: false,
        agentSoulText: '',
        agentModelSelection: '',
        agentReasoningSelection: '',
        agentReasoningOptions: [],
        agentConfigSaveStatus: '',

        // Health check
        healthData: null,
        showHealthPopover: false,

        // Dashboard extras (budget, quality, task detail)
        dashboardRefreshTimer: null,
        budget: {},
        quality: {},
        showTaskDetail: false,
        taskDetailData: null,
        taskReplay: null,
        taskDetailTab: 'result',

        // Preset management
        showAddPreset: false,
        newPresetName: '',
        newPresetCommand: '',

        // More menu + new views
        // showMoreMenu Ï†úÍ±∞Îê® (ÌÉ≠ Î∞îÎ°ú ÎåÄÏ≤¥)
        activityLogFilter: 'all',

        // Knowledge management
        knowledge: { files: [], loading: false, selectedFile: null, content: '', editMode: false, saving: false, newFileName: '', newFolder: '', showCreateForm: false },

        // Archive browser
        archive: { files: [], loading: false, selectedReport: null, content: '', filterDivision: 'all', searchCorrelation: '' },

        // SNS management
        sns: { tab: 'status', status: {}, oauthStatus: {}, queue: [], events: [], loading: false,
               igCaption: '', igImageUrl: '', igVideoUrl: '', igReelCaption: '',
               ytFilePath: '', ytTitle: '', ytDesc: '', ytTags: '', ytPrivacy: 'private',
               rejectReason: '', rejectingId: null, queueFilter: 'all' },

        // Org tree expand state
        expanded: {
          secretary: false,
          leet_master: true,
          tech: false,
          strategy: false,
          legal: false,
          marketing: false,
          investment: true,
          finance: false,
          publishing: false,
          tools: false,
        },

        // Agent name mapping
        agentNames: {
          'chief_of_staff': 'ÎπÑÏÑúÏã§Ïû•',
          'report_worker': 'Î≥¥Í≥† ÎπÑÏÑú',
          'schedule_worker': 'ÏùºÏ†ï ÎπÑÏÑú',
          'relay_worker': 'Ïó∞ÎùΩ ÎπÑÏÑú',
          'cto_manager': 'CTO Í∏∞Ïà†Í∞úÎ∞úÏ≤òÏû•',
          'frontend_specialist': 'ÌîÑÎ°†Ìä∏ÏóîÎìú',
          'backend_specialist': 'Î∞±ÏóîÎìú/API',
          'infra_specialist': 'DB/Ïù∏ÌîÑÎùº',
          'ai_model_specialist': 'AI Î™®Îç∏',
          'cso_manager': 'CSO ÏÇ¨ÏóÖÍ∏∞ÌöçÏ≤òÏû•',
          'market_research_specialist': 'ÏãúÏû•Ï°∞ÏÇ¨',
          'business_plan_specialist': 'ÏÇ¨ÏóÖÍ≥ÑÌöçÏÑú',
          'financial_model_specialist': 'Ïû¨Î¨¥Î™®Îç∏ÎßÅ',
          'clo_manager': 'CLO Î≤ïÎ¨¥ IPÏ≤òÏû•',
          'copyright_specialist': 'Ï†ÄÏûëÍ∂å',
          'patent_specialist': 'ÌäπÌóà/ÏïΩÍ¥Ä',
          'cmo_manager': 'CMO ÎßàÏºÄÌåÖÏ≤òÏû•',
          'survey_specialist': 'ÏÑ§Î¨∏/Î¶¨ÏÑúÏπò',
          'content_specialist': 'ÏΩòÌÖêÏ∏†',
          'community_specialist': 'Ïª§ÎÆ§ÎãàÌã∞',
          'cio_manager': 'CIO Ìà¨ÏûêÎ∂ÑÏÑùÏ≤òÏû•',
          'market_condition_specialist': 'ÏãúÌô©Î∂ÑÏÑù',
          'stock_analysis_specialist': 'Ï¢ÖÎ™©Î∂ÑÏÑù',
          'technical_analysis_specialist': 'Í∏∞Ïà†Ï†ÅÎ∂ÑÏÑù',
          'risk_management_specialist': 'Î¶¨Ïä§ÌÅ¨Í¥ÄÎ¶¨',
          'cpo_manager': 'Ï∂úÌåê¬∑Í∏∞Î°ùÏ≤òÏû• (CPO)',
          'chronicle_specialist': 'ÌöåÏÇ¨Ïó∞ÎåÄÍ∏∞',
          'editor_specialist': 'ÏΩòÌÖêÏ∏†Ìé∏Ïßë',
          'archive_specialist': 'ÏïÑÏπ¥Ïù¥Î∏å',
        },

        // Agent initials for avatars
        agentInitials: {
          'chief_of_staff': 'CS',
          'report_worker': 'RP',
          'schedule_worker': 'SC',
          'relay_worker': 'RL',
          'cto_manager': 'CTO',
          'frontend_specialist': 'FE',
          'backend_specialist': 'BE',
          'infra_specialist': 'IF',
          'ai_model_specialist': 'AI',
          'cso_manager': 'CSO',
          'market_research_specialist': 'MR',
          'business_plan_specialist': 'BP',
          'financial_model_specialist': 'FM',
          'clo_manager': 'CLO',
          'copyright_specialist': 'CR',
          'patent_specialist': 'PT',
          'cmo_manager': 'CMO',
          'survey_specialist': 'SV',
          'content_specialist': 'CT',
          'community_specialist': 'CM',
          'cio_manager': 'CIO',
          'market_condition_specialist': 'MC',
          'stock_analysis_specialist': 'SA',
          'technical_analysis_specialist': 'TA',
          'risk_management_specialist': 'RM',
          'cpo_manager': 'CPO',
          'chronicle_specialist': 'CH',
          'editor_specialist': 'ED',
          'archive_specialist': 'AR',
        },

        // Division mapping for auto-expand
        agentDivision: {
          'chief_of_staff': 'secretary', 'report_worker': 'secretary',
          'schedule_worker': 'secretary', 'relay_worker': 'secretary',
          'cto_manager': 'tech',
          'frontend_specialist': 'tech', 'backend_specialist': 'tech',
          'infra_specialist': 'tech', 'ai_model_specialist': 'tech',
          'cso_manager': 'strategy', 'market_research_specialist': 'strategy',
          'business_plan_specialist': 'strategy', 'financial_model_specialist': 'strategy',
          'clo_manager': 'legal', 'copyright_specialist': 'legal',
          'patent_specialist': 'legal', 'cmo_manager': 'marketing',
          'survey_specialist': 'marketing', 'content_specialist': 'marketing',
          'community_specialist': 'marketing',
          'cio_manager': 'finance', 'market_condition_specialist': 'finance',
          'stock_analysis_specialist': 'finance', 'technical_analysis_specialist': 'finance',
          'risk_management_specialist': 'finance',
          'cpo_manager': 'publishing', 'chronicle_specialist': 'publishing',
          'editor_specialist': 'publishing', 'archive_specialist': 'publishing',
        },

        // Agent color mapping
        agentColorMap: {
          'secretary': 'bg-hq-yellow/20 text-hq-yellow',
          'tech': 'bg-hq-cyan/20 text-hq-cyan',
          'strategy': 'bg-hq-cyan/20 text-hq-cyan',
          'legal': 'bg-hq-cyan/20 text-hq-cyan',
          'marketing': 'bg-hq-cyan/20 text-hq-cyan',
          'finance': 'bg-hq-purple/20 text-hq-purple',
          'publishing': 'bg-hq-green/20 text-hq-green',
        },
        agentRoles: {},
        agentModels: {},

        // Dynamic tools list (#5)
        toolsList: [],

        // Feedback stats (#7)
        feedbackStats: { good: 0, bad: 0, total: 0, satisfaction_rate: 0 },

        // Budget edit (#8)
        showBudgetEdit: false,
        budgetEditDaily: 0,
        budgetEditMonthly: 0,

        // Tab grouping (#12)
        showMoreTabs: false,

        // Task history pagination (#14)
        taskHistoryPage: 1,
        taskHistoryPageSize: 20,

        // Batch mode toggle (#5)
        useBatch: false,

        init() {
          // Dark mode
          const savedTheme = localStorage.getItem('corthex-theme');
          if (savedTheme === 'light') {
            this.darkMode = false;
            document.documentElement.classList.remove('dark');
          }
          // Greeting
          this.greeting = this.getGreeting();
          // Notification permission
          this.requestNotificationPermission();
          // Auth
          this.checkAuth();
          // Dynamic agent/tool loading
          this.loadAgentsAndTools();
          // Load tools list (#5)
          this.loadToolsList();
          // Load feedback stats (#7)
          this.loadFeedbackStats();
          // Restore activity logs from localStorage (#13)
          this.restoreActivityLogs();
          // Restore conversation
          this.loadConversation();
          this.connectWebSocket();
          this.loadDashboard();
          this.loadPresets();
          // Keyboard shortcuts (#16)
          this.initKeyboardShortcuts();
        },

        // ‚îÄ‚îÄ Theme ‚îÄ‚îÄ
        toggleTheme() {
          this.darkMode = !this.darkMode;
          if (this.darkMode) {
            document.documentElement.classList.add('dark');
            localStorage.setItem('corthex-theme', 'dark');
          } else {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('corthex-theme', 'light');
          }
        },

        // ‚îÄ‚îÄ Toast/Notification ‚îÄ‚îÄ
        showToast(message, type = 'info') {
          const id = ++this.toastCounter;
          this.toasts.push({ id, message, type, visible: true });
          setTimeout(() => this.removeToast(id), 4000);
        },
        removeToast(id) {
          const t = this.toasts.find(t => t.id === id);
          if (t) t.visible = false;
          setTimeout(() => { this.toasts = this.toasts.filter(t => t.id !== id); }, 300);
        },
        requestNotificationPermission() {
          if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission().then(p => { this.notificationsEnabled = p === 'granted'; });
          } else if ('Notification' in window && Notification.permission === 'granted') {
            this.notificationsEnabled = true;
          }
        },
        sendDesktopNotification(title, body) {
          if (this.notificationsEnabled && document.hidden) {
            new Notification(title, { body });
          }
        },

        // ‚îÄ‚îÄ WebSocket ‚îÄ‚îÄ
        connectWebSocket() {
          const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
          this.ws = new WebSocket(`${protocol}//${location.host}/ws`);

          this.ws.onopen = () => {
            this.wsConnected = true;
            if (this.connectionLost) {
              this.connectionLost = false;
              this.reconnectAttempt = 0;
              this.showToast('ÏÑúÎ≤ÑÏóê Îã§Ïãú Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§.', 'success');
            }
          };

          this.ws.onclose = () => {
            this.wsConnected = false;
            this.connectionLost = true;
            this.reconnectAttempt++;
            setTimeout(() => this.connectWebSocket(), 3000);
          };

          this.ws.onmessage = (event) => {
            const msg = JSON.parse(event.data);
            this.handleWsMessage(msg);
          };
        },

        handleWsMessage(msg) {
          switch (msg.event) {
            case 'processing_start':
            case 'task_accepted':
              this.systemStatus = 'working';
              if (msg.data?.task_id) this.currentTaskId = msg.data.task_id;
              if (!this.messages.some(m => m.type === 'processing')) {
                this.messages.push({ type: 'processing', id: Date.now() });
              }
              break;

            case 'agent_status':
              const d = msg.data;
              this.activeAgents[d.agent_id] = {
                status: d.status,
                progress: d.progress || 0,
                detail: d.detail || '',
              };

              if (d.status === 'working') {
                const div = this.agentDivision[d.agent_id];
                if (div) {
                  this.expanded[div] = true;
                  if (['tech','strategy','legal','marketing'].includes(div)) {
                    this.expanded.leet_master = true;
                  }
                  if (div === 'finance') {
                    this.expanded.investment = true;
                  }
                }
              }

              if (d.status === 'working' && d.progress < 0.9) {
                this.simulateProgress(d.agent_id);
              }
              break;

            case 'activity_log':
              msg.data.time = new Date().toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul', hour12: false });
              this.activityLogs.push(msg.data);
              if (this.activityLogs.length > 200) this.activityLogs = this.activityLogs.slice(-100);
              this.saveActivityLogs();
              break;

            case 'cost_update':
              this.totalCost = msg.data.total_cost;
              this.totalTokens = msg.data.total_tokens;
              break;

            case 'result':
            case 'task_completed':
              this.messages = this.messages.filter(m => m.type !== 'processing');
              this.messages.push({
                type: 'result',
                content: msg.data.content,
                sender_id: msg.data.sender_id || 'chief_of_staff',
                time_seconds: msg.data.time_seconds,
                cost: msg.data.cost,
                quality_score: msg.data.quality_score || null,
                task_id: this.currentTaskId || msg.data.task_id || '',
                collapsed: false,
                feedbackSent: false,
                feedbackRating: null,
              });
              this.systemStatus = 'idle';
              this.currentTaskId = null;
              this.totalCost = msg.data.cost || this.totalCost;
              this.showToast('ÏûëÏóÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.', 'success');
              this.sendDesktopNotification('CORTHEX HQ', 'ÏûëÏóÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.');
              this.$nextTick(() => this.scrollToBottom());
              // (#17) ÏóêÏù¥Ï†ÑÌä∏ ÏôÑÎ£å ÏÉÅÌÉú 5Ï¥à Ïú†ÏßÄ ÌõÑ idleÎ°ú
              Object.keys(this.activeAgents).forEach(id => {
                if (this.activeAgents[id]?.status === 'done') {
                  setTimeout(() => {
                    if (this.activeAgents[id]?.status === 'done') {
                      delete this.activeAgents[id];
                    }
                  }, 5000);
                }
              });
              // Refresh dashboard/history/feedback if currently viewing
              if (this.activeTab === 'home') { this.loadDashboard(); this.loadFeedbackStats(); }
              if (this.activeTab === 'history') this.loadTaskHistory();
              break;

            case 'error':
              this.messages = this.messages.filter(m => m.type !== 'processing');
              this.messages.push({ type: 'error', text: msg.data.message });
              this.systemStatus = 'error';
              this.currentTaskId = null;
              this.errorAlert = { visible: true, message: msg.data.message || 'Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', severity: 'error' };
              this.showToast(msg.data.message || 'Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
              setTimeout(() => { this.systemStatus = 'idle'; }, 3000);
              setTimeout(() => { this.errorAlert.visible = false; }, 10000);
              break;

            case 'error_alert':
              this.errorAlert = { visible: true, message: msg.data.message, severity: msg.data.severity || 'error' };
              if (msg.data.severity !== 'critical') {
                setTimeout(() => { this.errorAlert.visible = false; }, 10000);
              }
              break;
          }
        },

        simulateProgress(agentId) {
          const interval = setInterval(() => {
            if (!this.activeAgents[agentId] || this.activeAgents[agentId].status !== 'working') {
              clearInterval(interval);
              return;
            }
            const current = this.activeAgents[agentId].progress;
            if (current < 0.9) {
              this.activeAgents[agentId].progress = Math.min(0.9, current + 0.05 + Math.random() * 0.1);
            } else {
              clearInterval(interval);
            }
          }, 800);
        },

        // ‚îÄ‚îÄ Input Experience ‚îÄ‚îÄ
        sendMessage() {
          const text = this.inputText.trim();
          if (!text || this.systemStatus === 'working') return;

          this.commandHistory.push(text);
          if (this.commandHistory.length > 50) this.commandHistory.shift();
          this.historyIndex = -1;

          this.messages.push({ type: 'user', text });
          this.inputText = '';
          this.activeAgents = {};

          if (this.$refs.inputArea) this.$refs.inputArea.style.height = 'auto';

          if (this.ws && this.ws.readyState === WebSocket.OPEN) {
            this.ws.send(JSON.stringify({ type: 'command', text, batch: this.useBatch }));
          }

          this.$nextTick(() => this.scrollToBottom());
        },

        sendPreset(text) {
          this.inputText = text;
          this.sendMessage();
        },

        handleInputKeydown(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            this.sendMessage();
            return;
          }
          if (e.key === 'ArrowUp' && !this.inputText.trim()) {
            e.preventDefault();
            if (this.commandHistory.length > 0) {
              if (this.historyIndex < this.commandHistory.length - 1) this.historyIndex++;
              this.inputText = this.commandHistory[this.commandHistory.length - 1 - this.historyIndex];
            }
            return;
          }
          if (e.key === 'ArrowDown' && this.historyIndex >= 0) {
            e.preventDefault();
            this.historyIndex--;
            this.inputText = this.historyIndex < 0 ? '' : this.commandHistory[this.commandHistory.length - 1 - this.historyIndex];
            return;
          }
          if (e.key === 'Escape') this.showMentionDropdown = false;
        },

        handleInputChange(e) {
          const el = e.target;
          el.style.height = 'auto';
          el.style.height = Math.min(el.scrollHeight, 200) + 'px';

          const text = this.inputText;
          const cursorPos = el.selectionStart;
          const textBefore = text.substring(0, cursorPos);
          const atMatch = textBefore.match(/@(\S*)$/);

          if (atMatch) {
            this.mentionQuery = atMatch[1].toLowerCase();
            this.mentionResults = Object.entries(this.agentNames)
              .filter(([id, name]) => id.toLowerCase().includes(this.mentionQuery) || name.toLowerCase().includes(this.mentionQuery))
              .slice(0, 6)
              .map(([id, name]) => ({ id, name }));
            this.showMentionDropdown = this.mentionResults.length > 0;
          } else {
            this.showMentionDropdown = false;
          }
        },

        insertMention(agent) {
          const el = this.$refs.inputArea;
          const cursorPos = el.selectionStart;
          const textBefore = this.inputText.substring(0, cursorPos);
          const textAfter = this.inputText.substring(cursorPos);
          const replaced = textBefore.replace(/@\S*$/, `@${agent.name} `);
          this.inputText = replaced + textAfter;
          this.showMentionDropdown = false;
          this.$nextTick(() => { el.focus(); el.selectionStart = el.selectionEnd = replaced.length; });
        },

        cancelTask() {
          if (this.ws && this.ws.readyState === WebSocket.OPEN) {
            this.ws.send(JSON.stringify({ type: 'cancel', task_id: this.currentTaskId }));
          }
          this.systemStatus = 'idle';
          this.currentTaskId = null;
          this.messages = this.messages.filter(m => m.type !== 'processing');
          this.showToast('ÏûëÏóÖ Ï∑®ÏÜåÎ•º ÏöîÏ≤≠ÌñàÏäµÎãàÎã§.', 'warning');
        },

        // ‚îÄ‚îÄ Welcome Screen ‚îÄ‚îÄ
        getGreeting() {
          const hour = new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Seoul' })).getHours();
          if (hour < 12) return 'Ï¢ãÏùÄ ÏïÑÏπ®ÏûÖÎãàÎã§, CEOÎãò';
          if (hour < 18) return 'Ï¢ãÏùÄ Ïò§ÌõÑÏûÖÎãàÎã§, CEOÎãò';
          return 'Ï¢ãÏùÄ Ï†ÄÎÖÅÏûÖÎãàÎã§, CEOÎãò';
        },

        // loadBackendPresetsÎäî loadPresets()Ïóê ÌÜµÌï©Îê®

        getFilteredPresets() {
          const defaults = [
            { name: 'Í∏∞Ïà† Ïä§ÌÉù Ï†úÏïà', command: 'LEET MASTER ÏÑúÎπÑÏä§Ïùò Í∏∞Ïà† Ïä§ÌÉùÏùÑ Ï†úÏïàÌï¥Ï§ò', category: 'Ï†ÑÎûµ', color: 'hq-cyan', desc: 'CTO + Í∏∞Ïà†ÌåÄÏù¥ ÏµúÏ†ÅÏùò ÏïÑÌÇ§ÌÖçÏ≤òÎ•º ÏÑ§Í≥ÑÌï©ÎãàÎã§' },
            { name: 'Ï£ºÍ∞Ä Î∂ÑÏÑù', command: 'ÏÇºÏÑ±Ï†ÑÏûê Ï£ºÍ∞ÄÎ•º Î∂ÑÏÑùÌï¥Ï§ò', category: 'Î∂ÑÏÑù', color: 'hq-purple', desc: '4Î™ÖÏùò Ìà¨ÏûêÎ∂ÑÏÑùÌåÄÏù¥ Î≥ëÎ†¨Î°ú Î∂ÑÏÑùÌï©ÎãàÎã§' },
            { name: 'Ïù¥Ïö©ÏïΩÍ¥Ä ÏûëÏÑ±', command: 'ÏÑúÎπÑÏä§ Ïù¥Ïö©ÏïΩÍ¥Ä Ï¥àÏïàÏùÑ ÎßåÎì§Ïñ¥Ï§ò', category: 'Î≤ïÎ¨¥', color: 'hq-green', desc: 'CLO + Î≤ïÎ¨¥ÌåÄÏù¥ Î≤ïÏ†Å Î¨∏ÏÑúÎ•º ÏûëÏÑ±Ìï©ÎãàÎã§' },
            { name: 'ÎßàÏºÄÌåÖ Ï†ÑÎûµ', command: 'ÎßàÏºÄÌåÖ ÏΩòÌÖêÏ∏† Ï†ÑÎûµÏùÑ ÏàòÎ¶ΩÌï¥Ï§ò', category: 'ÎßàÏºÄÌåÖ', color: 'hq-yellow', desc: 'CMO + ÎßàÏºÄÌåÖÌåÄÏù¥ Ï†ÑÎûµÏùÑ ÏàòÎ¶ΩÌï©ÎãàÎã§' },
            { name: 'ÏÇ¨ÏóÖÍ≥ÑÌöçÏÑú', command: 'Ïä§ÌÉÄÌä∏ÏóÖ ÏÇ¨ÏóÖÍ≥ÑÌöçÏÑú Ï¥àÏïàÏùÑ ÏûëÏÑ±Ìï¥Ï§ò', category: 'Ï†ÑÎûµ', color: 'hq-cyan', desc: 'CSO + ÏÇ¨ÏóÖÍ∏∞ÌöçÌåÄÏù¥ ÏÇ¨ÏóÖÍ≥ÑÌöçÏùÑ ÏàòÎ¶ΩÌï©ÎãàÎã§' },
            { name: 'ÌäπÌóà Î∂ÑÏÑù', command: 'Ïö∞Î¶¨ ÏÑúÎπÑÏä§Ïùò ÌäπÌóà Í∞ÄÎä•ÏÑ±ÏùÑ Î∂ÑÏÑùÌï¥Ï§ò', category: 'Î≤ïÎ¨¥', color: 'hq-green', desc: 'CLO + Î≤ïÎ¨¥ÌåÄÏù¥ ÌäπÌóà Í∞ÄÎä•ÏÑ±ÏùÑ Î∂ÑÏÑùÌï©ÎãàÎã§' },
            ...this.backendPresets.map(p => ({
              name: p.name, command: p.command, category: 'Ï†ÑÏ≤¥', color: 'hq-accent',
              desc: p.command.length > 40 ? p.command.substring(0, 40) + '...' : p.command,
              isServer: true,
            })),
          ];
          if (this.presetTab === 'Ï†ÑÏ≤¥') return defaults;
          return defaults.filter(p => p.category === this.presetTab);
        },

        // ‚îÄ‚îÄ Result Helpers ‚îÄ‚îÄ
        copyToClipboard(text) {
          navigator.clipboard.writeText(text).then(
            () => this.showToast('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.', 'success'),
            () => this.showToast('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error')
          );
        },
        isLongContent(content) { return content && content.length > 1500; },
        getQualityBadge(score) {
          if (!score) return { label: '-', cls: 'bg-hq-muted/10 text-hq-muted' };
          if (score >= 90) return { label: 'A+', cls: 'bg-hq-green/20 text-hq-green border-hq-green/30' };
          if (score >= 80) return { label: 'A', cls: 'bg-hq-green/15 text-hq-green/80 border-hq-green/20' };
          if (score >= 70) return { label: 'B', cls: 'bg-hq-yellow/15 text-hq-yellow border-hq-yellow/20' };
          if (score >= 60) return { label: 'C', cls: 'bg-hq-yellow/10 text-hq-yellow/80 border-hq-yellow/15' };
          return { label: 'D', cls: 'bg-hq-red/15 text-hq-red border-hq-red/20' };
        },

        // ‚îÄ‚îÄ Agent Helpers ‚îÄ‚îÄ
        scrollToAgent(agentId) {
          const div = this.agentDivision[agentId];
          if (div) {
            this.expanded[div] = true;
            if (['tech','strategy','legal','marketing'].includes(div)) this.expanded.leet_master = true;
            if (div === 'finance') this.expanded.investment = true;
          }
          this.$nextTick(() => {
            const el = document.getElementById('agent-' + agentId);
            if (el) {
              el.scrollIntoView({ behavior: 'smooth', block: 'center' });
              el.classList.add('bg-hq-yellow/10');
              setTimeout(() => el.classList.remove('bg-hq-yellow/10'), 2000);
            }
          });
        },

        // ‚îÄ‚îÄ Task Detail Modal ‚îÄ‚îÄ
        async openTaskDetail(taskId) {
          this.taskDetailData = null;
          this.taskReplay = null;
          this.taskDetailTab = 'result';
          this.showTaskDetail = true;
          try {
            const res = await fetch(`/api/tasks/${taskId}`);
            if (res.ok) this.taskDetailData = await res.json();
            else this.showToast('ÏûëÏóÖ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
          } catch {
            this.showToast('ÏûëÏóÖ ÏÉÅÏÑ∏ Î°úÎìú Ïã§Ìå®', 'error');
          }
        },

        async loadTaskReplay(taskId) {
          this.taskReplay = null;
          try {
            const res = await fetch(`/api/replay/${taskId}`);
            if (res.ok) this.taskReplay = await res.json();
            else {
              const latest = await fetch('/api/replay/latest');
              if (latest.ok) this.taskReplay = await latest.json();
              else this.taskReplay = {};
            }
          } catch {
            this.taskReplay = {};
          }
        },

        renderTaskDetailReplay(node, depth) {
          if (!node) return '';
          const indent = depth * 20;
          const color = depth === 0 ? 'hq-accent' : depth === 1 ? 'hq-cyan' : 'hq-purple';
          let html = `<div style="margin-left:${indent}px" class="flex items-start gap-2 p-2 bg-hq-surface/50 rounded-lg mb-1">
            <span class="w-2 h-2 rounded-full bg-${color} mt-1.5 shrink-0"></span>
            <div>
              <span class="text-xs font-bold text-${color}">${this.getAgentName(node.agent_id || node.agent || '')}</span>
              ${node.action ? `<span class="text-xs text-hq-muted ml-2">${node.action}</span>` : ''}
              ${node.result ? `<div class="text-xs text-hq-text/60 mt-1 truncate max-w-lg">${(node.result || '').substring(0, 100)}${(node.result||'').length > 100 ? '...' : ''}</div>` : ''}
            </div>
          </div>`;
          if (node.children && Array.isArray(node.children)) {
            node.children.forEach(child => { html += this.renderTaskDetailReplay(child, depth + 1); });
          }
          return html;
        },

        // ‚îÄ‚îÄ Existing Helpers ‚îÄ‚îÄ
        toggleSection(section) {
          this.expanded[section] = !this.expanded[section];
        },

        getAgentName(id) {
          return this.agentNames[id] || id;
        },

        getAgentInitials(id) {
          return this.agentInitials[id] || id.substring(0, 2).toUpperCase();
        },

        getAgentAvatarClass(id) {
          const div = this.agentDivision[id];
          return this.agentColorMap[div] || 'bg-hq-accent/20 text-hq-accent';
        },

        getAgentDotClass(id) {
          const status = this.activeAgents[id];
          if (!status) return 'bg-hq-muted/40';
          switch (status.status) {
            case 'working': return 'bg-hq-green pulse-dot';
            case 'done': return 'bg-hq-green';
            case 'idle': return 'bg-hq-muted/40';
            default: return 'bg-hq-muted/30';
          }
        },

        getSectionBadgeClass(section) {
          const ids = this.getSectionAgentIds(section);
          const hasWorking = ids.some(id => this.activeAgents[id]?.status === 'working');
          if (hasWorking) return 'bg-hq-yellow/15 text-hq-yellow border border-hq-yellow/20';
          const hasDone = ids.some(id => this.activeAgents[id]?.status === 'done');
          if (hasDone) return 'bg-hq-green/15 text-hq-green border border-hq-green/20';
          return 'hidden';
        },

        getSectionStatusColor(section) {
          const ids = this.getSectionAgentIds(section);
          const hasWorking = ids.some(id => this.activeAgents[id]?.status === 'working');
          if (hasWorking) return 'text-hq-yellow';
          const hasDone = ids.some(id => this.activeAgents[id]?.status === 'done');
          if (hasDone) return 'text-hq-green';
          return 'text-hq-muted/30';
        },

        getSectionStatusText(section) {
          const ids = this.getSectionAgentIds(section);
          const working = ids.filter(id => this.activeAgents[id]?.status === 'working').length;
          if (working > 0) return `${working}Î™Ö ÏûëÏóÖÏ§ë`;
          const done = ids.filter(id => this.activeAgents[id]?.status === 'done').length;
          if (done > 0) return `${done}Î™Ö ÏôÑÎ£å`;
          return '';
        },

        getSectionAgentIds(section) {
          if (section === 'leet_master') {
            return Object.entries(this.agentDivision)
              .filter(([_, div]) => ['tech','strategy','legal','marketing'].includes(div))
              .map(([id]) => id);
          }
          if (section === 'investment') {
            return Object.entries(this.agentDivision)
              .filter(([_, div]) => div === 'finance')
              .map(([id]) => id);
          }
          return Object.entries(this.agentDivision)
            .filter(([_, div]) => div === section)
            .map(([id]) => id);
        },

        renderMarkdown(text) {
          try { return marked.parse(text || ''); }
          catch { return text; }
        },

        // ‚îÄ‚îÄ Quality Gate Settings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        sortModels(models) {
          const tierOrder = { executive: 0, manager: 1, specialist: 2, worker: 3 };
          return models.sort((a, b) => {
            const ta = tierOrder[a.tier] ?? 99;
            const tb = tierOrder[b.tier] ?? 99;
            if (ta !== tb) return ta - tb;
            return (b.cost_output || 0) - (a.cost_output || 0);
          });
        },

        getModelDisplayName(modelName) {
          const names = {
            'claude-opus-4-6': 'Claude Opus 4.6',
            'claude-sonnet-4-5-20250929': 'Claude Sonnet 4.5',
            'claude-haiku-4-5-20251001': 'Claude Haiku 4.5',
            'gpt-5.2-pro': 'GPT-5.2 Pro',
            'gpt-5.2': 'GPT-5.2',
            'gpt-5.2-codex': 'GPT-5.2 Codex',
            'gpt-5.1': 'GPT-5.1',
            'gpt-5.1-codex': 'GPT-5.1 Codex',
            'gpt-5': 'GPT-5',
            'gpt-5-mini': 'GPT-5 Mini',
            'gpt-5-nano': 'GPT-5 Nano',
          };
          return names[modelName] || modelName;
        },

        async loadQualityRules() {
          try {
            const [rulesRes, modelsRes] = await Promise.all([
              fetch('/api/quality-rules').then(r => r.json()),
              fetch('/api/available-models').then(r => r.json()),
            ]);
            this.qualityRules = rulesRes;
            this.availableModels = this.sortModels(Array.isArray(modelsRes) ? modelsRes : []);
            this.selectedReviewModel = rulesRes.rules?.review_model || (this.availableModels.length ? this.availableModels[0].name : '');
          } catch (e) {
            console.error('Failed to load quality rules:', e);
          }
        },

        async saveReviewModel() {
          this.qualitySaveStatus = 'saving';
          try {
            const res = await fetch('/api/quality-rules/model', {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ review_model: this.selectedReviewModel }),
            }).then(r => r.json());
            this.qualitySaveStatus = res.success ? 'saved' : 'error';
          } catch {
            this.qualitySaveStatus = 'error';
          }
          setTimeout(() => { this.qualitySaveStatus = ''; }, 2500);
        },

        startEditRubric(division) {
          this.editingRubric = division;
          const rubric = this.qualityRules.rubrics?.[division] || { name: '', prompt: '', model: '', reasoning_effort: '' };
          this.rubricEditName = rubric.name || '';
          this.rubricEditPrompt = rubric.prompt || '';
          this.rubricEditModel = rubric.model || '';
          this.rubricEditReasoning = rubric.reasoning_effort || '';
        },

        async saveRubric() {
          if (!this.editingRubric) return;
          this.qualitySaveStatus = 'saving';
          try {
            const res = await fetch(`/api/quality-rules/rubric/${this.editingRubric}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                name: this.rubricEditName,
                prompt: this.rubricEditPrompt,
                model: this.rubricEditModel || null,
                reasoning_effort: this.rubricEditReasoning || null,
              }),
            }).then(r => r.json());
            if (res.success) {
              if (!this.qualityRules.rubrics) this.qualityRules.rubrics = {};
              this.qualityRules.rubrics[this.editingRubric] = {
                name: this.rubricEditName,
                prompt: this.rubricEditPrompt,
                model: this.rubricEditModel,
                reasoning_effort: this.rubricEditReasoning,
              };
              this.editingRubric = null;
              this.qualitySaveStatus = 'saved';
            } else {
              this.qualitySaveStatus = 'error';
            }
          } catch {
            this.qualitySaveStatus = 'error';
          }
          setTimeout(() => { this.qualitySaveStatus = ''; }, 2500);
        },

        // ‚îÄ‚îÄ Office & Agent Config ‚îÄ‚îÄ
        getAgentStatusLight(agentId) {
          const agent = this.activeAgents[agentId];
          if (!agent) return 'status-light-idle';
          if (agent.status === 'working') return 'status-light-working';
          if (agent.status === 'done') return 'status-light-done';
          return 'status-light-idle';
        },

        async openAgentConfig(agentId) {
          this.agentConfigId = agentId;
          this.agentConfigLoading = true;
          this.showAgentConfig = true;
          this.agentConfigTab = 'info';
          this.agentConfigSaveStatus = '';
          try {
            const [agentRes, modelsRes] = await Promise.all([
              fetch(`/api/agents/${agentId}`).then(r => r.json()),
              this.availableModels.length ? Promise.resolve(this.availableModels) :
                fetch('/api/available-models').then(r => r.json()),
            ]);
            // ÏÑúÎ≤Ñ ÏóêÎü¨ Ï≤¥ÌÅ¨ (ÏÑúÎ≤Ñ Ï¥àÍ∏∞Ìôî Ïã§Ìå® Îì±)
            if (agentRes.error) {
              this.showToast('ÏóêÏù¥Ï†ÑÌä∏ Î°úÎìú Ïã§Ìå®: ' + agentRes.error, 'error');
              this.showAgentConfig = false;
              return;
            }
            this.agentConfigData = agentRes;
            if (!this.availableModels.length && Array.isArray(modelsRes)) {
              this.availableModels = this.sortModels(modelsRes);
            }
            this.agentSoulText = agentRes.system_prompt || '';
            this.agentModelSelection = agentRes.model_name || '';
            this.agentReasoningSelection = agentRes.reasoning_effort || '';
            // ÌòÑÏû¨ Î™®Îç∏Ïùò Ï∂îÎ°† Ï†ïÎèÑ ÏòµÏÖò Ï°∞Ìöå
            const currentModel = this.availableModels.find(m => m.name === this.agentModelSelection);
            this.agentReasoningOptions = currentModel?.reasoning_levels || [];
            // Fallback: Î™®Îç∏ Î™©Î°ù Î°úÎî© Ïã§Ìå®Ìï¥ÎèÑ Í∏∞Î≥∏ Ï∂îÎ°† ÏòµÏÖò Ï†úÍ≥µ
            if (this.agentReasoningOptions.length === 0 && this.agentModelSelection) {
              const mn = this.agentModelSelection;
              const defaultReasoning = {
                'claude-opus-4-6': ['low','medium','high'],
                'claude-sonnet-4-5-20250929': ['low','medium','high'],
                'gpt-5-nano': [],
                'gpt-5-mini': ['low','medium','high'],
                'gpt-5': ['none','low','medium','high'],
                'gpt-5.1': ['none','low','medium','high'],
                'gpt-5.1-codex': ['none','low','medium','high'],
                'gpt-5.2': ['none','low','medium','high','xhigh'],
                'gpt-5.2-codex': ['none','low','medium','high','xhigh'],
                'gpt-5.2-pro': ['medium','high','xhigh'],
              };
              this.agentReasoningOptions = defaultReasoning[mn] || [];
            }
          } catch (e) {
            this.showToast('ÏóêÏù¥Ï†ÑÌä∏ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§: ' + (e.message || 'ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïã§Ìå®'), 'error');
            this.showAgentConfig = false;
          } finally {
            this.agentConfigLoading = false;
          }
        },

        async saveAgentSoul() {
          this.agentConfigSaveStatus = 'saving';
          try {
            const res = await fetch(`/api/agents/${this.agentConfigId}/soul`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ system_prompt: this.agentSoulText }),
            }).then(r => r.json());
            if (res.error) {
              this.showToast(res.error, 'error');
              this.agentConfigSaveStatus = 'error';
            } else {
              this.agentConfigData.system_prompt = this.agentSoulText;
              this.agentConfigSaveStatus = 'saved';
              this.showToast('ÏÜåÏö∏Ïù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', 'success');
            }
          } catch (e) {
            this.agentConfigSaveStatus = 'error';
            this.showToast('ÏÜåÏö∏ Ï†ÄÏû• Ïã§Ìå®: ' + (e.message || 'ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•ò'), 'error');
          }
          setTimeout(() => { this.agentConfigSaveStatus = ''; }, 2500);
        },

        async saveAgentModel() {
          this.agentConfigSaveStatus = 'saving';
          try {
            const res = await fetch(`/api/agents/${this.agentConfigId}/model`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ model_name: this.agentModelSelection }),
            }).then(r => r.json());
            if (res.error) {
              this.showToast(res.error, 'error');
              this.agentConfigSaveStatus = 'error';
            } else {
              this.agentConfigData.model_name = this.agentModelSelection;
              // Î™®Îç∏ Î≥ÄÍ≤Ω Ïãú Ï∂îÎ°† ÏòµÏÖòÎèÑ Í∞±Ïã†
              const newModel = this.availableModels.find(m => m.name === this.agentModelSelection);
              this.agentReasoningOptions = newModel?.reasoning_levels || [];
              // Fallback
              if (this.agentReasoningOptions.length === 0 && this.agentModelSelection) {
                const mn = this.agentModelSelection;
                const defaultReasoning = {
                  'claude-opus-4-6': ['low','medium','high'],
                  'claude-sonnet-4-5-20250929': ['low','medium','high'],
                  'gpt-5-mini': ['low','medium','high'],
                  'gpt-5': ['none','low','medium','high'],
                  'gpt-5.1': ['none','low','medium','high'],
                  'gpt-5.1-codex': ['none','low','medium','high'],
                  'gpt-5.2': ['none','low','medium','high','xhigh'],
                  'gpt-5.2-codex': ['none','low','medium','high','xhigh'],
                  'gpt-5.2-pro': ['medium','high','xhigh'],
                };
                this.agentReasoningOptions = defaultReasoning[mn] || [];
              }
              // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Ï∂îÎ°† Ï†ïÎèÑÍ∞Ä ÏÉà Î™®Îç∏ÏóêÏÑú ÏßÄÏõê Ïïà ÎêòÎ©¥ Ï¥àÍ∏∞Ìôî
              if (this.agentReasoningSelection && !this.agentReasoningOptions.includes(this.agentReasoningSelection)) {
                this.agentReasoningSelection = '';
              }
              this.agentConfigSaveStatus = 'saved';
              this.showToast('Î™®Îç∏Ïù¥ Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.', 'success');
            }
          } catch (e) {
            this.agentConfigSaveStatus = 'error';
            this.showToast('Î™®Îç∏ Î≥ÄÍ≤Ω Ïã§Ìå®: ' + (e.message || 'ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•ò'), 'error');
          }
          setTimeout(() => { this.agentConfigSaveStatus = ''; }, 2500);
        },

        async saveAgentReasoning() {
          this.agentConfigSaveStatus = 'saving';
          try {
            const res = await fetch(`/api/agents/${this.agentConfigId}/reasoning`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ reasoning_effort: this.agentReasoningSelection }),
            }).then(r => r.json());
            if (res.error) {
              this.showToast(res.error, 'error');
              this.agentConfigSaveStatus = 'error';
            } else {
              this.agentConfigData.reasoning_effort = this.agentReasoningSelection;
              this.agentConfigSaveStatus = 'saved';
              this.showToast('Ï∂îÎ°† Ï†ïÎèÑÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.', 'success');
            }
          } catch (e) {
            this.agentConfigSaveStatus = 'error';
            this.showToast('Ï∂îÎ°† Ï†ïÎèÑ Î≥ÄÍ≤Ω Ïã§Ìå®: ' + (e.message || 'ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•ò'), 'error');
          }
          setTimeout(() => { this.agentConfigSaveStatus = ''; }, 2500);
        },

        // ‚îÄ‚îÄ Tab Switching ‚îÄ‚îÄ

        switchTab(tabId) {
          this.activeTab = tabId;
          if (tabId === 'home' && !this.dashboard.loaded) this.loadDashboard();
          if (tabId === 'performance' && !this.performance.loaded) this.loadPerformance();
          if (tabId === 'history' && !this.taskHistory.loaded) this.loadTaskHistory();
          if (tabId === 'schedule') this.loadSchedules();
          if (tabId === 'workflow') this.loadWorkflows();
          if (tabId === 'knowledge') this.loadKnowledge();
          if (tabId === 'archive') this.loadArchive();
          if (tabId === 'sns') this.loadSNS();
        },

        // ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ

        async loadDashboard() {
          try {
            const [data, budgetRes, qualityRes] = await Promise.all([
              fetch('/api/dashboard').then(r => r.ok ? r.json() : {}),
              fetch('/api/budget').then(r => r.ok ? r.json() : {}),
              fetch('/api/quality').then(r => r.ok ? r.json() : {}),
            ]);
            this.dashboard = {
              todayTasks: data.today_task_count || 0,
              todayCompleted: data.today_completed || 0,
              todayFailed: data.today_failed || 0,
              runningCount: data.running_count || 0,
              totalCost: data.total_cost || 0,
              totalTokens: data.total_tokens || 0,
              agentCount: data.agent_count || 0,
              recentCompleted: data.recent_completed || [],
              systemHealth: data.system_health || 'ok',
              loaded: true,
            };
            this.budget = budgetRes;
            this.quality = qualityRes;
          } catch (e) { console.error('Dashboard load failed:', e); }
        },

        // ‚îÄ‚îÄ Presets ‚îÄ‚îÄ

        async loadPresets() {
          try {
            const data = await fetch('/api/presets').then(r => r.json());
            this.presets.items = data || [];
            this.backendPresets = data || [];
          } catch (e) { console.error('Presets load failed:', e); }
        },

        // ‚îÄ‚îÄ Performance ‚îÄ‚îÄ

        async loadPerformance() {
          try {
            const data = await fetch('/api/performance').then(r => r.json());
            const agents = data.agents || [];
            const maxCost = Math.max(...agents.map(a => a.cost_usd || 0), 0.0001);
            const totalTasks = agents.reduce((s, a) => s + (a.tasks_completed || 0), 0);
            const rates = agents.filter(a => a.tasks_completed > 0).map(a => a.success_rate || 0);
            const avgRate = rates.length > 0 ? rates.reduce((s, r) => s + r, 0) / rates.length : 0;
            this.performance = {
              agents,
              totalCalls: data.total_llm_calls || 0,
              totalCost: data.total_cost_usd || 0,
              totalTasks,
              avgSuccessRate: avgRate,
              maxCost,
              loaded: true,
            };
          } catch (e) { console.error('Performance load failed:', e); }
        },

        // ‚îÄ‚îÄ Task History ‚îÄ‚îÄ

        async loadTaskHistory() {
          try {
            const params = new URLSearchParams();
            if (this.taskHistory.search) params.set('keyword', this.taskHistory.search);
            if (this.taskHistory.filterStatus !== 'all') params.set('status', this.taskHistory.filterStatus);
            if (this.taskHistory.bookmarkOnly) params.set('bookmarked', 'true');
            const data = await fetch('/api/tasks?' + params.toString()).then(r => r.json());
            this.taskHistory.items = data || [];
            this.taskHistory.loaded = true;
          } catch (e) { console.error('Task history load failed:', e); }
        },

        async loadTaskDetail(taskId) {
          try {
            const data = await fetch(`/api/tasks/${taskId}`).then(r => r.json());
            const task = this.taskHistory.items.find(t => t.task_id === taskId);
            if (task) {
              task._fullResult = data.result_data || '';
              task.correlation_id = data.correlation_id || '';
            }
          } catch (e) { console.error('Task detail load failed:', e); }
        },

        async toggleBookmark(taskId) {
          try {
            const res = await fetch(`/api/tasks/${taskId}/bookmark`, { method: 'POST' }).then(r => r.json());
            const task = this.taskHistory.items.find(t => t.task_id === taskId);
            if (task) task.bookmarked = res.bookmarked;
          } catch (e) { console.error('Bookmark toggle failed:', e); }
        },

        toggleTaskSelect(taskId) {
          const idx = this.taskHistory.selectedIds.indexOf(taskId);
          if (idx >= 0) {
            this.taskHistory.selectedIds.splice(idx, 1);
          } else {
            if (this.taskHistory.selectedIds.length >= 2) this.taskHistory.selectedIds.shift();
            this.taskHistory.selectedIds.push(taskId);
          }
        },

        async openComparison() {
          if (this.taskHistory.selectedIds.length !== 2) return;
          try {
            const [a, b] = await Promise.all(
              this.taskHistory.selectedIds.map(id => fetch(`/api/tasks/${id}`).then(r => r.json()))
            );
            this.taskHistory.compareA = a;
            this.taskHistory.compareB = b;
            this.taskHistory.compareMode = true;
          } catch (e) { console.error('Comparison load failed:', e); }
        },

        async loadReplay(correlationId, taskId) {
          if (this.taskHistory.replayData[taskId]) {
            this.taskHistory.replayData[taskId] = null;
            return;
          }
          try {
            const data = await fetch(`/api/replay/${correlationId}`).then(r => r.json());
            this.taskHistory.replayData[taskId] = data;
          } catch (e) { console.error('Replay load failed:', e); }
        },

        renderReplayTree(data) {
          if (!data || !data.root) return '<div class="text-xs text-hq-muted">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>';
          const renderNode = (node, depth = 0) => {
            const indent = depth * 16;
            const icon = node.type === 'task_request' ? '‚Üí' : '‚Üê';
            const color = node.success === false ? 'text-hq-red' : node.type === 'task_result' ? 'text-hq-green' : 'text-hq-cyan';
            let html = `<div style="margin-left:${indent}px" class="py-1 text-[11px]">`;
            html += `<span class="${color} font-semibold">${icon} ${node.sender_id || ''}</span>`;
            html += `<span class="text-hq-muted ml-1">${(node.detail || node.summary || '').substring(0, 100)}</span>`;
            if (node.time) html += `<span class="text-hq-muted/50 ml-1 font-mono">${node.time}s</span>`;
            html += '</div>';
            if (node.children) {
              for (const child of node.children) {
                html += renderNode(child, depth + 1);
              }
            }
            return html;
          };
          return renderNode(data.root);
        },

        // ‚îÄ‚îÄ Memory (ÏóêÏù¥Ï†ÑÌä∏ Í∏∞Ïñµ) ‚îÄ‚îÄ

        async openMemoryModal(agentId, agentName) {
          this.memoryModal.agentId = agentId;
          this.memoryModal.agentName = agentName;
          this.memoryModal.newKey = '';
          this.memoryModal.newValue = '';
          this.memoryModal.visible = true;
          await this.loadMemory(agentId);
        },

        async loadMemory(agentId) {
          try {
            const data = await fetch(`/api/memory/${agentId}`).then(r => r.json());
            this.memoryModal.items = Array.isArray(data) ? data : [];
          } catch (e) { this.memoryModal.items = []; }
        },

        async addMemory() {
          const key = this.memoryModal.newKey.trim();
          const value = this.memoryModal.newValue.trim();
          if (!key || !value) return;
          try {
            await fetch(`/api/memory/${this.memoryModal.agentId}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ key, value }),
            });
            this.memoryModal.newKey = '';
            this.memoryModal.newValue = '';
            await this.loadMemory(this.memoryModal.agentId);
          } catch (e) { console.error('Add memory failed:', e); }
        },

        async deleteMemory(memoryId) {
          try {
            await fetch(`/api/memory/${this.memoryModal.agentId}/${memoryId}`, { method: 'DELETE' });
            await this.loadMemory(this.memoryModal.agentId);
          } catch (e) { console.error('Delete memory failed:', e); }
        },

        // ‚îÄ‚îÄ Schedules ‚îÄ‚îÄ

        async loadSchedules() {
          try {
            const data = await fetch('/api/schedules').then(r => r.json());
            this.schedules.items = (Array.isArray(data) ? data : data.schedules || []).map(s => ({
              ...s, id: s.schedule_id, cron_label: s.cron_preset,
            }));
          } catch (e) { this.schedules.items = []; }
        },

        async addSchedule() {
          const name = this.schedules.editName.trim();
          const command = this.schedules.editCommand.trim();
          const cron_preset = this.schedules.editCronPreset;
          if (!name || !command) return;
          try {
            await fetch('/api/schedules', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ name, command, cron_preset }),
            });
            this.schedules.editName = '';
            this.schedules.editCommand = '';
            this.schedules.showModal = false;
            await this.loadSchedules();
          } catch (e) { console.error('Add schedule failed:', e); }
        },

        async toggleSchedule(id) {
          try {
            await fetch(`/api/schedules/${id}/toggle`, { method: 'POST' });
            await this.loadSchedules();
          } catch (e) { console.error('Toggle schedule failed:', e); }
        },

        async deleteSchedule(id) {
          try {
            await fetch(`/api/schedules/${id}`, { method: 'DELETE' });
            await this.loadSchedules();
          } catch (e) { console.error('Delete schedule failed:', e); }
        },

        // ‚îÄ‚îÄ Workflows ‚îÄ‚îÄ

        async loadWorkflows() {
          try {
            const data = await fetch('/api/workflows').then(r => r.json());
            this.workflows.items = (Array.isArray(data) ? data : data.workflows || []).map(w => ({
              ...w, id: w.workflow_id,
            }));
          } catch (e) { this.workflows.items = []; }
        },

        editWorkflow(wf) {
          this.workflows.editing = wf.id || wf.workflow_id;
          this.workflows.editName = wf.name;
          this.workflows.editDesc = wf.description || '';
          this.workflows.editSteps = wf.steps.map(s => ({ ...s }));
          this.workflows.showEditor = true;
        },

        async saveWorkflow() {
          const name = this.workflows.editName.trim();
          if (!name || this.workflows.editSteps.length === 0) return;
          const body = {
            name,
            description: this.workflows.editDesc,
            steps: this.workflows.editSteps.filter(s => s.command.trim()),
          };
          try {
            if (this.workflows.editing) {
              await fetch(`/api/workflows/${this.workflows.editing}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body),
              });
            } else {
              await fetch('/api/workflows', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body),
              });
            }
            this.workflows.showEditor = false;
            await this.loadWorkflows();
          } catch (e) { console.error('Save workflow failed:', e); }
        },

        async deleteWorkflow(id) {
          try {
            await fetch(`/api/workflows/${id}`, { method: 'DELETE' });
            await this.loadWorkflows();
          } catch (e) { console.error('Delete workflow failed:', e); }
        },

        async runWorkflow(id) {
          this.workflows.runningId = id;
          try {
            await fetch(`/api/workflows/${id}/run`, { method: 'POST' });
          } catch (e) { console.error('Run workflow failed:', e); }
          finally { setTimeout(() => { this.workflows.runningId = null; }, 2000); }
        },

        // ‚îÄ‚îÄ Auth (Ïù∏Ï¶ù) ‚îÄ‚îÄ

        async checkAuth() {
          try {
            const data = await fetch('/api/auth/status').then(r => r.json());
            this.auth.bootstrapMode = data.bootstrap_mode;
            if (data.bootstrap_mode) {
              this.auth.role = 'ceo';
              this.auth.showLogin = false;
              return;
            }
            // ÌÜ†ÌÅ∞ ÌôïÏù∏
            const token = localStorage.getItem('corthex_token');
            if (token) {
              this.auth.token = token;
              const userJson = localStorage.getItem('corthex_user');
              if (userJson) {
                this.auth.user = JSON.parse(userJson);
                this.auth.role = this.auth.user.role;
              }
              this.auth.showLogin = false;
            } else {
              this.auth.showLogin = true;
            }
          } catch (e) {
            // API Ïò§Î•ò Ïãú Î∂ÄÌä∏Ïä§Ìä∏Îû© Î™®ÎìúÎ°ú Í∞ÑÏ£º
            this.auth.bootstrapMode = true;
            this.auth.role = 'ceo';
          }
        },

        async doLogin() {
          this.auth.loginError = '';
          const username = this.auth.loginUser.trim();
          const password = this.auth.loginPass.trim();
          if (!username || !password) { this.auth.loginError = 'ÏÇ¨Ïö©ÏûêÎ™ÖÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî'; return; }
          try {
            const data = await fetch('/api/auth/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ username, password }),
            }).then(r => r.json());
            if (data.success) {
              localStorage.setItem('corthex_token', data.token);
              localStorage.setItem('corthex_user', JSON.stringify(data.user));
              this.auth.token = data.token;
              this.auth.user = data.user;
              this.auth.role = data.user.role;
              this.auth.showLogin = false;
              this.auth.loginUser = '';
              this.auth.loginPass = '';
            } else {
              this.auth.loginError = data.error || 'Î°úÍ∑∏Ïù∏ Ïã§Ìå®';
            }
          } catch (e) { this.auth.loginError = 'ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•ò'; }
        },

        async doRegister() {
          this.auth.loginError = '';
          const username = this.auth.loginUser.trim();
          const password = this.auth.loginPass.trim();
          if (!username || !password) { this.auth.loginError = 'ÏÇ¨Ïö©ÏûêÎ™ÖÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî'; return; }
          try {
            const data = await fetch('/api/auth/register', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ username, password }),
            }).then(r => r.json());
            if (data.success) {
              localStorage.setItem('corthex_token', data.token);
              localStorage.setItem('corthex_user', JSON.stringify(data.user));
              this.auth.token = data.token;
              this.auth.user = data.user;
              this.auth.role = data.user.role;
              this.auth.showLogin = false;
              this.auth.loginUser = '';
              this.auth.loginPass = '';
            } else {
              this.auth.loginError = data.error || 'ÌöåÏõêÍ∞ÄÏûÖ Ïã§Ìå®';
            }
          } catch (e) { this.auth.loginError = 'ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•ò'; }
        },

        doLogout() {
          localStorage.removeItem('corthex_token');
          localStorage.removeItem('corthex_user');
          this.auth.token = null;
          this.auth.user = null;
          this.auth.role = 'viewer';
          if (!this.auth.bootstrapMode) {
            this.auth.showLogin = true;
          }
        },

        // ‚îÄ‚îÄ Dynamic Loading ‚îÄ‚îÄ
        async loadAgentsAndTools() {
          try {
            const [agents, tools] = await Promise.all([
              fetch('/api/agents').then(r => r.ok ? r.json() : []),
              fetch('/api/tools').then(r => r.ok ? r.json() : []),
            ]);
            if (Array.isArray(agents) && agents.length > 0) {
              agents.forEach(a => {
                this.agentNames[a.agent_id] = a.name_ko || a.agent_id;
                const nameKo = a.name_ko || a.agent_id;
                this.agentInitials[a.agent_id] = nameKo.length >= 2 ? nameKo.substring(0, 2) : nameKo.toUpperCase();
                this.agentRoles[a.agent_id] = a.role || '';
                this.agentModels[a.agent_id] = a.model_name || '';
                if (a.division) {
                  const divMap = { 'ÎπÑÏÑúÏã§': 'secretary', 'Í∏∞Ïà†Í∞úÎ∞úÏ≤ò': 'tech', 'ÏÇ¨ÏóÖÍ∏∞ÌöçÏ≤ò': 'strategy',
                                   'Î≤ïÎ¨¥Ï≤ò': 'legal', 'ÎßàÏºÄÌåÖÏ≤ò': 'marketing', 'Ìà¨ÏûêÎ∂ÑÏÑùÏ≤ò': 'finance',
                                   'Ï∂úÌåêÍ∏∞Î°ùÏ≤ò': 'publishing', 'Ï∂úÌåêÏ≤ò': 'publishing' };
                  this.agentDivision[a.agent_id] = divMap[a.division] || a.division;
                }
              });
            }
          } catch (e) {
            console.warn('ÏóêÏù¥Ï†ÑÌä∏/ÎèÑÍµ¨ ÎèôÏ†Å Î°úÎî© Ïã§Ìå®, ÌïòÎìúÏΩîÎî© ÏÇ¨Ïö©:', e);
          }
        },

        async loadConversation() {
          try {
            const res = await fetch('/api/conversation');
            if (!res.ok) return;
            const history = await res.json();
            if (Array.isArray(history) && history.length > 0) {
              history.forEach(item => {
                if (item.command) this.messages.push({ type: 'user', text: item.command });
                if (item.summary) this.messages.push({ type: 'result', content: item.summary, sender_id: 'system', collapsed: false, feedbackSent: false, feedbackRating: null });
              });
              this.$nextTick(() => this.scrollToBottom());
            }
          } catch (e) {
            console.warn('ÎåÄÌôî Í∏∞Î°ù Î≥µÏõê Ïã§Ìå®:', e);
          }
        },

        async sendFeedback(msg, rating) {
          if (msg.feedbackSent) return;
          try {
            const res = await fetch('/api/feedback', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ correlation_id: msg.task_id || '', rating, agent_id: msg.sender_id || '' }),
            });
            const data = await res.json();
            if (data.success) {
              msg.feedbackSent = true;
              msg.feedbackRating = rating;
              this.showToast(rating === 'good' ? 'Í∏çÏ†ï ÌîºÎìúÎ∞±ÏùÑ Î≥¥ÎÉàÏäµÎãàÎã§.' : 'Î∂ÄÏ†ï ÌîºÎìúÎ∞±ÏùÑ Î≥¥ÎÉàÏäµÎãàÎã§.', 'success');
            } else {
              this.showToast(data.error || 'ÌîºÎìúÎ∞± Ï†ÑÏÜ° Ïã§Ìå®', 'error');
            }
          } catch {
            this.showToast('ÌîºÎìúÎ∞± Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
          }
        },

        async loadHealth() {
          try {
            const res = await fetch('/api/health');
            if (res.ok) this.healthData = await res.json();
          } catch { /* Î¨¥Ïãú */ }
        },

        // ‚îÄ‚îÄ Preset Management (Ïõ∞Ïª¥ÌôîÎ©¥Ïö©) ‚îÄ‚îÄ
        async addPreset() {
          const name = this.newPresetName.trim();
          const command = this.newPresetCommand.trim();
          if (!name || !command) { this.showToast('Ïù¥Î¶ÑÍ≥º Î™ÖÎ†πÏñ¥Î•º Î™®Îëê ÏûÖÎ†•ÌïòÏÑ∏Ïöî.', 'warning'); return; }
          try {
            const res = await fetch('/api/presets', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ name, command }),
            });
            const data = await res.json();
            if (data.success) {
              this.showAddPreset = false;
              this.newPresetName = '';
              this.newPresetCommand = '';
              this.showToast('ÌîÑÎ¶¨ÏÖãÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.', 'success');
              await this.loadPresets();
            } else {
              this.showToast(data.error || 'ÌîÑÎ¶¨ÏÖã Ï∂îÍ∞Ä Ïã§Ìå®', 'error');
            }
          } catch { this.showToast('ÌîÑÎ¶¨ÏÖã Ï∂îÍ∞ÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        async deletePreset(name) {
          try {
            const res = await fetch(`/api/presets/${encodeURIComponent(name)}`, { method: 'DELETE' });
            const data = await res.json();
            if (data.success) {
              this.showToast(`ÌîÑÎ¶¨ÏÖã '${name}'Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'success');
              await this.loadPresets();
            } else {
              this.showToast(data.error || 'ÌîÑÎ¶¨ÏÖã ÏÇ≠Ï†ú Ïã§Ìå®', 'error');
            }
          } catch { this.showToast('ÌîÑÎ¶¨ÏÖã ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        // ‚îÄ‚îÄ Knowledge Management ‚îÄ‚îÄ
        async loadKnowledge() {
          this.knowledge.loading = true;
          try {
            const res = await fetch('/api/knowledge');
            if (res.ok) this.knowledge.files = await res.json();
          } catch { this.showToast('ÏßÄÏãù ÌååÏùº Î™©Î°ùÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.', 'error'); }
          finally { this.knowledge.loading = false; }
        },

        async selectKnowledgeFile(file) {
          this.knowledge.selectedFile = file;
          this.knowledge.editMode = false;
          try {
            const res = await fetch(`/api/knowledge/${encodeURIComponent(file.folder)}/${encodeURIComponent(file.filename)}`);
            if (res.ok) {
              const data = await res.json();
              this.knowledge.content = data.content || '';
            }
          } catch { this.showToast('ÌååÏùº ÎÇ¥Ïö©ÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.', 'error'); }
        },

        async saveKnowledge() {
          if (!this.knowledge.selectedFile) return;
          this.knowledge.saving = true;
          try {
            const res = await fetch('/api/knowledge', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ folder: this.knowledge.selectedFile.folder, filename: this.knowledge.selectedFile.filename, content: this.knowledge.content }),
            });
            const data = await res.json();
            if (data.success) {
              this.showToast('ÌååÏùºÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', 'success');
              this.knowledge.editMode = false;
            } else { this.showToast(data.error || 'Ï†ÄÏû• Ïã§Ìå®', 'error'); }
          } catch { this.showToast('ÌååÏùº Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
          finally { this.knowledge.saving = false; }
        },

        async deleteKnowledge() {
          if (!this.knowledge.selectedFile) return;
          const f = this.knowledge.selectedFile;
          try {
            const res = await fetch(`/api/knowledge/${encodeURIComponent(f.folder)}/${encodeURIComponent(f.filename)}`, { method: 'DELETE' });
            const data = await res.json();
            if (data.success) {
              this.knowledge.files = this.knowledge.files.filter(x => x.folder !== f.folder || x.filename !== f.filename);
              this.knowledge.selectedFile = null;
              this.knowledge.content = '';
              this.showToast('ÌååÏùºÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
            } else { this.showToast(data.error || 'ÏÇ≠Ï†ú Ïã§Ìå®', 'error'); }
          } catch { this.showToast('ÌååÏùº ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        async createKnowledgeFile() {
          const folder = this.knowledge.newFolder.trim() || 'general';
          const filename = this.knowledge.newFileName.trim();
          if (!filename) { this.showToast('ÌååÏùºÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.', 'warning'); return; }
          try {
            const res = await fetch('/api/knowledge', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ folder, filename, content: '' }),
            });
            const data = await res.json();
            if (data.success) {
              await this.loadKnowledge();
              this.knowledge.showCreateForm = false;
              this.knowledge.newFolder = '';
              this.knowledge.newFileName = '';
              this.showToast('ÌååÏùºÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.', 'success');
            } else { this.showToast(data.error || 'ÏÉùÏÑ± Ïã§Ìå®', 'error'); }
          } catch { this.showToast('ÌååÏùº ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        // ‚îÄ‚îÄ Archive Browser ‚îÄ‚îÄ
        async loadArchive() {
          this.archive.loading = true;
          try {
            const res = await fetch('/api/archive');
            if (res.ok) this.archive.files = await res.json();
          } catch { this.showToast('ÏïÑÏπ¥Ïù¥Î∏åÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.', 'error'); }
          finally { this.archive.loading = false; }
        },

        async readArchiveReport(file) {
          this.archive.selectedReport = file;
          try {
            const res = await fetch(`/api/archive/${encodeURIComponent(file.division)}/${encodeURIComponent(file.filename)}`);
            if (res.ok) {
              const data = await res.json();
              this.archive.content = data.content || '';
            }
          } catch { this.showToast('Î≥¥Í≥†ÏÑúÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.', 'error'); }
        },

        async searchArchiveByCorrelation() {
          const id = this.archive.searchCorrelation.trim();
          if (!id) return;
          try {
            const res = await fetch(`/api/archive/by-correlation/${encodeURIComponent(id)}`);
            if (res.ok) {
              const data = await res.json();
              if (Array.isArray(data) && data.length > 0) {
                this.archive.content = data.map(d => `### ${d.division}/${d.filename}\n\n${d.content}`).join('\n\n---\n\n');
                this.archive.selectedReport = { filename: `Í≤ÄÏÉâ: ${id}` };
              } else {
                this.showToast('Ìï¥Îãπ ÏûëÏóÖ IDÏùò Î≥¥Í≥†ÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'warning');
              }
            }
          } catch { this.showToast('Í≤ÄÏÉâÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        // ‚îÄ‚îÄ SNS Management ‚îÄ‚îÄ
        async loadSNS() {
          this.sns.loading = true;
          try {
            const [status, oauth] = await Promise.all([
              fetch('/api/sns/status').then(r => r.ok ? r.json() : {}),
              fetch('/api/sns/oauth/status').then(r => r.ok ? r.json() : {}),
            ]);
            this.sns.status = status;
            this.sns.oauthStatus = oauth;
          } catch { /* Î¨¥Ïãú */ }
          finally { this.sns.loading = false; }
        },

        async connectPlatform(platform) {
          try {
            const res = await fetch(`/api/sns/auth/${platform}`);
            if (res.ok) {
              const data = await res.json();
              if (data.auth_url) {
                window.open(data.auth_url, '_blank', 'width=600,height=700');
                this.showToast(`${platform} Ïù∏Ï¶ù Ï∞ΩÏù¥ Ïó¥Î†∏ÏäµÎãàÎã§. Ïù∏Ï¶ù ÏôÑÎ£å ÌõÑ Ïù¥ ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏÑ∏Ïöî.`, 'info');
              }
            }
          } catch { this.showToast('Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        async postInstagramPhoto() {
          if (!this.sns.igImageUrl.trim()) { this.showToast('Ïù¥ÎØ∏ÏßÄ URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.', 'warning'); return; }
          try {
            const res = await fetch('/api/sns/instagram/photo', {
              method: 'POST', headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ image_url: this.sns.igImageUrl, caption: this.sns.igCaption }),
            });
            const data = await res.json();
            data.success ? this.showToast('Instagram ÏÇ¨ÏßÑÏù¥ Í≤åÏãúÎêòÏóàÏäµÎãàÎã§.', 'success') : this.showToast(data.error || 'Í≤åÏãú Ïã§Ìå®', 'error');
          } catch { this.showToast('Í≤åÏãúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        async postInstagramReel() {
          if (!this.sns.igVideoUrl.trim()) { this.showToast('ÎπÑÎîîÏò§ URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.', 'warning'); return; }
          try {
            const res = await fetch('/api/sns/instagram/reel', {
              method: 'POST', headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ video_url: this.sns.igVideoUrl, caption: this.sns.igReelCaption }),
            });
            const data = await res.json();
            data.success ? this.showToast('Instagram Î¶¥Ïä§Í∞Ä Í≤åÏãúÎêòÏóàÏäµÎãàÎã§.', 'success') : this.showToast(data.error || 'Í≤åÏãú Ïã§Ìå®', 'error');
          } catch { this.showToast('Í≤åÏãúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        async postYouTubeVideo() {
          if (!this.sns.ytFilePath.trim() || !this.sns.ytTitle.trim()) { this.showToast('ÌååÏùº Í≤ΩÎ°úÏôÄ Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.', 'warning'); return; }
          try {
            const res = await fetch('/api/sns/youtube/upload', {
              method: 'POST', headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                file_path: this.sns.ytFilePath, title: this.sns.ytTitle, description: this.sns.ytDesc,
                tags: this.sns.ytTags.split(',').map(t => t.trim()).filter(Boolean), privacy: this.sns.ytPrivacy,
              }),
            });
            const data = await res.json();
            data.success ? this.showToast('YouTube ÏóÖÎ°úÎìúÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.', 'success') : this.showToast(data.error || 'ÏóÖÎ°úÎìú Ïã§Ìå®', 'error');
          } catch { this.showToast('ÏóÖÎ°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        async loadSNSQueue() {
          this.sns.loading = true;
          try {
            const res = await fetch('/api/sns/queue');
            if (res.ok) this.sns.queue = await res.json();
          } catch { /* Î¨¥Ïãú */ }
          finally { this.sns.loading = false; }
        },

        async approveSNS(id) {
          try {
            const res = await fetch(`/api/sns/approve/${id}`, { method: 'POST' });
            const data = await res.json();
            if (!data.error) {
              this.showToast('ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§.', 'success');
              this.loadSNSQueue();
            } else { this.showToast(data.error, 'error'); }
          } catch { this.showToast('ÏäπÏù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        async rejectSNS(id) {
          try {
            const res = await fetch(`/api/sns/reject/${id}`, {
              method: 'POST', headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ reason: this.sns.rejectReason }),
            });
            const data = await res.json();
            if (!data.error) {
              this.showToast('Í±∞Ï†àÎêòÏóàÏäµÎãàÎã§.', 'success');
              this.sns.rejectingId = null;
              this.sns.rejectReason = '';
              this.loadSNSQueue();
            } else { this.showToast(data.error, 'error'); }
          } catch { this.showToast('Í±∞Ï†àÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        async loadSNSEvents() {
          this.sns.loading = true;
          try {
            const res = await fetch('/api/sns/events?limit=50');
            if (res.ok) {
              const data = await res.json();
              this.sns.events = data.events || [];
            }
          } catch { /* Î¨¥Ïãú */ }
          finally { this.sns.loading = false; }
        },

        // ‚îÄ‚îÄ #5: Dynamic Tools Loading ‚îÄ‚îÄ
        async loadToolsList() {
          try {
            const data = await fetch('/api/tools').then(r => r.ok ? r.json() : []);
            this.toolsList = Array.isArray(data) ? data : [];
          } catch { this.toolsList = []; }
        },

        // ‚îÄ‚îÄ #7: Feedback Stats ‚îÄ‚îÄ
        async loadFeedbackStats() {
          try {
            const data = await fetch('/api/feedback').then(r => r.ok ? r.json() : {});
            this.feedbackStats = {
              good: data.good || 0,
              bad: data.bad || 0,
              total: data.total || 0,
              satisfaction_rate: data.total > 0 ? Math.round((data.good / data.total) * 100) : 0,
            };
          } catch { /* Î¨¥Ïãú */ }
        },

        // ‚îÄ‚îÄ #8: Budget Edit ‚îÄ‚îÄ
        async saveBudget() {
          try {
            const res = await fetch('/api/budget', {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ daily_limit: this.budgetEditDaily, monthly_limit: this.budgetEditMonthly }),
            }).then(r => r.json());
            if (res.success) {
              this.budget.daily_limit = res.daily_limit;
              this.budget.monthly_limit = res.monthly_limit;
              this.showBudgetEdit = false;
              this.showToast('ÏòàÏÇ∞ ÌïúÎèÑÍ∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.', 'success');
            } else {
              this.showToast(res.error || 'ÏòàÏÇ∞ ÏàòÏ†ï Ïã§Ìå®', 'error');
            }
          } catch { this.showToast('ÏòàÏÇ∞ ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); }
        },

        // ‚îÄ‚îÄ #13: Activity Log Persistence ‚îÄ‚îÄ
        restoreActivityLogs() {
          try {
            const saved = localStorage.getItem('corthex-activity-logs');
            if (saved) this.activityLogs = JSON.parse(saved).slice(-100);
          } catch { /* Î¨¥Ïãú */ }
        },
        saveActivityLogs() {
          try {
            localStorage.setItem('corthex-activity-logs', JSON.stringify(this.activityLogs.slice(-100)));
          } catch { /* Î¨¥Ïãú */ }
        },

        // ‚îÄ‚îÄ #14: Task History Pagination ‚îÄ‚îÄ
        getPagedTaskHistory() {
          const end = this.taskHistoryPage * this.taskHistoryPageSize;
          return this.taskHistory.items.slice(0, end);
        },
        loadMoreTasks() {
          this.taskHistoryPage++;
        },
        hasMoreTasks() {
          return this.taskHistoryPage * this.taskHistoryPageSize < this.taskHistory.items.length;
        },

        // ‚îÄ‚îÄ #15: Conversation Export ‚îÄ‚îÄ
        exportConversation() {
          let md = '# CORTHEX HQ ÎåÄÌôî Í∏∞Î°ù\n\n';
          md += `ÎÇ†Ïßú: ${new Date().toLocaleDateString('ko-KR')}\n\n---\n\n`;
          this.messages.forEach(msg => {
            if (msg.type === 'user') {
              md += `## CEO Î™ÖÎ†π\n\n${msg.text}\n\n`;
            } else if (msg.type === 'result') {
              md += `## Í≤∞Í≥º (${msg.sender_id || 'system'})\n\n${msg.content || ''}\n\n---\n\n`;
            } else if (msg.type === 'error') {
              md += `## Ïò§Î•ò\n\n${msg.text}\n\n`;
            }
          });
          const blob = new Blob([md], { type: 'text/markdown' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `corthex-ÎåÄÌôî-${new Date().toISOString().slice(0, 10)}.md`;
          a.click();
          URL.revokeObjectURL(url);
          this.showToast('ÎåÄÌôî Í∏∞Î°ùÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.', 'success');
        },

        // ‚îÄ‚îÄ #16: Keyboard Shortcuts ‚îÄ‚îÄ
        initKeyboardShortcuts() {
          document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + K ‚Üí Î™ÖÎ†π ÏûÖÎ†•Ï∞ΩÏúºÎ°ú Ìè¨Ïª§Ïä§
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
              e.preventDefault();
              this.activeTab = 'command';
              this.viewMode = 'chat';
              this.$nextTick(() => {
                if (this.$refs.inputArea) this.$refs.inputArea.focus();
              });
            }
            // Esc ‚Üí Î™®Îã¨ Îã´Í∏∞
            if (e.key === 'Escape') {
              if (this.showAgentConfig) { this.showAgentConfig = false; return; }
              if (this.showQualitySettings) { this.showQualitySettings = false; return; }
              if (this.showTaskDetail) { this.showTaskDetail = false; return; }
              if (this.showBudgetEdit) { this.showBudgetEdit = false; return; }
              if (this.taskHistory.compareMode) { this.taskHistory.compareMode = false; return; }
              if (this.memoryModal.visible) { this.memoryModal.visible = false; return; }
            }
          });
        },

        // ‚îÄ‚îÄ #12: Tab grouping helpers ‚îÄ‚îÄ
        getPrimaryTabs() {
          return this.tabs.filter(t => ['home', 'command', 'performance', 'history', 'sns'].includes(t.id));
        },
        getSecondaryTabs() {
          return this.tabs.filter(t => !['home', 'command', 'performance', 'history', 'sns'].includes(t.id));
        },

        // ‚îÄ‚îÄ #4: Publishing division support ‚îÄ‚îÄ
        getDivisionLabel(division) {
          const labels = {
            'default': 'Í∏∞Î≥∏ (Ï†ÑÏ≤¥ Í≥µÌÜµ)',
            'secretary': 'ÎπÑÏÑúÏã§',
            'leet_master.tech': 'Í∏∞Ïà†Í∞úÎ∞úÏ≤ò (CTO)',
            'leet_master.strategy': 'ÏÇ¨ÏóÖÍ∏∞ÌöçÏ≤ò (CSO)',
            'leet_master.legal': 'Î≤ïÎ¨¥Ï≤ò (CLO)',
            'leet_master.marketing': 'ÎßàÏºÄÌåÖÏ≤ò (CMO)',
            'finance.investment': 'Ìà¨ÏûêÎ∂ÑÏÑùÏ≤ò (CIO)',
            'publishing': 'Ï∂úÌåê¬∑Í∏∞Î°ù (CPO)',
          };
          return labels[division] || division;
        },

        getToolDisplayName(toolId) {
          const t = (this.toolsList || []).find(t => t.name === toolId);
          return t?.name_ko || toolId;
        },

        getToolDescription(toolId) {
          const t = (this.toolsList || []).find(t => t.name === toolId);
          return t?.description || '';
        },

        // ‚îÄ‚îÄ SNS platform name mapping (#6) ‚îÄ‚îÄ
        getSNSPlatformName(platform) {
          const names = {
            'instagram': 'Instagram',
            'youtube': 'YouTube',
            'linkedin': 'LinkedIn',
            'tistory': 'Tistory',
            'naver_blog': 'ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏',
            'naver_cafe': 'ÎÑ§Ïù¥Î≤Ñ Ïπ¥Ìéò',
            'daum_cafe': 'Îã§Ïùå Ïπ¥Ìéò',
          };
          return names[platform] || platform;
        },

        scrollToBottom() {
          const el = this.$refs.chatArea;
          if (el) el.scrollTop = el.scrollHeight;
        },
      };
    }
  </script>
</body>
</html>
