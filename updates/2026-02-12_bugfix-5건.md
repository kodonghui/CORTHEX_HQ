# 버그 수정 5건 (2026-02-12)

## 개요

CORTHEX HQ 코드 분석 후 발견된 버그 5건을 수정했습니다.

---

## Bug 1. API 키 미설정 시 크래시 (Critical)

**파일:** `src/cli/app.py`

**증상:** API 키가 하나도 없어도 경고만 출력하고 실행을 계속함. 이후 LLM 호출 시 `NoneType` 에러로 크래시.

**수정:** 경고 메시지 출력 후 `raise SystemExit(1)`로 즉시 종료하도록 변경.

---

## Bug 2. JSON 파싱 실패 시 로그 누락 (Medium)

**파일:** `src/core/agent.py` — `_parse_plan_json()`

**증상:** LLM이 유효한 JSON을 반환하지 못했을 때, 에러 로그 없이 첫 번째 부하 에이전트에게 전체 응답을 그대로 넘김. 업무 분배 오류를 추적할 수 없었음.

**수정:** `logger.warning`으로 파싱 실패 원인과 응답 일부를 기록하도록 추가.

---

## Bug 3. 부하 에이전트 전원 실패 시 원인 불명 (Medium)

**파일:** `src/core/agent.py` — `_delegate_subtasks()`, `_synthesize_results()`

**증상:** 부하 에이전트가 전부 Exception으로 실패해도 "결과를 받지 못했습니다"만 반환. 실패 원인을 알 수 없었음.

**수정:**
- `_delegate_subtasks()`가 성공 결과와 에러 목록을 함께 반환하도록 변경
- `_synthesize_results()`에서 에러 목록을 포함한 상세 메시지 반환

---

## Bug 4. WebSocket 예외 시 연결 정리 누락 (Low)

**파일:** `web/app.py` — `websocket_endpoint()`

**증상:** `WebSocketDisconnect`만 catch하고 있어서, 다른 예외(`json.JSONDecodeError` 등) 발생 시 `ws_manager`에 죽은 연결이 남아있었음.

**수정:** `except Exception` 블록을 추가하여 모든 예외에서 `ws_manager.disconnect(ws)` 호출.

---

## Bug 5. 요약 모델 하드코딩 (Minor)

**파일:** `src/core/agent.py` — `_summarize()`

**증상:** 에이전트별로 모델 설정이 있음에도, 요약 시에는 무조건 `gpt-4o-mini`를 사용함.

**수정:** `"gpt-4o-mini"` → `self.config.model_name`으로 변경하여 에이전트 설정에 따른 모델 사용.

---

## 변경 파일

| 파일 | 변경 사항 |
|------|----------|
| `src/cli/app.py` | API 키 미설정 시 `SystemExit(1)` |
| `src/core/agent.py` | JSON 파싱 로깅, 에러 상세 반환, 모델 하드코딩 제거 |
| `web/app.py` | WebSocket 예외 처리 보완 |

## 커밋

- **브랜치:** `claude/test-parallel-coding-ObY3p`
- **커밋:** `e10e60a`
